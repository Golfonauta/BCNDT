window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initVenueMapsCode=function(){var e=Microsoft.Maps.Resources,i=window.Microsoft.Maps,c=i.Gimme,b=i.Globals,nt=i.Point,et=i.PixelReference,t=i.Events,k=i.LocationRect,o=i.Location,u=i.MapTypeId,h=i.LabelOverlay,s=i.Color,it=i.Polygon,ot=i.Infobox,ut=i.TileSource,tt=i.TileLayer,d=i.QuadKey,l=i.InternalNamespaceForDelay,v=l.Network,p=l.Quirks,rt=l.PRF,ft=Microsoft.Maps.InternalNamespaceForDelay.Debug,n={},r,y,a,f,w;n.VenueMapConstants={_strokeWeightNormal:"2",_strokeWeightHighlighted:"2",_log_FeatureName:"VenueMaps",_log_Action_LaunchVenueMap:"LaunchVenueMap",_log_Action_CloseVenueMap:"CloseVenueMap",_log_Action_SetFloor:"SetFloor",_log_Action_StoreClick:"StoreClick",_log_Action_FootprintClick:"FootprintClick",_log_Info_NullOrEmptyMetadata:"NullOrEmptyMetadata",_log_Info_InvalidMetadata:"InvalidMetadata",_log_Key_MapId:"mapId",_log_Key_MapType:"mapType",_log_Key_MapView:"mapView",_log_Key_Floor:"floor",_log_Key_YpId:"ypId",_log_Key_BusinessName:"businessName",_log_Key_TargetLod:"targetLod",viewHidden:"hidden",viewHalfImmersed:"halfImmersed",viewFullyImmersed:"fullyImmersed"},n.bind=function(n,t){return function(){return t.apply(n,arguments)}},n._callAsync=function(){var r=arguments[0],t,n,i;if(r){for(t=[],n=1,i=arguments.length;n<i;n++)t[n-1]=arguments[n];window.setTimeout(function(){r.apply(window,t)},1)}},n.addDOMElement=function(n,t,i,r,u){var f=document.createElement(n);return t&&(f.id=t),u&&f.appendChild(document.createTextNode(u)),i&&(f.className=i),r&&r.appendChild(f),f},n.measure=function(n){var t,i;if(!n)return{width:0,height:0};t={width:n.offsetWidth,height:n.offsetHeight};if(!t.width&&!t.height){var f=n.style.visibility,u=n.style.position,e=n.style.top,r=n.style.left;c(n).set_style("visibility","hidden").set_style("position","absolute").set_style("top","-1000px").set_style("left","-1000px"),i=!1,n.offsetParent||(document.body.appendChild(n),i=!0),t={width:n.offsetWidth,height:n.offsetHeight},i&&document.body.removeChild(n),c(n).set_style("visibility",f).set_style("position",u).set_style("top",e).set_style("left",r)}return t},n.is_in_DOM=function(n){var t=n;while(t!==null&&t!==document.body)t=t.parentNode;return t===document.body},n.guid=function(){function n(){return((1+Math.random())*65536|0).toString(16).substr(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},n.generateLinkToLSVPage=function(n){return b.streetsideBusinessSearchUriFormat.replace("{0}",n)+"&mkt="+b.locale},n.validateMetadata=function(n){var u,f,e,i,r,t;if(n&&n.Floors&&n.DefaultFloor&&n.Footprint&&n.MapId&&n.Floors[n.DefaultFloor]){u=n.Floors;for(f in u){e={key:f,value:u[f]},i=e.value;if(i&&i.Name&&i.Transform&&i.LodRange&&n.Floors[i.Name]){if(i.Primitives)for(t=0;t<i.Primitives.length;t++){r=i.Primitives[t];if(!i.Primitives[t].X||!i.Primitives[t].Y||i.Primitives[t].X.length<3||i.Primitives[t].Y.length<3||i.Primitives[t].X.length!==i.Primitives[t].Y.length)return!1;if(i.Primitives[t].YpId&&!i.Primitives[t].Name)return!1;if(r.Id&&r.Id>99999)return!1}}else return!1}if(n.Footprint.Polygons&&n.Footprint.Polygons.length){for(t=0;t<n.Footprint.Polygons.length;t++)if(!n.Footprint.Polygons[t].X||!n.Footprint.Polygons[t].Y||n.Footprint.Polygons[t].X.length<3||n.Footprint.Polygons[t].Y.length<3||n.Footprint.Polygons[t].X.length!==n.Footprint.Polygons[t].Y.length)return!1}else return!1;return!0}return!1},n.populateViewForStyle=function(t,i){switch(i){case n.VEMapStyle.road:default:t.mapTypeId=u.road;break;case n.VEMapStyle.auto:t.mapTypeId=u.auto;break;case n.VEMapStyle.aerial:t.mapTypeId=u.aerial,t.labelOverlay=h.hidden;break;case n.VEMapStyle.hybrid:t.mapTypeId=u.aerial,t.labelOverlay=h.visible;break;case n.VEMapStyle.birdsEye:t.mapTypeId=u.birdseye,t.labelOverlay=h.hidden;break;case n.VEMapStyle.birdsEyeHybrid:t.mapTypeId=u.birdseye,t.labelOverlay=h.visible;break;case n.VEMapStyle.collinsBart:t.mapTypeId=u.collinsBart;break;case n.VEMapStyle.ordnanceSurvey:t.mapTypeId=u.ordnanceSurvey}},n.getMapStyle=function(t,i){var r="\x00";switch(t){case u.road:default:r=n.VEMapStyle.road;break;case u.auto:r=n.VEMapStyle.auto;break;case u.aerial:r=i===h.visible?n.VEMapStyle.hybrid:n.VEMapStyle.aerial;break;case u.birdseye:r=i===h.visible?n.VEMapStyle.birdsEyeHybrid:n.VEMapStyle.birdsEye;break;case u.collinsBart:r=n.VEMapStyle.collinsBart;break;case u.ordnanceSurvey:r=n.VEMapStyle.ordnanceSurvey}return r},n.optimalZoom=function(n,t,i){var p=t.getNorth(),w=t.getSouth(),v=t.getEast(),y=t.getWest(),s=n.getRootElement().clientWidth,e=n.getRootElement().clientHeight,r=n.getTargetZoom(),u=n.tryLocationToPixel(new o(p,y)),f=n.tryLocationToPixel(new o(w,v));if(u&&f&&s&&e&&r){var c=Math.abs(u.y-f.y),h=Math.abs(f.x-u.x),a=r+Math.log(i*e/c)*Math.LOG2E,l=r+Math.log(i*s/h)*Math.LOG2E;return Math.round(Math.min(a,l))}return 17},n.Directory={},n.BreadcrumbEventNames={locked:"locked",unlocked:"unlocked",breadcrumbsChanged:"breadcrumbschanged",pathNodeClicked:"pathnodeclicked",closed:"closed",groupSelectedItemChanged:"groupselecteditemchanged"},n.BreadcrumbManager=function(n,t,i,r,u,f,e){this._map=n,this._bounds=f,this._buildingName=t,this._selectedFloor=i[0],this._zoom=u,this._center=r,this._halfImmersedRange=e,this._floors=i,this._isMultiFloor=i.length>1,this._isDisposed=!1,this._added=!1,this._breadcrumb=null,this._mapStyleChangedHandler=null,this._viewChangedHandler=null,this._closeButtonHandler=null,this._selectionChangedHandler=null,this._componentAddedHandler=null,this._nodeChangedHandler=null,this._showWhenLoaded=!1,this._isLocked=!1,this._init()},n.BreadcrumbManager.prototype={show:function(){this._breadcrumb?(this._updateBreadcrumb(),this._captureMapEvents()):this._showWhenLoaded=!0},hide:function(){this._removeVenueFromBreadcrumb(),this._uncaptureMapEvents()},_raiseEvent:function(n,i){t.invoke(this,n,i)},get__floor:function(){return this._selectedFloor},set__floor:function(n){return this._selectedFloor!==n&&(this._selectedFloor=n,this._breadcrumb&&this._added&&this._isMultiFloor&&this._breadcrumb.selectGroupItem("floor",this._selectedFloor)),n},_dispose:function(){this._uncaptureMapEvents(),this._removeVenueFromBreadcrumb();var n=this._componentAddedHandler;n&&(t.removeHandler(n),this._componentAddedHandler=null),this._breadcrumb=null,this._isDisposed=!0},_captureMapEvents:function(){this._viewChangedHandler||(this._viewChangedHandler=t.addHandler(this._map.getMap(),"viewchangeend",n.bind(this,this._onViewChanged))),this._mapStyleChangedHandler||(this._mapStyleChangedHandler=t.addHandler(this._map,"stylechanged",n.bind(this,this._onStyleChanged)))},_uncaptureMapEvents:function(){t.removeHandler(this._viewChangedHandler),t.removeHandler(this._mapStyleChangedHandler),this._viewChangedHandler=null,this._mapStyleChangedHandler=null},_init:function(){var r,i,f,u;if(this._isDisposed)return;r=this._map.get_Breadcrumb(),r?(i=this._componentAddedHandler,i&&(t.removeHandler(i),this._componentAddedHandler=null),this._breadcrumb=r,this._showWhenLoaded&&(this.show(),delete this._showWhenLoaded)):this._componentAddedHandler||(f=n.bind,u=this._map,this._componentAddedHandler=t.addHandler(u.getMap(),"componentadded",f(this,this._init)))},_attachEventHandlers:function(){this._breadcrumb&&(this._closeButtonHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.closed,n.bind(this,this._onCloseButtonClicked)),this._selectionChangedHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.groupSelectedItemChanged,n.bind(this,this._onSelectionChanged)),this._nodeChangedHandler=t.addHandler(this._breadcrumb,n.BreadcrumbEventNames.pathNodeClicked,n.bind(this,this._onBreadcrumbNodeChanged)))},_removeEventHandlers:function(){this._breadcrumb&&(t.removeHandler(this._closeButtonHandler),t.removeHandler(this._selectionChangedHandler),t.removeHandler(this._nodeChangedHandler))},_onBreadcrumbNodeChanged:function(n){var t=n;t.pathNodeLevel==="building"?this._map.SetView({center:this._center,zoom:this._zoom},!0):t.pathNodeLevel==="floor"&&(this._breadcrumb.highlightCrumb(null),this._updateHighlight())},_onCloseButtonClicked:function(n){this._breadcrumb&&this._removeVenueFromBreadcrumb(),this._raiseEvent("closed",n)},_onSelectionChanged:function(n){if(this._breadcrumb){this._breadcrumb.highlightCrumb(null),this._updateHighlight();var t=n;t.groupName==="floor"&&t.newItem!==this._selectedFloor&&(this._selectedFloor=t.newItem,this._raiseEvent("floorchanged",t))}},_onViewChanged:function(){this._updateBreadcrumb(),this._updateHighlight()},_onStyleChanged:function(){this._updateBreadcrumb()},_updateHighlight:function(){var n=this._map.GetTargetZoomLevel();n===this._zoom?this._breadcrumb.highlightCrumb("building"):n>this._zoom&&this._breadcrumb.highlightCrumb(null)},_updateBreadcrumb:function(){this._breadcrumb&&(this._map.IsMercator()?this._updateVisibility():this._removeVenueFromBreadcrumb())},_updateVisibility:function(){if(this._breadcrumb){var n=this._map.GetTargetZoomLevel();n<this._halfImmersedRange.get_from()||!this._bounds.intersects(this._map.GetBounds())?this._removeVenueFromBreadcrumb():n>this._halfImmersedRange.get_to()?(this._isLocked||(this._breadcrumb.lockToLocation(this._center),this._isLocked=!0),this._addVenueToBreadcrumb(),this._breadcrumb.setVisibility("building",!0),this._isMultiFloor&&this._breadcrumb.setVisibility("floor",!0),this._breadcrumb.showCloseButton()):(this._isLocked||(this._breadcrumb.lockToLocation(this._center),this._isLocked=!0),this._addVenueToBreadcrumb(),this._breadcrumb.setVisibility("building",!0),this._isMultiFloor&&this._breadcrumb.setVisibility("floor",!1),this._breadcrumb.hideCloseButton())}},_addVenueToBreadcrumb:function(){this._breadcrumb&&!this._added&&(this._breadcrumb.addCrumb("element","building",this._buildingName,null,!0),this._isMultiFloor&&this._breadcrumb.addCrumb("group","floor",this._selectedFloor,this._floors,!0),this._breadcrumb.showCloseButton(),this._attachEventHandlers(),this._added=!0)},_removeVenueFromBreadcrumb:function(){this._breadcrumb&&this._added&&(this._breadcrumb.removeCrumb("building"),this._isMultiFloor&&this._breadcrumb.removeCrumb("floor"),this._breadcrumb.hideCloseButton(),this._breadcrumb.unlockFromLocation(),this._removeEventHandlers(),this._isLocked=!1),this._added=!1}},n.DoubleRange=function(n,t){this._fromValue=n,this._toValue=t},n.DoubleRange.prototype={_fromValue:0,_toValue:0,get_to:function(){return this._toValue},get_from:function(){return this._fromValue},get_range:function(){return this.get_to()-this.get_from()}},n.LocationPolygon=function(n,t,i,r){for(var p=n.length,y=new Array(p),e=i[3]*n[0]+i[4]*t[0]+i[5],l=e,f=i[0]*n[0]+i[1]*t[0]+i[2],c=f,h,s,a,v,u=0;u<p;u++)h=i[0]*n[u]+i[1]*t[u]+i[2],s=i[3]*n[u]+i[4]*t[u]+i[5],y[u]=new o(s,h),e<s&&(e=s),l>s&&(l=s),f>h&&(f=h),c<h&&(c=h);a=new o((e+l)/2,(f+c)/2),v=new k(a,c-f,e-l),this.latLongs=y,this.center=a,this.boundingBox=v,this.optimalZoom=function(n){var s=r.getRootElement().clientWidth,h=r.getRootElement().clientHeight,u=r.getTargetZoom(),t=r.tryLocationToPixel(new o(e,f)),i=r.tryLocationToPixel(new o(l,c));if(t&&i&&s&&h&&u){var y=Math.abs(t.y-i.y),p=Math.abs(i.x-t.x),a=u+Math.log(n*h/y)*Math.LOG2E,v=u+Math.log(n*s/p)*Math.LOG2E;return Math.round(Math.min(a,v))}return 18}},n.MapController=function(n){this._map=n,this._shapes={},this._layers={},this._mapEntities={},this._registerEvents()},n.MapController.prototype={_map:null,_layers:null,_shapes:null,_zoomAwareLines:null,_isDisposed:!1,_offscreenPoint:new nt(-1e4,-1e4),getMap:function(){return this._map},IsMercator:function(){return this._map.isMercator()},GetBounds:function(){return this._map.getBounds()},get_Breadcrumb:function(){return this._map.getComponent("breadcrumb")},GetMapStyle:function(){var r=this._map.getMapTypeId(),i=this._map.getOptions(),t=i.labelOverlay;return n.getMapStyle(r,t)},SetMapStyle:function(t){if(t!==this.GetMapStyle()){var i={};n.populateViewForStyle(i,t),this._map.setView(i)}},SetView:function(n){this._map.setView(n)},GetMapWidth:function(){return this._map.getWidth()},GetMapHeight:function(){return this._map.getHeight()},GetTargetZoomLevel:function(){return this._map.getTargetZoom()},AddLayer:function(n,t){this._layers[n]||(t.layerId=n,this._map.entities.push(t),this._layers[n]=t)},RemoveLayer:function(n){this._layers[n]&&(this._map.entities.remove(this._layers[n]),delete this._layers[n])},GetShape:function(n){return this._shapes[n]},AddShapeById:function(n,t){this._addShape(n,t),this._shapes[n]=t},RemoveShapeById:function(n){if(n){var t=this.GetShape(n);t&&t.eroController&&t.eroController.detachFromShape(),this._removeShape(n),delete this._shapes[n]}},_mapEntities:null,_addShape:function(n,t){this._removeShape(n);var i=this._map.entities;i.push(t),this._mapEntities[n]=t},_removeShape:function(n){var i=this._mapEntities[n],t;i&&(t=i.parentCollection,t||(t=this._map.entities),t.remove(i),delete this._mapEntities[n])},get_MapContainer:function(){return this._map?this._map.getRootElement():null},AddPolygon:function(n,t,i,r,u){var f=this._addPolygon2(n,t,i,r,u);return this._shapes[n]=f,f},_addPolygon2:function(n,t,i,r,u){this._removeShape(n);var f=new it(t,{strokeThickness:i,strokeColor:r,fillColor:u}),e=this._map.entities;return e.push(f),this._mapEntities[n]=f,f},_viewChangeEndHandler:null,_imageryChangedHandler:null,_registerEvents:function(){this._viewChangeEndHandler||(this._viewChangeEndHandler=t.addHandler(this._map,"targetviewchanged",n.bind(this,this._map_ViewChanged))),this._imageryChangedHandler||(this._imageryChangedHandler=t.addHandler(this._map,"imagerychanged",n.bind(this,this._map_ImageryChanged)))},dispose:function(){if(this._isDisposed)return;this._unregisterEvents(),this._isDisposed=!0},_unregisterEvents:function(){this._viewChangeEndHandler&&(t.removeHandler(this._viewChangeEndHandler),this._viewChangeEndHandler=null),this._imageryChangedHandler&&(t.removeHandler(this._imageryChangedHandler),this._imageryChangedHandler=null)},_raiseEvent:function(n,i){t.invoke(this,n,i)},_map_ViewChanged:function(){this._raiseEvent("viewchanged",new n.MapControllerEventArgs)},_map_ImageryChanged:function(){this._raiseEvent("stylechanged",new n.MapControllerEventArgs)}},n.MapControllerEventArgs=function(n){this._keyCode=n},n.MapControllerEventArgs.prototype={_keyCode:0,get_key:function(){return this._keyCode}},n.MultiscaleTileSource=function(n,t){this._tileWidth=n,this._tileHeight=t},n.MultiscaleTileSource.prototype={_tileWidth:0,_tileHeight:0,get__tileWidth:function(){return this._tileWidth},get__tileHeight:function(){return this._tileHeight},isSame:function(n){return this.get__tileWidth()===n.get__tileWidth()&&this.get__tileHeight()===n.get__tileHeight()&&this.get_uriFormat()===n.get_uriFormat()&&this.get_numberOfTileServers()===n.get_numberOfTileServers()},createTileSource:function(){return new ut({width:this.get__tileWidth(),height:this.get__tileHeight(),uriFormat:this.get_uriFormat().replace("{{","{").replace("}}","}"),uriConstructor:n.bind(this,this.getTileUri)})}},n.MercatorModeTileSource=function(t){n.MultiscaleTileSource.apply(this,[n.MercatorModeTileSource._defaultTileSize$1,n.MercatorModeTileSource._defaultTileSize$1]),this._format$1=t,this._numberOfTileServers$1=i.Globals.venueMapsNumberOfMapTileServers||0;var u=i.Globals.venueMapsTileServerSubdomainsX||"",r=i.Globals.venueMapsTileServerSubdomainsY||"";this._subdomains$1=[u.split(","),r.split(",")],n.MercatorModeTileSource._xLength$1=this._subdomains$1.length,n.MercatorModeTileSource._yLength$1=this._subdomains$1[0].length},n.MercatorModeTileSource.prototype=new n.MultiscaleTileSource(0,0),r=n.MercatorModeTileSource.prototype,r._format$1="",r._numberOfTileServers$1=0,r._hasZoomRange$1=!1,r._minZoom$1=0,r._maxZoom$1=0,r.get_tileServerCount=function(){return this._numberOfTileServers$1},r._subdomains$1=null,r.get_hasZoomRange=function(){return this._hasZoomRange$1},r.set_hasZoomRange=function(n){return this._hasZoomRange$1=n,n},r.get_minZoom=function(){return this._minZoom$1},r.set_minZoom=function(n){return this._minZoom$1=n,n},r.get_maxZoom=function(){return this._maxZoom$1},r.set_maxZoom=function(n){return this._maxZoom$1=n,n},r.getTileUri=function(n){return this.get_hasZoomRange()&&(n.levelOfDetail<this.get_minZoom()||n.levelOfDetail>this.get_maxZoom())?null:this.getTileUriFromFormat(n,this.get_uriFormat())},r.getTileUriFromFormat=function(n,t){var u=null,i=d.fromTileId(n),r;return this.get_numberOfTileServers()===4?(r=i.charAt(i.length-1),u=t.replace("{{quadkey}}",i).replace("{{subdomain}}",(r%this.get_tileServerCount()).toString())):(r=this.tileCoordinatesToSubdomainNumber(n.x,n.y),u=t.replace("{{quadkey}}",i).replace("{{subdomain}}",r)),u},r.tileCoordinatesToSubdomainNumber=function(t,i){return this._subdomains$1[t%n.MercatorModeTileSource._xLength$1][i%n.MercatorModeTileSource._yLength$1]},r.get_uriFormat=function(){return this._format$1},r.set_uriFormat=function(n){return this._format$1=n,n},r.get_numberOfTileServers=function(){return this._numberOfTileServers$1},r.set_numberOfTileServers=function(n){return this._numberOfTileServers$1=n,n},y=n.MercatorModeTileSource,y._defaultTileSize$1=256,y._xLength$1=0,y._yLength$1=0,n.MapCruncherTileSource=function(t,i,r){n.MercatorModeTileSource.apply(this,[t]),this._bounds$2=i,this._lodRange$2=r,this.set_hasZoomRange(!1)},n.MapCruncherTileSource.prototype=new n.MercatorModeTileSource(""),a=n.MapCruncherTileSource.prototype,a._bounds$2=null,a._lodRange$2=null,a.getTileUri=function(t){var i="";return this._tileIsInBounds$2(t.x,t.y,t.levelOfDetail)&&(i=n.MercatorModeTileSource.prototype.getTileUri.apply(this,[t])),i},a._tileIsInBounds$2=function(t,i,r){if(!this._bounds$2)return!0;if(this._lodRange$2)if(!(this._lodRange$2.get_from()<=r&&this._lodRange$2.get_to()>=r))return!1;var u=n.TileSystem._tileXYToPixelXY(t,i),f={x:u.x+255,y:u.y+255},s=n.TileSystem.pixelXYToLatLong(u.x,u.y,r),o=n.TileSystem.pixelXYToLatLong(f.x,f.y,r),e=k.fromCorners(s,o);return e.intersects(this._bounds$2)},n.MetadataRequest=function(n){n.timeout||(n.timeout=6e3),n.metadataUriFormat||(n.metadataUriFormat="http://bing.com/maps/VenueMapMetadata.ashx?id={0}"),this._options=n},n.MetadataRequest.prototype={options:function(){return this._options},metadata:function(){return this._data},timedOut:function(){return this._timeout},execute:function(){var t=this._options.metadataUriFormat.replace("{0}",this._options.venueMapId);p.useXHR||(t+="&jsonp=microsoftMapsNetworkCallback&jsonso={jsono}"),v.getObjectAsync(t,n.bind(this,this._onWebRequestCompleted),null,this._options.timeout)},_onWebRequestCompleted:function(n,t){this._timeout=!t.success;if(t.success&&n)try{this._data=n}catch(i){}else this._data=null;this._options.callback&&this._options.callback(this)}},n.TileSystem=function(){},f=n.TileSystem,f._clip=function(n,t,i){return Math.min(Math.max(n,t),i)},f._mapSize=function(n){return 256<<n},f.pixelXYToLatLong=function(t,i,r){var u=n.TileSystem._mapSize(r),e=n.TileSystem._clip(t,0,u-1)/u-.5,f=.5-n.TileSystem._clip(i,0,u-1)/u;return new o(90-360*Math.atan(Math.exp(-f*2*Math.PI))/Math.PI,360*e)},f._tileXYToPixelXY=function(n,t){return{x:n*256,y:t*256}},f._earthRadius=6378137,f._minLatitude=-85.05112878,f._maxLatitude=85.05112878,f._minLongitude=-180,f._maxLongitude=180,n.ToolTipHelper=function(t){var r=t,u=0,i=document.createElement("div");i.style.cssText="position:absolute;display:block;visibility:hidden;border:solid 1px black;padding:4px;background-color:#FFFFE0;z-index:20;white-space:nowrap;font-family:sans-serif",r.get_MapContainer().appendChild(i);var f=20,o=function(n){var i=r.GetMapWidth(),t=n+f;return t<0&&(t=0),t+u>i&&(t-=t+u-i),t},e=function(n){var i=r.GetMapHeight(),t=n+f;return t<0?t=0:t+40>i&&(t-=t+40-i),t};this.turnOff=function(){i.style.visibility="hidden"},this.turnOn=function(){i.innerHTML&&(i.style.visibility="visible")},this.setPosition=function(n,t){i.style.top=e(n)+"px",i.style.left=o(t)+"px"},this.updateContent=function(t){t?(i.style.zIndex=1e4,i.innerHTML=t,u=n.measure(i).width+10):i.innerHTML=""}},n.VEMapStyle={auto:"u",road:"r",aerial:"a",hybrid:"h",birdsEye:"o",birdsEyeHybrid:"b",collinsBart:"c",ordnanceSurvey:"s"},n.VenueMap=function(r){function gi(){ht||(ht=t.addHandler(c,"viewchanged",ar)),ct||(ct=t.addHandler(c,"stylechanged",or))}function nr(){t.removeHandler(ht),t.removeHandler(ct),ht=null,ct=null}function tr(){l&&(l.hide(),t.removeHandler(ti),t.removeHandler(ii),l._dispose(),l=null)}function cr(){var r,i,f;if(!l){for(r=[],i=0;i<ut.length;i++)f=ut[i],r.push(f.name);l=new n.BreadcrumbManager(c,u.name,r,w.center,w.zoom,st,new n.DoubleRange(dt.zoom,w.zoom-1)),s&&l.set__floor(s.name),ti=t.addHandler(l,"floorchanged",sr),ii=t.addHandler(l,"closed",bi),l.show()}}function lr(){if(ni)return;u.popupHelper.dispose(),u.minipopupHelper.hide();var n=u.id;b=null,s=null,bt(),a&&(a.dispose(),a=null),y&&(t.removeHandler(ur),y.dispose(),y=null),c&&(c.dispose(),c=null),u.directory&&(u.directory.removeFromDOM(),u.directory=null),nt&&vt(null),ni=!0}function vt(n){var i=tt.activeVenueMap;i!==n&&(tt.activeVenueMap=n,i&&i.detachFromBreadcrumb(),n&&n.attachToBreadcrumb(),t.invoke(v,"activevenuemapchanged",{oldVenueMap:i,newVenueMap:n}))}function ar(){d()}function hr(n){if(b&&b[n]){var t=b[n];t.highlight()}}function er(n){if(b&&b[n]){var t=b[n];t.unhighlight()}}function or(){d()}function sr(n){var i=n,t=i.newItem;t!==s.name&&(wt(t),d()),u.unselect()}function si(){var n=c.GetMapStyle(),t;n!=="r"&&n!=="a"&&n!=="h"&&(t="r",n==="o"?t="a":n==="b"&&(t="h"),c.SetMapStyle(t))}function gt(n){wt(n),d(),s&&l&&l.set__floor(s.name)}function hi(){var n=null;return s&&(n=s.name),n}function li(n){for(var r=n.toLowerCase(),i,t=0;t<u.floors.length;t++){i=u.floors[t];if(i.name.toLowerCase()===r)return i}throw Error.argument("floor","the given floor "+n+" does not exist");}function wt(r){var d,w,y,v,o,l,e;if(!r)throw Error.argumentNull("floor");if(s&&s.name===r)return;d=s&&s.name,s=li(r),u.popupHelper.hidePopup(),bt(),a&&a.dispose(),w=rt.replace("{0}",u.id).replace("{1}",s.name);if(f.MaxLatitude){var nt=f.MaxLatitude,g=f.MinLatitude,tt=f.MinLongitude,it=f.MaxLongitude;y=i.LocationRect.fromEdges(nt,tt,g,it)}else y=st;a=new n.VenueMapTileLayer("VenueMapTileLayer",c,w,y,new n.DoubleRange(s.zoomRange[0],s.zoomRange[1])),v=[];if(p.isShapeEventsSupported())for(o=0;o<s.primitives.length;o++)l=s.primitives[o],l.name&&(e=b[l.id],k.push(t.addHandler(e,"click",di)),k.push(t.addHandler(e,"mouseover",ki)),k.push(t.addHandler(e,"mouseout",vi)),v.push(e));h=v,t.invoke(u,"floorchanged",{oldFloor:d,newFloor:r})}function fi(){nt||(nt=!0,si(),s||gt(u.defaultFloor),d(),gi()),vt(u)}function ei(){nt&&(nt=!1,u.popupHelper.hidePopup(),d(),nr(),vt(null))}function bi(){t.invoke(u,"close",null),u.dispose()}function wi(n){c.SetView(w,!0),t.invoke(u,"footprintclick",n)}function di(n){t.hasHandler(u,"click")?t.invoke(u,"click",n):u.handleMouseClick(n)}function ki(n){t.hasHandler(u,"mouseover")?t.invoke(u,"mouseover",n):u.handleMouseOver(n)}function vi(n){t.hasHandler(u,"mouseout")?t.invoke(u,"mouseout",n):u.handleMouseOut(n)}function ai(){return et}function d(){var e=c.GetTargetZoomLevel(),r,i,f;if(e>=dt.zoom&&c.IsMercator()&&nt)if(e<w.zoom){a&&a.hide(),y&&y.show();if(h)for(i=0;i<h.length;i++)h[i].hide();u.popupHelper.hidePopup(),u.minipopupHelper.hide(),r=n.VenueMapConstants.viewHalfImmersed}else{a&&a.show(),y&&y.hide();if(h)for(i=0;i<h.length;i++)h[i].show();r=n.VenueMapConstants.viewFullyImmersed}else{a&&a.hide(),y&&y.hide();if(h)for(i=0;i<h.length;i++)h[i].hide();u.popupHelper.hidePopup(),u.minipopupHelper.hide(),r=n.VenueMapConstants.viewHidden}r!==et&&(f=et,et=r,t.invoke(u,"viewchanged",{newView:r,oldView:f}))}function bt(){for(var n=0;n<k.length;n++)t.removeHandler(k[n]);k=[];if(h)for(n=0;n<h.length;n++)h[n].hide();h=null}var u=this,v=r.map,nt=!1,tt=v.getComponent("venueMaps"),ft,ut,yt;tt||(tt={activeVenueMap:null},v.addComponent("venueMaps",tt));var f=r.metadata,at=0,yi=n.guid(),it=null,c=new n.MapController(v),b={},et=n.VenueMapConstants.viewHidden,ot=0,rt=f.TileUriFormat,ri=function(t,i,r,u){var f=new n.LocationPolygon(t,i,r,v);u.center=f.center,u.bounds=f.boundingBox,u.optimalZoom=f.optimalZoom,u.locations=f.latLongs},pi=function(n,t){var r={},u=n.Polygons,i,t;for(r.polygons=[],i=0;i<u.length;i++)t={},ri(u[i].X,u[i].Y,n.Transform,t),r.polygons[i]=t;return r.zoomRange=n.LodRange,r},ci=function(n,t){var i={};return n.Id&&n.Id>0?i.id=n.Id+ot*1e5:(i.id=at.toString(),at--),ri(n.X,n.Y,t,i),i.businessId=n.YpId,i.name=n.Name,n.CatId?(i.categoryId=n.CatId,i.categoryName=n.CatName):(i.categoryId=yi,i.categoryName=e.getString("L_VenueMaps_Other_Text")),i.description=n.Description,i},oi=function(t){var f=t,r={},o,s,u,i,e;r.name=f.Name,r.zoomRange=f.LodRange,r.primitives=[];if(f.Primitives)for(o=f.Primitives,s=f.Transform,u=0;u<o.length;u++)i=ci(o[u],s),i.floor=r,e=new n.VenueMapPolygon(i,c),b[i.id]=e,i.highlight=e.highlight,i.unhighlight=e.unhighlight,r.primitives[u]=i;return r};rt||(rt=r.tileUriFormat,rt||(rt="http://embedmap.blob.core.windows.net/{0}/{1}/{{quadkey}}.png"));var ht=null,ct=null,ti=null,ii=null,st=null,a=null,h=null,s=null,l=null,ni=!1,lt=pi(f.Footprint),ir=new n.DoubleRange(13,15),fr=18,rr=16,ui=17,vr=.9,k=[],pt=[];for(ft=0;ft<lt.polygons.length;ft++)pt=pt.concat(lt.polygons[ft].locations);var st=i.LocationRect.fromLocations(pt),kt=n.optimalZoom(v,st,.8),y=new n.VenueMapFootprint(c,lt,e.getString("L_VenueMaps_ToolTip_Text").replace("{0}",f.Name)),ur=t.addHandler(y,"click",wi),w={center:st.center,zoom:Math.max(Math.min(kt,fr),rr)},dt={center:w.center,zoom:Math.max(Math.min(kt-1,ir.get_from()),0)};this.baseMap=v,this.supportedProjections=["r","a","h"],this.popupHelper=new n.PopupHelper(v),this.minipopupHelper=new n.MiniPopupHelper(this),this.directory=new n.Directory(this),this.name=f.Name,this.address=f.Address,this.phoneNumber=f.PhoneNumber,this.id=f.MapId,this.defaultFloor=f.DefaultFloor,this.type=f.MapType,this.floorHeader=f.FloorHeader,this.businessId=f.YpId,this.center=new o(f.CenterLatitude,f.CenterLongitude),this.footprint=lt,this.socialIds=f.SocialIds,ut=[];for(yt in f.Floors)f.Floors.hasOwnProperty(yt)&&(ut[ot]=oi(f.Floors[yt]),++ot);delete ot,delete at,this.floors=ut,this.bestMapView=w.zoom<ui?{center:w.center,zoom:ui}:w,this.minimumZoomForTileLayer=w.zoom,this.setBestMapView=function(n,t,i,r){t||(t=.1);var u=n.optimalZoom(t);i&&(u=Math.max(u,i)),r&&(u=Math.min(u,r)),v.setView({center:n.center,zoom:u,animate:!0})},this.select=function(n){u.unselect(),n&&u.highlight(n.id),it=n},this.unselect=function(){it&&u.unhighlight(it.id),it=null},this.handleMouseOver=function(n){u.popupHelper.fetchPopupData(n),u.minipopupHelper.show(n),u.highlight(n.id);var t=document.getElementById(n.id);t&&g(t).add_class("dtrHighlighted")},this.handleMouseOut=function(n){n!==it&&u.unhighlight(n.id);var t=document.getElementById(n.id);t&&g(t).remove_class("dtrHighlighted"),u.minipopupHelper.hide()},this.handleMouseClick=function(n){u.select(n),u.popupHelper.showPopup(n),u.minipopupHelper.hide(),u.directory.select(n);var t=n.optimalZoom(.1);t>v.getZoom()&&v.setView({center:n.center,zoom:t,animate:!0})},this.detachFromBreadcrumb=tr,this.attachToBreadcrumb=cr,this.dispose=lr,this.highlight=hr,this.unhighlight=er,this.setActiveFloor=gt,this.getActiveFloor=hi,this.show=fi,this.hide=ei,this.getActiveView=ai},n.VenueMapFootprint=function(i,r,u){function ut(){t.removeHandler(e),e=null,c(i.get_MapContainer()).set_style("cursor",s);for(var r=0;r<f.length;r++)f[r].setOptions({strokeColor:g,strokeWeight:b,fillColor:d});h.turnOff()}function nt(n){var u,r;for(h.turnOn(),e=t.addHandler(i.getMap(),"mousemove",tt),u=n,it(),r=0;r<f.length;r++)f[r].setOptions({strokeWeight:ft,strokeColor:st,fillColor:et})}function it(){var n=c(i.get_MapContainer());s=n.get_style("cursor"),s==="pointer"&&(s="default"),n.set_style("cursor","pointer")}function tt(n){var t=i.getMap(),u=t.getWidth()/2+n.getX(),r=t.getHeight()/2+n.getY();h.setPosition(r,u)}function rt(n){t.invoke(ot,"click",n)}for(var ot=this,b=n.VenueMapConstants._strokeWeightNormal,ft=n.VenueMapConstants._strokeWeightHighlighted,g=n.VenueMapFootprint.footprintStrokeNormal,st=n.VenueMapFootprint.footprintStrokeHighlighted,d=n.VenueMapFootprint.footprintFillNormal,et=n.VenueMapFootprint.footprintFillHighlighted,v=r.polygons,o=v.length,y=new Array(o),s="default",f=new Array(o),l,e,a=0;a<o;a++)y[a]=n.guid();try{s=c(i.get_MapContainer()).get_style("cursor")}catch(ht){s="default"}var w=new Array(o),k=new Array(o),p=new Array(o),h=new n.ToolTipHelper(i);h.updateContent(u),l=!1,e=null,this.dispose=function(){this.hide()},this.show=function(){if(!l){for(var n=0;n<v.length;n++)f[n]=i.AddPolygon(y[n],v[n].locations,b,g,d),w[n]=t.addHandler(f[n],"mouseover",nt),k[n]=t.addHandler(f[n],"mouseout",ut),p[n]=t.addHandler(f[n],"click",rt);l=!0}},this.hide=function(){if(l){for(var n=0;n<v.length;n++)t.removeHandler(k[n]),t.removeHandler(w[n]),t.removeHandler(p[n]),i.RemoveShapeById(y[n]);e&&(t.removeHandler(e),e=null),h.turnOff()}l=!1}},n.VenueMapFootprint.footprintFillNormal=new s(51,0,0,255),n.VenueMapFootprint.footprintFillHighlighted=new s(51,0,0,255),n.VenueMapFootprint.footprintStrokeNormal=new s(154,255,255,255),n.VenueMapFootprint.footprintStrokeHighlighted=new s(255,0,0,0),n.VenueMapFootprint._lineStyle="solid",n.VenueMapFootprint._lineJoinMode="round",w={},i.VenueMaps=w,w.VenueMapFactory=function(t){var r=t.getComponent("venueMaps");r||(r={activeVenueMap:null},t.addComponent("venueMaps",r)),this.getActiveVenueMap=function(){return r.activeVenueMap},this.create=function(r){var h=function(n,t){return(t==="prod"||t==="dev"||t==="staging")&&(n=n+"&venuemapenv="+t),n},c=function(n,t){t&&(t==="prod"||t==="dev"||t==="staging")||(t="default");var r=new RegExp(t+"=([^;]*)"),i=n.match(r);return i&&(i=i[1]),i||(i=n),i},s=function(n){callback=r.success,callback&&callback(n,r)},f=function(n){callback=r.error,callback&&callback(n,r)},u=r.metadataUriFormat,e,o;u||(u=h(i.Globals.venueMapsMetadataJsonpUrl,r.environment)),e=c(i.Globals.venueMapsTileUrl,r.environment),o=new n.MetadataRequest({venueMapId:r.venueMapId,metadataUriFormat:u,timeout:3e4,callback:function(i){var c=r.venueMapId,h=i.options().venueMapId,u,o;c===h&&(u=i.metadata(),o=i.timedOut(),o?f(3):u?n.validateMetadata(u)?s(new n.VenueMap({map:t,metadata:u,tileUriFormat:e})):f(2):f(1))}}),o.execute()},this.getNearbyVenues=function(r){var u=r.callback,f=r.location,e=r.radius;u&&(f&&e?t.getCredentials(function(t){if(t){var o=i.Globals.venueMapsNearbyUrl.replace("{location}",f.latitude+","+f.longitude).replace("{radius}",e).replace("{credentials}",t);v.getObjectAsync(o,function(t){n._callAsync(u,t,r)})}else n._callAsync(u,null,r)}):n._callAsync(u,null,r))}},n.VenueMapPolygon=function(i,r){var v=this,p=n.VenueMapConstants._strokeWeightNormal,nt=n.VenueMapConstants._strokeWeightHighlighted,a=n.VenueMapPolygon.polygonStrokeNormal,d=n.VenueMapPolygon.polygonStrokeHighlighted,y=n.VenueMapPolygon.polygonFillNormal,g=n.VenueMapPolygon.polygonFillHighlighted,l=p,e=a,o=y,f=!1,c=i.id,h=r,s=i,rt=i.locations,u=null,b=null,k=null,w=null;h.RemoveShapeById(c);var ut=function(){t.invoke(v,"mouseout",s)},tt=function(){t.invoke(v,"mouseover",s)},it=function(){t.invoke(v,"click",s)};this.show=function(){f||(u=h.AddPolygon(c,rt,l,e,o),b=t.addHandler(u,"mouseover",tt),k=t.addHandler(u,"mouseout",ut),w=t.addHandler(u,"click",it),f=!0)},this.hide=function(){f&&(h.RemoveShapeById(c),t.removeHandler(b),t.removeHandler(k),t.removeHandler(w),f=!1)},this.highlight=function(){l=nt,e=d,o=g,u&&u.setOptions({strokeWeight:nt,strokeColor:d,fillColor:g})},this.unhighlight=function(){l=p,e=a,o=y,u&&u.setOptions({strokeWeight:p,strokeColor:a,fillColor:y})}},n.VenueMapPolygon.polygonStrokeNormal=new s(0,158,185,184),n.VenueMapPolygon.polygonStrokeHighlighted=new s(255,0,0,0),n.VenueMapPolygon.polygonFillNormal=new s(0,191,215,217),n.VenueMapPolygon.polygonFillHighlighted=new s(0,236,246,247),n.VenueMapPolygon._lineStyle="solid",n.VenueMapPolygon._lineJoinMode="round",n.VenueMapTileLayer=function(t,i,r,u,f){this._map=i,this._layerId=t,this._tileSource=new n.MapCruncherTileSource(r,u,f),this._layer=new tt({zIndex:n.VenueMapTileLayer.tileLayerZIndex,mercator:this._tileSource.createTileSource()})},n.VenueMapTileLayer.prototype={show:function(){this._added||(this._map.AddLayer(this._layerId,this._layer),this._added=!0)},hide:function(){this._added&&(this._map.RemoveLayer(this._layerId),this._added=!1)},dispose:function(){this.hide()}},n.VenueMapTileLayer.tileLayerZIndex=2,n.PopupHelper=function(t){function s(){e&&(e=!1,t.entities.remove(f))}function c(n){if(n&&n.SearchResponse&&n.SearchResponse.Query&&n.SearchResponse.Query.SearchTerms)var t=n.SearchResponse.Query.SearchTerms;else return;r[t].json=n,r[t].hasCompleted=!0,o()}function o(){var i;if(u){var h=u,s=r[h].json,o=r[h].primitive,c={id:u,visible:!0,showPointer:!0,zIndex:3,title:o.name,description:o.description?"":"No information available."};o.businessId&&(c.titleClickHandler=function(t){window.open(n.generateLinkToLSVPage(o.businessId)),t.preventDefault()}),s.SearchResponse&&s.SearchResponse.Phonebook&&s.SearchResponse.Phonebook.Results&&(i=s.SearchResponse.Phonebook.Results[0],i&&(c.description=i.Address+", "+i.City+", "+i.StateOrProvince+" "+i.PostalCode+"<br>"+i.PhoneNumber)),f.setLocation(r[h].primitive.center),f.setOptions(c),e||(e=!0,t.entities.push(f)),u=null}}var r={},f=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{title:"My Pushpin"}),e=!1,u=null,h=function(n){var t=n.businessId,e=n.center.latitude,o=n.center.longitude,f;if(t){if(r[t]&&r[t].hasCompleted)return;var s=i.Globals.venueMapsEroServiceAppId,h=i.Globals.venueMapsEroServiceUrl,u="microsoftMapsVenueMapsPhonebookCallback";window[u]=function(n){c(n)},f=h.replace("{ypid}",t).replace("{query}",t).replace("{appid}",s).replace("{latitude}",e).replace("{longitude}",o).replace("{jsonp}",u).replace("{jsonso}",t),r[t]={},r[t].primitive=n,r[t].hasCompleted=!1,p.useXHR?v.getObjectAsyncCacheFriendly(f,window[u],t):v.getObjectAsyncCacheFriendly(f)}};this.fetchPopupData=h,this.showPopup=function(t){var i=t.businessId;i||(i=n.guid(),r[i]={hasCompleted:!0,primitive:t,json:{searchResponse:null}}),u=i,r[i]?r[i].hasCompleted&&o():h(t)},this.hidePopup=s,this.dispose=function(){s()}},n.MiniPopupHelper=function(n){function e(t){return t.floor.name==n.getActiveFloor()?f(t):!1}function f(n){var c=n.bounds.center.latitude-n.bounds.height/2,h=n.bounds.center.latitude+n.bounds.height/2,y=n.bounds.center.longitude-n.bounds.width/2,v=n.bounds.center.longitude+n.bounds.width/2,a=new Microsoft.Maps.Location(c,y),l=new Microsoft.Maps.Location(h,v),u=t.tryLocationToPixel(a),r=t.tryLocationToPixel(l);if(u&&r){var o=t.getWidth(),f=t.getHeight(),e={x:-o/2+i.left,y:-f/2+i.top},s={x:o/2-i.right,y:f/2-i.bottom};return!(u.x>s.x||u.y>s.y||r.x<e.x||r.y<e.y)}return!1}var t=n.baseMap,u=new Microsoft.Maps.Infobox(new Microsoft.Maps.Location(0,0),{title:""}),r=!1,i={top:10,bottom:10,left:10,right:10};this.show=function(n){if(e(n)){var i={visible:!0,showPointer:!1,showCloseButton:!1,zIndex:2,title:n.name,height:50,width:150};u.setLocation(n.center),u.setOptions(i),r||(r=!0,t.entities.push(u))}},this.hide=function(){r&&(t.entities.remove(u),r=!1)}},n.Directory=function(i){function oi(){var h,t,v,r;if(!vt){b=n.Directory.PrimitiveHelper.buildArray(i),s=new n.Directory.Renderer(i),u=document.createElement("div"),u.id="venuedirectory",o=n.addDOMElement("div","venuedirectory_div1",null,u,null),i.businessId?(h=n.addDOMElement("div","venuetitle","contactcardtitle",o,null),t=n.addDOMElement("a","venuetitleanchor",null,h,i.name),t.href=n.generateLinkToLSVPage(i.businessId),t.target="_blank"):n.addDOMElement("div","venuetitle","contactcardtitle",o,i.name),n.addDOMElement("div","address",null,o,i.address),v=n.addDOMElement("div","Phoneandyplinks","Phoneandyplinks",o,null),n.addDOMElement("div","directory","headingtext",o,e.getString("L_VenueMaps_Directory_Text")),ut=n.addDOMElement("div","categoriestogglebutton","categoriesbutton",o,null),g(ut).add_event("click",hi);var a=n.addDOMElement("div",null,"columnheadertable",o,null),c=n.addDOMElement("table",null,null,a,null),y=n.addDOMElement("tbody",null,null,c,""),f=n.addDOMElement("tr",null,null,y,null),l=n.addDOMElement("td",null,"venuecolumn",f,null);st=n.addDOMElement("span","sortalphabutton",null,l,e.getString("L_VenueMaps_SortByAlpha_Text")),r=n.addDOMElement("td",null,"levelcolumn",f,null),ot=n.addDOMElement("span","sortfloorbutton",null,r,e.getString("L_VenueMaps_SortByLevel_Text")),g(st).add_event("click",fi),g(ot).add_event("click",pi),it=n.addDOMElement("div","venuedirectory_div2",null,u,null),d=n.addDOMElement("div",null,null,it,null),vt=!0}}function ri(i,f,o){i&&vt&&!n.is_in_DOM(u)&&(k=i,h=f,l=o,et(nt()),ut.innerHTML=l===w.none?e.getString("L_VenueMaps_ShowCategories_Text"):e.getString("L_VenueMaps_HideCategories_Text"),h==c.alphabetical?(st.className="sortselected",ot.className="sortnormal"):(st.className="sortnormal",ot.className="sortselected"),k.appendChild(u),g(window.self).add_event("resize",ni),kt=t.addHandler(s,"click",si),at=t.addHandler(s,"mouseout",vi),ht=t.addHandler(s,"mouseover",yi),r&&ti(r))}function ai(){u&&u.parentNode&&(u.parentNode.removeChild(u),g(window.self).remove_event("resize",ni),t.removeHandler(kt),t.removeHandler(at),t.removeHandler(ht),kt=null,at=null,ht=null,r=null)}function li(n){if(!n||n<=0)return;n<100?(p=n,rt=null):(rt=n,p=null),dt()}function ti(n){if(n&&n.id)a(),y(n);else throw{name:"InvalidArgumentException",message:""};}function a(){if(r){var n=document.getElementById(r.id);n&&g(n).remove_class("dtrSelected")}r=null}function y(n){var t=document.getElementById(n.id);t&&(ci(t)||t.scrollIntoView(),g(t).add_class("dtrSelected")),r=n}function ci(n){if(k){var i=g(k).get_absolute_pos().y,u=i+k.offsetHeight,o=g(n),t=o.get_absolute_pos().y,r=t+n.offsetHeight,e=t>=i&&t<=u,f=r>=i&&r<=u;return e&&f}return!1}function dt(){var t,r,n;if(!rt&&!p)return;t=p?p*i.baseMap.getHeight():rt,r=o.offsetHeight,n=t-r,n>0&&(it.style.height=n+"px",it.style.overflowY="auto")}function ni(){var t=r;a(),dt(),t&&y(t)}function hi(n){var i=r,t=null;a(),l===w.byCategory?(l=w.none,t=e.getString("L_VenueMaps_ShowCategories_Text")):(l=w.byCategory,t=e.getString("L_VenueMaps_HideCategories_Text")),n.currentTarget.innerHTML=t,et(nt()),v.collapseAll(),ft.collapseAll(),i&&y(i)}function fi(){var n=r;a(),h=c.alphabetical,et(nt()),gt(),n&&y(n)}function pi(){var n=r;a(),h=c.floor,et(nt()),gt(),n&&y(n)}function yi(n){t.hasHandler(f,"mouseover")?t.invoke(f,"mouseover",n):f.handleMouseOver(n)}function vi(n){t.hasHandler(f,"mouseout")?t.invoke(f,"mouseout",n):f.handleMouseOut(n)}function si(n){t.hasHandler(f,"click")?t.invoke(f,"click",n):f.handleMouseClick(n)}function gt(){var t=document.getElementById("sortalphabutton"),n=document.getElementById("sortfloorbutton");h===c.alphabetical?(t.className="sortselected",n.className="sortnormal"):(t.className="sortnormal",n.className="sortselected")}function nt(){return l===w.none?h===c.alphabetical?ei():ui():(ii(),h===c.alphabetical?lt().get_root():ct().get_root())}function ii(){var n=v;h===c.alphabetical?(v=lt(),ft=ct()):(v=ct(),ft=lt()),n!==v&&n&&v.set_expanded_or_collapsed_selections(ft.get_expanded_or_collapsed_selections())}function et(n){if(d!==n){var t=d.parentNode;t.removeChild(d),t.appendChild(n),d=n}}function ei(){return wt||(wt=s.render(tt.sortAlphabetical(b))),wt}function ui(){return bt||(bt=s.render(tt.sortByFloor(b))),bt}function lt(){return pt||(pt=new n.Directory.GroupView(tt.group_Alpha(b),s)),pt}function ct(){return yt||(yt=new n.Directory.GroupView(tt.group_Floor(b),s)),yt}var f=this,u=null,k=null,o=null,it=null,vt=!1,b=null,s=null,h=null,l=null,d=null,wt=null,bt=null,pt=null,yt=null,v=null,ft=null,ut=null,st=null,ot=null,c=Microsoft.Maps.VenueMaps.DirectorySortOrder,w=Microsoft.Maps.VenueMaps.DirectoryGrouping,wi=n.Directory.CategoryViewState,tt=n.Directory.PrimitiveHelper,rt=null,p=null,r=null,kt,at,ht;if(!i)throw{name:"ArgumentNullException",message:"argument cannot be null"};this.handleMouseClick=function(n){var t=n.primitive;f.select(t),i.select(t),i.popupHelper.showPopup(t),i.minipopupHelper.hide()},this.handleMouseOut=function(n){var t=n.primitive;t&&t!==r&&t.unhighlight(),g(n.eventArgs.currentTarget).remove_class("dtrHighlighted"),i.minipopupHelper.hide()},this.handleMouseOver=function(n){var t=n.primitive;t&&(t.highlight(),i.popupHelper.fetchPopupData(t)),g(n.eventArgs.currentTarget).add_class("dtrHighlighted"),i.minipopupHelper.show(t)},this.select=ti,this.unselect=a,this.createUIElements=oi,this.addToDOM=ri,this.removeFromDOM=ai,this.setHeight=li,this.isInDOM=function(){return n.is_in_DOM(u)}},n.Directory.PrimitiveHelper=new function(){function r(t){var r=n(t),i=f(r);return u(i)}function n(n){for(var i=[],t=0;t<n.length;t++)i.push(n[t]);return i}function i(n,t){var r=n,u=t,i=r.name.localeCompare(u.name);return i||(i=r.floor.name.localeCompare(u.floor.name)),i}function t(n,t){var r=n,u=t,i=r.floor.name.localeCompare(u.floor.name);return i||(i=r.name.localeCompare(u.name)),i}function f(n){for(var r={},e,u=0;u<n.length;u++){var f=n[u],i=f.categoryId,o=f.categoryName,t;r[i]?t=r[i].tuples:(t=new Array(0),e={categoryId:i,categoryName:o,tuples:t},r[i]=e),t[t.length]=f}return r}function u(n){var t=new Array(0),u=n,i,r;for(i in u)r={key:i,value:u[i]},t[t.length]=r.value;return t.sort(function(n,t){var r=n,i=t;return r.categoryName.localeCompare(i.categoryName)}),t}this.buildArray=function(n){for(var f=[],u,i,t,r=0;r<n.floors.length;r++)for(u=n.floors[r],i=0;i<u.primitives.length;i++)t=u.primitives[i],t&&t.id&&t.name&&f.push(t);return f},this.buildHashTable=function(n){for(var f={},u,i,t,r=0;r<n.floors.length;r++)for(u=n.floors[r],i=0;i<u.primitives.length;i++)t=u.primitives[i],t&&t.id&&t.name&&(f[t.id]=t);return f},this.sortAlphabetical=function(t){var r=n(t);return r.sort(i),r},this.sortByFloor=function(i){var r=n(i);return r.sort(t),r},this.group_Alpha=function(n){for(var u=r(n),t=0;t<u.length;t++)u[t].tuples.sort(i);return u},this.group_Floor=function(n){for(var u=r(n),i=0;i<u.length;i++)u[i].tuples.sort(t);return u}},n.Directory.CategoryViewState={expanded:0,collapsed:1},Microsoft.Maps.VenueMaps.DirectorySortOrder={alphabetical:0,floor:1},Microsoft.Maps.VenueMaps.DirectoryGrouping={none:0,byCategory:1},n.Directory.GroupView=function(t,i){function v(n){n.preventDefault();var i=n.currentTarget,t=i.id;h(t)}function h(n){var t=r[n],i;i=l[n],t.visible?(i.removeChild(t.root),t.visible=!1):(i.appendChild(t.root),t.visible=!0)}for(var p=this,c=document.createElement("div"),a=c.appendChild(document.createElement("ul")),r={},l={},s,u=0;u<t.length;u++){var e=t[u],o=e.categoryId,y=e.categoryName,f=document.createElement("li");a.appendChild(f),s=n.addDOMElement("div",o,"categorylistitem",f,y),r[o]={root:i.render(e.tuples),visible:!1},l[o]=f,g(s).add_event("click",v)}this.get_root=function(){return c},this.get_expanded_or_collapsed_selections=function(){var t={},n;for(n in r)t[n]=r[n].visible;return t},this.set_expanded_or_collapsed_selections=function(n){var t,i;for(t in n)i=r[t],i.visible!==n[t]&&h(t)},this.collapseAll=function(){var r={},u,n,i;for(u in t)n=t[u],i=n.categoryId,r[i]=!1;p.set_expanded_or_collapsed_selections(r)}},n.Directory.Renderer=function(i){function o(n){t.invoke(r,"mouseover",{eventArgs:n,primitive:u[n.currentTarget.id]})}function e(n){t.invoke(r,"mouseout",{eventArgs:n,primitive:u[n.currentTarget.id]})}function f(n){n.preventDefault();var e=n.currentTarget.parentNode.parentNode.id,f=u[e];i.setActiveFloor(f.floor.name),i.setBestMapView(f,.1,i.minimumZoomForTileLayer),t.invoke(r,"click",{eventArgs:n,primitive:f})}var u=n.Directory.PrimitiveHelper.buildHashTable(i),r=this;this.render=function(t){for(var s=document.createElement("table"),a=n.addDOMElement("tbody",null,null,s,""),i=0;i<t.length;i++){var c=i%2,l=c?"directorytablerow2":"directorytablerow1",r=n.addDOMElement("tr",t[i].id,l,a,null),h=n.addDOMElement("td",null,"venuecolumn",r,null),u=n.addDOMElement("a",null,null,h,t[i].name);u.href="#",n.addDOMElement("td",null,"levelcolumn",r,t[i].floor.name),g(r).add_event("mouseenter",o).add_event("mouseleave",e),g(u).add_event("click",f)}return s}},Microsoft.Maps.VenueMaps.VenueMapTask=function(n){function u(){n.show(),n.baseMap.setView(n.bestMapView),n.directory.createUIElements(),n.directory.addToDOM(i,0,0)}function f(){n.dispose()}var r=this,i=document.createElement("div"),e=t.addHandler(r,"remove",f),o=t.addHandler(r,"activate",u);this.getTitle=function(){return n.name},this.getPanel=function(){return i}},delete window.Microsoft.Maps.initVenueMapsCode,l.Dynamic&&l.Dynamic.done("Microsoft.Maps.VenueMaps"),rt.end("Module initialized","Microsoft.Maps.VenueMaps",{module:"VenueMaps"})},Microsoft.Maps.Map&&Microsoft.Maps.initVenueMapsCode&&window.Microsoft.Maps.initVenueMapsCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initTraffic=function(){function r(n){var e=this,r=n,t=null;this.show=function(){e.getTileLayer(),r.entities.indexOf(t)===-1&&r.entities.push(t)},this.hide=function(){t&&r.entities.indexOf(t)!==-1&&r.entities.remove(t)},this.getTileLayer=function(){if(t===null){var n=new u({uriConstructor:f.trafficUriFormat,width:256,height:256});t=new i({mercator:n,opacity:.7})}return t}}var n=window.Microsoft.Maps,f=n.Globals,t=n.InternalNamespaceForDelay,e=t.PRF,u=n.TileSource,i=n.TileLayer;typeof n.Traffic=="undefined"&&(n.Traffic={}),n.Traffic.TrafficLayer=r,delete window.Microsoft.Maps.initTraffic,t.Dynamic&&t.Dynamic.done("Microsoft.Maps.Traffic"),e.end("Module initialized","Microsoft.Maps.Traffic",{module:"Traffic"})},Microsoft.Maps.Map&&Microsoft.Maps.initTraffic&&window.Microsoft.Maps.initTraffic(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initBingTheme=function(){var n=window.Microsoft.Maps,s=n.Globals,t=n.Events,i=n.Gimme,y=n.Map,e=n.Pushpin,r=n.Point,f=n.Polygon,a=n.Color,l=n.Location,u=n.Infobox,h=n.InfoboxType,v=i.Helper.contains,o=n.InternalNamespaceForDelay,c=o.PRF;(function(){n.Themes=n.Themes||{},n.Themes.BingTheme=function(){function tt(){o instanceof e?st():o instanceof f&&ut(),o=null}function hi(n,t,i,r){return ot=s.bingThemeIconUrlFormat,ot.replace("{iconStyle}",n).replace("{imageryStyle}",t).replace("{state}",ht(i,r))}function ht(n,t){return n?"_s":t?"_h":""}function st(){if(o){o._selected=!1,o._hover=!1,o._shrink&&o._shrink.reverse(),o._shrink=null,o.iconData==k.micro&&o.temporary&&c.entities.remove(o),v(o);var n=o.trueEntity.getInfobox();n&&v(n)}o=null}function ei(n){var r;if(o==n)return;tt(),n._selected=!0;var u=n.getWidth(),f=n.getHeight(),t=.5;n._shrink=i.Effects.Storyboard.create([n],{x:0,y:0,width:u,height:f,p:0},{x:(1-t)*u/2,y:(1-t)*f/2,width:t*u,height:t*f,p:1},function(t,i){n.overrideOptions=i,v(n)},300,null,null,et),n._shrink.begin(),o=n,r=n.trueEntity.getInfobox(),r&&v(r)}function ri(n){var t=n.target;t.trueEntity.getInfobox()&&ei(t)}function ii(n){nt(n.target,!0)}function fi(n){nt(n.target,!1)}function nt(n,t){n._hover=t;var i=n.trueEntity.getInfobox();i&&v(i),i&&v(n)}function ui(n,t,i){var u=i.iconData,o=ft(),f=t.overrideOptions||{},s=f.p>.5,e=n.getZIndex()+u.zIndex;t._selected&&s?e+=si:t._hover&&(e+=oi),b(t,{icon:hi(u.iconStyle,o,t._selected,t._hover),typeName:"pushpin pin"+u.iconStyle+" "+o+" "+ht(t._selected,t._hover),anchor:new r(u.anchor.x-(f.x||0),u.anchor.y-(f.y||0)),width:f.width||u.width,height:f.height||u.height,textOffset:new r(0,0),text:s?"":n.getText()||"",id:n.getId(),draggable:n.getDraggable(),visible:n.getVisible(),useTransform3d:n.getUseTransform3d(),zIndex:e})}function bi(n,t){var h=n.getIcon(),f=(n.getTypeName()||"").split(" "),i,c=f.length,o,r,u;while(c--){r=f[c];if(k[r]){i=r;break}}return i||h&&h!=s.pushpinImageUrl||(i="bluepin"),u=k[i],u&&(o=new e(n.getLocation()),t.iconData=u),o}function ut(){if(o){o._selected=!1,o._hover=!1,v(o);var n=o.trueEntity.getInfobox();n&&v(n)}o=null}function ki(n){if(o==n)return;tt(),n._selected=!0,o=n;var t=n.trueEntity.getInfobox();t&&v(t)}function pi(n){var t=n.target;t.trueEntity.getInfobox()&&ki(t)}function ai(n){rt(n.target,!0)}function li(n){rt(n.target,!1)}function rt(n,t){n._hover=t;var i=n.trueEntity.getInfobox();i&&v(i),i&&v(n)}function yi(n,t,i,r){return i?wi:r.strokeColor}function vi(n,t,i){var r=ft();b(t,{strokeColor:yi(r,t._selected,t._hover,i),visible:n.getVisible(),strokeThickness:n.getStrokeThickness(),strokeDashArray:n.getStrokeDashArray(),fillColor:i.fillColor})}function ti(n,t){var i=new f(n.getLocations());return t.strokeColor=n.getStrokeColor(),t.fillColor=n.getFillColor(),i}function lt(n){var r=n.measure(),t;n.overrideOptions={width:260,height:null,typeName:"Infobox2 hiddenInfobox"},v(n),t=n.measure(),i.Effects.Storyboard.create([n],{width:r.width,height:r.height-18,p:0},{width:t.width,height:t.height,p:1},function(t,i){n.overrideOptions=i,v(n)},300,null,null,et).begin()}function ct(n,t,i,u){var s=n.getPushpin(),d=s&&s[u.themeReferenceKey],nt=d?d.proxyEntity:null,a=n.getPolygon(),k=a&&a[u.themeReferenceKey],it=k?k.proxyEntity:null,f=t.overrideOptions||{},l=f.p>.5,o=f.p>.95,g=!1,v=36,p=-25,c=!1,y=null;o?(p=0,v=-2):!l&&f.height&&(v=54);var e=nt||it,tt=s||a,w=new r(p,v);e?(c=!!(e._hover||e._selected),e._selected&&!t.overrideOptions?lt(t):!e._selected&&t.overrideOptions&&(t.overrideOptions=null)):tt===null&&(l=n.typeName&&n.typeName===h.mini?!1:!0,o=n.getShowPointer(),c=n.getVisible(),g=n.getShowCloseButton(),w=n.getOffset(),y=n.getWidth()),b(t,{typeName:f.typeName||(l?"Infobox2":"MiniInfobox2"),title:n.getTitle(),width:f.width||y,height:!o&&f.height||null,description:n.getDescription(),titleAction:n.getTitleAction(),titleClickHandler:n.getTitleClickHandler(),offset:w,zIndex:f?vt:yt,actions:n.getActions(),showPointer:o,showCloseButton:g,visible:c,htmlContent:n.getHtmlContent(),location:n.getLocation()})}function pt(n){var f=(n.getTypeName()||"").split(" "),e=!0,i=f.length,r;while(i--)if(f[i]=="notheme"){e=!1;break}return e&&(r=new u(n.getLocation())),r}function gt(n,r){c=n,r.showDualMapTypeSelector!==!1&&(r.showDualMapTypeSelector=!0),r.showBreadcrumb!==!1&&(r.showBreadcrumb=!0),i(c.getRootElement()).add_class("BingTheme"),it(),t.addHandler(c,"click",wt),i(window).add_event("resize",p),t.addHandler(c,"resize",p),p(),t.addHandler(c,"imagerychanged",ni)}function ni(){v(c.entities)}function wt(n){n.mouseMoved||n.targetType!="map"||(st(),ut())}function ft(){switch(c.getImageryId()){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":return"dark";default:return"light"}}function p(n){n=typeof n=="number"?n:0;var r=c.getComponent("breadcrumb");if(r!=null){if(n>50)return;w&&(t.removeHandler(w),w=null),setTimeout(function(){var u=i(c.getRootElement()).select(".pathContainer").get_relative_pos().x,t=i(c.getRootElement()).select(".NavBar_zoomControlContainer").get_relative_pos().x,f=t-u-30;u>0&&t>0?r.setWidth(f):p(n+1)},100)}else w||(w=t.addHandler(c,"componentadded",p))}function it(){c.overlays?(c.overlays.setOptions({className:c.overlays.getClassName()+" stylev2"}),d&&t.removeHandler(d)):d=t.addHandler(c,"overlayscreationstart",it)}function et(n){return i.Effects.Easing.Exponential.ease_in_out(n,4)}function v(n){t.invoke(n,"entitychanged",{entity:n})}function g(n){var i=n.entity,t;if(i.changing)return;t=i.trueEntity,t&&v(t)}function b(n,t){var e=!1,s=!1,i;for(i in t){var h="get"+i.substring(0,1).toUpperCase()+i.substring(1),o=typeof n[h]=="function"?n[h]():null,f=t[i];e=i=="anchor"||i=="textOffset"||i=="offset"?!r.areEqual(o,f):i=="strokeColor"?o.toHex()!=f.toHex():i=="location"?s=!l.areEqual(o,f):o!=f;if(e){n.changing=!0,s?n.setLocation(f):n.setOptions(t),n.changing=!1,n instanceof u&&n.trueEntity&&v(n.trueEntity);return}}}function dt(n,i){var r,o,h=i.eventHandlers,s;n instanceof e?(r=bi(n,i),o=ci):n instanceof f?(r=ti(n,i),o=di):n instanceof u&&(r=pt(n,i),(n.getPushpin()||n.getPolygon())&&(o=at));if(r){r.trueEntity=n,r.themeReference=i;if(o)for(s in o)h.push(t.addHandler(r,s,o[s]))}return r}function bt(n,t,i){var o=t.appliedTheme,s=!1,r;return o!=y&&(o&&o._unhookFromEntity(n,t),t.appliedTheme=y,t.eventHandlers=[],t.proxyEntity=dt(n,t),s=!0),r=t.proxyEntity,r&&(i.updateEntity||s)&&(n instanceof f?vi(n,r,t,i):n instanceof e?ui(n,r,t,i):n instanceof u&&ct(n,r,t,i)),r||n}function kt(n,i){var u=i.eventHandlers,r;if(u){r=u.length;while(r--)t.removeHandler(u[r])}}var y=this,w,gi=i("body"),d,c,o=null,si=2e3,oi=1e3,ot=null,k={micro:{width:16,height:16,anchor:new r(8,8),iconStyle:0,zIndex:0},bluepin:{width:28,height:28,anchor:new r(14,14),textOffset:new n.Point(0,6),iconStyle:55,zIndex:1}},ci={mouseover:ii,mouseout:fi,click:ri,entitychanged:g},wi=new a(255,0,0,0),di={mouseover:ai,mouseout:li,click:pi,entitychanged:g},vt=3e3,yt=3100,at={entitychanged:g};y._attachToMap=gt,y._preRenderEntity=bt,y._unhookFromEntity=kt}})(),delete window.Microsoft.Maps.initBingTheme,o.Dynamic&&o.Dynamic.done("Microsoft.Maps.Themes.BingTheme"),c.end("Module initialized","Microsoft.Maps.Themes.BingTheme",{module:"BingTheme"})},Microsoft.Maps.Map&&Microsoft.Maps.initBingTheme&&window.Microsoft.Maps.initBingTheme(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initAdvancedShapes=function(){function e(n){var u=this,t,r;e.baseConstructor.call(u,n);if(n&&n.bubble===!0){this._bubble=!0;function f(n){n&&n.eventName&&i.invoke(u,n.eventName,n)}t=["mousedown","mouseup","mouseover","mouseout","click","rightclick","dblclick"],r=t.length;while(r--)this._eventsHandlers.push([t[r],f])}}function o(n,t){n&&n.length&&(this._locationsArrays=n[0]&&typeof n[0].latitude=="number"?[n]:n),this.setOptions(t)}function l(n,t){this._locationRect=n,this.setOptions(t)}function nt(n){function e(n,i){var e=null,r=n[t],o,u;return r&&(o=r.harmony,o&&(u=r.path,u&&(e=u.nativeShape,o.removePath(u),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),f.isEventsSupported()&&e?{doms:[e]}:null}function i(n){var i=n[t];return i||(i={},n[t]=i),i}var u=n,r="cm"+h.getNext(),t=r+"_etr";this.shouldDraw=function(n,t){var f=n.getVisible()&&(t.linear||t.animationEnd||c.animateShapes),e,r,u;return f&&(e=i(n),r=e.boundingRect,(t.update||!r)&&(u=n.getRings(),e.boundingRect=r=u&&u.length>0?w.fromLocations(u[0]):null),f=r&&t.currentBounds.intersects(r)),f},this.update=function(n,t){var s=t.viewportSize,o=i(n),a,l,b,e,nt,it,ut,v,rt,et,ft,tt,y,w,k;t.update=o.updateEntity||t.update,o.updateEntity=!1,a=o.harmony,!a&&t.parentDom&&(l=t.parentDom.harmony,l||(l=p("div","position:absolute;width:"+s.width+"px;height:"+s.height+"px;left:"+-(s.width/2)+"px;top:"+-(s.height/2)+"px;"+c.safariRenderHack),t.parentDom.harmony=l,b=t.parentDom,b.firstChild?b.insertBefore(l,b.firstChild):b.appendChild(l)),a=f.getContext(l),l.className="MicrosoftMapDrawing",o.harmony=a),e=o.path,nt=!1,e&&g.areEqual(o.previousSize,s)||(a.setSize(s.width,s.height),o.previousSize=s,nt=!0),e||(e=a.createPath(),e.id=r+"path"+h.getNext(),o.path=e,t.update=!0),t.update&&(it=n.getStrokeColor(),e.strokeStyle=it.toHex(),e.strokeOpacity=it.getOpacity(),e.lineWidth=n.getStrokeThickness(),e.dashArray=n.getStrokeDashArray(),ut=n.getFillColor(),e.fillStyle=ut.toHex(),e.fillOpacity=ut.getOpacity());if(!t.linear||!o.points||nt){rt=n.getRings(),o.ringPoints=[],o.offsetLeft=t.parentOffsetLeft,o.offsetTop=t.parentOffsetTop,v=rt.length;while(v--)o.ringPoints[v]=u.tryLocationToPixel(rt[v])}if(!t.linear||t.animationEnd||t.update||nt){et=o.ringPoints,e.beginPath(),ft=o.offsetLeft-s.width/2,tt=o.offsetTop-s.height/2,v=et.length;while(v--){y=et[v];if(y&&y.length)for(w=y[0],e.moveTo(w.x-ft,w.y-tt),k=1;k<y.length;k++)w=y[k],e.lineTo(w.x-ft,w.y-tt)}e.data||e.moveTo(0,0),e.stroke(),o.isDrawn||(a.renderPath(e),o.isDrawn=!0)}return f.isEventsSupported()?{doms:[e.nativeShape],type:d.polygon}:null},this.remove=e,this.dispose=function(n){delete n[t]}}function rt(n){function e(n,i){var e=null,r=n[t],o,u;return r&&(o=r.harmony,o&&(u=r.path,u&&(e=u.nativeShape,o.removePath(u),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),f.isEventsSupported()&&e?{doms:[e]}:null}function r(n){var i=n[t];return i||(i={},n[t]=i),i}var i=n,u="cm"+h.getNext(),t=u+"_etr";this.shouldDraw=function(n,t){var u=n.getVisible()&&(t.linear||t.animationEnd||c.animateShapes),f,i;return u&&(f=r(n),i=f.boundingRect,(t.update||!i)&&(f.boundingRect=i=n.getEllipse()),u=i&&t.currentBounds.intersects(i)),u},this.update=function(n,t){var k=t.viewportSize,b=r(n),st,et,ht,e,at,pt,yt,nt;t.update=b.updateEntity||t.update,b.updateEntity=!1,st=b.harmony,!st&&t.parentDom&&(et=t.parentDom.harmony,et||(et=p("div","position:absolute;width:"+k.width+"px;height:"+k.height+"px;left:"+-(k.width/2)+"px;top:"+-(k.height/2)+"px;"+c.safariRenderHack),t.parentDom.harmony=et,ht=t.parentDom,ht.firstChild?ht.insertBefore(et,ht.firstChild):ht.appendChild(et)),st=f.getContext(et),et.className="MicrosoftMapDrawing",b.harmony=st),e=b.path,at=!1,e&&g.areEqual(b.previousSize,k)||(st.setSize(k.width,k.height),b.previousSize=k,at=!0),e||(e=st.createPath(),e.id=u+"path"+h.getNext(),b.path=e,t.update=!0),t.update&&(pt=n.getStrokeColor(),e.strokeStyle=pt.toHex(),e.strokeOpacity=pt.getOpacity(),e.lineWidth=n.getStrokeThickness(),e.dashArray=n.getStrokeDashArray(),yt=n.getFillColor(),e.fillStyle=yt.toHex(),e.fillOpacity=yt.getOpacity());if(!t.linear||!b.center||at){var w=t.parentOffsetLeft-k.width/2,v=t.parentOffsetTop-k.height/2,ot=n.getEllipse();nt=i.tryLocationToPixel(ot.center);var vt=i.tryLocationToPixel(new s(ot.getNorth(),ot.center.longitude-ot.width/2)),wt=i.tryLocationToPixel(new s(ot.getSouth(),ot.center.longitude+ot.width/2)),bt=vt.x<nt.x?Math.abs(nt.x-vt.x):Math.abs(wt.x-nt.x);b.center=nt;var it=.5522847498,ct=[nt.x-bt,nt.x,nt.x+bt],lt=[vt.y,nt.y,wt.y],y,a,l,o,rt,ut,tt,ft;y=ct[1],a=lt[0],l=ct[2],o=lt[1],rt=y+(l-y)*it,ut=a,tt=l,ft=o-(o-a)*it,e.beginPath(),e.moveTo(y-w,a-v),e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),y=l,a=o,l=ct[1],o=lt[2],rt=y,ut=a+(o-a)*it,tt=l+(y-l)*it,ft=o,e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),y=l,a=o,l=ct[0],o=lt[1],rt=y-(y-l)*it,ut=a,tt=l,ft=o+(a-o)*it,e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),y=l,a=o,l=ct[1],o=lt[0],rt=y,ut=a-(a-o)*it,tt=l-(l-y)*it,ft=o,e.curveTo(rt-w,ut-v,tt-w,ft-v,l-w,o-v),e.stroke(),b.isDrawn||(st.renderPath(e),b.isDrawn=!0)}return f.isEventsSupported()?{doms:[e.nativeShape],type:d.polygon}:null},this.remove=e,this.dispose=function(n){delete n[t]}}var t=window.Microsoft.Maps,ft=t.Globals,i=t.Events,w=t.LocationRect,s=t.Location,n=t.InternalNamespaceForDelay,h=n.IdGenerator,tt=n.PRF,it=t.EntityCollection,b=t.Polygon,c=n.Quirks,v=n.Common,k=n.CompositeMode,f=n.Harmony,g=n.Size,d=n.EventTargetType,ut=v.stopPropagation,p=v.createElement,a=v.extend,y,r,u;a(e,it),y=e.prototype,y.setOptions=function(n,t){var r=e.superClass.setOptions.call(this,n,!0),f,u;if(this._bubble&&n.bubble!==!1){f=this.getLength();while(f--)u=this.get(f),u.setOptions&&(r=u.setOptions(n,!0)||r)}return r&&!t&&i.invoke(this,"entitychanged",{entity:this}),r},y.toString=function(){return"[AdvancedShapes.EntityCollection]"},t.EntityCollection=e,a(o,b),r=o.prototype,r.setRings=function(n){this._locationsArrays=n,i.invoke(this,"entitychanged",{entity:this})},r.getRings=function(){return this._locationsArrays},r.setLocations=function(n){this._locationsArrays=[n],i.invoke(this,"entitychanged",{entity:this})},r.getLocations=function(){var n=this._locationsArrays;return n&&n.length?n[0]:null},r.setOptions=function(n,t){var r=o.superClass.setOptions.call(this,n,!0);return r&&!t&&i.invoke(this,"entitychanged",{entity:this}),r},r.toString=function(){return"[AdvancedShapes.Polygon]"},t.Polygon=o,a(l,b),u=l.prototype,u.setEllipse=function(n){this._locationRect=n,i.invoke(this,"entitychanged",{entity:this})},u.getEllipse=function(){return this._locationRect},u.setLocations=function(n){this._locationRect=w.fromLocations(n),i.invoke(this,"entitychanged",{entity:this})},u.getLocations=function(){var n=this._locationRect;return[n.getNorthwest(),new s(n.getNorth(),n.getEast()),n.getSoutheast(),new s(n.getSouth(),n.getWest())]},u.toString=function(){return"[AdvancedShapes.Ellipse]"},t.Ellipse=l,new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof o){f=n.length;while(f--)n[f]===i&&(u=t[f]);u||(u=new nt(i),n.push(i),t.push(u))}return u};k.registerEntityRenderer(i,{priority:0})},new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof l){f=n.length;while(f--)n[f]===i&&(u=t[f]);u||(u=new rt(i),n.push(i),t.push(u))}return u};k.registerEntityRenderer(i,{priority:0})},delete window.Microsoft.Maps.initAdvancedShapes,n.Dynamic&&n.Dynamic.done("Microsoft.Maps.AdvancedShapes"),tt.add("AdvancedShapes initialized")},Microsoft.Maps.Map&&Microsoft.Maps.initAdvancedShapes&&window.Microsoft.Maps.initAdvancedShapes(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initDirectionsCode=function(){function su(n){this._map=n,this._task=null}function ft(t){function r(n){n&&n.disambiguation&&(i._disambiguation=n.disambiguation),i._uniqueId===null&&(i._uniqueId=ft._uniqueWaypointId++)}function u(t){if(t){var r=!1;t.address&&t.address.formattedAddress&&(t.latitude&&t.longitude&&((!i._location||i._location&&(i._location.latitude!==t.latitude||i._location.longitude!==t.longitude))&&(r=!0),i._location=new l(t.latitude,t.longitude),i._geoLocation=new l(t.latitude,t.longitude)),i._address!==t.address.formattedAddress&&(r=!0),i._shortAddress!==t.address.shortFormattedAddress&&(r=!0),i._shortAddress=t.address.shortFormattedAddress,i._address=t.address.formattedAddress,i._exactLocation=!0,i._inputType=t.inputType,r&&n.invoke(i,"changed",{waypoint:i})),t.disambiguation&&(i._inputType=t.inputType,i._disambiguation=t.disambiguation,i._location||(r=!0)),r&&i._geocoded()}}var i=this;i.setOptions=function(t){var u,f;t&&(u=!1,r(t),typeof t.address=="string"&&i._address!==t.address&&(i._address=t.address,i._disambiguation=null,u=!0),t.location&&!l.areEqual(t.location,i._location)&&(i._location=t.location,u=!0),t.geoLocation&&!l.areEqual(t.geoLocation,i._geoLocation)&&(i._geoLocation=t.geoLocation,u=!0),typeof t.isViapoint=="boolean"&&(i._isViapoint=t.isViapoint,u=!0),(t.pushpin&&t.pushpin instanceof lt||t.pushpin===null)&&(i._pushpin=t.pushpin,u=!0),typeof t.shortAddress=="string"&&(i._shortAddress=t.shortAddress,i._disambiguation=null,u=!0),typeof t.exactLocation=="boolean"&&(i._exactLocation=t.exactLocation,u=!0),typeof t.disambiguationContainer=="object"&&(i._disambiguationContainer=t.disambiguationContainer,u=!0),t.businessDetails&&(f=t.businessDetails,typeof f.businessName=="string"&&(i._businessName=f.businessName,u=!0),typeof f.phoneNumber=="string"&&(i._phoneNumber=f.phoneNumber,u=!0),typeof f.entityId=="string"&&(i._entityId=f.entityId,u=!0),typeof f.website=="string"&&(i._website=f.website,u=!0)),u&&n.invoke(i,"changed",{waypoint:i}))},i.clear=function(){i._address="",i._shortAddress="",i._locationIdentifier="",i._location=null,i._geoLocation=null,i._businessName="",i._phoneNumber="",i._exactLocation=!0,i._disambiguationContainer=null,i._disambiguation=null,i._entityId="",i._website="",i._inputType=null,i._isViapoint=i._isViapoint,n.invoke(i,"cleared",{waypoint:i})},i._updateWaypoint=function(n){n&&(n.failed||u(n))},i._reverseGeocoded=function(){n.invoke(i,"reverseGeocoded",{waypoint:this})},i._geocoded=function(){n.invoke(i,"geocoded",{waypoint:this})},r(t),i.setOptions(t)}function yu(t,i){function s(n,t,i,r,u){i.visible=!1,i.id=n;var e=new vu(t,i),o=new ii;return o.init(f,e,t,r,u),e.ZoomAwarePolyline=ii,e}function e(n){var t,i=u.getOptions();return t=n===d.walk?u.cloneOptions(i.walkingPolylineOptions):n===d.ferry||n===d.bus||n===d.train||n===d.airline||n===d.other?u.cloneOptions(i.transitPolylineOptions):u.cloneOptions(i.drivingPolylineOptions)}var r=this,f=t,u=i;r._displayedRoutes={},r.updateRouteOnMapControl=function(n,t,i){for(var it=n.length,f,k,s,g,y,tt,h,b,l,c,v=0;v<it;v++){f=n[v];if(r._displayedRoutes[f.legKey])continue;for(k=f.subLegs.length,s=0;s<k;s++)if(!r._displayedRoutes[f.subLegs[s].subLegKey]){var a=f.subLegs[s].routePath,w=[],nt=u.getOptions().routeMode;if(nt!==o.transit)p.decodeRoute(a,!0),g=nt===o.walking?d.walk:d.auto,w[0]=r.addPolyline(f.subLegs[s].subLegKey,a,e(g),t,f.legKey,f.subLegs[s].subLegKey);else for(p.decodeRoute(a,!1),y=bt._splitTransitRoutes(f.itineraryItems,a),tt=y.length,h=0;h<tt;h++){if(f.itineraryItems[h].startPathIndex===f.itineraryItems[h].endPathIndex)continue;b=f.itineraryItems[h].iconType,l=null,f.itineraryItems[h]&&f.itineraryItems.length===y.length&&(l=e(b),i&&(c=l.strokeColor.clone(),c.a=c.getOpacity()<.5?c.a+80:c.a-80,l.strokeColor=c)),w[w.length]=r.addPolyline(f.subLegs[s].subLegKey+"_"+h,y[h],l,t,f.legKey,f.subLegs[s].subLegKey)}}}},r.clearRoute=function(t){var c,u,o,h,l,e,a,s;if(t)for(r._removeAllTemporaryRoutes(),c=t.length,u=0;u<c;u++){o=r._displayedRoutes;for(h in o){l=o[h];if(l.subLegKey===t[u]||l.parentLegKey===t[u]){for(e=l.polylines,a=e.length,s=0;s<a;s++)f.entities.remove(e[s]),n.invoke(this,"polylineRemoved",{polyline:e[s]});delete r._displayedRoutes[h]}}}else{o=r._displayedRoutes;for(h in o)for(e=o[h].polylines,c=e.length,u=0;u<c;u++)f.entities.remove(e[u]),n.invoke(this,"polylineRemoved",{polyline:e[u]});r._displayedRoutes={}}},r._removeAllTemporaryRoutes=function(){var e=r._displayedRoutes,u,i,t,o,n;for(u in e){i=e[u];if(i.temporaryRoute){for(t=i.polylines,o=t.length,n=0;n<o;n++)f.entities.remove(t[n]);delete r._displayedRoutes[u]}}},r.addPolyline=function(t,i,f,e,o,h){for(var p=i.decodedLatitudes.length,w=new Array(p),v,c,y,a=0;a<p;a++)w[a]=new l(i.decodedLatitudes[a],i.decodedLongitudes[a]);return v=s(u.PolylinePrefixId+t,w,f,i.decodedRegions,i.zoomLevels.split(",")),r._displayedRoutes[h]?(y=r._displayedRoutes[h].polylines,y[y.length]=v):(c=new hr,c.polylines=[],c.parentLegKey=o,c.polylines[0]=v,c.subLegKey=h,c.temporaryRoute=e,r._displayedRoutes[h]=c),n.invoke(this,"polylineAdded",{polyline:v,tempararyPolyline:e}),v},r.dispose=function(){r.clearRoute(null,!1)}}function nu(n,o,s,c){function nt(n){return d?t._convert24HourTo12Hour(n):n}function tt(n){return n?u.getString("L_TimePM_Text"):u.getString("L_TimeAM_Text")}function rt(){var u=y(b),f=u.innerHTML,r=t.getDateFromStringInSupportedFormat(f,h.TransitDateFormat),i=n.getOptions().transitOptions.transitTime;i instanceof Date||(i=new Date),r&&(i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),i.getHours(),i.getMinutes(),i.getSeconds())),n.setOptions({transitOptions:{transitTime:i}}),c&&c(i)}function k(i){var r=n.getOptions().transitOptions.transitTime,e,u,f;r instanceof Date||(r=new Date),e=r.getHours()>=12^i,p&&(p.innerHTML=tt(e)),u=parseInt(a.value,10),d&&(u=t._convert12HourTo24Hour(u,e)),u<0||u>23?a.value=nt(r.getHours()).toString():r.setHours(u),f=parseInt(v.value,10),f<0||f>59?v.value=r.getMinutes().toString():r.setMinutes(f),n.setOptions({transitOptions:{transitTime:r}}),c&&c(r)}var d=h.TransitTimeUse12Hour,it=n._getPrefixId(),b=it+o,l=n.getOptions().transitOptions.transitTime,g,a,v,p;l instanceof Date||(l=new Date),f("label",b,"transitDateContainer transitDateTimeBox transitCalendarOpener",s,t.getDateInSupportedFormat(l)),g=w==="ja-jp",wi.InitCalendar(b,l,g,r(self,rt)),a=f("input","hourInput","transitDateTimeBox transitTimeBox",s,""),a.value=nt(l.getHours()).toString(),a.setAttribute("type","text"),a.setAttribute("maxlength",2),a.setAttribute("size",2),f("label","","transitTimeSeperator",s,":"),v=f("input","minuteInput","transitDateTimeBox transitTimeBox",s,null),v.value=(l.getMinutes()<10?"0":"")+l.getMinutes().toString(),v.setAttribute("type","text"),v.setAttribute("maxlength",2),v.setAttribute("size",2),p=null,d&&(p=e("amPmSwitch","transitDateTimeBox",s),p.innerHTML=tt(l.getHours()>=12),i(p).add_event("click",r(self,function(){k(!0)}))),i(a).add_event("change",k),i(v).add_event("change",k)}function er(n,i){function u(n){var i=r._state.getOptions(),u=i.transitOptions,t;if(i.routeMode!==o.transit)return;n||(n={});switch(u.timeType){case et.departure:default:n.limit="D";break;case et.arrival:n.limit="A";break;case et.lastAvailable:n.limit="LT"}t=u.transitTime,t instanceof Date||(t=new Date),n.time=""+t.getFullYear()+(t.getMonth()+1<10?"0":"")+(t.getMonth()+1)+(t.getDate()<10?"0":"")+t.getDate()+(t.getHours()<10?"0":"")+t.getHours()+(t.getMinutes()<10?"0":"")+t.getMinutes(),n.sri=i.routeIndex,n.maxr=r._state.getOptions().maxRoutes,h.TransitAdvancedOptions&&(n.opt=i.routeOptimization)}function f(n){var u="",t=n.getDisambiguationResult(),i;return t?(t.dependentLocation.latitude||t.dependentLocation.longitude)&&(u=t.dependentLocation.latitude.toFixed(a)+","+t.dependentLocation.longitude.toFixed(a)):(i=r._state.getPreviousWaypoint(n._uniqueId),i&&i.getLocation()&&(u=i.getLocation().latitude.toFixed(a)+","+i.getLocation().longitude.toFixed(a))),u}var r=this;r._map=n,r._state=i,r.generateGetDirectionsLink=function(n,t,i){for(var f={},e="",l=t.length,c=!1,o,s,h,u=0;u<l;u++)u>0&&(e+="~"),o=t[u],e+=r._getStopPointParam(o),o.getLocation()||o.getDisambiguationResult()||(c=!0);for(f.w=e,e="",u=0;u<n.length;u++)u>0&&(e+="|"),s=n[u],e+=s[0].toString()+"~"+s[1].toString();return f.d=e,e="",r._addRouteOptionsLink(f,!0),c&&(f.bb=r._generateMapBoundingBoxLink(),r.addUserLocation(f)),h=r._getQueryParam(null,null),h&&(f.q=h),r._addPermalinkAdditionalParams(f,i),f},r.generateNearbyArterialsLink=function(n,t){var i={},u=n.latitude.toFixed(a)+","+n.longitude.toFixed(a)+",";return i.w=u,i.m="8",r._addPermalinkAdditionalParams(i,t),i},r.generateReverseGeocodeLink=function(n,t){var i={},u;return i.m="7",u=n.latitude.toFixed(a)+","+n.longitude.toFixed(a)+",",i.w=u,r._addPermalinkAdditionalParams(i,t),i},r.generateGetTransitScheduleLink=function(n,t){var i={m:"9",stopIds:n.join(","),transitType:2};return u(i),r._addPermalinkAdditionalParams(i,t),i},r.generateResolveWaypointLink=function(n,t,i,u,e){var o={},h,s;return o.w="a."+n.getAddress(),i?t?o.prew=t.latitude.toFixed(a)+","+t.longitude.toFixed(a):o.start="1":(h=n._uniqueId===r._state.stoppoints[0]._uniqueId,o.start=h?"1":"0",h||(s=f(n),s&&(o.prew=s))),o.bb=r._generateMapBoundingBoxLink(),r.addUserLocation(o),u<0||(o.si=u),r._addPermalinkAdditionalParams(o,e),o},r.addUserLocation=function(){},r._addPermalinkAdditionalParams=function(n){var f="",e=t.parseQueryString().form,o,s,u,r;e&&(n.FORM=e);for(o in n)f+=n[o].toString();for(s=f.length,u=0,r=0;r<s;r++)u+=f.charCodeAt(r);gt.useXHR||(n.jsonso="d"+u,n.jsonp="microsoftMapsNetworkCallback"),n.mkt=w,b.ishttpsenabled&&(n.s="1")},r._getStopPointParam=function(n){var t="",i;return n.isViapoint()&&(t+="v."),i=n.getLocation(),i?(t+=i.latitude.toFixed(a),t+=",",t+=i.longitude.toFixed(a),r._state.getOptions().routeMode!==o.transit&&n._locationIdentifier&&(t+=",",t+=n._locationIdentifier)):t+="a."+n.getAddress(),t},r._generateMapBoundingBoxLink=function(){var t="",n;return r._map&&(n=r._map.getBounds(),t+=n.getNorth().toFixed(a)+","+n.getEast().toFixed(a),t+="~",t+=n.getSouth().toFixed(a)+","+n.getWest().toFixed(a)),t},r._addRouteOptionsLink=function(n,t){var i=r._state.getOptions(),f,e;switch(i.routeMode){case o.walking:n.mode="W";break;case o.transit:n.mode="T";break;case o.driving:default:n.mode="D"}f="",i.routeMode===o.driving?(f+=i.routeOptimization+"~",f+=i.avoidTraffic?"1":"0",f+="~0~",n.rtop=f):r._state.getOptions().routeMode===o.transit&&u(n),t&&(n.u=r._state.getOptions().distanceUnit===rt.miles?"0":"1"),i.routeAvoidance!==s.none&&(e=i.routeAvoidance,(e&s.avoidExpressTrain)===s.avoidExpressTrain&&(e|=s.avoidBulletTrain),n.av=e)},r._getQueryParam=function(n,t){var s="",o=r._state.getAllWaypoints(),i,f,u,e;return o&&(i=o[0],f=i.getAddress(),!f&&i.getLocation()&&(f=bi.replace("{0}",i.getLocation().latitude.toFixed(a)).replace("{1}",i.getLocation().longitude.toFixed(a))),u=o[o.length-1],e=u.getAddress(),!e&&u.getLocation()&&(e=bi.replace("{0}",u.getLocation().latitude.toFixed(a)).replace("{1}",u.getLocation().longitude.toFixed(a))),n&&t&&(i._uniqueId===n._uniqueId?f=bi.replace("{0}",t.latitude.toFixed(a)).replace("{1}",t.longitude.toFixed(a)):u._uniqueId===n._uniqueId&&(e=bi.replace("{0}",t.latitude.toFixed(a)).replace("{1}",t.longitude.toFixed(a)))),s=f+"~"+e),s}}function ot(){function g(n){for(var f=0;f<n.length;f++){var u=n[f].transitLine,r=or,i=lr;u&&(u.lineColor&&(r=u.lineColor),u.lineTextColor&&(i=u.lineTextColor),r===or&&i!==lr&&(r=t.getLuminance(i)<wf?rr:cr),r!==or&&i===lr&&(i=t.getLuminance(r)<of?rr:cr),Math.abs(t.getLuminance(r)-t.getLuminance(i))<50&&(r=cr,i=rr),u.lineColor=r,u.lineTextColor=i)}}function nt(){var t="d",n;typeof VEShell!="undefined"&&(t=VEShell.Cookie.read(dr)),n=h.DefaultMode;if(t)switch(t){case"d":h.DrivingDirectionsEnabled&&(n=o.driving);break;case"t":h.TransitDirectionsEnabled&&(n=o.transit);break;case"w":h.WalkingDirectionsEnabled&&(n=o.walking)}return n}function d(n){var i=r.routes[n].routeLegs,u;if(!i||!i.length)return;for(r.summary[n].northEast=i[0].summary.northEast,r.summary[n].southWest=i[0].summary.southWest,u=1;u<i.length;u++){var t=i[u].summary,o=r.summary[n].northEast.latitude>t.northEast.latitude?r.summary[n].northEast.latitude:t.northEast.latitude,s=r.summary[n].southWest.latitude<t.southWest.latitude?r.summary[n].southWest.latitude:t.southWest.latitude,f=r.summary[n].northEast.longitude>t.northEast.longitude?r.summary[n].northEast.longitude:t.northEast.longitude,e=r.summary[n].southWest.longitude<t.southWest.longitude?r.summary[n].southWest.longitude:t.southWest.longitude;r.summary[n].northEast=new l(o,f),r.summary[n].southWest=new l(s,e)}r.updateBoundingBoxWithBuffer(r.summary[n].northEast,r.summary[n].southWest)}function c(n){if(n==null)return null;var t={};for(key in n)t[key]=typeof n[key]!="object"||n[key]instanceof Date||n[key]instanceof l||n[key]instanceof Microsoft.Maps.Color||n[key]instanceof Array||key==="itineraryContainer"?n[key]&&n[key].clone?n[key].clone():n[key]:c(n[key]);return t}function f(n){var t;return t=typeof u[n]=="object"?c(u[n]):u[n]}function k(n,t){if(!t||typeof t!="object")return;n==null&&(n=t),typeof t.routeIndex=="undefined"&&(typeof t.transitOptions!="undefined"||typeof t.routeMode!="undefined")&&(t.routeIndex=0);for(key in t)typeof t[key]!="undefined"&&(typeof n[key]!="object"||n[key]==null||n[key]instanceof Date||n[key]instanceof l||key==="itineraryContainer"||typeof t[key]!="object"||t[key]instanceof Date||t[key]instanceof l?((typeof n[key]==typeof t[key]||typeof n[key]=="undefined"||n[key]==null)&&((key==="routeMode"&&n[key]!==t[key]||key==="avoidTraffic"&&n[key]!==t[key]||key==="routeOptimization"&&n[key]!==t[key]||key==="routeAvoidance"&&n[key]!==t[key]||key==="timeType"&&n[key]!==t[key]||key==="distanceUnit"&&n[key]!==t[key])&&(key==="routeMode"&&r.stoppoints.length>2&&t[key]===o.transit?t[key]=n[key]:y()),key==="routeIndex"&&typeof t[key]=="number"?r.routes&&r.routes.length>0&&(t[key]>r.routes.length-1&&(t[key]=0),r.currentRouteLegs=r.routes[t[key]].routeLegs):key==="maxRoutes"&&(typeof t[key]!="number"||t[key]>df||t[key]<1)?t[key]=n[key]:key==="timeType"&&w!=="ja-jp"&&t[key]===et.lastAvailable?t[key]=n[key]:key!=="routeAvoidance"||w==="ja-jp"||t[key]<s.avoidExpressTrain?key==="routeOptimization"&&w!=="ja-jp"&&(t[key]===st.minimizeMoney||t[key]===st.minimizeTransfers||t[key]===st.minimizeWalking)&&(t[key]=n[key]):t[key]=n[key],n[key]=t[key]),key==="transitTime"?(!t[key]instanceof Date&&(n[key]=null),y()):key==="itineraryContainer"&&(n[key]=t[key])):k(n[key],t[key]))}function y(){r.summary=null,r.currentRouteLegs.length=0,r.routes=null}var r=this,e,it,p,v,u;r.saveUserLocationEnabled=!1,r.stoppoints=[],r.inlineImagesCache=[],r.currentRouteLegs=[],r.summary=null,r.isLandingPage=!1,r.routes=null,ot._uniquePrefixId++,e=ot._uniquePrefixId,r.TransitStepPinPrefixId=cf+e+"_",r.SteppinPrefixId=lf+e+"_",r.StoppointPinPrefixId=af+e+"_",r.DisambiguationPinPrefixId=kf+e+"_",r.PolylinePrefixId=hf+e+"_",r.ItineraryPrefixId=vf+e+"_",it="0",r.distanceUnitFromCookie="",p=r.distanceUnitFromCookie?r.distanceUnitFromCookie===pi?rt.miles:rt.kilometers:h.DistanceUnitMiles?rt.miles:rt.kilometers,v={routeAvoidance:s.none,avoidTraffic:uf,routeOptimization:st.shortestTime,routeMode:nt(),routeIndex:0,maxRoutes:3,transitOptions:{transitTime:null,timeType:et.departure,showTransitStopSchedule:null,scheduleName:null},routeDraggable:!0,distanceUnit:p,itineraryContainer:null,waypointPushpinOptions:{height:48,width:44,anchor:new tt(38,41),textOffset:new tt(-10,4),draggable:h.WaypointDragging,hoverIcon:b.directionsImagePath+"pins/POI_flag_hover.png",icon:b.directionsImagePath+"pins/POI_flag_start.png",visible:ht?!1:!0},middleWaypointIcon:b.directionsImagePath+"pins/POI_flag_middle.png",lastWaypointIcon:b.directionsImagePath+"pins/POI_flag_end.png",stepPushpinOptions:{width:14,height:14,visible:!1,anchor:new tt(6,7),draggable:!1,icon:b.directionsImagePath+"pins/POI_step.png"},viapointPushpinOptions:{height:27,width:27,anchor:new tt(13,13),draggable:!0,visible:ht?!1:!0,icon:b.directionsImagePath+"pins/POI_dd-via-large.png"},drivingPolylineOptions:{strokeColor:new Microsoft.Maps.Color(fr,yr,br,gr),strokeThickness:ir},walkingPolylineOptions:{strokeColor:new Microsoft.Maps.Color(fr,du,ku,nf),strokeThickness:ir,strokeDashArray:"5 4"},transitPolylineOptions:{strokeColor:new Microsoft.Maps.Color(fr,yr,br,gr),strokeThickness:ir},autoUpdateMapView:!0,autoDisplayDisambiguation:!0,displayStepWarnings:!0,displayTrafficAvoidanceOption:!0,displayPreItineraryItemHints:!0,displayPostItineraryItemHints:!0,displayManeuverIcons:!0,displayDisclaimer:!1,displayWalkingWarning:!0,displayRouteSelector:!0,disambiguationPushpinOptions:{hoverIcon:b.directionsImagePath+"pins/poi_desktop_default_selected.png",icon:b.directionsImagePath+"pins/poi_desktop_default.png",width:28,height:28,visible:ht?!1:!0,anchor:new tt(14,14),textOffset:new tt(0,5)},displayRouteModeOptions:!1,displayWaypointDisambiguation:!1,displayLandingPage:!1},u=c(v),r.cloneOptions=c,r.resetDirectionState=function(n){var i,t;n?(n.removeAllWaypoints&&r._removeAllStoppoints(),n.resetRequestOptions&&(i=r.getRenderOptions(),u=c(v),r.setOptions(null,i)),n.resetRenderOptions&&(t=r.getRequestOptions(),u=c(v),r.setOptions(t,null))):(u=c(v),r._removeAllStoppoints()),y()},r.getOptions=function(){return u},r.getRenderOptions=function(){return{displayRouteModeOptions:u.displayRouteModeOptions,displayWaypointDisambiguation:u.displayWaypointDisambiguation,displayLandingPage:u.displayLandingPage,disambiguationPushpinOptions:f("disambiguationPushpinOptions"),itineraryContainer:u.itineraryContainer,waypointPushpinOptions:f("waypointPushpinOptions"),stepPushpinOptions:f("stepPushpinOptions"),middleWaypointIcon:u.middleWaypointIcon,lastWaypointIcon:u.lastWaypointIcon,viapointPushpinOptions:f("viapointPushpinOptions"),drivingPolylineOptions:f("drivingPolylineOptions"),walkingPolylineOptions:f("walkingPolylineOptions"),transitPolylineOptions:f("transitPolylineOptions"),autoDisplayDisambiguation:u.autoDisplayDisambiguation,displayStepWarnings:u.displayStepWarnings,displayPreItineraryItemHints:u.displayPreItineraryItemHints,displayPostItineraryItemHints:u.displayPostItineraryItemHints,displayManeuverIcons:u.displayManeuverIcons,displayRouteSelector:u.displayRouteSelector,displayTrafficAvoidanceOption:u.displayTrafficAvoidanceOption,displayWalkingWarning:u.displayWalkingWarning,displayDisclaimer:u.displayDisclaimer,autoUpdateMapView:u.autoUpdateMapView}},r.getRequestOptions=function(){return{routeIndex:u.routeIndex,routeMode:u.routeMode,routeAvoidance:u.routeAvoidance,routeOptimization:u.routeOptimization,avoidTraffic:u.avoidTraffic,distanceUnit:u.distanceUnit,maxRoutes:u.maxRoutes,transitOptions:f("transitOptions"),routeDraggable:u.routeDraggable}},r.setOptions=function(){for(var i=0;i<arguments.length;i++)arguments[i]&&typeof arguments[i]=="object"&&k(u,arguments[i])},r.updateDefaultRouteMode=function(){var n=u.routeMode.substr(0,1);typeof VEShell!="undefined"&&VEShell.Cookie.create(dr,n,1)},r.updateBoundingBoxWithBuffer=function(n,t){var r=wr*(n.latitude-t.latitude),i=wr*(n.longitude-t.longitude);n.latitude+=r,t.latitude-=r,n.longitude+=i,t.longitude-=i},r.addStoppoint=function(t,i){i===undefined?this.stoppoints[this.stoppoints.length]=t:this.stoppoints.splice(i,0,t),n.invoke(this,"waypointAdded",{waypoint:t})},r.updateRouteModeAndUnitBasedOnRouteResult=function(n){if(n)switch(n.requestedRouteMode){case 2:u.routeMode=o.walking;break;case 4:u.routeMode=o.transit;break;default:u.routeMode=o.driving}n.distanceUnit&&(u.distanceUnit=n.distanceUnit===pi?rt.miles:rt.kilometers)},r.removeModifiedLegs=function(n){for(var u=0,e=[],l,s,c,i,h,o,f,t=0;t<r.currentRouteLegs.length;t++){for(l=!1,i=0;i<r.stoppoints.length-1;i++){s=r.stoppoints[i];if(s.isViapoint())continue;o=u+"~"+s._uniqueId+"~"+r.getNextWaypoint(s._uniqueId)._uniqueId;if(r.routes[u].routeLegs[t].legKey===o){l=!0;break}}l||(f=r.routes[u].routeLegs[t].legKey,e[e.length]=f,r.removeLeg(f),t--)}if(n&&n.length>0)for(t=0;t<r.currentRouteLegs.length;t++){for(c=!1,i=0;i<n.length;i++){h=n[i],o=u+"~"+r.stoppoints[h[0]]._uniqueId+"~"+r.stoppoints[h[1]]._uniqueId;if(r.routes[u].routeLegs[t].legKey===o){c=!0;break}}c&&(f=r.routes[u].routeLegs[t].legKey,e[e.length]=f,r.removeLeg(f),t--)}return e},r.getUnavailableRouteWaypointIndexes=function(){for(var a=0,h=[],c,n,i,l,e,t,o,s,f,u=0;u<r.stoppoints.length-1;u++){c=!1,n=r.stoppoints[u];if(n.isViapoint())continue;i=r.getNextWaypoint(n._uniqueId);if(r.routes)for(l=r.routes[a].routeLegs,e=0;e<l.length;e++){t=l[e],o=t.subLegs.length;if(t.legKey===a+"~"+n._uniqueId+"~"+i._uniqueId&&n.getLocation()&&i.getLocation()&&t.subLegs[0].actualStart.latitude===n.getLocation().latitude&&t.subLegs[0].actualStart.longitude===n.getLocation().longitude&&t.subLegs[o-1].actualEnd.latitude===i.getLocation().latitude&&t.subLegs[o-1].actualEnd.longitude===i.getLocation().longitude&&(!r.getAllViaInLeg||o===r.getAllViaInLeg(n._uniqueId).length+1)){c=!0;break}}if(!c){for(s=new Array(2),s[0]=u,f=u+1;f<r.stoppoints.length;f++)if(r.stoppoints[f]._uniqueId===i._uniqueId){s[1]=f;break}h[h.length]=s}}return h},r.getStoppointIndex=function(n){for(var t=0;t<r.stoppoints.length;t++)if(n===r.stoppoints[t]._uniqueId)return t;return-1},r.getStoppointByIndex=function(n){for(var t=0;t<r.stoppoints.length;t++)if(t===n)return r.stoppoints[t];return null},r.getAllStoppointIds=function(){for(var t=[],n=0;n<r.stoppoints.length;n++)t[n]=r.stoppoints[n]._uniqueId;return t},r.getAllWaypoints=function(){for(var t=[],n=0;n<r.stoppoints.length;n++){if(r.stoppoints[n].isViapoint())continue;t[t.length]=r.stoppoints[n]}return t},r.getViaCount=function(){var t=0,i,n;if(r.stoppoints)for(i=r.stoppoints.length,n=0;n<i;n++)r.stoppoints[n].isViapoint()&&t++;return t},r.removeEmptyWaypoints=function(){var e=!1,u,t,f;if(r.stoppoints.length>2)for(u=0;u<r.stoppoints.length;u++){t=r.stoppoints[u];if(t){f=i.Helper.index_of(r.stoppoints,t);if(t.isViapoint()&&e){f<0||(r.stoppoints.splice(f,1),n.invoke(r,"waypointRemoved",{waypoint:t})),u--;continue}!u||t.getAddress()||t.getLocation()?e=!1:(f<0||(r.stoppoints.splice(f,1),n.invoke(r,"waypointRemoved",{waypoint:t})),u--,e=!0)}}r.removeModifiedLegs(null)},r.getStoppointById=function(n){for(var t=0;t<r.stoppoints.length;t++)if(r.stoppoints[t]._uniqueId===n)return r.stoppoints[t];return null},r.getPreviousStopPoint=function(n){for(var i=null,t=1;t<r.stoppoints.length;t++)r.stoppoints[t]._uniqueId===n&&(i=r.stoppoints[t-1]);return i},r.getPreviousWaypoint=function(n){for(var f=null,u=!1,i,t=0;t<r.stoppoints.length;t++){i=r.stoppoints[t];if(i._uniqueId===n){u=!0;break}i.isViapoint()||(f=r.stoppoints[t])}return u?f:null},r.getNextStoppoint=function(n){for(var i=null,t=0;t<r.stoppoints.length-1;t++)r.stoppoints[t]._uniqueId===n&&(i=r.stoppoints[t+1]);return i},r.getNextWaypoint=function(n){for(var f=null,e=!1,t,u,i=0;i<r.stoppoints.length-1;i++)if(r.stoppoints[i]._uniqueId===n){for(t=i+1;t<r.stoppoints.length;t++){u=r.stoppoints[t];if(!u.isViapoint()){f=r.stoppoints[t];break}}e=!0;break}return e?f:null},r.getRouteLegByLegKey=function(n){for(var t=0;t<r.currentRouteLegs.length;t++)if(r.currentRouteLegs[t].legKey===n)return r.currentRouteLegs[t];return null},r.removeStoppoint=function(t,i){for(var e=!1,s=-1,f,o,u=0;u<r.stoppoints.length;u++){f=r.stoppoints[u],e=f.isViapoint();if(f._uniqueId===t){r.stoppoints.splice(u,1),n.invoke(r,"waypointRemoved",{waypoint:f});break}e||(s=u)}if(!e&&i)for(u=s+1;u<r.stoppoints.length;u++)if(r.stoppoints[u].isViapoint())o=r.stoppoints[u],r.stoppoints.splice(u,1),n.invoke(r,"waypointRemoved",{waypoint:o}),u--;else break;r.removeModifiedLegs(null)},r.reverseWaypoints=function(){var t,n,i;for(r.removeAllViaPoint&&r.removeAllViaPoint(),t=r.stoppoints.length,n=0;n<t-1;n++)i=r.stoppoints[t-1],r.stoppoints.splice(t-1,1),r.stoppoints.splice(n,0,i)},r.addInlineImages=function(n){if(n)for(var t in n)r.inlineImagesCache[t]=n[t]},r.addRoutes=function(n,t){var h,f,i;if(!t||t.length===0)return;if(u.routeMode===o.transit||!r.routes)for(n||u.routeMode!==o.transit||(n=[],n[0]=[0,1]),r.routes=new Array(t.length),i=0;i<t.length;i++)r.routes[i]={},r.routes[i].routeLegs=[];for(h=u.routeIndex,(r.stoppoints.length>2||r.routes&&h>=r.routes.length)&&r.setOptions({routeIndex:0}),r.currentRouteLegs=r.routes[u.routeIndex].routeLegs,f=0;f<t.length;f++)for(i=0;i<t[f].routeLegs.length;i++){var c=n[i],l=c[0],s=c[1],e=t[f].routeLegs[i];e.legKey=f+"~"+r.stoppoints[l]._uniqueId+"~"+r.stoppoints[s]._uniqueId,e.startWaypointLocation=r.stoppoints[l].getLocation(),e.endWaypointLocation=r.stoppoints[s].getLocation(),r.addLegAndUpdateWaypoints(t[f].routeLegs[i],f),u.routeMode===o.transit&&g(t[f].routeLegs[i].itineraryItems)}},r.addLegAndUpdateWaypoints=function(n,t){var v,a,s,u,f,h;r.summary||(r.summary=new Array(0)),r.summary[t]||(r.summary[t]={},r.summary[t].distance=0,r.summary[t].time=0,r.summary[t].timeWithTraffic=0),r.summary[t].distance+=n.summary.distance,r.summary[t].time+=n.summary.time,r.summary[t].timeWithTraffic+=n.summary.timeWithTraffic;for(var p=n.legKey.split("~"),c=0,i=0,i=0;i<r.stoppoints.length;i++){if(r.stoppoints[i]._uniqueId===parseInt(p[1])){r.routes[t].routeLegs.splice(c,0,n);break}r.stoppoints[i].isViapoint()||c++}for(v=0;i<r.stoppoints.length-1;i++){n.subLegs[v++].subLegKey=t+"~"+r.stoppoints[i]._uniqueId+"~"+r.stoppoints[i+1]._uniqueId;if(!r.stoppoints[i+1].isViapoint())break}for(a=n.subLegs[0].subLegKey.split("~")[1],s=r.getStoppointById(parseInt(a)),s.setOptions({location:new l(n.subLegs[0].actualStart.latitude,n.subLegs[0].actualStart.longitude)}),s._locationIdentifier=n.subLegs[0].startLocationIdentifier,i=0;i<n.subLegs.length;i++){var y=n.subLegs[i].subLegKey.split("~")[2],e=r.getStoppointById(parseInt(y)),o=e.getAddress();o&&(u=n.itineraryItems,u.length>0&&(f=u[u.length-1].formattedText,f=f.replace(new RegExp("<WaypointName>.*</WaypointName>","gi"),"<WaypointName>"+o+"</WaypointName>"),f=f.replace(new RegExp("<EndLocation>.*</EndLocation>","gi"),"<EndLocation>"+o+"</EndLocation>"),u[u.length-1].formattedText=f)),h={location:new l(n.subLegs[i].actualEnd.latitude,n.subLegs[i].actualEnd.longitude)},e.isViapoint()&&(h.address=n.subLegs[i].endDescription),e.setOptions(h),e._locationIdentifier=n.subLegs[i].endLocationIdentifier}d(t)},r.removeLeg=function(n){for(var f=parseInt(n.split("~")[0]),t,e,u=0;u<r.currentRouteLegs.length;u++){t=r.currentRouteLegs[u];if(t.legKey===n){r.summary[f].distance-=t.summary.distance,r.summary[f].time-=t.summary.time,r.summary[f].timeWithTraffic-=t.summary.timeWithTraffic,e=i.Helper.index_of(r.currentRouteLegs,t),e<0||r.currentRouteLegs.splice(e,1),d(f);break}}},r.persistResolvedWaypoint=function(n,t){var e={failed:!1,invalidCredentials:!1},u,f,i;if(n[ai]){u=n[ai][0];if(u&&u.length===t.length)for(f=0;f<r.stoppoints.length;f++)for(i=0;i<t.length;i++)r.stoppoints[f]._uniqueId===t[i]&&u[i]&&(u[i].failed?e.failed=!0:u[i].invalidCredentials?e.invalidCredentials=!0:r.stoppoints[f]._updateWaypoint(u[i]))}return e},r.validateAndUpdateWhatOnlyWaypointDisambiguation=function(){var u,t,e;if(!this.stoppoints.length)return;for(u=this.stoppoints[0],t=1;t<this.stoppoints.length;t++){var n=this.stoppoints[t],f=n.getDisambiguationResult(),i=f?f.dependentLocation:null,r=u.getLocation();f&&n._inputType===hu.whatOnly&&i&&(!r||i.latitude.toFixed(a)!==r.latitude.toFixed(a)||i.longitude.toFixed(a)!==r.longitude.toFixed(a))&&(e=n.getAddress(),n.clear(),n.setOptions({address:e})),u=n}},r._getPrefixId=function(){var n="";return u.itineraryContainer&&u.itineraryContainer.id?(n=u.itineraryContainer.id,ti&&(n+=e+"_")):n=r.ItineraryPrefixId,n},r._removeAllStoppoints=function(){while(r.stoppoints.length){var t=r.stoppoints[r.stoppoints.length-1];r.stoppoints.pop(t),n.invoke(r,"waypointRemoved",{waypoint:t})}y()},r.dispose=function(){y(),r._removeAllStoppoints(),u=null,v=null,r.inlineImagesCache=null}}function ki(s,h){function fi(){var t=!1,n;return typeof VEShell!="undefined"&&(n=VEShell.TaskHost.get_activeTask(),n&&(t=n._isPermalinkRequest&&!n._isBackButtonRequest)),t}function tr(t){var i=t.waypoint;k.push(n.addHandler(i,"changed",r(y,fr))),k.push(n.addHandler(i,"reverseGeocoded",r(y,or))),si(i),n.invoke(nt,"waypointAdded",{waypoint:i})}function hr(t){var i=t.waypoint;kt(i),n.invoke(nt,"waypointRemoved",{waypoint:i}),i.dispose()}function fr(n){var t=n.waypoint;g&&!p&&(rt.clearRoute(null,!1),w&&(w._removePushpins(v.SteppinPrefixId),w._removePushpins(v.StoppointPinPrefixId),w._removePushpins(v.TransitStepPinPrefixId),w.createPushpins(v.getAllWaypoints())),g._waypointChanged(t)),si(t),tt!==-1&&v.isRoutableLatLongAvailableForAllStopPoints&&v.isRoutableLatLongAvailableForAllStopPoints()&&ri(v.stoppoints)}function si(n){n._address&&!n._location&&v.getOptions().displayLandingPage?ni.resolveWaypoint(d,n,null,-1,null,y._permalinkHelper):!n._address&&n._location&&ni.reverseGeocode(d,n._location,r(y,li),r(y,li),n,y._permalinkHelper)}function li(n,t){var i="",u="",r;n&&(i=n.formattedAddress,u=n.shortFormattedAddress),i||(r=t.getLocation(),i=r.latitude.toFixed(a)+","+r.longitude.toFixed(a),u=i),t.setOptions({address:i,shortAddress:u}),t._reverseGeocoded()}function or(n){var t=n.waypoint;p&&p.updateReverseGeocodedText(t),g&&g.updateReverseGeocodedText(t)}function ut(t,i){var r=!1;return n.hasHandler(nt,t)&&(n.invoke(nt,t,i),r=i.handled),r}function ur(n){ut("mouseEnterStep",n)||(p&&p._onMouseEnterStepUnhandled(n),w&&v.getOptions().routeMode!==o.transit&&w.displayStepPushpin(n.location,n.stepNumber))}function wi(n){ut("mouseLeaveStep",n)||(p&&p._onMouseLeaveStepUnhandled(n),w&&v.getOptions().routeMode!==o.transit&&w.hideStepPushpin())}function ir(n){!ut("itineraryStepClicked",n)&&d&&(d.setView({center:n.location,zoom:16}),v.getOptions().routeMode!==o.transit&&w&&w.displayStepPushpin(n.location,n.stepNumber))}function rr(n){ct&&window.clearTimeout(ct),ct=window.setTimeout(r(y,function(){ct=null;if(!ut("mouseEnterRouteSelector",n)&&d){rt.clearRoute(null,!1);var t=v.routes[n.routeIndex].routeLegs;rt.updateRouteOnMapControl(t,!0,!1),rt.updateRouteOnMapControl(v.currentRouteLegs,!0,!0),w&&w.createTransitStepPushpins&&w.createTransitStepPushpins(t)}}),rf)}function cr(n){if(ct){window.clearTimeout(ct),ct=null;return}if(!ut("mouseLeaveRouteSelector",n)&&d){rt.clearRoute(null,!1),rt.updateRouteOnMapControl(v.currentRouteLegs,!1,!1);var t=v.currentRouteLegs;w&&w.createTransitStepPushpins&&w.createTransitStepPushpins(t)}}function pr(n){ut("routeSelectorClicked",n)||(v.setOptions({routeIndex:n.routeIndex}),y._setViewPortForSelectedRoute(),typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(n.containerElement.id),gt())}function wr(t){p.createRouteSelectorItem&&!ut("beforeRouteSelectorRender",t)&&p.createRouteSelectorItem(t.containerElement,t.routeLeg,t.routeIndex),delete t.handled,n.invoke(nt,"afterRouteSelectorRender",t)}function br(t){ut("beforeStepRender",t)||p.createSingleItineraryStep(t.step,t.prevStep,t.stepIndex,t.routeLegIndex,t.containerElement,t.lastStep),delete t.handled,n.invoke(nt,"afterStepRender",t)}function yr(t){!ut("beforeWaypointRender",t)&&p._createNewWaypoint&&p._createNewWaypoint(t.waypoint,t.containerElement),delete t.handled,n.invoke(nt,"afterWaypointRender",t)}function lr(t){ut("beforeSummaryRender",t)||(p._directionsPanel.appendChild(t.containerElement),p.createRouteSummary(t.summary,t.routeLegIndex,t.containerElement)),delete t.handled,n.invoke(nt,"afterSummaryRender",t)}function pt(i,u,f,e){if(!v.getOptions().displayLandingPage)return;yt(),dt(),g?g.dispose():(g=new vi(d,w,y._permalinkHelper,v),k.push(n.addHandler(nt,"beforeDisambiguationRender",g._createWaypointDisambiguation)),k.push(n.addHandler(g,"updateDirections",r(y,y.setDirections))),k.push(n.addHandler(g,"optionsChanged",r(y,function(n){if(!n.clearResultsPage&&p)y.setDirections();else if(n.refreshLandingPage||p)n.clearResultsPage&&!n.refreshLandingPage?(yt(),at(),g.createLandingPushpins(),g._setFocus()):pt(!0,!0,"");else return})))),i&&(at(),g.createLandingPushpins()),g._createLandingPage(f,e),t._reRenderDirectionsPanel(v._getPrefixId()),n.invoke(nt,"landingPageUpdated",{updateHistory:u}),window.setTimeout(g._setFocus,100)}function ar(t){t.failed?(y._setViewPortForSelectedRoute(),y.setDirections()):(v.getViaCount()>0&&v.setOptions({avoidTraffic:!1}),v.setOptions({routeIndex:0}),y.setDirections()),n.invoke(nt,"dragDropCompleted",{})}function vr(n){ai(n.cordinates)}function st(t,i){var s=v.getOptions(),r=s.routeMode,e,f;if(t===c.invalidCredentials)message=u.getString("L_InvalidCredentials_Text");else if(t===c.tooFar)message=u.getString("L_DirectionsTripLengthTooLong_Text"),r===o.walking?message=u.getString("L_WalkingDirectionsTripLengthTooLong_Text"):r===o.transit&&(message=u.getString("L_TransitTripLengthTooLong_Text"));else if(t===c.timeout||t===c.cacheMiss||t===c.searchServiceFailed||t===c.unknownError)message=u.getString("L_RouteErrorServerBusy_Text"),r===o.walking?message=u.getString("L_WalkingRouteErrorServerBusy_Text"):r===o.transit&&(message=u.getString("L_TransitRouteErrorServerBusy_Text"));else if(t!==c.success)switch(r){case o.driving:message=u.getString("L_DrivingDirectionNotAvailable_Text");break;case o.walking:message=u.getString("L_WalkingDirectionNotAvailable_Text");break;case o.transit:message=u.getString("L_TransitDirectionNotAvailable_Text")}t===c.waypointDisambiguation?message=u.getString("L_WaypointDisambiguationError_Text"):t===c.emptyWaypoint?message=u.getString("L_EmptyWaypointError_Text"):t===c.atleastTwoWaypointsRequired?message=u.getString("L_AtleastTwoWaypointsRequiredError_Text"):t===c.firstOrLastStoppointIsVia?message=u.getString("L_FirstOrLastStoppointIsViaError_Text"):t===c.exceedMaxWaypointLimit&&(message=u.getString("L_ExceedMaxWaypointLimitError_Text").replace("{0}",ui));if(r===o.transit)switch(t){case c.dataSourceNotFound:case c.cannotFindNearbyRoad:message=u.getString("L_TransitNotAvailableWarning_Text");break;case c.noSolution:message=u.getString("L_TransitDirectionNoSolution_Text");break;case c.exceedMaxWaypointLimit:message=u.getString("L_ExceedMaxTransitWaypointLimitError_Text");break;case c.noAvailableTransitTrip:message=u.getString("L_TransitDirectionNoAvailableTransitTrip_Text");break;case c.outOfTransitBounds:message=u.getString("L_TransitDirectionOutOfTransitBounds_Text");break;case c.transitStopsTooClose:case c.walkingBestAlternative:message=u.getString("L_TransitDirectionTooClose_Text")}message&&typeof vi!="undefined"&&pt(!0,!0,message,t),t!==c.success&&(e=!1,f={},t===c.waypointDisambiguation&&(e=yi(i),e?n.invoke(nt,"disambiguationAdded",{waypoint:i,waypointIndex:v.getStoppointIndex(i._uniqueId)}):f.waypoint=i),e||(f.responseCode=t,f.message=message,n.invoke(nt,"directionsError",f)))}function yi(t){var c=!1,l=v.getOptions(),s,f,a,o,h,u;return l.autoDisplayDisambiguation&&t&&(s=t.getDisambiguationContainer(),f=v._getPrefixId(),s||(oi.createDirectionPanel(l.itineraryContainer,f,a),s=i("#"+f+ei).element()),a=l.routeMode,o={waypoint:t,containerElement:s},ut("beforeDisambiguationRender",o)?c=o.handled:(et||(et=new lu(d,w,!0,!0,v,y._permalinkHelper),k.push(n.addHandler(et,"selected",r(y,pi)))),h=o.containerElement,u=null,h&&(u=i("#"+f+"DisambiguationContainer").element(),u?u.innerHTML="":u=e(f+"DisambiguationContainer","MicrosoftMap dd_disambgContainer",h)),et.addDisambiguationControl(u,t),c=!0)),c}function pi(n){var r,t,u;ut("disambiguationSuggestionSelected",n)||(r=n.waypoint,t=i("#"+v._getPrefixId()+"DisambiguationContainer").element(),t&&t.parentNode&&t.parentNode.removeChild(t),u=n.newWaypointOptions,r.clear(),r.setOptions(u),y.setDirections())}function ii(){var i=!0,t,n;if(v.getAllWaypoints().length<2)return st(c.atleastTwoWaypointsRequired),!1;for(t=v.stoppoints.length,n=0;n<t;n++)if(!v.stoppoints[n].getLocation()&&!v.stoppoints[n].getAddress())return st(c.emptyWaypoint,v.stoppoints[n]),!1;if(v.stoppoints[0].isViapoint()||v.stoppoints[t-1].isViapoint())return st(c.firstOrLastStoppointIsVia),!1;for(v.validateAndUpdateWhatOnlyWaypointDisambiguation(),count=v.stoppoints.length,n=0;n<count;n++)if(!v.stoppoints[n].getLocation()){if(v.stoppoints[n].getDisambiguationResult())return st(c.waypointDisambiguation,v.stoppoints[n]),!1;break}return!0}function di(i,r){var a,u,s,h,e,o,f,l;t.toggleTaskProgressIndicator(!1,v._getPrefixId()),a=!0,u=c.success,r&&r.success&&i?(s=r.userData,h=s[0],v.removeModifiedLegs(h),e=v.persistResolvedWaypoint(i,s[1]),e.invalidCredentials?u=c.invalidCredentials:e.failed&&(u=c.searchServiceFailed),ii()&&(v.saveUserLocationEnabled&&DirectionsShell.DirectionShellUtility.storeAnonymousLocations(v.stoppoints),o=i.routeResults,o&&(f=o[0],f.routeResponseCode===c.success?(a=!1,v.addInlineImages(f.inlineImageCache),v.addRoutes(h,f.routes),v.updateRouteModeAndUnitBasedOnRouteResult(f),l=v.getOptions().routeIndex,(v.stoppoints.length>2||v.routes&&l>=v.routes.length)&&v.setOptions({routeIndex:0}),y._setViewPortForSelectedRoute(),gt(),wt.end("Directions Completed","setDirections"),n.invoke(nt,"directionsUpdated",{routeSummary:v.summary,route:v.routes})):(u=f.routeResponseCode,f.invalidCredentials&&(u=c.invalidCredentials))))):u=r&&!r.success?c.timeout:c.unknownError,u!==c.success&&st(u),tt=-1}function gi(n,i){var r,u;t.toggleTaskProgressIndicator(!1,v._getPrefixId()),r=c.success,i&&i.success&&n?(u=n.TransitInfoByStopId&&n.TransitInfoByStopId[0],ki(u)):r=i&&!i.success?c.timeout:c.unknownError,r!==c.success&&st(r),tt=-1}function bi(){y.setDirections()}function dt(){i("#"+v._getPrefixId()+nr).set_html("")}function ki(n){function ft(n,t){for(var f=ut(n,t),u,i=0;i<r.childNodes.length;i++){u=r.childNodes[i];if(u.departure&&u.departure.getTime()>f.departure.getTime()){it.insertBefore(f,u);return}}it.appendChild(f)}function ut(n,r){var l=t._parseCustomDateTime(r.departure),o=f("tr"),u,y,h,s,c,v,a;return o.departure=l,u=f("td",null,null,o),c=n.AbbreviatedName,c.length>7?(h=e(null,null,u),s=e(null,null,u),u.colSpan=2):(h=u,u.className="dd_schCell1",s=y=f("td",null,"dd_schCell2",o)),v=i(h).add_class("dd_stopTitle"),s.className="dd_schSubTitle",h.appendChild(document.createTextNode(n.AbbreviatedName)),s.appendChild(document.createTextNode(r.headsign)),a=f("td",null,"dd_stopTime",o),a.appendChild(document.createTextNode(t._getFormattedTime(l))),o}function ot(n){f("span",b+"MessageContainer","dd_messageContainer",r,n)}var b=v._getPrefixId(),r,tt,et,k,w,s,y,o,l,h,nt,a,d;yt(),dt(),g&&g.dispose(),r=i("#"+b+nr).element(),tt=v.getOptions().transitOptions.scheduleName||u.getString("L_TransitDefaultTitle_Text"),e(null,"dd_stopHeader",r).appendChild(document.createTextNode(tt)),et=e(null,null,r),k=e(null,"dd_calendarContainer",r),nu(v,"ScheduleTime",k,null),i(t._addInputElement(b+"UpdateSchedule","button goButton",k,u.getString("L_TransitUpdateSchedule_Text"),"Submit","")).add_event("click",bi),w=e(null,"dd_schHeader",r),e(null,"dd_schHeaderRoutes",w).appendChild(document.createTextNode(u.getString("L_TransitScheduleRoutes_Text"))),e(null,"dd_schHeaderDeparts",w).appendChild(document.createTextNode(u.getString("L_TransitScheduleDeparts_Text")));var it=f("table",null,null,r),p=c.success,rt=!1;for(s=0;s<n.length;s++){y=n[s],p==c.success&&(p=y.responseCode),o=y.scheduleTimeInfo;if(o)for(l=0;l<o.length;l++)for(h=o[l],nt=h.Line,a=0;a<h.Trips.length;a++)d=h.Trips[a],rt=!0,ft(nt,d);o&&rt||ot(u.getString("L_TransitScheduleUnavailable_Text"))}return p}function gt(){d&&(wt.start("resultPage-Route"),rt.clearRoute(null,!1),rt._removeAllTemporaryRoutes(),ht&&n.invoke(nt,"beforeRouteRender",{}),rt.updateRouteOnMapControl(v.currentRouteLegs,!1,!1),w&&w.createAllPushpins(v.currentRouteLegs,v.stoppoints),wt.end("Directions-route","resultPage-Route"));var i=v.getOptions();!ht&&i.itineraryContainer&&(wt.start("resultPage-itinerary"),typeof pt!="undefined"&&pt(!1,!1,""),yt(),dt(),p=vt.getNewResultsPage(d,w,y._permalinkHelper,v),k.push(n.addHandler(p,"updateDirections",r(y,y.setDirections))),k.push(n.addHandler(p,"mouseEnterStep",r(y,ur))),k.push(n.addHandler(p,"mouseLeaveStep",r(y,wi))),k.push(n.addHandler(p,"itineraryStepClicked",r(y,ir))),k.push(n.addHandler(p,"beforeStepRender",r(y,br))),k.push(n.addHandler(p,"beforeWaypointRender",r(y,yr))),k.push(n.addHandler(p,"beforeSummaryRender",r(y,lr))),k.push(n.addHandler(p,"beforeRouteSelectorRender",r(y,wr))),k.push(n.addHandler(p,"mouseEnterRouteSelector",r(y,rr))),k.push(n.addHandler(p,"mouseLeaveRouteSelector",r(y,cr))),k.push(n.addHandler(p,"routeSelectorClicked",r(y,pr))),k.push(n.addHandler(p,"setMapView",r(y,function(){y._setViewPortForSelectedRoute()}))),p.createResultsPage(),t._reRenderDirectionsPanel(v._getPrefixId()),wt.end("Directions-itinerary","resultPage-itinerary"),n.invoke(nt,"itineraryUpdated",{}))}function ri(n){var u=v.getOptions(),t;if(u.autoUpdateMapView&&!(ti||ht)&&!fi()){var r=[],f=n.length,i=!0;for(t=0;t<f;t++)if(n[t]&&n[t].getLocation())r[t]=n[t].getLocation();else{i=!1;break}i&&ai(r)}}function ai(n){var e,o,h,t,i,u,r,f,s;if(!d)return;e=n.length;if(e)if(e===1)o=n[0],h={center:new l(o.latitude,o.longitude),zoom:ef},d.setView(h);else{for(t=n[0].clone(),i=new l(t.latitude,t.longitude),f=1;f<e;f++)u=n[f].latitude,r=n[f].longitude,t.latitude>u&&(t.latitude=u),t.longitude>r&&(t.longitude=r),i.latitude<u&&(i.latitude=u),i.longitude<r&&(i.longitude=r);v.updateBoundingBoxWithBuffer(i,t),s=hi.fromEdges(i.latitude,t.longitude,t.latitude,i.longitude),d.setView({bounds:s})}else return}function at(){d&&(rt.clearRoute(null,!1),w&&w.removeAllPushpins())}function kt(t){var i=k.length;while(i--)t&&k[i].target===t&&(n.removeHandler(k[i]),k.pop(k[i])),t||n.removeHandler(k[i]);t||(k=[])}function yt(){p&&(p.dispose(),kt(p),p=null)}var y=this,nt=h,v=new ot,d=s,lt,rt,bt;y.options=null,y._eros=null;var g=null,p=null,ct=null,et=null;y._permalinkHelper=new er(d,v);var tt=-1,k=[],w=null;d&&(typeof tu!="undefined"&&(lt=new tu(d)),typeof ci!="undefined"&&(w=new ci(d,v,lt),k.push(n.addHandler(w,"disambiguationPushpinsAdded",r(y,vr)))),rt=new yu(d,v),typeof iu!="undefined"&&(bt=new iu(w,rt,v,d,y._permalinkHelper,lt),k.push(n.addHandler(bt,"dropCompleted",r(y,ar))))),k.push(n.addHandler(v,"waypointAdded",r(y,tr))),k.push(n.addHandler(v,"waypointRemoved",r(y,hr))),y.setDirections=function(){var s,o,i,e,u,f;it.isRequestCompleted(tt)||it.abortRequest(tt),u=v.getOptions(),ii()?(wt.start("setDirections"),y.clearDisplay(),f=v.getUnavailableRouteWaypointIndexes(),f.length>0&&v.stoppoints.length>=2?t.getCredentials(d,r(y,function(n){s=y._permalinkHelper.generateGetDirectionsLink(f,v.stoppoints,n),o=t.convertPermalinkDictionaryToPermalink(s),i=b.directionsService+o;var u=[];u[0]=f,u[1]=v.getAllStoppointIds(),e=r(y,di),t.toggleTaskProgressIndicator(!0,v._getPrefixId()),tt=it.getObjectAsync(i,e,u,sr,t.GetUniqueNetworkRequestId(i)),ri(v.stoppoints)})):(gt(),wt.end("Directions Completed-cache","setDirections"),n.invoke(nt,"directionsUpdated",{routeSummary:v.summary,route:v.routes}))):u.transitOptions.showTransitStopSchedule&&u.transitOptions.showTransitStopSchedule.length?t.getCredentials(d,r(y,function(n){var f=u.transitOptions.showTransitStopSchedule;y.clearDisplay(),s=y._permalinkHelper.generateGetTransitScheduleLink(f,n),o=t.convertPermalinkDictionaryToPermalink(s),i=b.directionsService+o,e=r(y,gi),t.toggleTaskProgressIndicator(!0,v._getPrefixId()),tt=it.getObjectAsync(i,e,null,sr,t.GetUniqueNetworkRequestId(i))})):g||at()},y._setViewPortForSelectedRoute=function(n){var r=v.getOptions(),t,i;d&&v.summary&&(r.autoUpdateMapView||n)&&!fi()&&(t=v.summary[r.routeIndex],t&&(i=hi.fromEdges(t.northEast.latitude,t.southWest.longitude,t.southWest.latitude,t.northEast.longitude),d.setView({bounds:i})))},y.clearDisplay=function(){at(),yt()},y.resetDirections=function(n){y.clearDisplay(),v.resetDirectionState(n)},y.addWaypoint=function(n,t){if(n instanceof ft){var i=v.getOptions();(v.stoppoints.length<ui||i.routeMode===o.transit)&&(v.stoppoints.length<2||i.routeMode!==o.transit)?(v.addStoppoint(n,t),it.isRequestCompleted(tt)||(it.abortRequest(tt),y.setDirections())):st(c.exceedMaxWaypointLimit)}},y.removeWaypoint=function(n,t){var i=null;i=typeof n=="number"?v.getStoppointByIndex(n):n,i instanceof ft&&(it.isRequestCompleted(tt)?v.removeStoppoint(i._uniqueId,t):(it.abortRequest(tt),v.removeStoppoint(i._uniqueId,t),y.setDirections()))},y.setOptions=function(n,t){it.isRequestCompleted(tt)?v.setOptions(n,t):(it.abortRequest(tt),v.setOptions(n,t),y.setDirections())},y.setRenderOptions=function(n){y.setOptions(null,n)},y.setRequestOptions=function(n){y.setOptions(n,null)},y.getNearbyArterials=function(n,t,i,r){n instanceof l&&t&&ni.getNearbyArterialsResults(d,n,t,i,r,y._permalinkHelper)},y.reverseGeocode=function(n,t,i,r){n instanceof l&&t&&ni.reverseGeocode(d,n,t,i,r,y._permalinkHelper)},y._getState=function(){return v},y.dispose=function(){at(),tt!=-1&&(it.abortRequest(tt),tt=-1),et&&(et.dispose(),et=null),p&&(p.dispose(),p=null),g&&(g.dispose(),g=null),kt(null),d&&(lt&&(lt.dispose(),lt=null),w&&w.dispose(),rt.dispose(),bt&&bt.dispose()),v&&(v.dispose(),v=null)}}function lu(o,s,h,c,a,v){function nt(o){var h=o.getDisambiguationResult(),a=h.locationSuggestions.length>0,ot=a?h.locationSuggestions.length:h.businessSuggestions.length,l,s,tt,et,k,ct,v,nt;if(b){b.innerHTML="",lt&&(l="",l=ti?u.getString("L_DisambiguationGeneralMessageb2b_Text").replace("{0}",o.getAddress()):ht?o._uniqueId===d.stoppoints[0]._uniqueId?u.getString("L_DisambiguationMessageFromMbing_Text"):u.getString("L_DisambiguationMessageToMbing_Text"):u.getString("L_DisambiguationGeneralMessage_Text"),ot>1?f("span",p+"DisambiguationMessage2"+o._uniqueId,"headerText",b,l):ot>0?f("span",p+"DisambiguationMessage"+o._uniqueId,"headerText",b,l):f("span",p+"DisambiguationMessage"+o._uniqueId,"headerText",b,h.headerText));var ut=e(p+"DisambiguationChoicesPanel"+o._uniqueId,"",b),pt=f("ul","","",ut,""),c=0;for(h.businessSuggestions.length>0&&(c=h.businessSuggestions[0].index),s=0;s<ot;s++)tt=f("li",p+"DisambiguationAddress_"+o._uniqueId+"_"+s,"",pt,""),et="dd_DisambgStepLetter",s+1+c<10||(et+=" dd_TwoDigitsDisambgPushPin"),f("span",p+"DisambiguationPushpin_"+o._uniqueId+"_"+s,et,tt,(c+1+s).toString()),k=e(p+"DisambiguationAddressContainer"+o._uniqueId,a?"dd_LocDisambgAddressContainer":"dd_BizDisambgAddressContainer",tt),ct=t._addAnchorElementWithEncodeOption(p+"DisambiguationAddressLink"+o._uniqueId+s,"",k,a?h.locationSuggestions[s].formattedSuggestion:h.businessSuggestions[s].name,"",!1),i(ct).add_event("click",r(w,st),!1),a||(f("div","","",k,h.businessSuggestions[s].address),h.businessSuggestions[s].isApproximate&&f("div","","disambgLocationApprox",k,u.getString("L_ApproximateLocation_Text"))),v=i(tt),v.add_event("mouseenter",r(w,vt),!0).add_event("mouseleave",r(w,yt),!0),v.set_attr("WaypointUniqueId",o._uniqueId).set_attr("SuggestionsIndex",s.toString()),v.select("*").set_attr("WaypointUniqueId",o._uniqueId).set_attr("SuggestionsIndex",s.toString());h.businessSuggestions.length>0&&(c>0&&rt(!0,ut,o._uniqueId,!1,c-ru),h.hasMoreSuggestions&&(c>0&&f("span","","",ut,"|"),rt(!1,ut,o._uniqueId,!c,c+ru)))}it&&y&&y.createDisambiguationPushpin&&(y.removeDisambiguationPushpins(o),y.createDisambiguationPushpin(o),g=n.addHandler(y,"selected",r(w,ft))),ki&&ki.makeDummyRequest&&(nt={},nt.query=o.getAddress(),nt.queryType=a?"L":"B",ki.makeDummyRequest(at,!0,nt))}function yt(n){tt(n.target,!1)}function vt(n){tt(n.target,!0)}function rt(n,t,f,e,o){var s=k(n?p+"DisambiguationPreviousLink":p+"dd_DisambgNextLink",n?"dd_DisambgPreviousLink":e?"dd_DisambgNextLinkFirstPage":"dd_DisambgNextLink",t,n?u.getString("L_Previous_Text"):u.getString("L_Next_Text"),"#");s.setAttribute("StartingIndex",o),s.setAttribute("WaypointUniqueId",f),i(s).add_event("click",r(w,ot),!1)}function tt(n,t){var e=i(n),f=p+"DisambiguationPushpin",o=p+"DisambiguationAddress",r=e.get_attr("WaypointUniqueId"),u=parseInt(e.get_attr("SuggestionsIndex"));t?i("#"+f+"_"+r+"_"+u).add_class("dd_DisambgStepLetterHover"):i("#"+f+"_"+r+"_"+u).remove_class("dd_DisambgStepLetterHover"),y&&y.displayHoverPushpin(d.DisambiguationPinPrefixId+r+"_"+u,t)}function st(n){var i;n.preventDefault();var t=n.target,u="",r=-1;ut(n.target.getAttribute("shapeId"))?(ut(n.target.getAttribute("WaypointUniqueId"))&&(t=t.parentNode),u=t.getAttribute("WaypointUniqueId").toString(),r=t.getAttribute("SuggestionsIndex")):(i=t.getAttribute("shapeId").split("_"),u=i[1],r=parseInt(i[2])),ft({waypointId:parseInt(u),suggestionsIndex:parseInt(r)})}function ft(t){var e=t.suggestionsIndex,o=t.waypointId,f=null,u=d.getStoppointById(parseInt(o)),r,i;u&&(r=u.getDisambiguationResult(),r&&r.locationSuggestions&&r.locationSuggestions.length>0?(i=r.locationSuggestions[e],f={address:i.suggestion,location:new l(i.location.latitude,i.location.longitude),geoLocation:new l(i.location.latitude,i.location.longitude)}):(i=r.businessSuggestions[e],f={address:i.address,location:new l(i.location.latitude,i.location.longitude),geoLocation:new l(i.location.latitude,i.location.longitude),businessDetails:{website:i.website,phoneNumber:i.phoneNumber,businessName:i.name,entityId:i.entityId}})),y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(u),n.invoke(w,"selected",{waypoint:u,newWaypointOptions:f})}function ot(n){n.preventDefault();var i=n.target.getAttribute("WaypointUniqueId"),u=d.getStoppointById(parseInt(i)),t=n.target.getAttribute("StartingIndex");t<0&&(t=0),ni.resolveWaypoint(ct,u,r(w,et),t,null,v)}function et(n){it&&y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(n),nt(n)}var w=this,g,y=s,lt=h,it=c,d=a,ct=o,at=v,p=d._getPrefixId(),b=null;w.addDisambiguationControl=function(n,t){b=n,nt(t)},w.dispose=function(){y&&y.removeDisambiguationPushpins&&y.removeDisambiguationPushpins(),n.removeHandler(g),g=null}}function ci(t,i,u){function l(n){var t=f._state.cloneOptions(f._state.getOptions().stepPushpinOptions);return t.id=f._state.SteppinPrefixId+n,t.visible=!0,t}function p(n){var r=f._state.stoppoints,u=!1,e=!1,t,i;return r&&r.length>1&&(u=r[r.length-1]._uniqueId===n._uniqueId,e=!u&&r[0]._uniqueId!==n._uniqueId),t=f._state.getOptions(),i=oi.getDefaultWaypointOption(f._state,n),i.id=f._state.StoppointPinPrefixId+n._uniqueId,u&&t.lastWaypointIcon&&(i.icon=t.lastWaypointIcon),e&&t.middleWaypointIcon&&(i.icon=t.middleWaypointIcon),i}function w(n){var t=f._state.cloneOptions(f._state.getOptions().viapointPushpinOptions);return t.id=f._state.StoppointPinPrefixId+n._uniqueId,t}function b(n){var t=n.target;t.setOptions({icon:t._hoverIcon})}function k(n){var t=n.target;t.setOptions({icon:t._originalIcon})}function v(t){n.invoke(f,"drag",t)}function y(t){n.invoke(f,"drop",t)}function c(t){var r=e.length;while(r--){var i=e[r].target,i=i instanceof lt||i instanceof fi?i:i.getPushpin(),u=i._uniqueId?i._uniqueId:i.getId();t&&u.indexOf(t)!==0||(n.removeHandler(e[r]),e.pop(e[r]))}}var f=this,e,a,s;f._map=t,f._state=i,e=[],f._handlers=e,a=u,s=null,f.createAllPushpins=function(n,t){f.removeAllPushpins(),f.createPushpins(t),f._state.getOptions().routeMode===o.transit&&f.createTransitStepPushpins&&f.createTransitStepPushpins(n)},f.displayStepPushpin=function(n,t){if(s){s.setLocation(n);var i=l(t);s.setOptions(i)}else s=new lt(n,l(t)),f._map.entities.push(s)},f.hideStepPushpin=function(){s&&s.setOptions({visible:!1})},f.createPushpins=function(t){for(var u,l,p,i,o,c,s=0;s<t.length;s++){u=t[s];if(!u.getLocation())continue;l=f._state.StoppointPinPrefixId+u._uniqueId,p=f._getEntityById(l),p||(i=u.getPushpin(),i?i.setLocation(u.getLocation()):(o=f.getDefaultOptions(u),i=new lt(u.getLocation(),o),o.hoverIcon&&(i._hoverIcon=o.hoverIcon,f._attachHoverBehavior(i))),i._uniqueId=l,f._map.entities.push(i),h.WaypointDragging&&typeof tr!="undefined"&&i.getDraggable()&&typeof tr!="undefined"&&(c=new tr(i,f._map,a),e.push(n.addHandler(c,"drag",r(f,v))),e.push(n.addHandler(c,"drop",r(f,y)))))}},f.displayHoverPushpin=function(n,t){var i=f._getEntityById(n);i&&i.setOptions({icon:t?i._hoverIcon:i._originalIcon})},f.removeAllPushpins=function(){f._removePushpins("")},f._attachHoverBehavior=function(t){t._hoverIcon&&(t._originalIcon=t.getIcon(),e.push(n.addHandler(t,"mouseover",r(f,b))),e.push(n.addHandler(t,"mouseout",r(f,k))))},f._removePushpins=function(n){var e,u,i,r;for(c(n),e=f._map.entities,u=0;u<e.getLength();u++)i=e.get(u),i&&(i instanceof lt||i instanceof fi)&&(i.getId&&i.getId()||i._uniqueId)&&(r=i._uniqueId?i._uniqueId:i.getId(),(n&&r.indexOf(n)===0||!n&&(r.indexOf(f._state.SteppinPrefixId)===0||r.indexOf(f._state.StoppointPinPrefixId)===0||r.indexOf(f._state.DisambiguationPinPrefixId)===0||r.indexOf(f._state.TransitStepPinPrefixId)===0))&&(t.entities.remove(i),u--,r.indexOf(f._state.SteppinPrefixId)===0&&(s=null)))},f._isLightColorPopupRequired=function(){var n=!1,t=f._map.getImageryId();switch(t){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":n=!0;break;default:n=!1}return n},f.getDefaultOptions=function(n){return n.isViapoint()?w(n):p(n)},f._getEntityById=function(n){for(var r=f._map.entities,u=r.getLength(),t,i=0;i<u;i++){t=r.get(i);if(t&&(t._uniqueId&&t._uniqueId===n||t.getId&&t.getId()===n))return t}return null},f.getPushpin=function(n){var t=f._state.StoppointPinPrefixId+n._uniqueId;return f._getEntityById(t)},f.dispose=function(){c(""),f._removePushpins(""),s=null}}function iu(i,f,e,s,h,a){function kt(t){var u=v.getOptions(),i;u.routeMode!==o.transit&&!t.tempararyPolyline&&u.routeDraggable&&(i=new dt(g,t.polyline,ft,v),y.push(n.addHandler(i,"dragMove",r(w,ii))),y.push(n.addHandler(i,"dragEnd",r(w,ti))))}function bt(t){var i=y.length,r,u;while(i--)y[i]instanceof dt&&(r=y[i].target,u=r.getPolyline(),t.polyline.getId()===u.getId()&&(n.removeHandler(y[i]),y.pop(y[i]),r.dispose()))}function ni(n){if(v.getOptions().routeMode===o.transit||!v.routes||v.routes.length===0){k=!0;return}var t=parseInt(n.id),u=v.getPreviousStopPoint(t),r=v.getNextStoppoint(t),i=v.getStoppointById(t);et(n.location,i,u,r)}function ri(n){var i=parseInt(n.id),t=v.getStoppointById(i),u,r;(!v.routes||v.routes.length===0)&&t?(t.clear(),t.setOptions({location:n.location})):(u=v.getPreviousStopPoint(i),r=v.getNextStoppoint(i),ot(n.location,t,u,r))}function ii(n){var u=n.location,f=n.polyline,e=f.getId().split("_")[1],t=e.split("~"),r=v.getStoppointById(parseInt(t[1])),i=v.getStoppointById(parseInt(t[2]));et(u,null,r,i)}function ti(n){var u=n.location,f=n.polyline,e=f.getId().split("_")[1],t=e.split("~"),r=v.getStoppointById(parseInt(t[1])),i=v.getStoppointById(parseInt(t[2]));ot(u,null,r,i)}function et(n,i,u,f){var o,e;k||(nt=0);if(uu>0&&nt>=uu)return;o=ut(i);if(!k){if(o&&v.getViapointCountInLeg(u)>=au)return;tt=null}++nt,k=!0,e=[],e[0]=pt(i,u,f,o),e[1]=++gt,e[2]=n,e[3]=i&&v.stoppoints[0]._uniqueId===i._uniqueId,e[4]=o,t.getCredentials(g,r(w,function(o){var c=st.generateDragAndDropStopPointLink(i,u,f,n,!0,null,o),l=t.convertPermalinkDictionaryToPermalink(c),s=b.directionsService+l,h=r(w,at);it.getObjectAsync(s,h,e,-1,t.GetUniqueNetworkRequestId(s))}))}function at(n,t){var f,y,et,st,ot,l,w,c,rt,r,i,a,h,s,e,ft;--nt,f=t.userData,y=f[1];if(y<lt)return;lt=y;if(k&&t&&t.success&&n){l=f[0];if(!ut(n.subLegs)){w=n.subLegs[0],c=w.length,tt=f[2];var ht=f[4],b=[],u=[],ct=!ht||c===1?c:c-1,it=v.getOptions();for(i=0;i<l.length;i++)i<ct?b[b.length]=l[i]:u[u.length]=l[i];for(d.clearRoute(b,!0),rt=v.cloneOptions(it.routeMode===o.walking?it.walkingPolylineOptions:it.drivingPolylineOptions),i=0;i<c;i++)r=w[i],p.decodeRoute(r.routePath,!0),r.routePath.decodedRegions=wt(r.routePath.decodedLatitudes.length),r.routePath.zoomLevels=g.getZoom().toString(),e=y+"_"+i,ft=d.addPolyline(e,r.routePath,rt,!0,null,e);for(et=u.length,i=0;i<et;i++){if(d._displayedRoutes[u[i]])continue;for(st=v.currentRouteLegs.length,a=0;a<st;a++)for(h=v.currentRouteLegs[a],ot=h.subLegs.length,s=0;s<ot;s++){e=h.subLegs[s].subLegKey;if(e!==u[i])continue;ft=d.addPolyline(u[i],h.subLegs[s].routePath,rt,!1,h.legKey,e)}}yt(w,f[3])}}}function yt(n,i){for(var o=0,h=0,y=i?n[0].startDescription:n[0].endDescription,a,c=v.currentRouteLegs.length,s,e,f,l,r=0;r<c;r++)for(s=v.currentRouteLegs[r],a=s.subLegs.length,e=0;e<a;e++)f=s.subLegs[e],d._displayedRoutes[f.subLegKey]&&f.summary&&(o+=f.summary.distance,h+=f.summary.time);for(c=n.length,r=0;r<c;r++){if(r>=2)break;ut(n[r].summary)||(o+=n[r].summary.distance,h+=n[r].summary.time)}l=u.getString("L_DragSummaryToolTip_Text").replace("{0}",y).replace("{1}",o.toFixed(1)).replace("{2}",v.getOptions().distanceUnit===rt.miles?u.getString("L_DistanceUnitMilesShortText_Text"):u.getString("L_DistanceUnitKm_Text")).replace("{3}",t._getDurationFormattedTime(h)),ft.setToolTip(l)}function ot(n,i,u,f){ft.setVisibility(!1);if(!k)return;k=!1;if(!i&&v.getViapointCountInLeg(u)>=au)return;var a=!i||i.isViapoint(),s=null,h=null;a?(s=u.isViapoint()?v.getPreviousWaypoint(u._uniqueId):u,h=f.isViapoint()?v.getNextWaypoint(f._uniqueId):f):(s=v.getPreviousWaypoint(i._uniqueId),h=v.getNextWaypoint(i._uniqueId));var o=[],e=[],c=v.getOptions();!i||i.isViapoint()?e[e.length]=c.routeIndex+"~"+s._uniqueId+"~"+h._uniqueId:(s&&(e[e.length]=c.routeIndex+"~"+s._uniqueId+"~"+i._uniqueId),h&&(e[e.length]=c.routeIndex+"~"+i._uniqueId+"~"+h._uniqueId)),o[0]=e,o[1]=n,o[2]=i?i._uniqueId:"",u&&(o[3]=u._uniqueId),o[4]=++ct,t.toggleTaskProgressIndicator(!0,v._getPrefixId()),!a&&i&&n&&(i._geoLocation=new l(n.latitude,n.longitude)),t.getCredentials(g,r(w,function(e){var c=st.generateDragAndDropStopPointLink(i,u,f,n,!1,tt,e),l=t.convertPermalinkDictionaryToPermalink(c),s=b.directionsService+l,h=r(w,vt);it.getObjectAsync(s,h,o,sr,t.GetUniqueNetworkRequestId(s))}))}function vt(i,r){var a=r.userData,it=a[4],f,h,y,s,tt,e,u,g,p,d;if(it<ct||k)return;t.toggleTaskProgressIndicator(!1,v._getPrefixId());if(r&&r.success&&i){var b=a[0],w=a[1],nt=i.routeResults;if(nt){f=nt[0];if(f.routeResponseCode===c.success){h=a[2];if(v.getOptions().routeMode===o.transit){h&&(s=v.getStoppointById(h),s.clear(),s._geoLocation=new l(w.latitude,w.longitude)),v.addInlineImages(f.inlineImageCache),v.addRoutes(null,f.routes),v.setOptions({routeIndex:0}),n.invoke(this,"dropCompleted",{failed:!1});return}if(f.routes[0].routeLegs.length!==b.length){n.invoke(this,"dropCompleted",{failed:!0});return}for(y=b.length,u=0;u<y;u++)v.removeLeg(b[u]);for(h?(s=v.getStoppointById(h),s.clear(),s._geoLocation=new l(w.latitude,w.longitude)):typeof v.addNewViapoint!="undefined"&&v.addNewViapoint(a[3]),y=f.routes.length,e=0;e<y;e++)for(tt=f.routes[e].routeLegs.length,u=0;u<tt;u++)g=b[u],p=f.routes[e].routeLegs[u],p.legKey=g,d=g.split("~"),p.startWaypointLocation=v.getStoppointById(parseInt(d[1])).getLocation(),p.endWaypointLocation=v.getStoppointById(parseInt(d[2])).getLocation(),v.addLegAndUpdateWaypoints(f.routes[e].routeLegs[u],e)}}n.invoke(this,"dropCompleted",{failed:!1})}else r&&!r.success?n.invoke(this,"dropCompleted",{failed:!0}):n.invoke(this,"dropCompleted",{failed:!0})}function pt(n,t,i,r){var a=r||n.isViapoint(),e=null,s,f;e=a?i.isViapoint()?v.getNextWaypoint(i._uniqueId):i:v.getNextWaypoint(n._uniqueId);for(var o=[],c=ut(t)?n._uniqueId:t._uniqueId,l=ut(e)?n._uniqueId:e._uniqueId,h=c,u=0;u<v.stoppoints.length;u++){f=v.stoppoints[u];if(f._uniqueId===c)break}for(s=v.getOptions(),u=u+1;u<v.stoppoints.length;u++){f=v.stoppoints[u],o[o.length]=s.routeIndex+"~"+h+"~"+f._uniqueId,h=f._uniqueId;if(f._uniqueId===l)break}return o}function wt(n){var u=[],i=[],r=new li(g.getBounds(),null,null),t;for(r.indexes=new Array(n),t=0;t<n;t++)r.indexes[t]=t;return i[i.length]=r,u[u.length]=i,u}var w=this,g=s,v=e,ht=i,d=f,st=h,y=[],k=!1,gt=0,ct=0,lt=0,nt=0,tt=null,ft=a;y.push(n.addHandler(ht,"drag",r(w,ni))),y.push(n.addHandler(ht,"drop",r(w,ri))),y.push(n.addHandler(d,"polylineAdded",r(w,kt))),y.push(n.addHandler(d,"polylineRemoved",r(w,bt))),w.dispose=function(){var t=y.length;while(t--)n.removeHandler(y[t]);y=[]}}function tu(n){function u(){if(i){var n={visible:!1,offset:new tt(kr,kr*-1),htmlContent:""};t=new fi(i.getCenter(),n),i.entities.push(t)}}var r=this,i=n,t=null;u(),r.setLocation=function(n){t.setLocation(n)},r.setVisibility=function(n){t.setOptions({visible:n})},r.setToolTip=function(n){t.setOptions({htmlContent:'<div id="MicrosoftMapsDragToolTip" class="dd_DirectionsDragToolTip">'+n+"</div>"}),r.setVisibility(!0)},r.dispose=function(){i&&i.entities.remove(t)}}function tr(t,i,f){function d(){a=!0,e.push(n.addThrottledHandler(c,"mousemove",r(s,b),100)),p=c.getWidth(),y=c.getHeight()}function nt(n){if(a){var t=n.entity;w(!0),v.setLocation(t.getLocation())}}function it(t){var i,r;a=!1,i=e.length;while(i--)if(e[i].eventName==="mousemove"){n.removeHandler(e[i]),e.pop(e[i]);break}r=t.entity,w(!1)}function rt(n){if(n){var t=n.target;v.setLocation(t.getLocation()),v.setToolTip(u.getString("L_DragToolTip_Text"))}}function g(){a||v.setVisibility(!1)}function b(n){if(a){var u=n.getX()+p/2,f=n.getY()+y/2,t=0,i=0;u<50?t=Math.min(50-u,25):u>p-50&&(t=Math.max(p-50-u,-25)),f<50?i=Math.min(50-f,25):f>y-50&&(i=Math.max(y-50-f,-25)),t||i?(l=new tt(t,i),h===-1&&(h=window.setInterval(r(s,k),250))):(l=new tt(0,0),window.clearInterval(h),h=-1)}}function k(){var n,i,t;a&&(l.x||l.y)?(n=c.tryLocationToPixel(o.getLocation()),n&&(i=c.tryPixelToLocation(new tt(n.x-l.x,n.y-l.y)),o.setLocation(i),t={center:c.getCenter(),centerOffset:l,animate:!1},c.setView(t),w(!0))):h!==-1&&(window.clearInterval(h),h=-1)}function w(i){var u=o._uniqueId?o._uniqueId:o.getId(),r={id:u.split("_")[1],location:t.getLocation()};i?n.invoke(s,"drag",r):n.invoke(s,"drop",r)}var s=this,o=t,c=i,a=!1,p,y,l,h,e=[],v=f;e.push(n.addHandler(o,"dragstart",r(s,d))),e.push(n.addThrottledHandler(o,"drag",r(s,nt),250)),e.push(n.addHandler(o,"dragend",r(s,it))),e.push(n.addHandler(o,"mouseover",r(s,rt))),e.push(n.addHandler(o,"mouseout",r(s,g))),s.getPushpin=function(){return o},s.dispose=function(){var t=e.length;while(t--)n.removeHandler(e[t]);e=[],h!==-1&&(window.clearInterval(h),h=-1)}}function at(n,t,i,r){cc_sb_ie?n.attachEvent("on"+t,i):n.addEventListener(t,i,r)}function eu(n){return cc_sb_ie?event.srcElement:n.target}function ou(n){cc_sb_ie?event.returnValue=!1:n.preventDefault()}function vr(n){cc_sb_ie?n.cancelBubble=!0:n.stopPropagation()}function wi(){}function pu(t){function f(t){t.preventDefault();var i=t.target.getAttribute("mode").toString();if(i===o.transit&&s.stoppoints.length>2||i===s.getOptions().routeMode)return;s.setOptions({routeMode:i}),s.updateDefaultRouteMode(),typeof VEShell!="undefined"&&t.currentTarget&&VEShell.Logging.get_instance().logSubmit(t.currentTarget.id),n.invoke(c,"modeChanged",{mode:i})}var c=this,s=t,r=t._getPrefixId()+di;c.createModeSwitchingIcons=function(n){var v=0,b=null,y=s.getOptions(),a=e("","modeSwitchInnerContainer",b),c,t,l;h.DrivingDirectionsEnabled&&(c=k(r+"SwitchToCar","modeSwitch "+(y.routeMode===o.driving?"carModeSwitchSelected":"carModeSwitch"),a,"","#"),c.title=u.getString("L_CarModeToolTip_Text"),c.setAttribute("mode",o.driving),i(c).add_event("click",f),v++);if(h.TransitDirectionsEnabled){var p="transitModeSwitch",g="transitModeSwitchDisabled",d="transitModeSwitchSelected",nt=u.getString("L_TransitModeToolTip_Text");if(w==="en-gb")var p="tubeModeSwitch",g="tubeModeSwitchDisabled",d="tubeModeSwitchSelected",nt=u.getString("L_TubeModeToolTip_Text");t=k(r+"SwitchToTransit","modeSwitch "+p,a,"","#"),s.stoppoints.length>2?i(t).swap_class(p,g):y.routeMode===o.transit&&i(t).swap_class(p,d),t.title=nt,t.setAttribute("mode",o.transit),i(t).add_event("click",f),v++}h.WalkingDirectionsEnabled&&(l=k(r+"SwitchToWalking","modeSwitch "+(y.routeMode===o.walking?"walkingModeSwitchSelected":"walkingModeSwitch"),a,"","#"),l.title=u.getString("L_WalkingModeToolTip_Text"),l.setAttribute("mode",o.walking),i(l).add_event("click",f),v++),v<1||n.appendChild(a)},c.dispose=function(){i("#"+r+"SwitchToCar").remove_event("click",f),i("#"+r+"SwitchToTransit").remove_event("click",f),i("#"+r+"SwitchToWalking").remove_event("click",f)}}function wu(c){function p(n){var r=y("hourInput"),i=y("minuteInput"),t=y("amPmSwitch");r&&(r.disabled=n),i&&(i.disabled=n),t&&(t.disabled=n)}function rt(t){var r=l.getOptions().transitOptions,i=null;t.selectedIndex?t.selectedIndex===1?(p(!1),i=et.arrival):t.selectedIndex===2&&(p(!0),i=et.lastAvailable):(p(!1),i=et.departure),i&&r.timeType!==i&&l.setOptions({transitOptions:{timeType:i}}),n.invoke(v,"optionsChanged",{updateDirections:!1})}function it(){n.invoke(v,"optionsChanged",{updateDirections:!1})}function ft(n){var s=e(a+"WalkingOptionsDiv","collapsibleRouteOptions routeOptionsContainer",n),o=f("fieldset","","routeOptions",s,""),i=t._addCheckBox(a+"RoundTrip",o,u.getString("L_DirectionsMenuRoundtrip_Text"),!1,r(v,b));v.addCollapsibleHeader(null,u.getString("L_RouteOptions_Text"),i,!1)}function ut(n){var o=l.getOptions(),y=e(a+"CarOptionsDiv","",n),i=f("fieldset","","routeOptions",y,""),h=(o.routeAvoidance&s.avoidLimitedAccessHighway)===s.avoidLimitedAccessHighway||(o.routeAvoidance&s.minimizeLimitedAccessHighway)===s.minimizeLimitedAccessHighway,c=u.getString("L_AvoidHighways_Text");w==="en-gb"&&(c=u.getString("L_AvoidMotorways_Text")),t._addCheckBox(a+"AvoidHighways",i,c,h,r(v,d)),h=(o.routeAvoidance&s.avoidToll)===s.avoidToll||(o.routeAvoidance&s.minimizeToll)===s.minimizeToll,t._addCheckBox(a+"AvoidTolls",i,u.getString("L_AvoidTolls_Text"),h,r(v,tt)),t._addCheckBox(a+"RoundTrip",i,u.getString("L_DirectionsMenuRoundtrip_Text"),!1,r(v,b)),v.addCollapsibleHeader(null,u.getString("L_RouteOptions_Text"),i,!1)}function b(t){var u=t.target,f,i,r,e;!u.checked&&l.stoppoints.length>2&&(f=l.stoppoints[l.stoppoints.length-1],l.removeStoppoint(f._uniqueId,!0)),i=l.getAllWaypoints(),r=l.getOptions().routeMode===o.transit?ar:ui,u.checked&&i.length<r&&(e=l.addRoundTripWapoint()),n.invoke(v,"optionsChanged",{updateDirections:!0})}function d(t){var r=t.target,i=l.getOptions().routeAvoidance;(i&s.avoidLimitedAccessHighway)===s.avoidLimitedAccessHighway&&(i=i-s.avoidLimitedAccessHighway),(i&s.minimizeLimitedAccessHighway)===s.minimizeLimitedAccessHighway&&(i=i-s.minimizeLimitedAccessHighway),r.checked&&(i=i|s.avoidLimitedAccessHighway),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})}function tt(t){var r=t.target,i=l.getOptions().routeAvoidance;(i&s.avoidToll)===s.avoidToll&&(i=i-s.avoidToll),(i&s.minimizeToll)===s.minimizeToll&&(i=i-s.minimizeToll),r.checked&&(i=i|s.avoidToll),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})}function nt(o){var ft=l.getOptions().transitOptions,at=null,tt=f("fieldset",a+"TransitCollapsible","routeOptions",o,""),lt=e("","optionPickerContainer",tt),y=f("select",a+"TransitDepartArrive","transitDateTimeBox transitDepartArrive",lt,""),c,ht,nt,ot,k,d,w,b;f("option","","departArriveOption",y,u.getString("L_TransitOptionDepartAt_Text")),f("option","","departArriveOption",y,u.getString("L_TransitOptionArriveBy_Text")),h.LastTrainOption&&f("option","","lastTrainOption",y,u.getString("L_TransitOptionLastTrain_Text")),ft.timeType===et.arrival?y.selectedIndex=1:ft.timeType===et.departure?y.selectedIndex=0:ft.timeType===et.lastAvailable&&(y.selectedIndex=2),i(y).add_event("change",r(v,function(){rt(y)})),nu(l,"TransitDate",tt,it);if(h.TransitAdvancedOptions){var p=l.getOptions(),ut=e(a+"TransitAdvancedOptionsContainer","transitAdvancedOptionsContainer",tt),ct=e(a+"TransitSortByDiv","",ut);f("span",a+"TransitSortByLabel","transitAdvancedOptionsLabel",ct,u.getString("L_TransitSortByLabel_Text")),c=f("select",a+"TransitSortBy","transitSortBySelectBox",ct,""),f("option","","",c,u.getString("L_TransitSortByOptionMinimizeTime_Text")),f("option","","",c,u.getString("L_TransitSortByOptionMinimizeMoney_Text")),f("option","","",c,u.getString("L_TransitSortByOptionMinimizeTransfers_Text"));switch(p.routeOptimization){case st.shortestTime:c.selectedIndex=0;break;case st.minimizeMoney:c.selectedIndex=1;break;case st.minimizeTransfers:c.selectedIndex=2}i(c).add_event("change",r(v,function(){var i=l.getOptions().routeOptimization;switch(c.selectedIndex){case 0:i=st.shortestTime;break;case 1:i=st.minimizeMoney;break;case 2:i=st.minimizeTransfers}l.setOptions({routeOptimization:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),ht=e(a+"ExcludeAirLineDiv","",ut),nt=t._addInputElement(a+"ExcludeAirLine","",ht,"","checkbox",""),f("label",a+"AirLineLabel","",ht,u.getString("L_TransitExcludeAirLineLabel_Text")),nt.checked=p.routeAvoidance&s.avoidAirline,nt.setAttribute("defaultChecked",nt.checked),ot=e(a+"ExcludeExpressDiv","",ut),k=t._addInputElement(a+"ExcludeExpressTrain","",ot,"","checkbox",""),f("label",a+"ExpressLabel","",ot,u.getString("L_TransitExcludeExpressLabel_Text")),k.checked=p.routeAvoidance&s.avoidExpressTrain,k.setAttribute("defaultChecked",k.checked),d=e(a+"BulletTrainDiv","transitBulletTrainDiv",ut),w=t._addInputElement(a+"IncludeBulletTrainRadio","",d,"fewestTime","radio","bulletTrainRadio"),f("label",a+"IncludeBulletTrainLabel","",d,u.getString("L_TransitIncludeBulletTrain_Text")),w.checked=!(p.routeAvoidance&s.avoidBulletTrain),w.setAttribute("defaultChecked",w.checked),w.disabled=p.routeAvoidance&s.avoidExpressTrain,b=t._addInputElement(a+"ExcludeBulletTrainRadio","",d,"fewestTransfer","radio","bulletTrainRadio"),f("label",a+"ExcludeBulletTrainLabel","",d,u.getString("L_TransitExcludeBulletTrain_Text")),b.checked=p.routeAvoidance&s.avoidBulletTrain,b.setAttribute("defaultChecked",b.checked),b.disabled=p.routeAvoidance&s.avoidExpressTrain,g(nt,k,w,b)}v.addCollapsibleHeader(at,"",tt,!1)}function g(t,u,f,e){i(t).add_event("click",r(v,function(){var r=l.getOptions().routeAvoidance;(r&s.avoidAirline)===s.avoidAirline&&(r=r-s.avoidAirline),t.checked&&(r=r|s.avoidAirline),l.setOptions({routeAvoidance:r}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),i(u).add_event("click",r(v,function(){var i=l.getOptions().routeAvoidance;(i&s.avoidExpressTrain)===s.avoidExpressTrain&&(i=i-s.avoidExpressTrain),u.checked?(i=i|s.avoidExpressTrain,f.disabled=!0,e.disabled=!0):(f.disabled=!1,e.disabled=!1),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),i(f).add_event("click",r(v,function(){var i=l.getOptions().routeAvoidance;(i&s.avoidBulletTrain)===s.avoidBulletTrain&&(i=i-s.avoidBulletTrain),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})})),i(e).add_event("click",r(v,function(){var i=l.getOptions().routeAvoidance;(i&s.avoidBulletTrain)!==s.avoidBulletTrain&&(i=i|s.avoidBulletTrain),l.setOptions({routeAvoidance:i}),n.invoke(v,"optionsChanged",{updateDirections:!0})}))}var v=this,l=c,a=l._getPrefixId();v.showRouteOptionsForCurrentMode=function(n,t){var r=y(a+"optionsContainer"),i=e(a+"optionsContainer","optionsContainer",null);r?(r.parentNode.removeChild(r),n.insertBefore(i,y(a+"RouteSettingsDiv"))):n.appendChild(i);switch(l.getOptions().routeMode){case o.driving:case null:ut(i);break;case o.transit:nt(t);break;case o.walking:ft(i)}return i},v.addCollapsibleHeader=function(n,r,f,o){var s,h,a,c;o?(s=l.getOptions(),h=s.routeMode,s.OptionsControlExpandedState=s.OptionsControlExpandedState||{},s.OptionsControlExpandedState[h]==="undefined"&&(s.OptionsControlExpandedState[h]=!1),n||(n=e("","directionsSettingExpanderClosed routeOptionsHeader",null),a=k("optionsHeader","",n,r,"#"),i(a).add_event("click",function(n){n.preventDefault()})),f.parentNode.insertBefore(n,f),t.toggleInline(i(f)),c=function(){var e=i(n),o=y("optionsHeader");e.has_class("directionsSettingExpanderClosed")?(e.swap_class("directionsSettingExpanderClosed","directionsSettingExpanderOpen"),o.innerHTML=t.htmlEncode(u.getString("L_HideOptions_Text"))):(e.swap_class("directionsSettingExpanderOpen","directionsSettingExpanderClosed"),o.innerHTML=t.htmlEncode(u.getString("L_ShowOptions_Text"))),t.toggleInline(i(f))},i(n).add_event("click",function(){c(),s.OptionsControlExpandedState[h]=!s.OptionsControlExpandedState[h]}),s.OptionsControlExpandedState[h]&&c()):i(f).set_attr("display","block")},v.dispose=function(){}}var u=Microsoft.Maps.Resources,ti=!1,ht=!1,v=window.Microsoft.Maps,cu,o,rt,s,st,et,hu,h,pt,kt,si,c,nt,hr,li,t,k,f,e,ut,ri,y,r,oi,vt,ct,ni,p,ii,bt,gu,dt,vi;v.Directions=v.Directions||{},DirectionPublicNamespace=v.Directions;var i=v.Gimme,b=v.Globals,tt=v.Point,n=v.Events,hi=v.LocationRect,l=v.Location,gi=v.Color,lt=v.Pushpin,fi=v.Infobox,vu=v.Polyline,yt=v.InternalNamespaceForDelay;yt.Directions=yt.Directions||{};var fu=yt.Directions,it=yt.Network,pe=yt.Size,wt=yt.PRF,gt=yt.Quirks,ui=b.directionsMaxWaypoints||25,w=gt.useXHR?Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.languages[0].toLowerCase():b.locale.toLowerCase();typeof cu=="undefined"&&(cu={}),o={driving:"driving",transit:"transit",walking:"walking"},v.Directions=v.Directions||{},v.Directions.RouteMode=o,rt={kilometers:0,miles:1},v.Directions=v.Directions||{},v.Directions.DistanceUnit=rt,s={none:0,minimizeLimitedAccessHighway:1,minimizeToll:2,avoidLimitedAccessHighway:4,avoidToll:8,avoidExpressTrain:16,avoidAirline:32,avoidBulletTrain:64},v.Directions=v.Directions||{},v.Directions.RouteAvoidance=s,st={shortestTime:0,shortestDistance:1,minimizeMoney:2,minimizeTransfers:3,minimizeWalking:4},v.Directions=v.Directions||{},v.Directions.RouteOptimization=st,et={departure:"departure",arrival:"arrival",lastAvailable:"lastAvailable"},v.Directions=v.Directions||{},v.Directions.TimeType=et,hu={unknown:0,whereOnly:1,whatAndWhere:2,whatOnly:3},h={WaypointDragging:!0,DefaultMode:o.driving,DistanceUnitMiles:!1,DrivingDirectionsEnabled:!0,WalkingDirectionsEnabled:!0,TransitDirectionsEnabled:!1,TrafficAwareDirections:!1,LastTrainOption:!1,TransitAdvancedOptions:!1,TransitTimeUse12Hour:!1,TransitShowRouteCost:!1,TransitShowDistanceUnitSetting:!0,TransitDateFormat:"m/d/yyyy",RadixPointDecimal:!0},w==="ja-jp"&&(h.DrivingDirectionsEnabled=!1,h.WalkingDirectionsEnabled=!1,h.TransitDirectionsEnabled=!0,h.TrafficAwareDirections=!1,h.LastTrainOption=!0,h.TransitAdvancedOptions=!0,h.TransitShowRouteCost=!0,h.TransitShowDistanceUnitSetting=!1,h.WaypointDragging=!1,h.DefaultMode=o.transit,h.DistanceUnitMiles=!0,h.TransitDateFormat="yyyy/m/d"),w==="en-ca"&&(h.TransitDirectionsEnabled=!0),w==="en-us"&&(h.TransitDirectionsEnabled=!0,h.TrafficAwareDirections=!0,h.DistanceUnitMiles=!0),w==="fr-ca"&&(h.TrafficAwareDirections=!0),w==="en-gb"&&(h.TransitDirectionsEnabled=!0,h.TrafficAwareDirections=!0,h.DistanceUnitMiles=!0,h.TransitDateFormat="d/m/yyyy"),pt=w.substring(0,2),(pt==="fr"||pt==="de"||pt==="es"||pt==="it"||pt==="pt"||pt==="nb"||pt==="nl"||pt==="sv")&&(h.RadixPointDecimal=!1),kt=w.substring(3),(kt==="us"||kt==="in"||kt==="au"||kt==="ca"||kt==="es")&&(h.TransitTimeUse12Hour=!0),(kt==="in"||kt==="fr")&&(h.TransitDateFormat="d-m-yyyy"),DirectionPublicNamespace.DirectionsManager=su,directionsManagerPrototype=DirectionPublicNamespace.DirectionsManager.prototype,directionsManagerPrototype._getTask=function(){return this._task||(this._task=new ki(this._map,this)),this._task},directionsManagerPrototype.calculateDirections=function(){this._getTask().setDirections()},directionsManagerPrototype.setMapView=function(){this._getTask()._setViewPortForSelectedRoute(!0)},directionsManagerPrototype.clearDisplay=function(){this._getTask().clearDisplay()},directionsManagerPrototype.resetDirections=function(n){this._getTask().resetDirections(n)},directionsManagerPrototype.addWaypoint=function(n,t){this._getTask().addWaypoint(n,t)},directionsManagerPrototype.removeWaypoint=function(n,t){this._getTask().removeWaypoint(n,t)},directionsManagerPrototype.getNearbyMajorRoads=function(n,t,i,r){this._getTask().getNearbyArterials(n,t,i,r)},directionsManagerPrototype.reverseGeocode=function(n,t,i,r){this._getTask().reverseGeocode(n,t,i,r)},directionsManagerPrototype.getMap=function(){return this._map},directionsManagerPrototype.getRouteResult=function(){return this._getTask()._getState().routes},directionsManagerPrototype.getAllWaypoints=function(){return this._getTask()._getState().stoppoints},directionsManagerPrototype.getRenderOptions=function(){return this._getTask()._getState().getRenderOptions()},directionsManagerPrototype.getRequestOptions=function(){return this._getTask()._getState().getRequestOptions()},directionsManagerPrototype.setRenderOptions=function(n){this._getTask().setRenderOptions(n)},directionsManagerPrototype.setRequestOptions=function(n){this._getTask().setRequestOptions(n)},directionsManagerPrototype.dispose=function(){this._getTask().dispose(),this._task=null};var ke=102,fr=182,yr=51,br=51,gr=255,du=51,ku=51,nf=255,uf=!1,rf=400,ir=4,tf=5280,bu=1e3,dr="DD_M",wr=.15,df=6,or=new gi(1,204,204,204),lr=new gi(1,17,17,17),rr=new gi(1,0,0,0),cr=new gi(1,230,230,230),wf=204,di="_LPanel",ei="_RPanel",nr="_SPanel",lf="veDDstep$",af="DDWaypointPushpin$",kf="DDDisambiguationPushpin$",yi=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],cf="veTransitStep$",hf="DDRouteSublegPolyline$",uu=3,sr=15e3,fe=1.60934,ue=100,ar=2,re="DDStart",ne="DDEnd",ee="DDAddToTrip",ie="DDNewRequest",te="RouteOptions",ai="resolvedWaypoints",ur="NearbyArterials",oe=100,ru=5,ye=4e3,au=10,ef=15,we=400,ff="du",pi="mi",sf="km",pr="reverseGeocodeResults",be="Maps",ve=!0,he=250,se=35,ce=20,ae="solid",le="6,4",kr=25,bi="{0}_{1}",of=128,bf="DD_SL",vf="MicrosoftMapsDirections_",a=6,pf="DDStart",yf="DDEnd",gf='routes="',d={none:0,other:1,auto:2,ferry:3,walk:4,bus:5,train:6,airline:7,tube:8};DirectionPublicNamespace.IconType=d,si={none:0,unknown:1,departStart:2,departIntermediateStop:3,departIntermediateStopReturning:4,arriveFinish:5,arriveIntermediateStop:6,turnLeft:7,turnRight:8,turnBack:9,uTurn:10,turnToStayLeft:11,turnToStayRight:12,bearLeft:13,bearRight:14,keepToStayLeft:15,keepToStayRight:16,keepToStayStraight:17,keepLeft:18,keepRight:19,keepStraight:20,take:21,takeRampLeft:22,takeRampRight:23,takeRampStraight:24,keepOnRampLeft:25,keepOnRampRight:26,keepOnRampStraight:27,merge:28,continueRoute:29,roadNameChange:30,enterRoundabout:31,exitRoundabout:32,turnRightThenTurnRight:33,turnRightThenTurnLeft:34,turnRightThenBearRight:35,turnRightThenBearLeft:36,turnLeftThenTurnLeft:37,turnLeftThenTurnRight:38,turnLeftThenBearLeft:39,turnLeftThenBearRight:40,bearRightThenTurnRight:41,bearRightThenTurnLeft:42,bearRightThenBearRight:43,bearRightThenBearLeft:44,bearLeftThenTurnLeft:45,bearLeftThenTurnRight:46,bearLeftThenBearRight:47,bearLeftThenBearLeft:48,rampThenHighwayRight:49,rampThenHighwayLeft:50,rampToHighwayStraight:51,enterThenExitRoundabout:52,bearThenMerge:53,turnThenMerge:54,bearThenKeep:55,transfer:56,wait:57,takeTransit:58,walk:59,transitDepart:60,transitArrive:61},DirectionPublicNamespace.Maneuver=si,c={success:0,unknownError:1,cannotFindNearbyRoad:2,tooFar:3,noSolution:4,dataSourceNotFound:5,cacheMiss:6,noAvailableTransitTrip:7,transitStopsTooClose:8,walkingBestAlternative:9,outOfTransitBounds:10,timeout:11,waypointDisambiguation:12,hasEmptyWaypoint:13,exceedMaxWaypointLimit:14,atleastTwoWaypointsRequired:15,firstOrLastStoppointIsVia:16,searchServiceFailed:17,invalidCredentials:18},DirectionPublicNamespace.RouteResponseCode=c,nt={info:0,minor:1,moderate:2,major:3,ccZoneEnter:4,ccZoneExit:5},DirectionPublicNamespace.StepWarningStyle=nt,hr=function(){},hr.prototype={parentLegKey:null,subLegKey:null,polylineIds:null,temporaryRoute:!1},li=function(n,t,i){this.boundingRectangle=n,this.childRegions=i,this.indexes=t},ft.prototype={_address:"",_shortAddress:"",_location:null,_geoLocation:null,_businessName:"",_phoneNumber:"",_exactLocation:!0,_uniqueId:null,_isViapoint:!1,_disambiguation:null,_disambiguationContainer:null,_entityId:null,_locationIdentifier:null,_website:null,_inputType:null,_pushpin:null,isViapoint:function(){return this._isViapoint},getPushpin:function(){return this._pushpin},getAddress:function(){return this._address},getShortAddress:function(){return this._shortAddress},getLocation:function(){return this._location},getGeoLocation:function(){return this._geolocation},isExactLocation:function(){return this._exactLocation},getDisambiguationResult:function(){return this._disambiguation},getDisambiguationContainer:function(){return this._disambiguationContainer},getBusinessDetails:function(){var n={};return this._businessName&&(n.businessName=this._businessName),this._phoneNumber&&(n.phoneNumber=this._phoneNumber),this._website&&(n.website=this._website),this._entityId&&(n.entityId=this._entityId),n},dispose:function(){}},ft._isBusinessWaypoint=function(n){var t=n.getBusinessDetails();return t.entityId||t.businessName&&n.getAddress()},ft._uniqueWaypointId=1,v.Directions=v.Directions||{},v.Directions.Waypoint=ft,t=function(){},t.RemoveDomElement=function(n){var t=y(n);t&&t.parentNode&&t.parentNode.removeChild(t)},t.removeBehavior=function(n){var t,r,i;if(n&&window.Sys&&window.Sys.UI&&window.Sys.UI.Behavior){t=Sys.UI.Behavior.getBehaviors(n);if(t&&t.length>0)for(r=t.length,i=0;i<r;i++)t[i].dispose()}},t.getCredentials=function(n,t){t("")},t.toggleTaskProgressIndicator=function(n,t){typeof VEShell!="undefined"&&VEShell.App.get_taskHost().toggleTaskProgressIndicator(n,t+ei)},t.toggleInline=function(n){n.set_style({display:n.get_style("display")!=="none"?"none":"block"})},k=t.addAnchorElement=function(n,i,r,u,f){return t._addAnchorElementWithEncodeOption(n,i,r,u,f,!0)},t._addAnchorElementWithEncodeOption=function(n,i,r,u,f,e){var o=document.createElement("a");return n&&(o.id=n),o.href=f,i&&(o.className=i),o.innerHTML=e?t.htmlEncode(u):u,ut(r)||r.appendChild(o),o},f=t.addDOMElement=function(n,t,i,r,u){var f=document.createElement(n);return t&&(f.id=t),u&&(gt.useXHR?MSApp.execUnsafeLocalFunction(function(){f.innerHTML=u}):f.innerHTML=u),i&&(f.className=i),r&&(gt.useXHR?MSApp.execUnsafeLocalFunction(function(){r.appendChild(f)}):r.appendChild(f)),f},e=t.addDivElement=function(n,t,i){var r=document.createElement("div");return n&&(r.id=n),t&&(r.className=t),i&&i.appendChild(r),r},t._addHtmlEncodedDivElementWithText=function(n,i,r,u){var f=e(n,i,r);return f.innerHTML=t.htmlEncode(u),f},t._addInputElement=function(n,t,i,r,u,f){var e=null;if(ri(f))e=document.createElement("input");else try{e=document.createElement("<input name='"+f+"'>")}catch(o){e=document.createElement("input"),e.name=f}return e.id=n,e.className=t,e.type=u,e.value=r,ut(i)||i.appendChild(e),e},t._addCheckBox=function(n,r,u,o,s){var l=e("","",r),c=f("span","","checkbox",l,""),h=t._addInputElement(n,"",c,"","checkbox",""),a=f("label","","",c,u);return n&&a.setAttribute("for",n),o&&i(h).set_attr("checked","checked"),i(h).add_event("click",s),l},t._getInlineImage=function(n,t){var r=t,u,i;return gt.isIE7OrEarlier||(u=t.substring(t.indexOf("?")+1).replace(/=/g,"").replace(/&/g,""),i=n.inlineImagesCache[u],i&&(r="data:image/png;base64,"+i)),r},t._reRenderDirectionsPanel=function(n){var r;if(gt.isIE8OrEarlier&&n){var u="0",f="0",t=null,e=i("#"+n+"_LPanel").element(),o=i("#"+n+"_RPanel").element();e&&(u=i(e).get_style("height"),t=e.parentElement),o&&(f=i(o).get_style("height"),t=o.parentElement),ti||(r=0,u&&u.indexOf("px")>0&&(r=parseInt(u.substring(0,u.indexOf("px")),10)),f&&f.indexOf("px")>0&&(r+=parseInt(f.substring(0,f.indexOf("px")),10)),t&&r>0&&i(t).set_style({height:r})),t&&(t.className=t.className)}},t.getInputDisplayText=function(n){var i,t=n.getBusinessDetails();return i=t&&t.businessName?t.businessName:n.getAddress()},t._getFormattedDistance=function(n,t){n=parseFloat(n);var i;return i=t===rt.miles?n<.1?(n*tf).toFixed(0)+" "+u.getString("L_DistanceUnitFeetShort_Text"):n.toFixed(1)+" "+u.getString("L_DistanceUnitMilesShortText_Text"):n<.1?(n*bu).toFixed(0)+" "+u.getString("L_DistanceUnitMeters_Text"):n.toFixed(1)+" "+u.getString("L_DistanceUnitKm_Text"),h.RadixPointDecimal||(i=i.replace(".",",")),i},t._getDurationFormattedTime=function(n){var i="",t=Math.round(n/60),f,r;return t<1?i=u.getString("L_TimeLessThanOneMin_Text"):t<60?i=u.getString("L_TimeLessThanOneHr_Text").replace("{0}",t.toFixed(0)):t<60||(f=Math.floor(t/60).toFixed(0),r=Math.floor(t%60),i=r?u.getString("L_TimeMoreThanOneHr_Text").replace("{0}",f).replace("{1}",r.toFixed(0)):u.getString("L_TimeInHr_Text").replace("{0}",f)),i},t._parseCustomDateTime=function(n){var u=null,r,t,i;return n&&(r=n.split("T"),r&&r.length===2&&(t=r[0].split("-"),i=r[1].split(":"),t.length===3&&i.length===3&&(u=new Date(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10),parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10))))),u},t._getTransitFormattedCost=function(n){return u.getString("L_TransitCostWithCurrency_Text").replace("{0}",t._formatCurrency(n))},t._formatCurrency=function(n){var e=n<0,t,i,u,f,r;for(n=Math.abs(n),n=Math.round(n*100)/100,t=n.toString(),i=t.indexOf("."),i<0&&(i=t.length+1),u=[],f=0,r=(i-1)%3;r<i;r+=3)r>0&&(u[u.length]=t.substring(f,r),f=r);return t=i<t.length?u.join(",")+t.substr(i):u.join(","),e&&(t="-"+t),t},t._getFormattedColor=function(n){var t="#{0}{1}{2}";return t.replace("{0}",(n.r<16?"0":"")+n.r.toString(16)).replace("{1}",(n.g<16?"0":"")+n.g.toString(16)).replace("{2}",(n.b<16?"0":"")+n.b.toString(16))},t._getFormattedTime=function(n){var i=n.getHours(),r="",u;return h.TransitTimeUse12Hour?(u=i>=12,i=t._convert24HourTo12Hour(i),r=i+":"+(n.getMinutes()<10?"0":"")+n.getMinutes()+(u?"PM":"AM")):r=i+":"+(n.getMinutes()<10?"0":"")+n.getMinutes(),r},t._convert24HourTo12Hour=function(n){return n<12||(n-=12),n||(n=12),n},t._convert12HourTo24Hour=function(n,t){return n===12&&(n=0),t&&(n+=12),n},t._getParentElementWithAttribute=function(n,t){var i=n.target,r;while(!ut(i)){r=i.getAttribute(t);if(ut(r))i=i.parentNode;else break}return i},t.isUndefined=function(n){return typeof n=="undefined"||typeof n=="unknown"},ut=t.isNullOrUndefined=function(n){return t.isUndefined(n)||n===null},ri=t.isNullOrEmpty=function(n){return typeof n=="undefined"||typeof n=="unknown"||n===null||n===""},t.GetUniqueNetworkRequestId=function(n){var r="",t,i;return n.indexOf("{jsono}")===-1&&(t=n.indexOf("jsonso="),i=-1,t>-1&&(t=t+7,i=n.indexOf("&",t),r=i>-1?n.substr(t,i-t):n.substr(t))),r},t.convertPermalinkDictionaryToPermalink=function(n){var i="",r=!0,t;for(t in n)r||(i+="&"),i+=t+"=",t==="jsonso"?i+=n[t]:ut(n[t])||(i+=encodeURIComponent(n[t].toString())),r=!1;return i},y=t.getElementById=function(n){return document.getElementById(n)},t.htmlEncode=function(n){var t=document.createElement("div"),i=document.createTextNode(n);return t.appendChild(i),t.innerHTML},t.parseQueryString=function(){var n,t;if(ri(window.location.search))return{};var u=window.location.search.substr(1),r=u.split("&"),i={},f=r.length;for(n=0;n<f;n++)t=r[n].split("="),i[t[0].toLowerCase()]=t[1];return i},r=t.createDelegate=function(n,t){return function(){if(t)return t.apply(n,arguments)}},t.extend=function(n,t){function i(){}i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n.baseConstructor=t,n.superClass=t.prototype},t.getDateInSupportedFormat=function(n){var t=h.TransitDateFormat;return t.replace("m",n.getMonth()+1).replace("d",n.getDate()).replace("yyyy",n.getFullYear())},t.getDateFromStringInSupportedFormat=function(n,t){var f=null,r=null,u=null,e=t.replace(/[/-]/ig,""),i=n.split(/[/-]/ig);switch(e){case"dmyyyy":r=i[0],f=i[1],u=i[2];break;case"yyyymd":u=i[0],f=i[1],r=i[2];break;default:f=i[0],r=i[1],u=i[2]}return new Date(u,f-1,r)},t.getLuminance=function(n){var r=.212671,i=.71516,t=.072169;return n.r*r+n.g*i+n.b*t},fu.Helper=t,fu.PermalinkHelper=er,ot._uniquePrefixId=0,oi=new function(){var n=this;n.getRouteModeClass=function(n){var t="";switch(n){case o.driving:t="dd_routeModeCar";break;case o.transit:t="dd_routeModeTransit";break;case o.walking:t="dd_routeModeWalking"}return t},n.createDirectionPanel=function(t,r,u){var s=n.getRouteModeClass(u),f=i("#"+r+ei),o,h,c;typeof vi!="undefined"&&(o=i("#"+r+di),o.element()?(o.remove_class("dd_routeModeCar dd_routeModeTransit dd_routeModeWalking"),o.add_class(s)):(h=e(r+di,"MicrosoftMap dd_directionsPanel landing noprint "+s,null),f.element()?t.insertBefore(h,f.element()):t.appendChild(h))),c=i("#"+r+nr),c.element()||e(r+nr,"MicrosoftMap dd_directionsPanel schedule",t),f.element()?(f.remove_class("dd_routeModeCar dd_routeModeTransit dd_routeModeWalking"),f.add_class(s)):e(r+ei,"MicrosoftMap dd_directionsPanel dd_route "+s,t)},n.getDefaultWaypointOption=function(n,t){var f=n.getOptions(),u=n.cloneOptions(f.waypointPushpinOptions),r,i;if(!u.text)for(r=n.getAllWaypoints(),i=0;i<r.length;i++)if(r[i]._uniqueId===t._uniqueId){u.text=yi[i];break}return u}},vt=function(s,c,a,v){function ct(){var t=p._state.routes,n;if(t&&t.length>0&&t[0].routeLegs&&t[0].routeLegs.length>0){n=t[0].routeLegs[0];if(n.itineraryItems&&n.itineraryItems.length>0&&n.itineraryItems[0].transitLine)return n.itineraryItems[0].transitLine.providerInfo}return""}function tt(n){var e=t._getParentElementWithAttribute(n,"StepIndex"),i={};if(e){var s=e.getAttribute("StepIndex"),f=s.split(":"),o=parseInt(f[2]),r=parseInt(f[0]),h=parseInt(f[1]),u=p._state.currentRouteLegs[o].itineraryItems[r];i.stepNumber=r+h+1,i.routeLegIndex=o,i.stepIndex=r,i.routeIndex=p._state.getOptions().routeIndex,i.location=new l(u.coordinate.latitude,u.coordinate.longitude),i.step=u,i.handled=!1,i.originalEventArgs=n}return i}var p=this,lt,st,d,ot,it,et,ut,rt;p._map=s,lt=a,p._panTimer=-1,p._state=v,p._taskHostIdPrefix=v._getPrefixId();var vt=null,b=!1,at=null;p._disambiguationControl=null,p._pushpinManager=c,p._directionsPanel=null,p.createResultsPage=function(){p._state.updateDefaultRouteMode(),b=!1;var n=p._state.getOptions(),r=p._state._getPrefixId(),t=n.itineraryContainer;oi.createDirectionPanel(t,r,n.routeMode),p._directionsPanel=i("#"+r+ei,t).element(),p._directionsPanel&&(p._directionsPanel.innerHTML=""),p.createRouteSelectionSwitcher&&n.displayRouteSelector&&p.createRouteSelectionSwitcher(),p.createItinerary(),st()},st=function(){var n=e(p._taskHostIdPrefix+"ResultsFooter","clearFloat",p._directionsPanel);p._createSendTo&&p._createSendTo(n),e("","clearFloat",n),typeof d!="undefined"&&d()},p.updateReverseGeocodedText=function(n){var f=n.getAddress(),r=n.getShortAddress(),i,t;n.isViapoint()?(t=y(p._taskHostIdPrefix+"ViaText"+n._uniqueId),t&&(t.innerHTML=u.getString("L_ViaList_Text").replace("{0}",r))):(i=y(p._taskHostIdPrefix+"WaypointText"+n._uniqueId),i.innerHTML=f)},p._createNewWaypoint=function(n,r){var l,w,s,nt,tt,c,y,o,a,d,g;if(!n)return;l=n.getLocation(),l&&(r.setAttribute("lat",l.latitude.toFixed(6)),r.setAttribute("lon",l.longitude.toFixed(6))),w=n._uniqueId,s={},n.getPushpin()?(nt=n.getPushpin(),s.text=nt.getText()):p._pushpinManager?s=p._pushpinManager.getDefaultOptions(n):(tt=oi.getDefaultWaypointOption(p._state,n),s.text=tt.text),c=e("","",r),ht?f("span","","dd_maneuver dd_MIconarriveFinish",c,""):f("span","","dd_directionStepLetter",c,s.text);var b=ft._isBusinessWaypoint(n),o=n.getBusinessDetails(),it=p._state.stoppoints[p._state.stoppoints.length-1]._uniqueId===w,v=o&&o.businessName?o.businessName:n.getAddress(),h=e("","dd_waypointDisplayText",c);b||i(h).add_class("dd_locationWaypoint"),y=null,o=n.getBusinessDetails(),y=o.entityId&&b&&typeof DirectionsShell!="undefined"?k("","",h,v,DirectionsShell.DirectionShellUtility.getSearchResultDetailsUrl(o.entityId)):t._addHtmlEncodedDivElementWithText(p._taskHostIdPrefix+"WaypointText"+w,"",h,v?v:""),b&&(n.getAddress()&&t._addHtmlEncodedDivElementWithText("","",h,n.getAddress()),a=e("","",h),o.phoneNumber&&(d=f("span","","",a,""),d.innerHTML=t.htmlEncode(o.phoneNumber)),o.website&&(g=k("","dd_ContactCardSeparator dd_Website noprint",a,u.getString("L_WebsiteLink_Text"),o.website),g.target="_blank"))},p._createWalkingWarning=function(){if(p._state.getOptions().displayWalkingWarning){var n=e(p._taskHostIdPrefix+"MessageContainer","dd_messageContainer dd_walkingWarning",p._directionsPanel),t=e("","dd_walkingWarningIcon",n);f("span","","dd_walkingWarningText",n,u.getString("L_WalkingDirectionsSidewalkWarning_Text"))}},d=function(){var t=p._state.getOptions(),i,n;t.displayDisclaimer&&(i=e("disclaimerDiv","clearFloat",p._directionsPanel),n="",n=w==="ja-jp"?u.getString("L_DirectionsDisclaimer_Text").replace("{0}",ct()):t.routeMode===o.transit?u.getString("L_TransitDisclaimer_Text"):u.getString("L_DirectionsDisclaimer_Text").replace("{0}",u.getString("L_TermsOfUse_Text")),n=n.replace(/{year}/,(new Date).getFullYear()),f("span",p._taskHostIdPrefix+"Disclaimer_disclaimerLabel","dd_directionsDisclaimer",i,n))},p.createViapoints=function(t,r){var f,u,o,e;if(p._state.getAllViaInLeg)for(f=p._state.getAllViaInLeg(t),u=0;u<f.length;u++)o=f[u],e=ot(o,r,p._taskHostIdPrefix,u===0),i(e).add_event("click",function(t){var i=t.target.getAttribute("UniqueId");t.preventDefault(),p._state.removeStoppoint(parseInt(i),!0),n.invoke(p,"updateDirections",null)})},ot=function(n,t,r,o){var h=e("","dd_viapointItemContainer",t),c,s;return o&&i(h).add_class("first"),c=f("span",r+"ViaText"+n._uniqueId,"dd_viapointText",h,""),n.getAddress()&&(c.innerHTML=u.getString("L_ViaList_Text").replace("{0}",n.getAddress())),s=k("","",h,u.getString("L_RemoveVia_Text"),"#"),s.setAttribute("UniqueId",n._uniqueId),s},p.createRouteSteps=function(t,i,r,u){var s=y(p._taskHostIdPrefix+"ItineraryContainer"+u._uniqueId),l,o,c,h;for(s?s.removeChild(s.children[0]):s=e(p._taskHostIdPrefix+"ItineraryContainer"+u._uniqueId,"dd_itinerary",p._directionsPanel),l=f("ul",p._taskHostIdPrefix+"StepItems","",s,""),o=0;o<t.itineraryItems.length;o++)c=this.itineraryStepSetup(o,r,i,l,t.itineraryItems),h={stepIndex:o,routeLegIndex:i,routeIndex:p._state.getOptions().routeIndex,containerElement:c,step:t.itineraryItems[o],prevStep:o===0?null:t.itineraryItems[o-1],lastStep:o===t.itineraryItems.length-1,handled:!1},n.invoke(p,"beforeStepRender",h)},p.itineraryStepSetup=function(n,t,u,e,o){var h=o[n],s=f("li",p._state._getPrefixId()+"StepListItem"+(n+t),"dd_singleStep",e,"");return s.setAttribute("StepIndex",n+":"+t+":"+u),s.setAttribute("lat",h.coordinate.latitude.toFixed(6)),s.setAttribute("lon",h.coordinate.longitude.toFixed(6)),i(s).add_event("mouseenter",r(p,et)),i(s).add_event("mouseleave",r(p,ut)),i(s).add_event("click",r(p,rt)),s},p.addWarnings=function(n,t){var s,u,i,r,e,o;if(n.length>0&&p._state.getOptions().displayStepWarnings){for(s=f("ul",p._taskHostIdPrefix+"AnnotationList","dd_annotationList",t,""),u=0,i=0;i<n.length;i++)(n[i].style===nt.ccZoneEnter||n[i].style===nt.ccZoneExit)&&u++;for(i=0;i<n.length;i++){r="",e="dd_annotation ";switch(n[i].style){case nt.info:r="dd_info";break;case nt.minor:r="dd_minor";break;case nt.moderate:r="dd_moderate";break;case nt.major:r="dd_major";break;case nt.ccZoneEnter:u!==1||b||(e+="tollzone_ccz");break;case nt.ccZoneExit:u===1&&(e+="tollzone_ccz",b=!1)}u===1?n[i].style===nt.ccZoneEnter||n[i].style===nt.ccZoneExit?it(n[i].style,e,s):(o=f("li","",e,s,""),f("span","",r,o,""),f("span","","",o,n[i].text)):(!u||u>1)&&n[i].style!==nt.ccZoneEnter&&n[i].style!==nt.ccZoneExit&&(o=f("li","",e,s,""),f("span","",r,o,""),f("span","","",o,n[i].text))}}},it=function(n,t,e){var s,h,o;n===nt.ccZoneEnter?b||(o=f("li","",t,e,""),s=k("","",o,u.getString("L_CongestionChargeZoneEnter_Text"),"http://www.cclondon.com"),o.title=u.getString("L_CongestionChargeZoneTooltip_Text"),s.setAttribute("target","_blank"),i(s).add_event("click",r(p,function(n){n.stopPropagation()})),h=f("span","","",o,u.getString("L_CongestionChargeZoneEnterTwo_Text")),b=!0):n===nt.ccZoneExit&&(o=f("li","",t,e,u.getString("L_CongestionChargeZoneExit_Text")))},p._onTrafficBasedRouteClicked=function(t){t.preventDefault(),p._state.setOptions({avoidTraffic:!p._state.getOptions().avoidTraffic}),n.invoke(p,"updateDirections",null)},et=function(t){n.invoke(p,"mouseEnterStep",tt(t))},p._onMouseEnterStepUnhandled=function(n){for(var u=g("li.dd_singleStep"),r,t=0;t<u.length;t++)r=u[t],i(r).remove_class("dd_outFocus"),r!==n.originalEventArgs.currentTarget&&i(r).add_class("dd_outFocus")},ut=function(t){n.invoke(p,"mouseLeaveStep",tt(t))},p._onMouseLeaveStepUnhandled=function(){for(var u=g("li.dd_singleStep"),r,t=0;t<u.length;t++)r=u[t],i(r).remove_class("dd_outFocus")},rt=function(t){n.invoke(p,"itineraryStepClicked",tt(t))},p.createRouteSummary=function(n,s,c){var v=s>=0?!1:!0,y,b,d,l,w,a;i(c).add_class("dd_routeSummary"),v&&i(c).add_class("dd_routeRootSummary"+(ti?" dd_routeRootSummaryb2b":"")),n&&(y=e("",v?"dd_tripSummary":"",c),v||(b=u.getString("L_RouteSummaryLink_Text").replace("{0}",yi[s]).replace("{1}",yi[s+1]),f("span","","directive",y,b)),d=t._getFormattedDistance(n.distance,p._state.getOptions().distanceUnit)+", ",f("span","dd_distance","",y,d),f("span","dd_time","",y,t._getDurationFormattedTime(n.time)),l=p._state.getOptions(),l.displayTrafficAvoidanceOption&&v&&l.routeMode===o.driving&&h.TrafficAwareDirections&&p._state.currentRouteLegs.length===1&&p._state.getViaCount()===0&&(w=e("","noprint dd_trafficTime",c),l.avoidTraffic||n.timeWithTraffic<n.time?l.avoidTraffic&&(w.innerHTML=u.getString("L_RerouteBasedOnTraffic_Text"),a=k(p._taskHostIdPrefix+"TrafficBasedRouteLink","noprint",c,u.getString("L_GoBackToThePreviousRoute_Text"),"#"),i(a).add_event("click",r(p,p._onTrafficBasedRouteClicked))):(w.innerHTML=u.getString("L_RouteTimeInCurrentTrafficCondition_Text").replace("{0}",t._getDurationFormattedTime(n.timeWithTraffic)),a=k(p._taskHostIdPrefix+"TrafficBasedRouteLink","noprint dd_avoidTraffic",c,u.getString("L_SeeTrafficBasedRoute_Text"),"#"),i(a).add_event("click",r(p,p._onTrafficBasedRouteClicked)))))},p.dispose=function(){p._disambiguationControl&&p._disambiguationControl.dispose();var n=y(p._state._getPrefixId()+ei);n&&(n.parentNode.removeChild(n),n=null)}},vt._currentHighConfidenceDisambiguationHighlightPin=null,vt.getNewResultsPage=function(n,t,i,r){var u=null;switch(r.getOptions().routeMode){case o.transit:u=new ct(n,t,i,r);break;default:u=new vt(n,t,i,r)}return u},vt._createViaEROContent=function(n){var i=f("div","","",null,"");return f("span","","dd_waypointPrefix",i,u.getString("L_WaypointViaEro_Text")),t._addHtmlEncodedDivElementWithText("","dd_waypointEroAddress",i,n.getAddress()),i},vt._getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(</ExitNumber>|</TurnDir>|</RoadName>|</Sign>|</WaypointName>)","gi"),"</span>"),n=n.replace(new RegExp("(<ExitNumber>|<TurnDir>|<RoadName>|<Sign>|<WaypointName>)","gi"),'<span class="instructionKeyword">'),n=n.replace(new RegExp("</(\\S*)>","gi"),""),n=n.replace(new RegExp("<(\\S*)>","gi"),"")),n},vt.prototype={createItinerary:function(){var u=this._state.getOptions(),c,t,h,f,i,s,l,r;for(u.routeMode===o.walking&&this._createWalkingWarning&&this._createWalkingWarning(),c=0,h=this._state.getAllWaypoints(),this._createHighConfidenceDisambiguation&&this._createHighConfidenceDisambiguation(this._directionsPanel),u.routeMode!==o.transit&&(i=e(this._taskHostIdPrefix+"SummaryContainer","",null),i.style.clear="both",r={summary:this._state.summary[u.routeIndex],containerElement:i,routeLegIndex:-1,handled:!1},n.invoke(this,"beforeSummaryRender",r)),t=0;t<this._state.currentRouteLegs.length;t++){f=this._state.currentRouteLegs[t],this._state.currentRouteLegs.length>1&&u.routeMode!==o.transit&&(i=e(this._taskHostIdPrefix+"SummaryContainer"+t,"",null),i.style.clear="both",r={summary:f.summary,containerElement:i,routeLegIndex:t,handled:!1},n.invoke(this,"beforeSummaryRender",r)),s=h[t];if(!ht){var v=t===0?"dd_waypoint firstWaypoint":"dd_waypoint dd_midWaypoint",a=e("",v,this._directionsPanel),y={waypoint:s,containerElement:a,handled:!1};n.invoke(this,"beforeWaypointRender",y),this.createViapoints&&this.createViapoints(s._uniqueId,a)}this.createRouteSteps(f,t,c,s),c+=f.itineraryItems.length}ht&&u.routeMode!==o.transit||(l=e("","dd_waypoint dd_lastWaypoint",this._directionsPanel),r={waypoint:h[t],containerElement:l,handled:!1},n.invoke(this,"beforeWaypointRender",r))},createSingleItineraryStep:function(n,i,r,u,o){var k=0,b=o.getAttribute("StepIndex"),v,a,c,w,l,p,y,h;b&&(v=b.split(":"),v&&v.length===3&&(k=parseInt(v[1]))),a=this._state.getOptions(),n.maneuverImageName!==""&&a.displayManeuverIcons&&(c="",i&&!ti&&(c=" dd_maneuverWithDistance"),n.isImageRoadShield?(w=f("img","","dd_maneuver"+c,o,""),w.src=n.maneuverImageName):n.maneuverImageName?f("span","","dd_maneuver dd_MIcon"+n.maneuverImageName+c,o,""):f("span","","dd_maneuver"+c,o,"")),l=e("","dd_iteneraryContainer",o),i&&(p=t._getFormattedDistance(i.distance,this._state.getOptions().distanceUnit),f("div",this._taskHostIdPrefix+"StepDistance","dd_distance",l,p)),y=f("div",this._taskHostIdPrefix+"StepInstruction","dd_instruction",l,""),f("div",this._taskHostIdPrefix+"StepInstructionMain","",y,n.formattedText),this.addWarnings(n.warnings,o);if(n.preIntersectionHints&&a.displayPreItineraryItemHints)for(h=0;h<n.preIntersectionHints.length;h++)f("span","","dd_intersectionHint",l,n.preIntersectionHints[h]);if(n.postIntersectionHints&&a.displayPostItineraryItemHints)for(h=0;h<n.postIntersectionHints.length;h++)f("span","","dd_intersectionHint",l,n.postIntersectionHints[h])}},ct=function(i,r,u,f){function o(n){var r=t._getParentElementWithAttribute(n,"RouteIndex"),i={},u;return r&&(u=parseInt(r.getAttribute("RouteIndex").toString()),i.routeIndex=u,i.containerElement=r,i.handled=!1),i}var e=this;e._state=f,e._map=i,e._routeOptionHoverTimeoutHandler=-1,e._taskHostIdPrefix=f._getPrefixId(),e._optionsControl=null,ct.baseConstructor.call(this,e._map,r,u,f),e._onRouteSelectOptionClick=function(t){n.invoke(e,"routeSelectorClicked",o(t))},e._onRouteSelectMouseEnter=function(t){n.invoke(e,"mouseEnterRouteSelector",o(t))},e._onRouteSelectMouseLeave=function(t){n.invoke(e,"mouseLeaveRouteSelector",o(t))}},t.extend(ct,vt),ct.prototype={_transitStepEROOpen:!1,createItinerary:function(){var i;if(w==="ja-jp"){i=e("","dd_transitItineraryTitle",this._directionsPanel),f("div","transitItineraryRouteIndex","dd_transitItineraryRouteIndex",i,u.getString("L_TransitItineraryTitle_Text").replace("{0}",this._state.getOptions().routeIndex+1));var o=e("transitItinerarySummary","dd_transitItinerarySummary",i),n=this._state.routes[this._state.getOptions().routeIndex].routeLegs[0],r=t._getDurationFormattedTime(n.summary.time);h.TransitShowRouteCost&&n.summary.monetaryCost>0&&(r+="&nbsp;&nbsp;"+t._getTransitFormattedCost(n.summary.monetaryCost)),o.innerHTML=r}ct.superClass.createItinerary.call(this)},createTransitActionInstruction:function(n,i,r,e){var o="",h,s;n.iconType==d.walk&&w!=="ja-jp"?(h="{0} / {1}",s=h.replace("{0}",t._getFormattedDistance(n.distance,r)).replace("{1}",t._getDurationFormattedTime(n.durationInSeconds)),o=u.getString("L_WalkingDistanceFrom_Text").replace("{0}",s)):o=i==0?n.iconType===d.bus?u.getString("L_TakeBus_Text"):n.iconType===d.tube?u.getString("L_TakeTube_Text"):u.getString("L_TakeTrain_Text"):u.getString("L_RideAndExitAt_Text").replace("{0}",t._getDurationFormattedTime(n.durationInSeconds)),f("div","","dd_stepDistance",e,o)},getTextBetweenTag:function(n,t){var u="",i=t.indexOf("<"+n+">"),r=t.indexOf("</"+n+">");return i!==-1&&r!==-1&&(i+=n.length+2,i<r&&(u=t.substring(i,r))),u},createTransitInstruction:function(n,t,r){var o="",e,h,s;n&&(e=f("div","","dd_stepText",r),n.iconType!=d.walk?t==0&&n.transitLine?(h=f("span","","dd_stepVerboseName",e,n.transitLine.verboseName),i(h).set_style({backgroundColor:"rgb("+n.transitLine.lineColor.r+","+n.transitLine.lineColor.g+","+n.transitLine.lineColor.b+")",color:"rgb("+n.transitLine.lineTextColor.r+","+n.transitLine.lineTextColor.g+","+n.transitLine.lineTextColor.b+")"}),f("span","","",e," "+n.transitTerminus)):t!=0&&n.transitLine&&(o=this.getTextBetweenTag("TransitStop",n.childItineraryItems[t].formattedText),f("span","","",e,o)):(s=this.getTextBetweenTag("EndLocation",n.formattedText),o=u.getString("L_WalkingInstruction_Text").replace("{0}",s),f("span","","",e,o)))},createTransitArrivalDepartureTimeInstruction:function(n,i,r){var s="",e,h,o;n&&(e=n.childItineraryItems[i],n&&e&&(h=t._getFormattedTime(t._parseCustomDateTime(e.time)),e.maneuver==si.transitDepart?s=u.getString("L_ScheduledDeparture_Text").replace("{0}",h):e.maneuver==si.transitArrive&&(s=u.getString("L_ScheduledArrival_Text").replace("{0}",h)),ht&&(o=RealTimeHelper.getRealTimeMetaData(n),o&&e.maneuver===si.transitDepart&&(r=k("dd_realTimeLink","",r,"",""),r.setAttribute("stopName",o.stopName),r.setAttribute("routeTag",o.routeTag),r.setAttribute("stopId",o.stopId),r.setAttribute("routes",o.routes))))),f("div","","dd_stepText",r,s)},createSingleItineraryStep:function(n,i,r,u,o){var y=this._state.getOptions(),w=f("img","","dd_TransitIcon",o,""),v,p,l,a,c;w.src=t._getInlineImage(this._state,n.maneuverImageName),v=null,n.childItineraryItems&&n.childItineraryItems.length!=0||(v=f("div","subStepContainer","dd_transitStepContainer",o),this.createTransitActionInstruction(n,0,y.distanceUnit,v),this.createTransitInstruction(n,0,v)),h.TransitShowRouteCost&&n.monetaryCost>0&&(p=t._getTransitFormattedCost(n.monetaryCost),f("span","","dd_stepCost",v,p)),this.addWarnings(n.warnings,o);if(n.preIntersectionHints&&y.displayPreItineraryItemHints)for(c=0;c<n.preIntersectionHints.length;c++)f("span","","dd_intersectionHint",v,n.preIntersectionHints[c]);if(n.childItineraryItems.length>0)for(l=null,l=e("subStepContainer","dd_transitStepContainer",o),a=0;a<n.childItineraryItems.length;a++){this.createTransitActionInstruction(n,a,y.distanceUnit,l),this.createTransitInstruction(n,a,l),this.createTransitArrivalDepartureTimeInstruction(n,a,l);if(a!==n.childItineraryItems.length-1)e("","dd_substepContainer",l);else if(n.postIntersectionHints&&y.displayPostItineraryItemHints)for(c=0;c<n.postIntersectionHints.length;c++)f("span","","dd_intersectionHint",l,n.postIntersectionHints[c])}},createRouteSelectionSwitcher:function(){var l=e(this._taskHostIdPrefix+"routeSelectionContainer","dd_routeSelectionContainer",this._directionsPanel),c,t,h,o,s;for(f("span",this._taskHostIdPrefix+"selectorTitleBar","dd_selectorTitleBar noprint",l,u.getString("L_TransitOptionsTitle_Text")),c=this._state.routes.length,t=0;t<c;t++)h=this._state.routes[t].routeLegs[0],o=e(this._taskHostIdPrefix+"routeOption"+t,"dd_routeSelectOption",l),t===this._state.getOptions().routeIndex&&(o.className+=" dd_routeSelectOptionSelected"),o.setAttribute("RouteIndex",t),s={containerElement:o,routeLeg:h,routeIndex:t,handled:!1},n.invoke(this,"beforeRouteSelectorRender",s),i(o).add_event("click",r(this,this._onRouteSelectOptionClick)),i(o).add_event("mouseenter",r(this,this._onRouteSelectMouseEnter)),i(o).add_event("mouseleave",r(this,this._onRouteSelectMouseLeave))},createRouteSelectorItem:function(n,r,o){var tt=o===this._state.getOptions().routeIndex?"dd_optionTextContainerSelected":"dd_optionTextContainer",k=e("",tt,n),rt=t._parseCustomDateTime(r.startTime),it=t._parseCustomDateTime(r.endTime),a,s,c,p,b,nt,v;k.innerHTML+=t._getDurationFormattedTime(r.summary.time),k.innerHTML+=",&nbsp;"+u.getString("L_TransitSummaryStartEndTime_Text").replace("{0}",t._getFormattedTime(rt)).replace("{1}",t._getFormattedTime(it)),h.TransitShowRouteCost&&r.summary.monetaryCost>0&&(k.innerHTML+="&nbsp;&nbsp;"+t._getTransitFormattedCost(r.summary.monetaryCost));var g=e("","dd_optionIconContainer",n),y=r.itineraryItems.length,l=0;for(a=0;a<y;a++)s=r.itineraryItems[a],c="",s.transitLine&&(c=s.transitLine.abbreviatedName,c||(c=s.transitLine.verboseName)),p=f("img","","dd_TransitRouteSelectionIcon "+(a===0?"first":""),null,""),p.src=t._getInlineImage(this._state,s.maneuverImageName),g.appendChild(p),s.circularImageName?(b=f("img","","dd_CircleIcon ",null,""),b.src=t._getInlineImage(this._state,s.circularImageName),g.appendChild(b)):c&&(nt=f("span","","dd_TransitRouteSelectionIconText",g,c),i(nt).set_style({backgroundColor:"rgb("+s.transitLine.lineColor.r+","+s.transitLine.lineColor.g+","+s.transitLine.lineColor.b+")",color:"rgb("+s.transitLine.lineTextColor.r+","+s.transitLine.lineTextColor.g+","+s.transitLine.lineTextColor.b+")"})),s.iconType===d.walk&&l++;w==="ja-jp"&&(v="",l>0&&(v=u.getString("L_TransitRouteToolTipWalking_Text").replace("{0}",l)+" "),y-1>l&&(v+=u.getString("L_TransitRouteToolTipTransfer_Text").replace("{0}",y-l-1)),n.title=v),e("","dd_routeStepClearBoth",n)},dispose:function(){ct.superClass.dispose.call(this),this._optionsControl&&(this._optionsControl.dispose(),this._optionsControl=null)}},ct._getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(</TransportType>|</TransitLineName>|</TransitLineTerminus>|</TransitStop>|</StartLocation>|</EndLocation>|</ServiceProvider>|</Phone>|</Action>)","gi"),"</span>"),n=n.replace(new RegExp("(<TransportType>|<TransitLineName>|<TransitLineTerminus>|<TransitStop>|<StartLocation>|<EndLocation>|<ServiceProvider>|<Phone>|<Action>)","gi"),'<span class="instructionKeyword">'),n=n.replace(new RegExp("</(\\S*)>","gi"),""),n=n.replace(new RegExp("<(\\S*)>","gi"),"")),n},ni=new function(){function f(n,t){var u=t.userData,f,i,r;t&&t.success&&n&&n[ur]&&n[ur].length===1?(f=n[ur][0],i=u[0],i&&i(f,u[2])):(r=u[1],r&&r())}function u(n,t){var i=t.userData,f=i[0],e=i[1],r=i[2],u="";t&&t.success&&n?(n[pr]&&(u=n[pr][0]),f&&f(u,e)):r&&r(null,e)}function i(n,t){var i;if(t&&t.success&&n){var r=t.userData,u=r[0],f=r[1],e=r[2];n[ai]&&(i=n[ai][0],i&&i.length==1&&u._updateWaypoint(i[0])),f&&f(u,e)}}var n=this;n.resolveWaypoint=function(u,f,e,o,s,h){var c=[];c[0]=f,c[1]=e,c[2]=s,t.getCredentials(u,r(n,function(u){var s=h.generateResolveWaypointLink(f,null,!1,o,u),l=t.convertPermalinkDictionaryToPermalink(s),e=b.directionsService+l;it.getObjectAsync(e,r(n,i),c,-1,t.GetUniqueNetworkRequestId(e))}))},n.reverseGeocode=function(i,f,e,o,s,h){if(f){var c=[];c[0]=e,c[1]=s,c[2]=o,t.getCredentials(i,r(n,function(n){var e=h.generateReverseGeocodeLink(f,n),o=t.convertPermalinkDictionaryToPermalink(e),i=b.directionsService+o;it.getObjectAsync(i,r(null,u),c,-1,t.GetUniqueNetworkRequestId(i))}))}},n.getNearbyArterialsResults=function(i,u,e,o,s,h){var c=[];c[0]=e,c[1]=o,c[2]=s,t.getCredentials(i,r(n,function(i){var o=h.generateNearbyArterialsLink(u,i),s=t.convertPermalinkDictionaryToPermalink(o),e=b.directionsService+s;it.getObjectAsync(e,r(n,f),c,-1,t.GetUniqueNetworkRequestId(e))}))}},p=function(){},p._encodedCoordinateLength=2,p._encodedFullCoordinateLength=4,p._encodedCoordinateBase=1e6,p.decodeRoute=function(n,t){ri(n.latitudes)||(n.decodedLatitudes=p._decodeCoordinates(n.latitudes,!0),n.latitudes=""),ri(n.longitudes)||(n.decodedLongitudes=p._decodeCoordinates(n.longitudes,!0),n.longitudes="");if(!ri(n.compressedPathIndexes)&&t){var i=n.zoomLevels.split(",").length,r=p.decodePathIndexes(n.compressedPathIndexes,n.decodedLongitudes,i);n.compressedPathIndexes="",n.decodedRegions=p.createLineRegions(i,n.decodedLatitudes,n.decodedLongitudes,r)}},p.decodePathIndexes=function(n,t,i){var c=t.length,s=8,e=0,a=n.charCodeAt(0),f=new Array(0),v=1,h=0,o,r,u,l;if(i>a){for(o=new Array(0),r=0;r<c;r++)o[r]=r;f[0]=o,h=1}for(r=0;r<c;r++){u=h;while(u<i){s===8&&(e=n.charCodeAt(v++),s=0),s++;if(e&128){e=e<<1&255;break}else(f[u]===null||f[u]===undefined)&&(f[u]=new Array(0)),l=f[u].length,f[u][l]=r,e=e<<1,u++}}return f},p.createLineRegions=function(n,t,i,r){for(var f=new Array(n),u=0;u<n;u++)f[u]=p._addRegionsForZoomLevel(t,i,r[u]);return f},p._addRegionsForZoomLevel=function(n,t,i){for(var f=null,v=new Array(0),w=i.length,p=100,o=p,y=0,e=[],r,u=0;u<w;u++){o<p||(u>0&&(v[y++]=new li(f,e,null),e=[]),f=hi.fromCorners(new l(n[u],t[u]),new l(n[u],t[u])),o=0),r=i[u],e[o]=r;var s=f.getNorth(),h=f.getSouth(),c=f.getEast(),a=f.getWest();n[r]>s?s=n[r]:n[r]<h&&(h=n[r]),t[r]>c?c=t[r]:t[r]<a&&(a=t[r]),f=hi.fromEdges(s,a,h,c),o++}return v[y]=new li(f,e,null),v},p._decodeCoordinates=function(n,t){for(var l=[],b=0,s=!0,h=1,u=-1,i=0,y=0,o=p._encodedFullCoordinateLength,v,k=n.length,w=p._encodedCoordinateBase,c=p._encodedCoordinateLength,f,a,e,r=0;r<k;r++)v=o-1,f=n.charCodeAt(r)^255,u++,t&&!u&&(h=f&128?-1:1,f&=127),i|=f,u===v?(s||i!==32767?(a=i/w,e=h*a+y,l[b++]=e,y=e,s=!1,o=c):(s=!0,o=c+2),i=0,u=-1,h=1):i<<=8;return l},ii=function(){},ii._isLastPointAdded=function(n,t){if(n.length<1)return!1;var i=n[n.length-1];return i.latitude===t.latitude&&i.longitude===t.longitude},ii.prototype={_id:null,_regions:null,_generalizedZooms:null,_regionHeap:null,_polyline:null,_locations:null,_northLat:0,_southLat:0,_westLong:0,_eastLong:0,_map:null,_mapViewChangedHandler:null,get_polyline:function(){return this._polyline},init:function(t,i,u,f,e){var s,o;this._map=t,this._polyline=i,this._locations=u,this._regions=f,this._generalizedZooms=e,this._id=i.getId();if(this._regions)for(this._regionHeap=[],s=this._regions.length,o=0;o<s;o++)this._regionHeap[this._regionHeap.length]=this._buildRegionHeap(this._regions[o],0,this._regions[o].length-1);this._mapViewChangedHandler=r(this,this.map_ViewChanged),n.addHandler(this._map,"viewchangeend",this._mapViewChangedHandler),this._draw(),this._polyline.setOptions({visible:!0}),this._map.entities.push(this._polyline)},dispose:function(){this._map&&n.removeHandler(this._map,"viewchangeend",this._mapViewChangedHandler)},remove:function(){this._map&&this._polyline&&this._map.entities.remove(this._polyline)},map_ViewChanged:function(){this._draw()},_draw:function(){this._computeBoundaries(),this._buildLine()},_computeBoundaries:function(){var t=this._map.getHeight(),i=this._map.getWidth(),r=t<900?900:t,u=i<900?900:i,n=this._map.getBounds();this._northLat=n.getNorth(),this._southLat=n.getSouth(),this._map.getZoom()>5?(this._westLong=n.getWest(),this._eastLong=n.getEast()):(this._westLong=-180,this._eastLong=180),this._westLong>this._eastLong&&(this._eastLong+=360)},_buildLine:function(){var t=null,n,r,u,i;if(this._generalizedZooms){n=this._generalizedZooms.length-1,r=this._map.getZoom();while(parseInt(this._generalizedZooms[n])<r&&n>=0)n--;this._regionHeap&&this._regionHeap[n]&&(t=this._getVisiblePointsFromRegion(this._regionHeap[n]))}if(!t)for(t=[],u=this._locations.length,i=0;i<u;i++)t[t.length]=this._locations[i];this._setPolyline(t)},_setPolyline:function(n){var t=n.length;if(t<2)return;this._polyline.setLocations(n)},_buildRegionHeap:function(n,t,i){var o=i-t+1,e,r,s;if(o<1)return null;if(o===1)return n[t];e=null,r=null,o===2?(e=n[t],r=n[i]):(s=Math.round((t+i)/2),e=this._buildRegionHeap(n,t,s),r=this._buildRegionHeap(n,s+1,i));if(e&&r){var u=e.boundingRectangle,f=r.boundingRectangle,a=u.getNorth()>f.getNorth()?u.getNorth():f.getNorth(),v=u.getEast()>f.getEast()?u.getEast():f.getEast(),l=u.getSouth()<f.getSouth()?u.getSouth():f.getSouth(),h=u.getWest()<f.getWest()?u.getWest():f.getWest(),c=hi.fromEdges(a,h,l,v);return new li(c,null,[e,r])}return e?e:r?r:null},_getVisiblePointsFromRegion:function(n){var t=[],c=new l(n.boundingRectangle.getNorth(),n.boundingRectangle.getEast()),a=new l(n.boundingRectangle.getSouth(),n.boundingRectangle.getWest()),s,e,h,i,r,u,o,f;if(this._rectangleDoesNotOverlapViewport(c,a))return t;if(n.childRegions)for(s=n.childRegions.length,e=0;e<s;e++)h=this._getVisiblePointsFromRegion(n.childRegions[e]),t=t.concat(h);else for(i=this._locations[n.indexes[0]],u=!1,this._isVisible(i.latitude,i.longitude)&&(t[t.length]=i,u=!0),o=n.indexes.length,f=1;f<o;f++)r=this._locations[n.indexes[f]],this._isVisible(r.latitude,r.longitude)?(u||ii._isLastPointAdded(t,i)||(t[t.length]=i),u=!0,t[t.length]=r):u?(u=!1,t[t.length]=r):this._rectangleDoesNotOverlapViewport(i,r)||(ii._isLastPointAdded(t,i)||(t[t.length]=i),t[t.length]=r),i=r;return t},_isVisible:function(n,t){return n>=this._southLat&&n<=this._northLat&&t>=this._westLong&&t<=this._eastLong},_rectangleDoesNotOverlapViewport:function(n,t){return n.latitude>this._northLat&&t.latitude>this._northLat||n.latitude<this._southLat&&t.latitude<this._southLat||n.longitude>this._eastLong&&t.longitude>this._eastLong||n.longitude<this._westLong&&t.longitude<this._westLong}},bt=function(){},bt._splitTransitRoutes=function(n,t){var f=[],r,e,u,i,s;if(!n)return f;var o=t.decodedLatitudes.length,c=p.decodePathIndexes(t.compressedPathIndexes,t.decodedLongitudes,t.zoomLevels.split(",").length),h=t.zoomLevels.split(",").length;for(r=0;r<n.length;r++){e=n[r].startPathIndex,u=n[r].endPathIndex;if(n[r].startPathIndex<0||u<0||n[r].startPathIndex>o-1||u>o-1)continue;i={},i.zoomLevels=t.zoomLevels,i.decodedLatitudes=bt._getCoordinates(e,u,t.decodedLatitudes),i.decodedLongitudes=bt._getCoordinates(e,u,t.decodedLongitudes),s=bt._getPathIndexesSubset(e,u,c),i.decodedRegions=p.createLineRegions(h,i.decodedLatitudes,i.decodedLongitudes,s),n[r].coordinate=new l(i.decodedLatitudes[0],i.decodedLongitudes[0]),f[f.length]=i}return f},bt._getCoordinates=function(n,t,i){for(var u=[],f=0,r=n;r<=t;r++)u[f++]=i[r];return u},bt._getPathIndexesSubset=function(n,t,i){for(var o=new Array(i.length),r,f,u,e=0;e<i.length;e++){for(r=new Array(0),f=i[e],r[0]=0,u=0;u<f.length;u++){if(f[u]<=n)continue;if(f[u]>t)break;r[r.length]=f[u]-n}r[r.length-1]<t-n&&(r[r.length]=t-n),o[e]=r}return o},gu={info:0,warning:1,error:2},lu.getDisambiguationCoordinates=function(n){for(var r=n.getDisambiguationResult(),f=r.locationSuggestions.length>0,u=f?r.locationSuggestions:r.businessSuggestions,e=u.length,i=[],t=0;t<e;t++)i[i.length]=new l(u[t].location.latitude,u[t].location.longitude);return i},DirectionPublicNamespace.DirectionsTask=function(){function s(n,u){t&&n==i||(i=n,t&&t.resetDirections(),t=new su(i),t.setRenderOptions({itineraryContainer:f,displayLandingPage:!0})),r(u[pf],0),r(u[yf],Math.max(1,t.getAllWaypoints().length)),t.calculateDirections()}function r(n,i){if(n){var r=null,u=DirectionPublicNamespace.Waypoint;n instanceof u?r=n:typeof n=="string"?r=new u({address:n}):(n.address||n.location)&&(r=new u(n));if(r){t.removeWaypoint(i);while(t.getAllWaypoints().length<i)t.addWaypoint(new u(null));t.addWaypoint(r,i)}}}function e(){t.clearDisplay()}var o=this,t=null,i=null,f=document.createElement("div");n.addHandler(o,"remove",e),this.init=s,this.getTitle=function(){return u.getString("L_DirectionsTaskTitle_Text")},this.getPanel=function(){return f}},ci.prototype.createDisambiguationPushpin=function(t){function rt(u){var h=u.target,o=h._disambiguationMetaData,s,e;i===null&&(e={id:f._state.DisambiguationPinPrefixId+t._uniqueId+"_DisInfobox",visible:!1},i=new fi(new l(o.location.latitude,o.location.longitude),e),f._handlers.push(n.addHandler(i,"mouseenter",r(i,function(){window.clearTimeout(this._timeOutHandler),this._timeOutHandler=null}))),f._handlers.push(n.addHandler(i,"mouseleave",r(i,function(){this.setOptions({visible:!1})}))),f._map.entities.push(i)),window.clearTimeout(i._timeOutHandler),i._timeOutHandler=null,i._waypointUniqueId=h._waypointUniqueId,i._disambiguationIndex=h._disambiguationIndex,s=o.entityId?!0:!1,e=w(this,o,s),e.visible=!0,ti?s||(e.height=90):e.typeName=f._isLightColorPopupRequired()?"lightInfobox":"darkInfobox",i.setLocation(new l(o.location.latitude,o.location.longitude)),i.setOptions(e)}function w(n,t,i){var f;return i?(f={title:t.name,description:t.address,actions:[{label:u.getString("L_SelectDisambiguation_Text"),eventHandler:r(n,b)}]},t.website&&f.actions.push({label:u.getString("L_WebsiteLink_Text"),eventHandler:r(t,tt)})):f={title:t.suggestion,actions:[{label:u.getString("L_SelectDisambiguation_Text"),eventHandler:r(n,b)}]},f}function ut(n){n.target instanceof lt,i=n.target._infobox}function nt(){if(i){var t=window.setTimeout(r(i,function(){this._timeOutHandler&&this.setOptions({visible:!1})}),500);i._timeOutHandler=t}}function b(t){t.preventDefault(),n.invoke(this,"selected",{waypointId:i._waypointUniqueId,suggestionsIndex:i._disambiguationIndex})}function tt(n){n.preventDefault(),this.website&&window.open(this.website)}for(var f=this,v=t.getDisambiguationResult(),p=v.locationSuggestions.length>0,s=p?v.locationSuggestions:v.businessSuggestions,y=s.length,it=p||y===0?0:s[0].index,d=[],i=null,g=f._map.getTheme(),c,h,e,k,a,o=y-1;o>=0;o--)c=new l(s[o].location.latitude,s[o].location.longitude),d.push(c),h=g===null?f._state.getOptions().disambiguationPushpinOptions:{},h.text=(o+1+it).toString(),h.id=f._state.DisambiguationPinPrefixId+t._uniqueId+"_DisInfobox",e=new lt(c,h),g===null?(h.hoverIcon&&(e._hoverIcon=h.hoverIcon,f._attachHoverBehavior(e)),f._handlers.push(n.addHandler(e,"mouseover",r(f,rt))),f._handlers.push(n.addHandler(e,"mouseout",r(f,nt)))):(k=s[o].entityId?!0:!1,a=w(this,s[o],k),a.id=f._state.DisambiguationPinPrefixId+t._uniqueId+"_"+o,a.pushpin=e,i=new fi(c,a),f._handlers.push(n.addHandler(e,"click",r(e,ut))),i._waypointUniqueId=t._uniqueId,i._disambiguationIndex=o,f._map.entities.push(i)),f._map.entities.push(e),e._disambiguationMetaData=s[o],e._waypointUniqueId=t._uniqueId,e._disambiguationIndex=o;y>0&&n.invoke(f,"disambiguationPushpinsAdded",{cordinates:d})},ci.prototype.removeDisambiguationPushpins=function(n){var t=n?n._uniqueId:"";this._removePushpins(this._state.DisambiguationPinPrefixId+t)},ci.prototype.createTransitStepPushpins=function(i){function et(n){if(u){window.clearTimeout(u._timeOutHandler),u._timeOutHandler=null;var t=n.target,r=t._stepMetadata,i={visible:!0,offset:new tt(14,16)};u.setOptions(i),u.setLocation(t.getLocation()),u.setHtmlContent(g(r).innerHTML)}}function ft(){if(u){var t=window.setTimeout(r(u,function(){this._timeOutHandler&&this.setOptions({visible:!1})}),500);u._timeOutHandler=t}}function g(n){var s=e("","",null),r,i,a,l,u,h,c;r=n.childItineraryItems.length>0?e("","dd_transitStepPopup "+(o._isLightColorPopupRequired()?"dd_lightTransitPopup":""),s):e("","dd_walkingStepPopup "+(o._isLightColorPopupRequired()?"dd_lightTransitPopup":""),s),i=n.formattedText,n.iconType!==d.tube||ri(i)||(i=i.replace(new RegExp("<TransportType>(.+?)</TransportType>","gi"),"<TransportType>Tube</TransportType>")),a=e("",nt(n.iconType)+" dd_directionIcon",r),l=n.childItineraryItems.length>0?f("div","","",r,ct._getHtmlFormattedInstruction(i)):f("div","","dd_popupText",r,ct._getHtmlFormattedInstruction(i));if(n.childItineraryItems)for(u=0;u<n.childItineraryItems.length;u++)h=e("","dd_popupText",r),c=t._parseCustomDateTime(n.childItineraryItems[u].time),f("span","","dd_eroStepTime",h,t._getFormattedTime(c)),f("span","","",h,ct._getHtmlFormattedInstruction(n.childItineraryItems[u].formattedText));return s}function k(n,t){for(var i in n)if(n.hasOwnProperty(i))if(n[i]==t)return i;return undefined}function nt(n){var r=o._isLightColorPopupRequired(),t=k(d,n);return r?"dd_"+t+"DarkIcon":"dd_"+t+"LightIcon"}function it(n,t){var i=null;return i={height:48,width:null,anchor:new tt(6,41),icon:n.transitStepIcon},i.id=o._state.TransitStepPinPrefixId+t,i}var o=this,v,b,c,p,y,h,w,u;for(o._removePushpins(o._state.TransitStepPinPrefixId),v=0,b=i.length,c=0;c<b;c++){for(p=i[c],y=p.itineraryItems.length,h=0;h<y;h++){var a=p.itineraryItems[h],c=v+h,ut=new l(a.coordinate.latitude,a.coordinate.longitude),s,rt=it(a,c);s=new lt(ut,rt),o._map.entities.push(s),s._stepMetadata=a,o._handlers.push(n.addHandler(s,s instanceof lt?"mouseover":"mouseenter",r(o,et))),o._handlers.push(n.addHandler(s,s instanceof lt?"mouseout":"mouseleave",r(o,ft)))}v+=y}w={id:o._state.TransitStepPinPrefixId+"_Infobox",visible:!1},u=new fi(new l(0,0),w),o._handlers.push(n.addHandler(u,"mouseenter",r(u,function(){window.clearTimeout(this._timeOutHandler),this._timeOutHandler=null}))),o._handlers.push(n.addHandler(u,"mouseleave",r(u,function(){this.setOptions({visible:!1})}))),o._map.entities.push(u)},er.prototype.generateDragAndDropStopPointLink=function(n,t,i,r,u,f,e){var o={},h="",tt=!n,b=tt||n.isViapoint(),v,d,k,p,s,nt;u||(h+=r.latitude.toFixed(a)+","+r.longitude.toFixed(a),o.dw=h,h="",f&&(h+=f.latitude.toFixed(a)+","+f.longitude.toFixed(a),o.lsdw=h,h="")),o.z=this._map.getZoom(),u||b||this._state.stoppoints[0]._uniqueId!==n._uniqueId||(o.start="1");var c=[],w=null,l=null,g=this._state.getOptions();b?(w=t.isViapoint()?this._state.getPreviousWaypoint(t._uniqueId):t,l=i.isViapoint()?this._state.getNextWaypoint(i._uniqueId):i):(w=this._state.getPreviousWaypoint(n._uniqueId),l=this._state.getNextWaypoint(n._uniqueId)),b?(v=this._state.getRouteLegByLegKey(g.routeIndex+"~"+w._uniqueId+"~"+l._uniqueId),c[c.length]=v.legId):(w&&(v=this._state.getRouteLegByLegKey(g.routeIndex+"~"+w._uniqueId+"~"+n._uniqueId),c[c.length]=v.legId),l&&(v=this._state.getRouteLegByLegKey(g.routeIndex+"~"+n._uniqueId+"~"+l._uniqueId),c[c.length]=v.legId)),tt&!u&&(o["new"]="1");if(b){for(d=0,k=!1,s=0;s<this._state.stoppoints.length;s++){k||this._state.stoppoints[s]._uniqueId!==w._uniqueId||(k=!0);if(k)if(this._state.stoppoints[s]._uniqueId===t._uniqueId)break;else d++}o.sli=d.toString()}o.m=u?"1":c.length===2?"5":b?"6":"4";var rt=t?t._uniqueId:n._uniqueId,it=l?l._uniqueId:n._uniqueId,y=0;for(s=0;s<this._state.stoppoints.length;s++){if(!u&&y>=2)break;y>0&&(h+="~"),p=this._state.stoppoints[s],(y>0||p._uniqueId===rt)&&(n||y!==1||(h+="v."+r.latitude.toFixed(a)+","+r.longitude.toFixed(a)+"~",y++),n&&p._uniqueId===n._uniqueId?(p.isViapoint()&&(h+="v."),h+=r.latitude.toFixed(a)+","+r.longitude.toFixed(a)):h+=this._getStopPointParam(p),y++);if(p._uniqueId===it)break}o.w=h,h="";if(!u)for(s=0;s<c.length;s++)o["lid"+s]=c[s];return this._addRouteOptionsLink(o,!0),u&&(o.bb=this._generateMapBoundingBoxLink()),nt=this._getQueryParam(n,r),nt&&!b&&(o.q=nt),this._addPermalinkAdditionalParams(o,e),o},ot.prototype.addNewViapoint=function(t){for(var u=this.stoppoints,f={isViapoint:!0},r=new ft(f),i=0;i<u.length;i++)u[i]._uniqueId===t&&u.splice(i+1,0,r);return n.invoke(this,"waypointAdded",{waypoint:r}),r},ot.prototype.removeAllViaPoint=function(){for(var r=this.stoppoints,i,t=0;t<r.length;t++)i=r[t],i.isViapoint()&&(r.splice(t,1),n.invoke(this,"waypointRemoved",{waypoint:i}),t--)},ot.prototype.removeAllViaInLeg=function(t){for(var f=this.stoppoints,u=!1,r,i=0;i<f.length;i++){r=f[i];if(u)if(r.isViapoint())f.splice(i,1),n.invoke(this,"waypointRemoved",{waypoint:r}),i--;else break;u||r._uniqueId!==t||(u=!0)}},ot.prototype.getViapointCountInLeg=function(n){return ut(n)?0:(n.isViapoint()&&(n=this.getPreviousWaypoint(n._uniqueId)),this.getAllViaInLeg(n._uniqueId).length)},ot.prototype.getAllViaInLeg=function(n){for(var u=[],r=!1,f=this.stoppoints,i,t=0;t<f.length;t++){i=f[t];if(r)if(i.isViapoint())u[u.length]=i;else break;r||i._uniqueId!==n||(r=!0)}return u},dt=function(t,i,f,e){function wt(){var t=it.cloneOptions(it.getOptions().viapointPushpinOptions);o=new lt(s.getCenter(),t),s.entities.push(o),ot=n.addHandler(o,"dragstart",r(h,vt)),ht=n.addThrottledHandler(o,"drag",r(h,pt),250),st=n.addHandler(o,"dragend",r(h,bt))}function vt(){v=!0,ut=n.addHandler(s,"mousemove",r(h,at)),k=s.getWidth(),d=s.getHeight()}function pt(t){if(v){var i=t.entity;b.setLocation(i.getLocation()),n.invoke(h,"dragMove",{location:o.getLocation(),polyline:p})}}function bt(){v=!1,n.removeHandler(ut),rt(!1),n.invoke(h,"dragEnd",{location:o.getLocation(),polyline:p})}function gt(t){var f,u,i,c,e;if(g)return;if(it.stoppoints.length>=ui)return;for(f=t,o||wt(),g=!0,w=-1,u=s.tryLocationToPixel(p.getLocations()),l=[],y=[],i=0;i<u.length;i++)l[i]=u[i].x,y[i]=u[i].y;nt=n.addHandler(s,"mousemove",r(h,kt)),c=f.pageY-s.getPageY(),e=f.pageX-s.getPageX(),et(e,c)}function kt(t){if(!g||!l||!y)return;var r=t.getX(),i=t.getY();et(r,i)||(l=null,y=null,v||rt(!1),n.removeHandler(nt),g=!1,b.setVisibility(!1))}function at(n){if(v){var u=n.getX()+k/2,f=n.getY()+d/2,t=0,i=0;u<50?t=Math.min(50-u,25):u>k-50&&(t=Math.max(k-50-u,-25)),f<50?i=Math.min(50-f,25):f>d-50&&(i=Math.max(d-50-f,-25)),t||i?(c=new tt(t,i),a===-1&&(a=window.setInterval(r(h,yt),250))):(c=new tt(0,0),window.clearInterval(a),a=-1)}}function et(n,t){var u=l.length,r,f,i;if(w>-1)for(r=Math.max(0,w-1),f=Math.min(r+1,u-1),i=r;i<=f;i++)if(ft(n,t,i))return w=i,!0;for(i=0;i<u-1;i++)if(ft(n,t,i))return w=i,!0;return!1}function yt(){var n,i,t;v&&o&&(c.x||c.y)?(n=s.tryLocationToPixel(o.getLocation()),n&&(i=s.tryPixelToLocation(new tt(n.x-c.x,n.y-c.y)),o.setLocation(i),t={center:s.getCenter(),centerOffset:c,animate:!1},s.setView(t))):a!==-1&&(window.clearInterval(a),a=-1)}function rt(n){o.setOptions({visible:n})}function ft(n,t,i){var e=l[i],h=y[i],v=l[i+1],a=y[i+1],r=dt._calculateIntersectionLineConstant(n,t,e,h,v,a);if(r<0||r>1)return!1;var p=Math.round(e+r*(v-e)),c=Math.round(h+r*(a-h)),d=dt._calculateDistanceBetweenPoints(n,t,p,c);if(d<10){var w=c,k=p,f=s.tryPixelToLocation(new tt(k,w));return f&&(o.setLocation(f),rt(!0)),b.setToolTip(u.getString("L_DragToolTip_Text")),b.setLocation(f),!0}return!1}var h=this,it=e,s=t,w=-1,a=-1,p=i,o=null,ot=null,ht=null,st=null,nt=null,ut=null,ct=null,l=null,y=null,g=!1,v=!1,c=null,k=0,d=0,b=f;h.getPolyline=function(){p},ct=n.addHandler(p,"mouseover",r(h,gt)),h.dispose=function(){n.removeHandler(ot),n.removeHandler(ht),n.removeHandler(st),n.removeHandler(ct),n.removeHandler(nt),n.removeHandler(ut),p=null,o&&(s.entities.remove(o),o=null)}},dt._calculateDistanceBetweenPoints=function(n,t,i,r){var f=i-n,u=r-t;return Math.sqrt(f*f+u*u)},dt._calculateIntersectionLineConstant=function(n,t,i,r,u,f){var e=dt._calculateDistanceBetweenPoints(u,f,i,r);return((n-i)*(u-i)+(t-r)*(f-r))/(e*e)},cc_sb_ie=!!window.ActiveXObject,cc_sb_i6=gt.isIE6,wi.InitCalendar=function(n,t,i,r){var s=new Date,e,f,o;s.setTime(t.valueOf()),e=new Date,f=new Date,f.setUTCDate(f.getUTCDate()+730),e.setUTCDate(e.getUTCDate()-730),o=[{id:n,lowDate:function(){return e},highDate:function(){return f},highlightDate:function(){return s},onChange:r}],wi.fc_cal({els:o,daysAbvr:u.getString("L_CalendarDays_Text").split(","),monthsAbvr:u.getString("L_CalendarMonths_Text").split(","),yearUnit:"",monthUnit:"",displayYearFirst:i?1:0})},wi.fc_cal=function(n){function b(n){for(var t=0;t<i.els.length;t++)if(i.els[t].id===n)return i.els[t];return{}}function y(n){if(n&&n.setHours)return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n}function l(n,t){var u,r;try{u=document.getElementById(n);if(u){r=i.parseDate(u.innerHTML.replace(/\<.*\>/ig,""));if(!isNaN(r.valueOf()))return r;throw"not a date";}}catch(f){if(t)return new Date}return undefined}function ot(){e.style.display="block",document.getElementById(e.id)||document.getElementById(i.els[0].id).appendChild(e),cc_sb_i6&&k()}function a(){try{e[o].display="none",u.curMonth=null}catch(n){}}function nt(n,t){var s,u,c,h;if(n.changeOther)try{for(s=0;s<n.changeOther.length;s++){var o=n.changeOther[s],a=o.id,e=o.amt,r=l(a),f=new Date(t.getTime());o.offset&&f.setDate(f.getDate()+o.offset);if(e>0&&r<f||e<0&&r>f||e==0){u=b(a),r=new Date(t.getTime()),r.setDate(r.getDate()+e);try{c=tt(u),h=it(u),r<c&&(r=c),r>h&&(r=h)}catch(v){}document.getElementById(a).value=i.formatDate(r),u.setCurMonth(r)}}}catch(v){}}function tt(n){var i,t;n.lowDate&&(i=n.lowDate());if(n.lowId){t=l(n.lowId);if(n.lowIdOffset)try{t.setUTCDate(t.getUTCDate()+n.lowIdOffset)}catch(r){}(!i||t>i)&&(i=t)}return i}function it(n){var i,t;n.highDate&&(i=n.highDate());if(n.highId){t=l(n.highId);if(n.highIdOffset)try{t.setUTCDate(t.getUTCDate()+n.highIdOffset)}catch(r){}(!i||t<i)&&(i=t)}return i}function p(){var p=tt(u),v=it(u),y,o,w,b,n,f,t,s,h,r,a;for(v&&(y=new Date(v.getTime()),y.setMonth(y.getMonth()-1)),o=l(u.id,!0),o<p&&(o=p),o>v&&(o=v),u.highlightDate&&(w=u.highlightDate()),u.highlightId&&(b=l(u.highlightId)),n=[],cc_sb_i6&&n.push('<iframe id="fc_cal_shield" src="" style="position:absolute;z-index:1;top:-',c,";left:-",c,';margin:0;padding:0" frameborder="0"></iframe>','<div id="fc_cal_ie6Border" class="fc_cal_holder" style="position:absolute;z-index:2;top:-',c,";left:-",c,';"></div>'),u.curMonth||u.setCurMonth(o),f=new Date(u.curMonth.getTime()),t=new Date(f.getTime()),t.setDate(1),s=1;s<=i.calCnt;s++){for(n.push('<div style="z-index:1001" class="fc_cal_monthHolder',s==1?" fc_cal_month_first":"",s==i.calCnt?" fc_cal_month_last":"",f>p||!p?"":" fc_cal_month_lowLimit",f<y||!y?"":" fc_cal_month_highLimit",'"><table><tr><th colspan="7">'),s==1&&n.push('<a href="#" id="fc_cal_monthDec" class="fc_cal_monthDec fc_cal_monthChange" onclick="return false">',i.decStr,"</a>"),s==i.calCnt&&n.push('<a href="#" id="fc_cal_monthInc" class="fc_cal_monthInc fc_cal_monthChange" onclick="return false">',i.incStr,"</a>"),n.push("<div>",i.formatMonth(f),"</div>"),n.push('</th></tr><tr class="fc_cal_days">'),h=0;h<i.daysAbvr.length;h++)n.push("<td>",i.daysAbvr[h],"</td>");for(r=0,n.push("</tr><tr>"),a=t.getDay(),a<i.firstDay&&(a=a+7),h=i.firstDay;h<a;h++)n.push('<td class="fc_cal_blank fc_cal_disabled">&nbsp;</td>'),r++;while(t.getMonth()==f.getMonth())r===0&&n.push("<tr>"),t<p||t>v?n.push('<td class="',t==o?"fc_cal_selected ":"",'fc_cal_disabled">',i.formatDay(t),"</td>"):n.push('<td class="',t.getTime()==o.getTime()?" fc_cal_current":"",w&&t.getTime()==w.getTime()?" fc_cal_highlight":"",b&&t.getTime()==b.getTime()?" fc_cal_highlight":"",'"><a href="#" id="fc_cal_day_',t.getTime(),'" onclick="return false">',i.formatDay(t),"</a></td>"),t.setDate(t.getDate()+1),r<6?r++:(n.push("</tr>"),r=0);while(r<7&&r>0)n.push('<td class="blank">&nbsp;</td>'),r<6||n.push("</tr>"),r++;n.push("</tbody></table></div>"),f.setMonth(f.getMonth()+1)}e.innerHTML=n.join(""),cc_sb_i6&&k()}function k(){var t,n;try{t=document.getElementById("fc_cal_shield"),t[o].height=e.offsetHeight+"px",t[o].width=e.offsetWidth+"px",n=document.getElementById("fc_cal_ie6Border"),n[o].height=e.offsetHeight-w*2+"px",n[o].width=e.offsetWidth-w*2+"px"}catch(i){}}function et(n){var f=eu(n),t=f.id,r;t.indexOf("fc_cal_day_")===0?(r=new Date(parseInt(t.substring(11),10)),document.getElementById(u.id).innerHTML=i.formatDate(r),u.setCurMonth(r),nt(u,r),u.onChange&&u.onChange(),a(),vr(n)):(t=="fc_cal_monthDec"&&(u.curMonth.setMonth(u.curMonth.getMonth()-1),p()),t=="fc_cal_monthInc"&&(u.curMonth.setMonth(u.curMonth.getMonth()+1),p()),vr(n),ou(n))}function d(n){var t=eu(n);u=b(t.id),vr(n),ou(n),p(),ot(t)}function rt(n){n.keyCode==9&&a()}var i=n,u,ft,e,c,w,ut,o="style",g={holderId:"fc_cal_holder",holderClass:"fc_cal_holder",firstDay:0,curMonth:undefined,incStr:"&#187;",decStr:"&#171;",calCnt:1,parseDate:function(n){try{var i=t.getDateFromStringInSupportedFormat(n,h.TransitDateFormat);if(isNaN(i.valueOf()))throw"NaN";return i}catch(r){return undefined}},formatDate:function(n){return t.getDateInSupportedFormat(n)},formatDay:function(n){return n.getDate()},formatMonth:function(n){var t=[];return i.displayYearFirst===1?t.push(n.getFullYear(),i.yearUnit," ",i.monthsAbvr[n.getMonth()],i.monthUnit):t.push(i.monthsAbvr[n.getMonth()],i.monthUnit," ",n.getFullYear(),i.yearUnit),t.join("")}},v,f,r,s;try{ft=y(new Date);for(v in g)i[v]===undefined&&(i[v]=g[v]);for(r=0;r<i.firstDay;r++)i.daysAbvr.push(i.daysAbvr.shift());for(e=document.createElement("div"),e.id=i.holderId,e.className=i.holderClass,e[o].display="none",e[o].position="absolute",e[o].zIndex="1000",document.getElementById(i.els[0].id).appendChild(e),cc_sb_i6&&(c=e.currentStyle.borderWidth,w=parseInt(c.substring(0,c.length-2),10),ut=e.currentStyle.borderColor),at(e,"click",et,!1),f=i.els,r=0;r<f.length;r++)f[r].setCurMonth=function(n){try{this.curMonth=new Date(n.getTime()),this.curMonth.setDate(1)}catch(t){}},s=document.getElementById(f[r].id),f[r].lowDate&&(f[r].lowDateSaver=f[r].lowDate,f[r].lowDate=function(){return y(this.lowDateSaver())}),f[r].highDate&&(f[r].highDateSaver=f[r].highDate,f[r].highDate=function(){return y(this.highDateSaver())}),f[r].highlightDate&&(f[r].highlightDateSaver=f[r].highlightDate,f[r].highlightDate=function(){return y(this.highlightDateSaver())}),at(s,"click",d),at(s,"focus",d),at(s,"keydown",rt),at(s,"change",a),f[r].onChange&&at(s,"change",f[r].onChange),f[r].changeOther&&at(s,"change",function(){var t=b(this.id),n=l(this.id);nt(t,n)});at(document,"click",a),at(window,"resize",a)}catch(st){}},ot.prototype.moveWaypoint=function(n,t){for(var f=null,r=this.stoppoints,u,i=0;i<r.length;i++){u=r[i];if(u._uniqueId===n){f=u,this.removeStoppoint(n,!0);break}}if(!f)return;if(t)for(this.removeAllViaInLeg&&this.removeAllViaInLeg(t),i=0;i<r.length;i++){u=r[i];if(u._uniqueId===t){r.splice(i+1,0,f);break}}else r.splice(0,0,f)},ot.prototype.addRoundTripWapoint=function(){var u=this.stoppoints,t=u[0],f;if(t.getAddress()){f=null,t.getLocation()&&(f=t.getLocation());var i=t.getBusinessDetails(),e={address:t.getAddress(),location:f,isViapoint:!1,exactLocation:t.isExactLocation(),businessDetails:{businessName:i.businessName,phoneNumber:i.phoneNumber,entityId:i.entityId,website:i.website}},r=new ft(e);return u[u.length]=r,n.invoke(this,"waypointAdded",{waypoint:r}),r}return null},ot.prototype.isRoutableLatLongAvailableForAllStopPoints=function(){var t=this.stoppoints,n,i;if(t.length<2)return!1;for(n=0;n<t.length;n++){i=t[n];if(!i.getLocation())return!1}return!0},vi=function(s,h,a,v){function bi(){var t=p.getOptions(),u=p._getPrefixId(),r=t.itineraryContainer,n;return oi.createDirectionPanel(r,u,t.routeMode),n=i("#"+u+di,r).element(),n.innerHTML="",n}function tr(n,t){var o,c,l,a,v,s,h;if(n)return o=e(d+"WaypointContainer"+n._uniqueId,"waypointContainer firstWaypoint",null),o.setAttribute("WaypointUniqueId",n._uniqueId),t&&(b._ddInputZIndex=400),o.style.zIndex=b._ddInputZIndex,b._ddInputZIndex--,c=y(d+"AddStopDiv"),g.insertBefore(o,c),l=f("span",d+"LandingLetter"+n._uniqueId,"dd_directionStepLetter",o,""),o.appendChild(document.createTextNode("")),a=si(o,n,t,"sw_b ddInput","sw_qbox ddInputBox"),v=i(l),v.add_event("mousedown",r(b,gt)),s=k(d+"WaypointClose"+n._uniqueId,"closeWaypoint closeWaypointLanding",a,"","#"),i(s).set_attr("WaypointUniqueId",n._uniqueId),i(s).add_event("click",r(b,ti)),t&&(h=k(d+"WaypointReverse","dd_reverseDirections",o,"","#"),h.title=u.getString("L_DirectionsMenuReverse_Text"),i(h).add_event("click",r(b,ai))),dt(n,o),o}function vi(n){var t=e(d+"AddStopDiv","addStopContainer",n),f=k(d+"AddStop","addStop",t,u.getString("L_AddStop_Text"),"#");return i(f).add_event("click",r(b,li)),wt(t),t}function ai(t){t.preventDefault(),p.reverseWaypoints(),n.invoke(b,"optionsChanged",{refreshLandingPage:!0})}function li(t){t.preventDefault();var i=new ft({});p.addStoppoint(i),n.invoke(b,"optionsChanged",{refreshLandingPage:!0})}function ht(){var t=p.stoppoints[0],r=p.stoppoints[p.stoppoints.length-1],u=i("#"+d+"RoundTrip"),n=u.element();n&&(n.checked=t.getAddress()&&t.getAddress()===r.getAddress())}function ut(){t.RemoveDomElement(d+"OneClickDirectionsContainer")}function si(n,u,f,o,s){var c=e(d+"basicWrapper"+u._uniqueId,o,n),h;return i(c).set_style({position:"static"}),h=t._addInputElement(d+"WaypointInput"+u._uniqueId,s,c,t.getInputDisplayText(u),"text",""),h.setAttribute("WaypointUniqueId",u._uniqueId),h.onChange=r(b,ct),i(h).add_event("change",r(b,wi)),i(h).add_event("keydown",r(b,gi)),c}function hi(){var i=0,t;for(count=p.stoppoints.length,t=0;t<count;t++)!p.stoppoints[t].isViapoint()&&(p.stoppoints[t].getAddress()||p.stoppoints[t].getLocation())&&i++;typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(d+"ShowDirections"),i<2||(p.removeEmptyWaypoints(),n.invoke(b,"updateDirections",null))}function ci(n){n.preventDefault()}function gi(n){var i=parseInt(n.target.getAttribute("WaypointUniqueId")),r=p.getStoppointIndex(i);r&&r!==1||ut(),st(i),t.RemoveDomElement(d+"MessageContainer"),ii(i)}function nr(n){var e=t._addInputElement(d+"WaypointClear","button higButton secondary",n,u.getString("L_Clear_Text"),"button",""),f;i(e).add_event("click",r(b,yt)),f=t._addInputElement(d+"ShowDirections","button goButton",n,u.getString("L_DirectionsGetDirections_Text"),"Submit",""),f.onclick=r(b,hi),i(f).add_event("click",r(b,ci))}function wi(n){ct(n.target)}function ct(t){var s=i(t).get_val().trim(),v=t.getAttribute("WaypointUniqueId").toString(),o,h,a,r,w,c;s===u.getString("L_DirectionsAddressCityLocation_Text")&&(s=""),o=p.getStoppointById(parseInt(v));if(o){var f=null,y=t.getAttribute("serializedWaypointAddress"),e="";y&&(e=y.toString(),t.removeAttribute("serializedWaypointAddress"),e&&(h=e.indexOf(";"),h>0&&(a=e.substring(0,h),r=a.split(","),r.length===4&&(r[0]&&r[1]?f=new l(parseFloat(r[0]),parseFloat(r[1])):r[2]&&r[3]&&(f=new l(parseFloat(r[2]),parseFloat(r[3]))))))),o.clear(),w=ki(parseInt(v)),c=f?new l(f.latitude,f.longitude):null,o.setOptions({address:s,location:f,geoLocation:c}),n.invoke(b,"optionsChanged",{refreshLandingPage:!1,clearResultsPage:!0}),window.setTimeout(b._setFocus,1)}}function ki(n){var o=!1;if(p&&p.stoppoints){var e=p.getPreviousWaypoint(n),h=p.getNextWaypoint(n),s=p.getStoppointById(n),r=e?e:s,i=h?h:s;if(p.stoppoints.length>0&&r&&i&&r!==i){var u=0,t=p.stoppoints[u],f=!0;while(t&&t!==i){if(f)t===r&&(f=!1);else if(t.isViapoint()){p.removeStoppoint(t._uniqueId,!1),o=!0,t=p.stoppoints[u];continue}t=p.stoppoints[u++]}}}return o}function bt(){var n=e(d+"ButtonPanel","buttonPanel",g);return nr(n),n}function vt(){var t=i("div[id*="+d+"WaypointContainer]"),r=t.length,c=r>2?"inline":"none",v=i("a[id*="+d+"WaypointClose]"),l,a,f,h,n,e,u,s;for(v.set_style({display:c}),l=i("#"+d+"ReverseRoute"),l.set_style({display:c}),a=i("#"+d+"WaypointReverse"),a.set_style({display:r===2?"inline":"none"}),f=i("div[id*="+d+"basicWrapper]"),f.remove_class("waypointCloseMargin"),r>2&&f.add_class("waypointCloseMargin"),h=i("span[id*="+d+"LandingLetter]"),t.remove_class("firstWaypoint"),t.remove_class("dd_midWaypoint"),t.remove_class("dd_lastWaypoint"),n=0;n<r;n++)e=h.element(n),e&&(e.innerHTML=yi[n]),n?n===r-1?i(t.element(n)).add_class("dd_lastWaypoint"):i(t.element(n)).add_class("dd_midWaypoint"):i(t.element(n)).add_class("firstWaypoint");u=y(d+"AddStop"),u&&(t=p.getAllWaypoints(),s=p.getOptions().routeMode===o.transit?ar:ui,u.style.display=t.length<s?"inline":"none"),ht()}function dt(){}function wt(s){var y=null,h;p.getOptions().routeMode===o.transit&&(y=e(d+"TransitOptionsDiv","collapsibleRouteOptions routeOptionsContainer",g));var et=e(d+"RouteSettingsDiv","optionsContainer",s),v=f("fieldset",d+"RouteSettings","routeOptions",s,""),a=f("span",d+"DistanceUnit","distanceUnit",v,"");w==="ja-jp"&&(a.style.display="none");var k=f("span","","radio",a,""),c=t._addInputElement(d+"mi","",k,"mi","radio","routeDistanceUnit"),ft=f("label",d+"miLabel","",k,u.getString("L_MilesSettings_Text"));ft.setAttribute("for",c.id),i(c).add_event("click",r(b,at));var tt=f("span","","radio",a,""),l=t._addInputElement(d+"km","",tt,"km","radio","routeDistanceUnit"),ut=f("label",d+"kmLabel","",tt,u.getString("L_KmSettings_Text"));ut.setAttribute("for",l.id),i(l).add_event("click",r(b,at)),p.getOptions().distanceUnit===rt.miles?i(c).set_attr("checked","checked"):i(l).set_attr("checked","checked"),nt||(nt=new wu(p,!0)),nt.addCollapsibleHeader(null,u.getString("L_ShowOptions_Text"),v,!0),h=nt.showRouteOptionsForCurrentMode(v,y),it.push(n.addHandler(nt,"optionsChanged",function(t){t.updateDirections?n.invoke(b,"optionsChanged",{refreshLandingPage:!1}):n.invoke(b,"optionsChanged",{clearResultsPage:!0,refreshLandingPage:!1})})),i("label",h).add_class("optionsLabel"),i("#SaveDestinationHistory",h).add_class("dd_checkboxInput")}function at(t){p.setOptions({distanceUnit:pi===i(t.target).get_val()?rt.miles:rt.kilometers}),n.invoke(b,"optionsChanged",{refreshLandingPage:!1}),VEShell.Cookie.create(ff,p.getOptions().distanceUnit===rt.miles?pi:sf,1)}function gt(n){var t,u,f;n.stopPropagation(),b._isDragging=!0,t=n.target.parentNode,b._moveTarget=t,u=i(t),i("#"+d+"WaypointReverse").set_style({display:"none"}),i("a[id*="+d+"WaypointClose]").set_style({display:"none"}),i("#"+p._getPrefixId()).add_class("disableSelection"),ut(),u.add_class("waypointDragging"),b._waypointMeasuredHeight=u.has_class("dd_lastWaypoint")?t.offsetTop-t.previousSibling.offsetTop:t.nextSibling.offsetTop-t.offsetTop,f=i.Screen.get_mouse_pos(n).y,ot=f,b._waypointDragMouseUpHandler=r(b,ei),i(document.documentElement).add_event("mouseup",b._waypointDragMouseUpHandler,!1),b._waypointDragMouseMoveHandler=r(b,fi),i(document.documentElement).add_event("mousemove",b._waypointDragMouseMoveHandler,!1),i.Events.capture_mouse(document.documentElement)}function fi(n){if(b._isDragging){var t=b._moveTarget,o=i.Screen.get_mouse_pos(n).y,e=i(t),r=o-ot,u=b._waypointMeasuredHeight,f=!1;!e.has_class("firstWaypoint")&&r<-.5*u?(t.parentNode.insertBefore(t,t.previousSibling),f=!0,r=u/2):!e.has_class("dd_lastWaypoint")&&r>.5*u&&(t.parentNode.insertBefore(t,t.nextSibling.nextSibling),f=!0,r=-u/2),f&&(vt(),i("#"+d+"WaypointReverse").set_style({display:"none"}),i("a[id*="+d+"WaypointClose]").set_style({display:"none"}),ot=o-r),e.set_style({top:r+"px"})}}function ei(){var u;i.Events.release_mouse(),i(document.documentElement).remove_event("mouseup",b._waypointDragMouseUpHandler,!1),i(document.documentElement).remove_event("mousemove",b._waypointDragMouseMoveHandler,!1),b._isDragging=!1;var f=i(b._moveTarget),e=parseInt(f.get_attr("WaypointUniqueId")),r="";f.has_class("firstWaypoint")||(u=i(b._moveTarget.previousSibling),r=parseInt(u.get_attr("WaypointUniqueId"))),p.moveWaypoint(e,r),n.invoke(b,"optionsChanged",{refreshLandingPage:!0}),i("#"+p._getPrefixId()).remove_class("disableSelection"),i(".waypointDragging").set_style({top:"0px"}).remove_class("waypointDragging")}function lt(){if(p.stoppoints.length<=1)return;var t=p.stoppoints[0],n=p.stoppoints[1].getLocation();t.getAddress()||t.getLocation()||!n||ni.getNearbyArterialsResults(kt,n,r(b,ri),null,null,pt)}function ri(t){var a,s,v,c;ut(),a=p.getOptions();if(!t.length||a&&a.routeMode!==o.driving)return;var h=p.stoppoints[0],g=y(d+"WaypointContainer"+h._uniqueId),w=e(d+"OneClickDirectionsContainer","ddOneClickDirectionsContainer",g);for(f("span",d+"OneClickDirectionsMessage","ddOneClickDirectionsHeader",w,u.getString("L_OneClickDirectionsHeader_Text")),s=0;s<t.length;s++)v=e("","ddOneClickDirectionsArterials",w),c=k(d+"OneClickDirectionsOption"+s,"",v,t[s].address.formattedAddress,"#"),i(c).set_attr("OptionNumber",s.toString()),i(c).add_event("click",r(b,function(r){r.preventDefault();var u=parseInt(i(r.target).get_attr("OptionNumber")),f={address:t[u].address.formattedAddress,location:new l(t[u].latitude,t[u].longitude)};h.clear(),h._locationIdentifier=t[u].locationIdentifier,h.setOptions(f),n.invoke(b,"updateDirections",null)}));b._setFocus(!0)}function ti(i){i.preventDefault();var r=i.target.getAttribute("WaypointUniqueId").toString(),u=y(d+"WaypointInput"+r);t.removeBehavior(u),p.removeStoppoint(parseInt(r),!0),typeof VEShell!="undefined"&&VEShell.Logging.get_instance().logSubmit(i.currentTarget.id),n.invoke(b,"optionsChanged",{refreshLandingPage:!0})}function ii(n){t.RemoveDomElement(d+"DisambiguationOuterContainer"+n)}function st(n){var i=y(d+"WaypointContainer"+n),t=y(d+"WaypointBizDataContainer_"+n);t&&i.removeChild(t)}var b=this,ot=-1,et=h,pt=a,tt=null,nt=null,g=null,p=v,ir=null,it=[],d=p._getPrefixId(),kt=s,yt;b._createWaypointDisambiguation=function(n){var t=n.waypoint,r=y(d+"WaypointContainer"+t._uniqueId),i=e(d+"DisambiguationOuterContainer"+t._uniqueId,"",r);n.containerElement=i,e(d+"DisambiguationContainerBeak"+t._uniqueId,"disambgContainerBeak",i)},b._waypointChanged=function(n){n&&!n.getDisambiguationResult()&&(p.getStoppointIndex(n._uniqueId)===1&&lt(),ht(),st(n._uniqueId),t.RemoveDomElement(d+"MessageContainer"))},b._createLandingPage=function(t,i){var e,l,s,a,r,h;g=bi(),tt||(tt=new pu(p,!0)),tt.createModeSwitchingIcons(g),it.push(n.addHandler(tt,"modeChanged",function(){n.invoke(b,"optionsChanged",{refreshLandingPage:!0})}));while(p.stoppoints.length<2)e=new ft({}),p.addStoppoint(e);for(p.stoppoints[p.stoppoints.length-1].isViapoint()&&(e=new ft({}),p.addStoppoint(e)),p.stoppoints[0].isViapoint()&&(e=new ft({}),p.addStoppoint(e,0)),l=p.getOptions().routeMode===o.transit?ar:ui,p.stoppoints.length>l&&(t=u.getString("L_ExceedMaxWaypointLimitError_Text").replace("{0}",ui),i=c.exceedMaxWaypointLimit),t&&i!==c.waypointDisambiguation&&i!==c.emptyWaypoint&&i!==c.atleastTwoWaypointsRequired&&f("span",d+"MessageContainer","dd_messageContainer",g,t),s=p.stoppoints,a=null,r=0;r<s.length;r++)h=s[r],h.isViapoint()||(a=tr(h,!r),r||lt());vi(g),bt(),vt()},b.updateReverseGeocodedText=function(n){var r=n.getAddress(),t=y(d+"WaypointInput"+n._uniqueId);t&&(t.value=r,i(t).remove_class("Watermark"))},b.createLandingPushpins=function(){et&&(et.removeAllPushpins(),et.createPushpins(p.getAllWaypoints()))},b._setFocus=function(n){var e=!1,t=i("a[id^="+d+"DisambiguationAddressLink]"),u,r,f;if(t.length>0)t=t[0];else{for(t=null,u=p.getAllWaypoints(),r=0;r<u.length;r++)if(!u[r].getAddress()&&!u[r].getLocation()){t=y(d+"WaypointInput"+u[r]._uniqueId),e=!0;break}t||(t=y(d+"ShowDirections"))}if(t){try{t.focus()}catch(o){}n&&e&&window.Sys&&window.Sys.UI&&window.Sys.UI.Behavior&&(f=Sys.UI.Behavior.getBehaviorByName(t,"PersonalizationBehavior"),f&&f.hideList())}},yt=function(){var i=p.getOptions(),r=i.distanceUnit;p.resetDirectionState({removeAllWaypoints:!0,resetRequestOptions:!0}),p.setOptions({distanceUnit:r,routeMode:i.routeMode}),n.invoke(b,"optionsChanged",{refreshLandingPage:!0})},b.dispose=function(){var f,u;tt&&tt.dispose(),nt&&nt.dispose(),g&&(f=i("input[id*="+d+"WaypointInput]").for_each(r(b,function(n){t.removeBehavior(n)})),g.parentNode.removeChild(g),g=null),u=it.length;while(u--)n.removeHandler(it[u]);it=[]}},delete window.Microsoft.Maps.initDirectionsCode,yt.Dynamic&&yt.Dynamic.done("Microsoft.Maps.Directions"),wt.end("Module initialized","Microsoft.Maps.Directions",{module:"Directions"})},Microsoft.Maps.Map&&Microsoft.Maps.initDirectionsCode&&window.Microsoft.Maps.initDirectionsCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initSearch=function(){function b(n){var t=this;t._task=null,t._map=n}var n=window.Microsoft.Maps,f=n.Search=n.Search||{},lt=n.Gimme,o=n.Globals,at=n.Events,t=n.InternalNamespaceForDelay,ot=t.Network,v=t.Quirks,p=t.PRF,a=n.Location,ht=n.LocationRect,yt=6,tt=10,u=20,et=function(n){return typeof n=="undefined"||typeof n=="unknown"},rt=function(n){return et(n)||n===null},vt=function(n){return typeof n=="undefined"||typeof n=="unknown"||n===null||n===""},s=function(n,t,i,r,u){p.start(u),ot.getObjectAsync(i,st,[n,r,u],n.timeout||-1)},st=function(n,t){var u=t.userData,i=u[0],o=i.errorCallback,f=u[1],e=u[2],r;e&&p.end(e),t&&t.success&&n?(r=v.useXHR?n:n.response,r&&f&&f(r,i,i.callback,i.userData)):o&&o({request:i})},l=function(n,t,i,r){return v.useXHR?n.format="json":(n.jsonso="{jsono}",n.jsonp="microsoftMapsNetworkCallback"),n.culture='"'+o.locale+'"',n.token=t?t:"",i+(r?"/"+r:"")+"?"+ut(n)},ut=function(n){var i="",r=!0,t;for(t in n)r||(i+="&"),i+=t+"=",t==="jsonso"?i+=n[t]:rt(n[t])||(i+=encodeURIComponent(n[t].toString())),r=!1;return i},it=function(n){var s="",f,e,r;if(n){f=n&&n.getNorthwest(),e=n&&n.getSoutheast();if(f&&e){var o=f.latitude,i=e.longitude,t=e.latitude,u=f.longitude;o<t&&(r=o,o=t,t=r),i<u&&(r=i,i=u,u=r),s=o+", "+i+", "+t+", "+u}}return s},w=function(n){if(n&&n.NorthEastCorner&&n.SouthWestCorner){var r=n.SouthWestCorner.Latitude,u=n.NorthEastCorner.Latitude,t=n.NorthEastCorner.Longitude,i=n.SouthWestCorner.Longitude;return new ht(new a((r+u)/2,(i+t)/2,null,null),t-i,u-r)}return null},i=function(n){return n?'"'+n+'"':""},h={none:0,good:1,ambiguous:2,upHierarchy:4,modified:8},r={high:0,medium:1,low:2,unknown:-1},y={interpolated:0,rooftop:1},c,k;f.MatchCode=h,f.MatchConfidence=r,f.LocationPrecision=y;var ct=function(n){var i=null,t;return n&&(t=ft(n.Results),t&&(i={parsedAddress:nt(n.ParsedAddress),parsedKeyword:n.parsedKeyword||"",parsedSeparator:n.parsedSeparator||"",results:t||[]})),i},e=function(n){var r=null,t,i;return n&&(t=n.Coordinates,t&&(i=n.Precision||y.Interpolated,r={location:new a(t.Latitude,t.Longitude),precision:i,name:n.Name})),r},g=function(n){var r=[],t,i;if(n)for(t=0;t<n.length;t++)i=e(n[t]),i&&r.push(i);return r},nt=function(n){var t=null;return n&&(t={addressLine:n.AddressLine||"",adminDistrict:n.AdminDistrict||"",countryRegion:n.CountryRegion||"",district:n.District||"",formattedAddress:n.FormattedAddress||"",locality:n.Locality||"",postalCode:n.PostalCode||"",postalTown:n.PostalTown||""}),t},d=function(n){var u=null;if(n&&n.Name&&n.BestLocation&&n.Locations&&n.BestView){var f=w(n.BestView),t=e(n.BestLocation),i=g(n.Locations);f&&t&&i&&(u={name:n.Name,location:t&&t.location,locations:i,bestView:f,matchConfidence:n.MatchConfidence||r.unknown,matchCode:n.MatchCode||h.none})}return u},ft=function(n){var r=[],t,i;if(n)for(t=0;t<n.length;t++)i=d(n[t]),i&&r.push(i);return r};f.SearchManager=b,searchManagerPrototype=b.prototype,searchManagerPrototype.search=function(n){var t=this._map;t&&(n.bounds||(n.bounds=t.getBounds()),k.search(n,t))},searchManagerPrototype.geocode=function(n){var t=this._map;t&&(n.bounds||(n.bounds=t.getBounds()),c.geocode(n,t))},searchManagerPrototype.reverseGeocode=function(n){var t=this._map;t&&c.reverseGeocode(n,t)},c=new function(){function c(n,t,i,r){i&&n&&i(ct(n),r)}function a(n,t,i,r){if(i&&n){var f=null,u=n.Results;u&&u.length>0&&(f=d(u[0])),i(f,r)}}function e(n,t){var e=n.count||tt,f,s;return e>u&&(e=u),f="",s={query:i(n.where),mapBounds:i(it(n.bounds)),count:e,landmark:f,addressLine:f,locality:f,postalTown:f,adminDistrict:f,district:f,postalCode:f,countryRegion:f,currentLocation:f,curLocAccuracy:f,entityTypes:f,rankBy:f},l(s,t,o.geocodingService,r)}function h(n,i){var r={};return r.latitude=n.latitude,r.longitude=n.longitude,l(r,i,o.geocodingService,t)}var f=this,r="Geocode",t="ReverseGeocode";f.geocode=function(n,t){t&&n&&t.getCredentials(function(i){var u=e(n,i);s(n,t,u,c,r)})},f.reverseGeocode=function(i,r){if(r&&i){var u=i.location;u instanceof n.Location&&r.getCredentials(function(n){var f=h(u,n);s(i,r,f,a,t)})}}},k=new function(){function ut(n,t,i,r){i&&n&&i(b(n,t),r)}function rt(t,r){var s=c,f=t.count||tt,e;return f>u&&(t.count=f=u),t.center instanceof n.Location&&(s=t.center.latitude+","+t.center.longitude),f+=1,e={count:f,startingIndex:t.startIndex||0,mapBounds:i(it(t.bounds)),locationcoordinates:i(s),entityType:i("Business"),sortorder:c,query:i(t.query),location:i(t.where),keyword:i(t.what)},l(e,r,o.searchService)}function b(n,i){var u=null,o,e,r;return n&&(o=t(n.SearchResults,y),e=i.count,u={searchRegion:f(n.SearchRegion),alternateSearchRegions:t(n.AlternateSearchRegions,f),parseResults:t(n.ParseResults,p),searchResults:o.splice(0,e),hasMore:o.length>e},r=n.ResponseSummary,r&&(u.responseSummary={copyright:r.Copyright||"",statusCode:r.StatusCode||0,authResultCode:r.AuthResultCode||0,errorMessage:r.ErrorMessage||null,traceId:r.TraceId||""})),u}function t(n,t){var u=[],i,r;if(n)for(i=0;i<n.length;i++)r=t(n[i]),r&&u.push(r);return u}function y(n){var i=null,t;return n&&(t=n.Location,i={entityType:n.EntityType||0,id:n.Id||"",name:n.Name||"",address:n.Address||"",city:n.City||"",state:n.State||"",postalCode:n.PostalCode||"",country:n.Country||"",phone:n.Phone||"",location:t&&new a(t.Latitude,t.Longitude),website:n.Website||"",hoursOfOperation:n.HoursOfOperation||null,userRating:n.UserRating||0,reviewCount:n.ReviewCount||0,birdsEyeSceneIndicator:n.BirdsEyeSceneIndicator||0,structuredDescription:n.StructuredDescription||null}),i}function p(n){var t=null;return n&&(t={keyword:n.Keyword||"",location:e(n.Location),matchConfidence:n.MatchConfidence||r.unknown}),t}function f(n){var i=null,t;return n&&(t=n.MapBounds,i={mapBounds:t?{locationRect:w(t),type:t.Type||0}:null,explicitLocation:e(n.ExplicitLocation),source:n.Source||"",matchConfidence:n.MatchConfidence||r.unknown,matchCode:n.MatchCode||h.none,address:nt(n.Address),geocodeLocations:g(n.GeocodeLocations)}),i}function v(n){return(n.where||n.what||n.query)&&n.count>0}var d=this,c="",ft=null,k="Search2";d.search=function(n,t){n&&(t&&v(n)?t.getCredentials(function(i){var r=rt(n,i);s(n,t,r,ut,k)}):n.errorCallback&&n.errorCallback({request:n}))}},delete window.Microsoft.Maps.initSearch,t&&t.Dynamic&&t.Dynamic.done("Microsoft.Maps.Search"),t&&t.PRF.end("Module initialized","Microsoft.Maps.Search",{module:"Search"})},Microsoft.Maps.Map&&Microsoft.Maps.initSearch&&window.Microsoft.Maps.initSearch()