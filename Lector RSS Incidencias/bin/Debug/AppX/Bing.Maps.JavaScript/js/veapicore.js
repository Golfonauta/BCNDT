window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},Microsoft.Maps.Gimme=function(){var n=function(){function n(n){Array.prototype.push.apply(this,n)}function t(i,r){var u=!i&&[]||(r||typeof i=="string")&&t.query(i,r)||i instanceof Array&&i||[i];return new n(u)}function i(n,t){var i;for(i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i])}return i(n,{length:Array.prototype.length,entities:function(){return Array.prototype.slice.apply(this)},sort:function(n){return Array.prototype.sort.call(this,n),this},reverse:function(){return Array.prototype.reverse.call(this),this},push:function(){return Array.prototype.push.apply(this,arguments),this},pop:function(){var t=Array.prototype.pop.call(this);return new n([t])},shift:function(){var t=Array.prototype.shift.call(this);return new n([t])},unshift:function(){return Array.prototype.unshift.apply(this,arguments),this},slice:function(){return new n(Array.prototype.slice.apply(this,arguments))},splice:function(){return new n(Array.prototype.splice.apply(this,arguments))},concat:function(t){return new n(Array.prototype.concat.apply(this.entities(),t.entities&&t.entities()||arguments))}}),t.Helper={get_guid:function(){var n=0;return function(t){if(!t)return"";if(t===window)return"win";if(t===document)return"doc";if(t.uniqueID)return t.uniqueID;var i="__$gimme$_guid__";return typeof t[i]=="undefined"&&(t[i]=i+n++),t[i]}}()},t.Browser=function(){var n=navigator.userAgent.toLowerCase();return{is_ie:typeof ActiveXObject!="undefined",is_opera:typeof window.opera!="undefined",is_khtml:n.indexOf("khtml")!==-1,is_gecko:n.indexOf("khtml")===-1&&n.indexOf("gecko")!==-1,is_in_quirks_mode:document.compatMode==="BackCompat"}}(),t.undefined={}._$gimme$_undefined,t.ext=n.prototype,t}();return n.ext.select=function(t){return n(t,this[0])},typeof g=="undefined"&&(window.g=n),n.Internals=new function(){function n(n){return function(t,i,r){this[n](t,i,r)}}return{addEventListener:n("addEventListener"),removeEventListener:n("removeEventListener"),attachEvent:n("attachEvent"),detachEvent:n("detachEvent")}},n.query=function(){return function(){function d(n,t,i){return u[t](n,i)}function k(n,t){var r=[],u=t.length,i;do i=p(n,t[--u]||t),i&&r.push(i);while(u);return r}function p(n,t){if(n===document||!t)return t;var i=t;while((i=i.parentNode)&&i!==n);return i===n&&t||null}function g(n,t){return p(n,document.getElementById(t))}function w(n,t){var u,f,i,e;t=t||document;if(n.id)return o([g(t,n.id)],n);delete n.id,u=t.getElementsByTagName(n.tag||"*");if((!n.classes||n.classes.length<1)&&(!n.attributes||n.attributes.length<1)&&(!n.pseudos||n.pseudos.length<1))return a(u);for(f=[],e=u.length,i=0;i<e;i++)r(n,u[i])&&f.push(u[i]);return f}function r(n,t){if(!t)return!1;for(var r=n.propNames,f=r.length,i=0;i<f;i++)if(!u[r[i]](t,n[r[i]]))return!1;return!0}function a(n){for(var i=[],r=n.length,t=0;t<r;t++)i[t]=n[t];return i}function o(n,t){for(var u=[],f=n.length,i=0;i<f;i++)n[i]&&n[i].nodeType===1&&r(t,n[i])&&u.push(n[i]);return u}function l(n,t){return h(n,t)!==-1}function c(n){var r;i.inc();for(var f=i.name,u=[],e=n.length,t=0;t<e;t++)r=n[t],r[f]!==i.t&&(r[f]=i.t,u.push(r));return u}function e(n){this.name=n,this.f=0,this.t=1,this.inc=function(){this.f=(this.t+=2)-1}}function b(n){this.parse=function(t){var f,i,e=n.preprocessInput,r,u;t=e&&e(t)||t,n.reset(),r=0,u=t.length;while(r<u){f=t.charAt(r),i=i||n[f]||n["default"];if(i){advance=i(t.substring(r,u));if(!advance)throw'No valid match found for "'+i.name+'" rule';r+=advance}else throw'No suitable rule found to handle character "'+f+'"';i=null}return n.finish()}}function s(t,i){var b=i,e,r,h,o,c,l,s;i=i||document,n.inc();if(typeof t!="string")return k(i||document,t);r=[];try{r=a(i.querySelectorAll(t))}catch(p){for(h=y.parse(t),c=h.length,o=0;o<c;o++){var u=h[o],v=u.length,f=v%2-1;e=f===0?w(u[f],i):[i||document];while(u[++f])l=u[f++],s=u[f],s.root=i,e=d(e,l,s);r=c>1?r.concat(e):e}}return r}var i,t,n,u,v,y,h=function(){function t(n,t){return n.indexOf(t)}function n(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i]===t)return i;return-1}return typeof Array.prototype.indexOf!="undefined"?t:n}(),f=function(){function t(n,t){return n.getAttribute(t)}function n(n,t){switch(t.toLowerCase()){case"class":return n.className||null;case"id":return n.id||null;case"href":case"src":if(typeof n.getAttribute!="undefined")return n.getAttribute(t,2)}return n.attributes&&n.attributes[t]&&n.attributes[t].nodeValue||n.getAttribute(t)}return function(){var r=document.createElement("div"),i;return r.innerHTML='<a href="#test">test</a>',i=r.firstChild,i.getAttribute("href")==="#test"?t:n}()}();return i=new e("__$gimme$_unique__"),t=new e("__$gimme$_genSib__"),n=new e("__$gimme$_nth__"),u={id:function(n,t){return n.id===t},tag:function(n,t){return n.tagName===t||t==="*"},classes:function(n,t){var i=n.className,u,r;typeof i!="string"&&(i=f(n,"class"));if(!i)return!1;u=" "+i+" ",r=t.length;while(r--)if(u.indexOf(" "+t[r]+" ")===-1)return!1;return!0},attributes:function(){var t={},n={parse:function(n){var i=n.match(/^\[([\w-_]+)?(\=|\^=|\$=|\*=|\|=|~=|!=)?(.*)\]$/);return t[n]={name:i&&i[1],delim:i&&i[2],val:i&&i[3].replace(/^['"]|["']$/g,"")}},"=":function(n,t){return n===t},"^=":function(n,t){return n.indexOf(t)===0},"$=":function(n,t){var i=n.lastIndexOf(t);return i!==-1&&i+t.length===n.length},"*=":function(n,t){return n.indexOf(t)!==-1},"|=":function(n,t){return n===t||n.indexOf(t+"-")===0},"~=":function(n,t){return n===t||l(n.split(" "),t)},"!=":function(n,t){return n!==t},unknown:function(){return!1}};return function(i,r){var o=r.length,u,e;while(o--){u=t[r[o]]||n.parse(r[o]),e=f(i,u.name);if(!e)return!1;if(!u.delim)continue;if(!n[u.delim||"unknown"](e,u.val))return!1}return!0}}(),pseudos:function(){function i(n){var t=n+"Sibling";return function(n){var i=n[t];while(i&&i.nodeType!==1)i=i[t];return!i}}var r={},t={parse:function(n){var t=n.match(/([\w-_]+)\b(\((((-?\d*)n)?([+-]?\d+)?|.*)\))?/),i={name:t&&t[1],param:{wholeValue:t&&t[3],a:t&&t[5]||0,b:t&&t[6]||0}};return i.param.wholeValue==="even"?(i.param.a=2,i.param.b=0):i.param.wholeValue==="odd"&&(i.param.a=2,i.param.b=1),r[n]=i},"first-child":i("previous"),"last-child":i("next"),"only-child":function(n){return t["first-child"](n)&&t["last-child"](n)},"nth-child":function(t,i){var l=1e4,s=n.t*l,u=n.name,r=t.parentNode,h=0,f;if(r){if(r[u+":parent"]!==n.t){r[u+":parent"]=n.t;var h=0,a,e=r.children||r.childNodes,o=-1,c=e.length;while(++o<c)e[o].nodeType===1&&(h++,e[o][u]=s+h)}return f=t[u]-s-i.param.b,!i.param.a&&i.param.b?f===0:i.param.a*f>=0&&f%(i.param.a||1)==0}return!1},contains:function(n,t){return(n.textContent||n.innerText||n.innerHTML).indexOf(t.param.wholeValue)!==-1},not:function(){return!1}};return function(n,i){var f=i.length,u;while(f--){u=r[i[f]]||t.parse(i[f]);if(!t[u.name](n,u))return!1}return!0}}()," ":function(n,t){for(var u=[],f=n.length,r,i=0;i<f;i++){r=w(t,n[i]),u=u.concat(r);if(t.id&&r.length===1)break}return c(u)},">":function(n,t){for(var r=[],u=n.length,i=0;i<u;i++)r=r.concat(o(n[i].childNodes,t));return r},"+":function(n,t){for(var e=[],o=n.length,f,i,u=0;u<o;u++){f=n[u],i=f.nextSibling;while(i&&i.nodeType!==1)i=i.nextSibling;r(t,i)&&e.push(i)}return e},"~":function(n,i){var e,u;t.inc();for(var s=t.name,o=[],h=n.length,f=0;f<h;f++){e=n[f],u=e.nextSibling;while(u&&u[s]!==t.t)u.nodeType===1&&(u[s]=t.t,r(i,u)&&o.push(u)),u=u.nextSibling}return o}},v=new function(){function i(){this.propNames=[]}var r,t,n,u;return i.prototype.propNames=[],i.prototype.storePropertyValue=function(n,t){this[n]=t,this.propNames[n]||(this.propNames.push(n),this.propNames[n]=!0)},i.prototype.storeArrayValue=function(n,t){this[n]||(this[n]=[]),this[n].push(t),this.propNames[n]||(this.propNames.push(n),this.propNames[n]=!0)},u={preprocessInput:function(n){return n.replace(/\s*([ >+~,])\s*/g,"$1")},reset:function(){r=[],t=[],n=new i},finish:function(){return n&&n.propNames.length>0&&t.push(n),t.length>0&&r.push(t),r},"default":function(t){var u="tag",r=t.match(/(\w+|\*)/),i;return r?(i=r[0].toUpperCase(),n.storePropertyValue(u,i),i.length):null},"#":function(t){var u="id",i=t.match(/#([_\-\w]+)/),r;return i?(r=i[1],n.storePropertyValue(u,r),i[0].length):null},".":function(t){var u="classes",i=t.match(/\.([_\-\w\d]+)/),r;if(i)return r=i[1],n.storeArrayValue(u,r),i[0].length},"[":function(t){var u="attributes",r=t.match(/(\[.*"\]|.*?\])/),i;return r?(i=r[0],n.storeArrayValue(u,i),i.length):null},":":function(t){var u="pseudos",r=t.match(/:[\w-_]+\b(\(.*\))?/),i;return r?(i=r[0],n.storeArrayValue(u,i),i.length):null}," ":function(){return t.push(n," "),n=new i,1},">":function(){return n.propNames.length>0&&t.push(n),t.push(">"),n=new i,1},"~":function(){return t.push(n,"~"),n=new i,1},"+":function(){return t.push(n,"+"),n=new i,1},",":function(){return t.push(n),r.push(t),t=[],n=new i,1}}},y=new b(v),s.Internal={unique:c,index_of:h,contains:l,has_class:u.classes,get_attr:f},s}()}(),n.Helper.index_of=n.query.Internal.index_of,n.Helper.contains=n.query.Internal.contains,n.Helper.unique=n.query.Internal.unique,n.Helper.has_class=n.query.Internal.has_class,n.Helper.get_attr=n.query.Internal.get_attr,n.Effects={Animation:function(n){function s(n){var r,o,s;_ease=e(n),r=t.length;while(r--){s={};for(o in u)s[o]=i[o][r]+u[o][r]*_ease;f(t[r],s,n)}}var t=n.elements||[],o=n.duration||1,i=n.from||{},r=n.to||{},u={},f,e;(function(){var f,n,h,e={},o={},s={};for(n in i){e[n]=[],o[n]=[],s[n]=[],f=t.length;while(f--)h=t[f],e[n][f]=typeof i[n]=="function"?i[n](h,n):i[n],o[n][f]=typeof r[n]=="function"?r[n](h,n):r[n],s[n][f]=o[n][f]-e[n][f]}i=e,r=o,u=s})(),f=n.animate,e=n.easing||function(n){return n},this.startTime=n.startTime||0,this.duration=o,this.add_element=function(n){t.push(n)},this.remove_element=function(n){var i=t.length;while(i--)if(t[i]===n){t.splice(i,1);break}},this.tick=s},Storyboard:function(n){function r(){f||(f=!0,e=+new Date,l=setInterval(b,1))}function nt(){t=0,i=1,r()}function w(){s(),a&&a(t)}function s(){clearInterval(l),f=!1}function g(){r()}function d(){i=1,r()}function rt(){i=-1,r()}function it(){i*=-1,r()}function tt(n){t=n,h()}function p(){return f}function y(){return i}function v(){return u}function k(){return o}function b(){var n=+new Date;t+=(n-e)/o*i,e=n,t=t<0?0:t>1?1:t,h(),(i===-1&&t===0||i===1&&t===1)&&(s(),c&&c(t))}function h(){var r=u.length,n;while(r--)n=(o*t-u[r].startTime)/u[r].duration,n=i===-1&&n<0?0:i===1&&n>1?1:n,n<0||n>1||u[r].tick(n)}var l,e,t=0,i=1,f=!1,u=n.animations,o=n.duration||0,c=n.completed,a=n.aborted;this.begin=nt,this.abort=w,this.pause=s,this.resume=g,this.forward=d,this.backward=rt,this.reverse=it,this.seek=tt,this.is_running=p,this.get_direction=y,this.get_animations=v,this.get_duration=k},Easing:{Back:new function(){function i(n,t,i,r){return t=.5,i=0,r=.5,Math.pow(1-n,i)*r*Math.sin(2*Math.PI*n*t)*-1+n}function t(){}function n(){}this.ease_in=i,this.ease_out=t,this.ease_in_out=n},Bounce:new function(){function r(n,t,i){return t=t||1.5,i=i||4,Math.abs(Math.pow(n,t)*Math.cos(Math.PI*n*i))}function i(t,i,r){return 1-n.Effects.Easing.Bounce.ease_in(1-t,i,r)}function t(t,i,r){var e=1,f=0,u=n.Effects.Easing.Bounce.ease_in;return t>.5&&(u=n.Effects.Easing.Bounce.ease_out,t-=.5,f=e/2),u(t,i,r)-f}this.ease_in=r,this.ease_out=i,this.ease_in_out=t},Elastic:new function(){function i(){}function t(n,t,i){return t=t||3.5,i=i||5,1-Math.pow(1-n,t)*Math.cos(2*Math.PI*n*i)}function n(){}this.ease_in=i,this.ease_out=t,this.ease_in_out=n},Exponential:new function(){function t(n,t){return Math.pow(n,t)}function n(n,t){return Math.pow(n,1/t)}function i(i,r){return i<=.5?t(i*2,r)*.5:n((i-.5)*2,r)*.5+.5}this.ease_in=t,this.ease_out=n,this.ease_in_out=i}},Enums:{Directions:{vertically:1,horizontally:2,both:3},Speeds:{quickly:500,slowly:1e3}},RunningAnimations:function(){var t={};return{add:function(n,i){t[n]=i},remove:function(n){delete t[n]},get:function(i){return t[i]||new n.Effects.Storyboard({animations:[]})},contains:function(n){return!!t[n]}}}()},n.Effects.Storyboard.create=function(t,i,r,u,f,e,o,s){f=Math.floor(f)||n.Effects.Enums.Speeds[f]||n.Effects.Enums.Speeds.quickly;var h=new n.Effects.Storyboard({duration:f,completed:function(){o&&o.call(this),n.Effects.RunningAnimations.remove(e),h=null},aborted:function(){n.Effects.RunningAnimations.remove(e),h=null},animations:[new n.Effects.Animation({from:i,to:r,duration:f,animate:u,easing:s,elements:t})]});return e&&n.Effects.RunningAnimations.add(e,h),h},function(){var t=0,i={};n.Effects.Animation.requestAnimationFrame=function(){function r(n,t){return function(){i[t]&&n(+new Date),delete i[t]}}function e(n,f){var e=i[++t]=r(n,t);return u(e,f),t}function f(u){var f=i[++t]=r(u,t);return n.setTimeout(f,o),t}var o=16,n=window,u=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame;return u?e:f}(),n.Effects.Animation.cancelAnimationFrame=function(n){delete i[n]}}(),n.Ajax=new function(){function t(t,i){n(t,i,!0)}function r(t,i){n(t,i,!1)}function i(){if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(n){throw new Error("Error invoking XMLHTTP");}else throw new Error("XMLHttp is not supported");}function n(n,t,r){var u=i();u.onreadystatechange=function(){if(u.readyState===4){var n=u.responseText;r&&n&&(n=eval("("+u.responseText+")")),t.call(u,n,u.status),u=null,callback=null}},u.open("GET",n,!0),u.send("")}this.request_json=t,this.request_ahah=r},n.Screen=new function(){function r(){var n={width:0,height:0};return n=typeof window.innerWidth!="undefined"?{width:window.innerWidth,height:window.innerHeight}:typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.getElementsByTagName("body")[0].clientWidth,height:document.getElementsByTagName("body")[0].clientHeight}}function i(n){var t,i;return n=n||window.event,t={x:0,y:0},typeof n.pageX!="undefined"?(t.x=n.pageX,t.y=n.pageY):(i=this.get_scroll_pos(),t.x=n.clientX+i.x,t.y=n.clientY+i.y),t}function t(){return n(window).get_scroll_pos()}this.get_viewport_size=r,this.get_mouse_pos=i,this.get_scroll_pos=t},n.Util=new function(){function t(){return n(arguments,!1)}function i(){return n(arguments,!0)}function n(n,t){function i(){u.apply(this,Array.prototype.slice.call(n,2)),t||(u=null)}var u=n[0],r=n[1];return t===!0?window.setInterval(i,r):window.setTimeout(i,r)}this.set_timeout=t,this.set_interval=i},n.Style=new function(){function f(i){var f=i.scrollTop&&i!==document.documentElement&&i!==document.body&&i.tagName!=="TEXTAREA"&&i.tagName!=="INPUT"?-1:0,r={x:i.scrollLeft*f,y:i.scrollTop*f},u;return n.Browser.is_ie&&t(i,"position")==="static"?(u=i.style.position,i.style.position="relative",r.x+=i.offsetLeft,r.y+=i.offsetTop,i.style.position=u):(r.x+=i.offsetLeft,r.y+=i.offsetTop),r}function l(i){var r={x:0,y:0},u;if(i.getBoundingClientRect){var e=i.getBoundingClientRect(),c=o(),h=n(window).get_scroll_pos();r.x=e.left-c.x+h.x,r.y=e.top-c.y+h.y}else while(i!==null)u=f(i),r.x+=u.x,r.y+=u.y,i=i.offsetParent,i&&!s()&&(r.x+=parseFloat(t(i,"borderLeftWidth"))||0,r.y+=parseFloat(t(i,"borderTopWidth"))||0);return r}function s(){var n,t;return typeof arguments.callee.constantValue=="undefined"&&(n=document.createElement("div"),n.style.cssText="position:absolute;visibility:hidden;top:0;left:0;border:1px solid #000;",t=document.createElement("div"),n.appendChild(t),document.body.appendChild(n),arguments.callee.constantValue=t.offsetTop===1,document.body.removeChild(n),n=t=null),arguments.callee.constantValue}function o(){var i,r;if(typeof arguments.callee.constantValue=="undefined"){var t=document.body,f=t.style.position,u=t.style.margin,e=t.style.border;t.style.position="static",t.style.margin="0",t.style.border="1px solid transparent",i=t.getBoundingClientRect(),r=n(window).get_scroll_pos(),arguments.callee.constantValue={x:i.left+r.x,y:i.top+r.y},t.style.position=f,t.style.margin=u,t.style.border=e,document.documentElement.className=document.documentElement.className}return arguments.callee.constantValue}function t(n,t){var i="",f,e,u;return n.currentStyle&&(t==="right"||t==="bottom")?i=r(t,"auto","auto",n)+"px":(f=document.defaultView&&document.defaultView.getComputedStyle&&document.defaultView.getComputedStyle(n,null)||n.currentStyle,f&&(i=f[t]||"",e=i.match(/px$/),e||(u=i.match(/(em|ex|%|in|cm|mm|pt|pc|small|medium|large|thin|thick|auto)$/),u&&(i=r(t,i,u[0],n)+"px")))),i}function r(i,r,u,f){var s,a,y,o,l,h,p,w,c,e,v;if(r){if(u==="px")return parseFloat(r);if(r==="auto")switch(i){case"top":case"left":return 0;case"bottom":case"right":s={bottom:["top","offsetTop","height","offsetHeight"],right:["left","offsetLeft","width","offsetWidth"]},a=n(f);if(a.get_style("position")==="relative")return y=s[i][0],-parseInt(a.get_style(y));o=f.parentNode;while(o!==document&&n(o).get_style("position")==="static")o=o.parentNode;return l=s[i][2],h=o===document?n.Screen.get_viewport_size()[l]:parseInt(n(o).get_style(l)),p=s[i][1],w=s[i][3],h-f[p]-f[w];case"height":return f.clientHeight||f.offsetHeight&&f.offsetHeight-parseFloat(t(f,"borderTopWidth"))-parseFloat(t(f,"borderBottomWidth"))||0;case"width":return f.clientWidth||f.offsetWidth&&f.offsetWidth-parseFloat(t(f,"borderLeftWidth"))-parseFloat(t(f,"borderRightWidth"))||0;default:return 0}else{switch(i){case"borderLeftWidth":case"borderRightWidth":case"borderTopWidth":case"borderBottomWidth":return i=i.replace("Width","Style"),c=t(f,i),c==="none"?0:parseFloat(c)}f=f||document.body,e=document.createElement("div"),e.style.visbility="hidden",e.style.position="absolute",e.style.lineHeight="0",u==="%"?(f=f.parentNode,i==="height"||i==="top"?e.style.height=r:(i==="width"||i==="left")&&(e.style.width=r)):(e.style.borderStyle="solid",e.style.borderBottomWidth="0",e.style.borderTopWidth=r);try{f.appendChild(e)}catch(b){f=f.parentNode,f.appendChild(e)}return f.offsetWidth,f.offsetHeight,v=e.offsetHeight||e.offsetWidth,f.removeChild(e),v}}else return 0}function v(n,t){var u,r;return t=t||document.body,u=i[n],u||(r=e(n),t.style[r]===undefined&&(r=a(r,t)||n),u=i[n]=r),u}function a(n,t){var r=e("-"+n),i=u.length;while(i--){n=u[i]+r;if(t.style[n]!==undefined)return n}return""}function e(n){return n.replace(/-(\w)/g,function(n,t){return t.toUpperCase()})}var c,h,i,u;this.get_relative_pos=f,this.get_absolute_pos=l,this.offset_includes_borders=s,this.get_bounding_client_rect_offsets=o,c=function(){function t(n,t){n.style.opacity=t}function i(n,t){t*=100;var i;try{i=n.filters.item("DXImageTransform.Microsoft.Alpha"),t<100?(i.Opacity=t,i.enabled||(i.enabled=!0)):i.enabled=!1}catch(r){t<100&&(n.style.filter=(n.currentStyle||n.runtimeStyle).filter+" progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")")}}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&t||typeof n.style.filter!="undefined"&&i||function(){}}(),this.set_opacity=c,h=function(){function i(n){return parseFloat(n.style.opacity)||t(n,"opacity")}function r(n){var t=n.filters["DXIMageTransform.Microsoft.Alpha"];return t?t.Opacity/100:1}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&i||typeof n.style.filter!="undefined"&&r||function(){}}(),this.get_opacity=h,this.get_rendered_style=t,this.normalize_style=r,i={},u=["O","ms","Moz","Webkit"],this.get_camelized_style_name=v},n.Events=new function(){var r=n.Helper,i=null,t=null;this.capture_mouse=function(r,u){return n.Events.release_mouse(),i=r,u!==!1&&(u=!0),r.setCapture!==undefined?r.setCapture(u):(t=function(r){var o=r.target,f=document.createEvent("MouseEvents"),e,s;f.initMouseEvent(r.type,r.bubbles,r.cancelable,window,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget),f.__defineGetter__&&(e=n.Screen.get_scroll_pos(),f.__defineGetter__("pageX",function(){return this.clientX+e.x}),f.__defineGetter__("pageY",function(){return this.clientY+e.y})),document.removeEventListener(r.type,t,!0),f.captureTarget=o,s=i,u||n(i).has(o)&&(dispatchElement=o),s.dispatchEvent(f),t!==null&&document.addEventListener(r.type,t,!0),delete f.captureTarget,r.stopPropagation()},document.addEventListener("mouseover",t,!0),document.addEventListener("mouseout",t,!0),document.addEventListener("mousemove",t,!0),document.addEventListener("mouseup",t,!0),document.addEventListener("mousedown",t,!0),document.addEventListener("click",t,!0),document.addEventListener("dblclick",t,!0)),this},this.release_mouse=function(){return i!==null&&(i.releaseCapture!==undefined?i.releaseCapture():(document.removeEventListener("mouseover",t,!0),document.removeEventListener("mouseout",t,!0),document.removeEventListener("mousemove",t,!0),document.removeEventListener("mouseup",t,!0),document.removeEventListener("mousedown",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("dblclick",t,!0)),i=t=null),this},this.get_capture_target=function(n){return n.captureTarget||n.srcElement||n.target},this.Pseudo=new function(){function t(n,t,i){this.pseudoName=n,this.getNativeName=t,this.getProxiedHandler=i}function h(n,t,i){if(n===t)return!1;var r=0;while(t&&t!=n)r++,t=t.parentNode;return i=i||r,t===n&&i===r}function o(n){var u=r.get_guid(n),t=i[u];return t||(t=i[u]=function(t){var i=t.relatedTarget;if(!i||this===i||h(this,i))return;n.call(this,t)}),t}function c(t){if(!n.Browser.is_gecko)return t;var f=r.get_guid(t),u=i[f];return u||(u=i[f]=function(n){n.wheelDelta=-40*n.detail,t.call(this,n),n.wheelDelta=null}),u}function f(t){if(!n.Browser.is_ie)return t;var e=r.get_guid(t),f=i[e];return f||(f=i[e]=function(i){var o,e,h,s,f;if(i.pointerType===2){i.type==="MSPointerUp"||i.type==="MSPointerCancel"?delete u[i.pointerId]:(i.preventManipulation&&i.preventManipulation(),o=n.Screen.get_mouse_pos(i),u[i.pointerId]={_$targetId:r.get_guid(i.target),identifier:i.pointerId,pageX:o.x,pageY:o.y}),h=[],s=[];for(e in u)u.hasOwnProperty(e)&&u[e]&&(f=u[e],h.push(f),f._$targetId===r.get_guid(i.target)&&s.push(f));i.touches=h,i.targetTouches=s,t.call(this,i),i.touches=i.targetTouches=null}}),f}function s(){}var i={},u={},e={touchstart:"MSPointerDown",touchend:"MSPointerUp",touchmove:"MSPointerMove",touchcancel:"MSPointerCancel"};return t.prototype.add=function(n,t,i){n.add_event(this.getNativeName(this.pseudoName),this.getProxiedHandler(t,n),i,!0)},t.prototype.remove=function(n,t,i){n.remove_event(this.getNativeName(this.pseudoName),this.getProxiedHandler(t,n),i,!0)},{mouseenter:new t("mouseenter",function(){return"mouseover"},function(n){return o(n)}),mouseleave:new t("mouseleave",function(){return"mouseout"},function(n){return o(n)}),mousewheel:new t("mousewheel",function(t){return n.Browser.is_gecko?"DOMMouseScroll":t},function(n){return c(n)}),touchstart:new t("touchstart",function(t){return n.Browser.is_ie?e[t]:t},function(t){return n(document).add_event("touchend",s,!0).add_event("touchcancel",s,!0),f(t)}),touchend:new t("touchend",function(t){return n.Browser.is_ie?e[t]:t},function(n){return f(n)}),touchmove:new t("touchmove",function(t){return n.Browser.is_ie?e[t]:t},function(n){return f(n)}),touchcancel:new t("touchcancel",function(t){return n.Browser.is_ie?e[t]:t},function(n){return f(n)})}}},function(){var f=n.Helper,e=n.Internals,r,t,o={},u={},i={load:!1,unload:!1,focus:!1,blur:!1,beforeunload:!1,stop:!1,beforeprint:!1,afterprint:!1,propertychange:!1,filterchange:!1,readystatechange:!1,losecapture:!1};n.ext.add_event=function(){function h(t,i,r,u){return!u&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[t]?n.Events.Pseudo[t].add(this,i,r):this.for_each(function(n){e.addEventListener.call(n,t,i,r)}),this}function s(s,h,c,l){function y(i,r){t=t||1,r.eventPhase=t,r.target=r.srcElement,r.currentTarget=i;var u=n.Screen.get_mouse_pos(r);r.pageX=u.x,r.pageY=u.y;switch(r.type){case"keyup":case"keydown":case"keypress":i.type!=="file"&&(r.keyCode===186?r.keyCode=59:r.keyCode===187?r.keyCode=61:r.keyCode===189?r.keyCode=109:null),r.which=r.keyCode,r.charCode=r.keyCode;break;case"mousedown":case"mouseup":case"click":case"dblclick":case"contextmenu":r.which=[1,1,3,r.button,2][r.button];break;case"mouseover":r.relatedTarget=r.fromElement;break;case"mouseout":r.relatedTarget=r.toElement}return r.preventDefault=function(){r.returnValue=!1},r.stopPropagation=function(){r.cancelBubble=!0},r}function p(n,t,r){var u=i[n],f;return u===!1?!1:(u||(u=i[n]={}),f=u[t],f||(f=u[t]=[]),f.push(r),!0)}function a(n,t){var r=u[n],i;r||(r=u[n]={}),i=r[t],i||(i=r[t]={handlerCount:0,remainingHandlers:0}),i.handlerCount++,i.remainingHandlers=i.handlerCount}function v(n,u){var a=[],l=n,h,e,o,v,c;while(l)a.push(l),l=l.parentNode;while(h=a.pop()){e=f.get_guid(h);if(i[s][e])for(r||(r=h),v=i[s][e].length,o=0;o<v;o++)u.cancelBubble||(h===u.target&&(u.eventPhase=t=2),c=i[s],c[e]&&c[e][o]&&c[e][o].call(h,u))}return r}return!l&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[s]?n.Events.Pseudo[s].add(this,h,c):this.for_each(function(n){var w=f.get_guid(n),k=f.get_guid(h)+(c||!1).toString(),b="{"+w+" / "+s+" / "+k+"}",l;c&&(c=p(s,w,h)),l=o[b],l||(l=function(f){var e=u[s][w];e.remainingHandlers--,f=y(n,f),i[s]&&t===1&&(r=v(n,f)),t=n===f.target?2:3,f.eventPhase=t,!c&&!f.cancelBubble&&h.call(n,f),(!r||f.cancelBubble||n==r&&e.remainingHandlers===0)&&(t=1,r=undefined,e.remainingHandlers=e.handlerCount),f.eventPhase=f.target=f.currentTarget=f.relatedTarget=f.which=f.preventDefault=f.stopPropagation=f.pageX=f.pageY=undefined},o[b]=l,e.attachEvent.call(n,"on"+s,l),a(s,w)),b=null,l=null}),this}return document.addEventListener?h:document.attachEvent?s:function(){}}(),n.ext.remove_event=function(){function r(t,i,r,u){return!u&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[t]?n.Events.Pseudo[t].remove(this,i,r):this.for_each(function(n){e.removeEventListener.call(n,t,i,r)}),this}function t(t,r,s,h){function l(t,r,u){var o=i[t],f,e;o&&(f=o[r],f&&(e=n(f).index_of(u),e!==-1&&f.splice(e,1),f.length===0&&delete o[r]))}function c(n,t){var i=u[n]&&u[n][t];i&&(i.handlerCount>0&&i.handlerCount--,i.remainingHandlers=i.handlerCount)}return!h&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[t]?n.Events.Pseudo[t].remove(this,r,s):this.for_each(function(n){var h=f.get_guid(n),a=f.get_guid(r)+(s||!1).toString(),u="{"+h+" / "+t+" / "+a+"}",i;s&&l(t,h,r),i=o[u],i&&(e.detachEvent.call(n,"on"+t,i),delete o[u],c(t,h)),u=null,i=null}),this}return document.addEventListener?r:document.attachEvent?t:function(){}}()}(),function(){var t=n.Helper;n.ext.add_class=function(i){var r=i.split(/\s+/);return this.for_each(function(i){n(r).for_each(function(n){t.has_class(i,[n])||(i.className===""?i.className=n:i.className+=" "+n)})}),this}}(),n.ext.remove_class=function(n){return this.swap_class(n,"$1")},n.ext.swap_class=function(t,i){i!=="$1"&&(i=" "+i+" ");var r=t.split(/\s+/);return this.for_each(function(t){var u=t.className;n(r).for_each(function(n){var t=new RegExp("(^| )"+n+"( |$)");u=u.replace(t,i)}),t.className=u.replace(/^\s+|\s+$/g,"")}),this},function(){var t=n.Helper;n.ext.has_class=function(n,i){var r=this[i||0];return r&&t.has_class(r,[n])||!1}}(),n.ext.get_html=function(n){var t=this[n||0];return t&&t.innerHTML||""},n.ext.set_html=function(n){return this.for_each(function(t){t.innerHTML=n}),this},n.ext.get_val=function(n){var t=this[n||0];return t&&t.value||""},n.ext.set_val=function(n){return this.for_each(function(t){typeof t.value!="undefined"&&(t.value=n)}),this},function(){var t=n.Helper.get_attr;n.ext.get_attr=function(n,i){var r=this[i||0];return r&&t(r,n)||""}}(),n.ext.set_attr=function(n,t){return this.for_each(function(i){i.setAttribute(n,t)}),this},function(){var r=n.Style.get_rendered_style,i=n.Style.get_opacity,t=n.Style.get_camelized_style_name;n.ext.get_style=function(n,u){var f=this[u||0];return f?n==="opacity"?i(f):r(f,t(n)):""}}(),function(){var i=n.Style.set_opacity,t=n.Style.get_camelized_style_name;n.ext.set_style=function(n){return this.for_each(function(r){var e,u,f;for(e in n){u=n[e],f=t(e);switch(f){case"height":case"maxHeight":case"minHeight":case"width":case"maxWidth":case"minWidth":case"top":case"right":case"bottom":case"left":case"marginTop":case"marginRight":case"marginBottom":case"marginLeft":case"paddingTop":case"paddingRight":case"paddingBottom":case"paddingLeft":r.style[f]=typeof u=="number"&&u+"px"||u;break;case"opacity":i(r,u);break;default:r.style[f]=u}}}),this}}(),n.ext.get_native_prop=function(n,t){var i=this[t||0];return i?i[n]:""},n.ext.parent=function(t){var i=this[t||0];return n(i&&i.parentNode)},n.ext.element=function(n){return this[n||0]},n.ext.get_ancestor=function(t,i){var r=this[i||0],u=t;while(u-->0)if(r)r=r.parentNode;else break;return n(r)},n.ext.get_sibling=function(t,i){var f=this[i||0],r=f;if(t!==0){var o=t>0?"nextSibling":"previousSibling",e=Math.abs(t),u=0;while(u<e){r=r[o];if(!r)break;r.nodeType===1&&u++}}return n(r)},n.ext.for_each=function(){function t(n,t){return this.entities().forEach(n,t),this}function n(n,t){for(var r=this.entities(),u=r.length,i=0;i<u;i++)n.call(t,r[i],i,r);return this}return typeof Array.prototype.forEach!="undefined"?t:n}(),n.ext.iterate=function(t){for(var u=this.length,r,i=0;i<u;i++)r=n(this[i]),t.call(r,i);return _callback=null,this},n.ext.filter=function(t){var r=n(),i=this.length;while(i--)t(this[i])&&r.unshift(this[i]);return r},n.ext.map=function(){function i(t,i){return n(this.entities().map(t,i))}function t(t,i){var u=n(),r=this.length;while(r--)u.unshift(t.call(i,this[r]));return u}return typeof Array.prototype.map!="undefined"?i:t}(),function(){var t=n.Helper;n.ext.contains=function(n){return t.contains(this.entities(),n)}}(),function(){var t=n.Helper;n.ext.index_of=function(n){return t.index_of(this.entities(),n)}}(),n.ext.select=function(t){return n(t,this[0])},n.ext.has=function(t,i){var r=this[i||0];return n(t,r).length>0},function(){var t=n.Helper;n.ext.unique=function(){return n(t.unique(this.entities()))}}(),function(){var t=n.Style.get_rendered_style;n.ext.get_style_pos=function(n){var i=this[n||0];return{x:parseFloat(t(i,"left")),y:parseFloat(t(i,"top"))}}}(),function(){var t=n.Style.get_absolute_pos;n.ext.get_absolute_pos=function(n){var i=this[n||0];return i&&t(i)||{x:0,y:0}}}(),function(){var t=n.Style.get_relative_pos;n.ext.get_relative_pos=function(n){var i=this[n||0];return i&&t(i)||{x:0,y:0}}}(),function(){n.ext.get_scroll_pos=function(t){var r=this[t||0],i={x:0,y:0};return r===window?typeof window.pageYOffset!="undefined"?(i.x=window.pageXOffset,i.y=window.pageYOffset):n.Browser.is_in_quirks_mode||typeof document.documentElement.scrollTop=="undefined"?typeof document.body.scrollTop!="undefined"&&(i.x=document.body.scrollLeft,i.y=document.body.scrollTop):(i.x=document.documentElement.scrollLeft,i.y=document.documentElement.scrollTop):(i.x=r.scrollLeft,i.y=r.scrollTop),i}}(),n.ext.animate=function(t,i,r,u,f){function l(n,t,i){switch(n){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;default:return i}}function c(t,i){var u=n(t).get_style(i)+"",r=parseFloat(u);return e.units[i]=u.replace(r,""),r}function a(n,i){var e=c(n,i),r=t[i]+"",u=r.match(/^[+\-*\/]/),f=u&&u[0]||"noOp";return r=Number(r.replace(f,"")),l(f,e,r)}var e={units:{},ops:{}},s={},o,h;for(o in t)e[o]=c,s[o]=a;return h=n.Effects.Storyboard.create(this,e,s,function(t,i){var f=n(t),r,u;for(r in i){if(r==="units")continue;u={},u[r]=i[r]+e.units[r],f.set_style(u)}},i,r,u,f),h.begin(),this},n.ext.bounce=function(t,i,r,u,f){function o(t){return n(t).get_style_pos().y}t===null&&(t=o);var e=n.Effects.Storyboard.create(this,{top:t},{top:i},function(n,t){n.style.top=Math.ceil(t.top)+"px"},r,u,f,n.Effects.Easing.Bounce.ease_out);return e.begin(),this},function(){function t(t,i,r,u,f){this.set_style({zoom:1}),t===null&&(t=function(t,i){return Number(n(t).get_style(i))});var o=n.Effects.Storyboard.create(this,{opacity:t},{opacity:i},function(t,i){n(t).set_style({opacity:i.opacity})},r,u,f,null);return o.begin(),this}n.ext.fade_to=t,n.ext.fade_in=function(n,i,r,u){return t.call(this,0,1,n,i,r,u)},n.ext.fade_out=function(n,i,r,u){return t.call(this,1,0,n,i,r,u)}}(),n.ext.slide=function(t,i,r,u,f,e){function s(t,i){i=i==="left"?"x":"y";var r=t.__pos;return r||(r=t.__pos=n(t).get_style_pos()),i==="y"&&(t.__pos=n.undefined),r[i]}t===null&&(t={x:s,y:s});var o=Math.round,c=n.Effects.Easing.Exponential.ease_in_out,h=n.Effects.Storyboard.create(this,{left:t.x,top:t.y},{left:i.x,top:i.y},function(n,t){n.style.top=o(t.top)+"px",n.style.left=o(t.left)+"px"},r,u,f,e||function(n){return c(n,4)});return h.begin(),this},n.ext.scroll_to=function(t,i,r,u){scrollPos=n.Screen.get_scroll_pos(),elemPos=n(this[0]).get_absolute_pos();var f=Math.round,o=n.Effects.Easing.Exponential.ease_out,e=n.Effects.Storyboard.create([window],{scrollX:scrollPos.x,scrollY:scrollPos.y},{scrollX:elemPos.x,scrollY:elemPos.y},function(n,t){n.scrollTo(f(t.scrollX),f(t.scrollY))},t,i,r,u||function(n){return o(n,4)});return e.begin(),this},n.ext.veil=function(t,i,r,u,f){function l(t,i){var r=parseInt(n(t).get_style(i),10);return t[c]=t[c]||{},t[c][i]=r}var e=n.Effects.Enums.Directions,c,s,o,h;return t=Math.floor(t)||e[t]||e.vertically,c="_$gimme$_veil",s={},o={},(t&e.vertically)===e.vertically&&(o.height=o.paddingTop=o.paddingBottom=l,s.height=s.paddingTop=s.paddingBottom=0),(t&e.horizontally)===e.horizontally&&(o.width=o.paddingLeft=o.paddingRight=l,s.width=s.paddingLeft=s.paddingRight=0),h=n.Effects.Storyboard.create(this.filter(function(t){var i=t.style.display||n(t).get_style("display");return i!=="none"}),o,s,function(n,i){var r=n.style;(t&e.vertically)===e.vertically&&(r.height=i.height+"px",r.paddingTop=i.paddingTop+"px",r.paddingBottom=i.paddingBottom+"px"),(t&e.horizontally)===e.horizontally&&(r.width=i.width+"px",r.paddingRight=i.paddingRight+"px",r.paddingLeft=i.paddingLeft+"px")},i,r,u,f||function(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}),h.get_animations().push(new n.Effects.Animation({startTime:0,elements:this,animate:function(n){n.style.overflow="hidden"}}),new n.Effects.Animation({startTime:h.get_duration(),elements:this,animate:function(n){n.style.display="none"}})),h.begin(),this},n.ext.unveil=function(t,i,r,u,f){function c(t,i){var r=t._$gimme$_veil;return r||(r=r||function(){var i=t.cloneNode(!0),f,u,r;return i.style.cssText="position:absolute;top:0;left:0;visibility:hidden;margin:0;padding:0;border:0;height:;width:;",i.style.display="block",t.parentNode.appendChild(i),i=n(i),f=parseInt(n(t).get_style("height"),10)||parseInt(i.get_style("height"),10),u=parseInt(n(t).get_style("width"),10)||parseInt(i.get_style("width"),10),i[0].style.padding=t.style.padding,r={height:f,width:u,paddingTop:parseInt(i.get_style("paddingTop"),10),paddingBottom:parseInt(i.get_style("paddingBottom"),10),paddingRight:parseInt(i.get_style("paddingRight"),10),paddingLeft:parseInt(i.get_style("paddingLeft"),10)},t.parentNode.removeChild(i[0]),t.style.overflow="hidden",r}()),r[i]}var e=n.Effects.Enums.Directions,s,o,h;return t=Math.floor(t)||e[t]||e.vertically,e=n.Effects.Enums.Directions,t=Math.floor(t)||e[t]||e.vertically,s={},o={},(t&e.vertically)===e.vertically&&(o.height=o.paddingTop=o.paddingBottom=0,s.height=s.paddingTop=s.paddingBottom=c),(t&e.horizontally)===e.horizontally&&(o.width=o.paddingLeft=o.paddingRight=0,s.width=s.paddingLeft=s.paddingRight=c),h=n.Effects.Storyboard.create(this.filter(function(t){var i=t.style.display||n(t).get_style("display");return i==="none"||i===null}),o,s,function(n,i){(t&e.vertically)===e.vertically&&(n.style.height=i.height+"px",n.style.paddingTop=i.paddingTop+"px",n.style.paddingBottom=i.paddingBottom+"px"),(t&e.horizontally)===e.horizontally&&(n.style.width=i.width+"px",n.style.paddingRight=i.paddingRight+"px",n.style.paddingLeft=i.paddingLeft+"px")},i,r,u,f||function(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}),h.get_animations().push(new n.Effects.Animation({startTime:0,elements:this,animate:function(n){n.style.overflow="hidden",n.style.display="block"}}),new n.Effects.Animation({startTime:h.get_duration(),elements:this,animate:function(n){n.style.overflow=""}})),h.begin(),this},n.toString=function(){return"Gimme v2.7.0 (Edmund) :: Thursday, May 10, 2012 3:53:09 PM"},n}(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},function(){window.Microsoft.Maps.Globals={disableVenueMaps:!1,disableDirections:!1,disableSearch:!1,disableAnalytics:!1,zoomOriginWidth:256,minMercatorZoom:1,maxMercatorZoom:20,jsonTimeStamp:new Date(1).valueOf()}}(),window.Microsoft.Maps.initMapCode=function(){function i(n,t){this.x=n,this.y=t}function y(n,t,i,r){this.latitude=parseFloat(n),this.longitude=parseFloat(t),kt.isValid(r)&&(this.altitude=parseFloat(i),this.altitudeReference=r)}function st(n,t,i){this.center=n,this.width=t,this.height=i}function eu(t){function i(){var i=e.getWidth(),t=e.getHeight();(i!==f||t!==o)&&(f=i,o=t,n.invoke(e,"resize",{width:i,height:t}))}var e=this,l=t.onresize!==h,r,f,o,c=b(t),s=b(window);this.getWidth=function(){return t.offsetWidth},this.getHeight=function(){return t.offsetHeight},this.startMonitoring=function(){l?(c.add_event("resize",i),u.useOnResize&&(t.onresize=i)):(r||(r=window.setInterval(i,1e3)),s.add_event("resize",i))},this.stopMonitoring=function(){c.remove_event("resize",i),u.useOnResize&&t.onresize===i&&(t.onresize=null),r&&(window.clearInterval(r),_timeoutId=null),s.remove_event("resize",i)},this.poll=function(){f=null,o=null,i()}}function er(r,f){function fr(){function p(){var n=e.getImageryId();switch(n){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":y.add_class("dark");break;default:y.remove_class("dark")}}var o,l,nt,r,i,h;f=f||{},s=g(),s.className="MicrosoftMap",u.allowFocus&&(v=g("button","position:fixed;width:1px;height:1px;left:0;top:0;padding:0;font-size:0;line-height:0;border:0;background:transparent;",s),u.useXHR&&b(v).set_style({display:"none"})),ft=rr(),ii=rr(),dt.appendChild(s);if(t.versionNotSupported===!0){r=g("div","position:absolute; width:100%; top:50%; text-align:center"),i=g("div","background: #f8f7f5; padding:10px; color: #000;"),i.innerHTML=vr.getString("L_VersionNotSupportedMessage_Text"),r.appendChild(i),e.getRootElement().appendChild(r);return}ot=b(document),bt=b(ft),y=b(s),f.theme&&(ht=f.theme,ht._attachToMap&&ht._attachToMap(e,f)),f.showHotRegions===!0&&(t.onDemandRoadUriFormat&&(t.roadUriFormat=t.onDemandRoadUriFormat),t.onDemandAerialWithLabelsUriFormat&&(t.aerialWithLabelsUriFormat=t.onDemandAerialWithLabelsUriFormat)),n.invoke(er,"mapcreationstart",{map:e,options:f}),nr=f.credentials,c.authenticate(f.credentials),typeof ut!="undefined"&&ut.authenticate(e.getCredentials),d=new eu(s),n.addHandler(d,"resize",cr),fi(f.width,f.height),!t.ddCoreStylesDownloaded&&t.ddCoreStyles&&t.ddCoreStyles!==""&&(ui.downloadStyles(t.ddCoreStyles),t.ddCoreStylesDownloaded=!0),o=dr(f),o.mapTypeId=o.mapTypeId||pt.auto||pt.road,o.animate=!1,e.setView(o),si&&e.focus(),y.add_event("mousedown",e.focus).add_event("touchstart",e.focus),w.dispatch(function(){if(c){var n={showDashboard:f.showDashboard,showMapTypeSelector:f.showMapTypeSelector,showDualMapTypeSelector:f.showDualMapTypeSelector,disableBirdseye:f.disableBirdseye,showBreadcrumb:f.showBreadcrumb,showScalebar:f.showScalebar,scalebarPosition:f.scalebarPosition||"bottomRight",showLogo:f.showLogo,logoPosition:f.logoPosition||"bottomLeft",clickable:f.enableClickableLogo,enableSearch:f.enableSearchLogo,showCopyright:f.showCopyright,copyrightPosition:f.copyrightPosition||"bottomRight",copyrightStacked:f.copyrightStacked||!1};c.showOverlays(n)}}),f.showHotRegions===!0&&(w.dispatch(function(){c&&c.showHotRegions(f.disableLabels)}),f.showVenueMapsExplorer===!0&&w.dispatch(function(){c&&c.showVenueMapsExplorer()})),t.disableAnalytics||f.disableAnalytics||(l=new yu(e),e.addComponent("analyticsProxy",l),!t.frontdoorLogUrl&&t.biciLoggingService&&e.getCredentials(function(n){l.enable({sessionKey:n})})),f.fixedMapPosition===!0&&(tr=!1),nt=n.addHandler(e,"imagerychanged",p),p(),u.useXHR&&t.message&&(r=g("div","position:absolute; width:100%; top:50%; text-Align:center"),i=g("div","background: #f8f7f5; padding:10px; color: #000;"),i.innerHTML=t.message,r.appendChild(i),e.getRootElement().appendChild(r)),t.updateAvailable===!0;if(t&&t.allowOrdnanceSurvey&&t.logOSServiceUriFormat){function a(){ui.getObjectAsyncWithNoJsonso(t.logOSServiceUriFormat.replace(/{credentials}/,credentials),function(){})}if(e.getImageryId()==="OrdnanceSurvey")w.dispatch(a);else{function k(){e.getImageryId()==="OrdnanceSurvey"&&(h&&(n.removeHandler(h),h=null),w.dispatch(a))}h=n.addHandler(e,"imagerychanged",k)}}}function sr(t){var i=p.length;while(i--)p[i][1]=n.addHandler(t,p[i][0],function(){var t=p[i][0];return function(i){n.invoke(e,t,i)}}());b(s).add_event("mouseenter",function(t){n.invoke(e,"mouseover",new li(e,ri.map,e,"mouseover",t.clientX,t.clientX,0,!1,t))}),b(s).add_event("mouseleave",function(t){n.invoke(e,"mouseout",new li(e,ri.map,e,"mouseout",t.clientX,t.clientX,0,!1,t))})}function ir(){var i,t=p.length;while(t--)i=p[t][1],i&&n.removeHandler(i),p[t][1]=null;b(s).remove_event("mouseenter",function(t){n.invoke(e,"mouseover",new li(e,ri.map,e,"mouseover",t.clientX,t.clientX,0,!1,t))}),b(s).remove_event("mouseleave",function(t){n.invoke(e,"mouseout",new li(e,ri.map,e,"mouseout",t.clientX,t.clientX,0,!1,t))})}function rr(){return g("div","z-index:0;position:absolute;left:50%;top:50%;"+u.safariRenderHack,s)}function fi(n,t){n>0&&t>0?(d.stopMonitoring(),ni=!1,s.style.cssText=ur.replace("{width}",n).replace("{height}",t),oi(n,t)):(s.style.cssText=or,ni=!0,d.startMonitoring(),d.poll())}function oi(t,i){t=Math.round(Math.max(1,t)),i=Math.round(Math.max(1,i)),(t!==gt||i!==kt)&&(gt=t,kt=i,n.invoke(e,"resize"))}function cr(n){ni&&oi(n.width,n.height)}function k(){var t,n;ti&&(t=y.get_absolute_pos(),st=t.x,vt=t.y,n=bt.get_absolute_pos(),tt=n.x,nt=n.y,ti=!1,tr&&w.dispatch(hi))}function hi(){ti=!0}function vi(n){for(var t in a)if(a.hasOwnProperty(t)&&a[t].getMode()===n)return a[t];return null}function hr(t){if(o!=t){var i=o,f=vi(i),u=vi(t),r="MapTypeId_";t.activating&&t.activating(e,{credentials:nr}),i&&i.deactivating&&i.deactivating(),ir(),o=t,it=null,f&&y.remove_class(r+f.getMapTypeId()),i&&i.deactivated&&i.deactivated(),u&&y.add_class(r+u.getMapTypeId()),sr(t),t.activated&&t.activated(),n.invoke(e,"modechanged"),n.invoke(e,"imagerychanged"),n.invoke(e,"copyrightchanged")}}function yt(n){var i,t;if(pi!==e)return!1;i=n.target;if(i){t=i.tagName;if(t==="INPUT"&&i.type==="text"||t==="TEXTAREA"||t==="SELECT")return!1}return!0}function wt(t,i){if(n.hasHandler(e,t)){var r=new hu(t,i.keyCode,i.altKey,i.ctrlKey,i.shiftKey);r.originalEvent=i,n.invoke(e,t,r)}}function ai(n){yt(n)&&wt("keydown",n)}function ci(n){yt(n)&&wt("keyup",n)}function yi(n){yt(n)&&wt("keypress",n)}var p;PRF.start("mapobj");var e=this,c=new fu(this),dt=r,s,ni=!0,si=window.top==window.self,gt,kt,st,vt,tt,nt,d,ct="z-index:0;overflow:hidden;background-color:";ct+=f&&f.backgroundColor?lt.clone(f.backgroundColor).toHex()+";":"#F4F2EE;";var or=ct+(b.Browser.is_in_quirks_mode?"position:absolute;top:0;left:0;width:100%;height:100%":"position:absolute;left:0;top:0;right:0;bottom:0"),ur=ct+"position:relative;width:{width}px;height:{height}px",tr=!0,ti=!0,ft,ii,et={min:t.minMercatorZoom,max:t.maxMercatorZoom},it=null,v,ot,bt,y,o=null,nr,a=[],at=null,ht=null,l={width:null,height:null,disableUserInput:!1,disableKeyboardInput:!1,disableMouseInput:!1,disableTouchInput:!1,disableZooming:!1,disablePanning:!1,labelOverlay:rt.visible,useInertia:!0,inertiaIntensity:-1,tileBuffer:0,showBackground:null},wi=new ki,di={};this.addComponent=function(t,i){di[t]=i,n.invoke(e,"componentadded",{componentName:t,component:i})},this.getComponent=function(n){return di[n]},this.getCredentials=function(n){c?c.getCredentials(n):typeof n=="function"&&n(null)},this.getWidth=function(){return gt},this.getHeight=function(){return kt},this.getPageX=function(){return k(),st},this.getPageY=function(){return k(),vt},this.getViewportX=function(){return k(),tt},this.getViewportY=function(){return k(),nt},this.getTheme=function(){return ht},this.focus=function(){l.disableUserInput||l.disableKeyboardInput||(v&&(v.offsetWidth>0||v.offsetHeight>0)&&si?v.focus():window.focus(),pi!==e&&(pi&&pi.blur(),v&&ot.add_event("keydown",ai).add_event("keypress",yi).add_event("keyup",ci),pi=e,n.invoke(e,"focus")))},this.blur=function(){if(v){try{v.blur()}catch(t){}ot.remove_event("keydown",ai).remove_event("keypress",yi).remove_event("keyup",ci)}pi===e&&(n.invoke(e,"blur"),pi=null)},this.getRootElement=function(){return s},this.getModeLayer=function(){return ft},this.getUserLayer=function(){return ii},this.updateMapPosition=hi,this.dispose=function(){if(e){n.invoke(e,"ondispose",null),c.dispose(),e.blur(),e.entities.clear(),o&&o.deactivating&&o.deactivating(),ir(),o&&o.deactivated&&o.deactivated(),o=null,a.length=0,d.stopMonitoring(),d=null,y.remove_event("mousedown",e.focus).remove_event("touchstart",e.focus),dt.removeChild(s),s=null,dt=null,ft=null,ii=null,ot=null,bt=null,y=null,c=null;var t=bi.length;while(t--)bi[t]===e&&bi.splice(t,1);e=null}},this.setView=function(t){var i,u,r;e.setOptions(t),t.mapTypeId&&(i=a[t.mapTypeId],i!==at&&(this.entities=wi,u=o,r=null,u&&(r=u.getCenter()),i.activating(),at=i,hr(i.getMode()),i.activated(),n.invoke(e,"maptypechanged"),t.center||t.bounds||!r||u===o||(t.center=r,t.animate==null&&(t.animate=!1)))),o.setView(t)},this.setOptions=function(t){var i,r=!1;for(i in t)l[i]!==h&&t[i]!==h&&l[i]!==t[i]&&(l[i]=t[i],r=!0);r&&(l.width!==h&&l.height!==h&&fi(l.width,l.height),n.invoke(e,"optionschanged"))},this.getOptions=function(){return dr(l)},this.getCenter=function(){return o.getCenter()},this.getZoom=function(){return o.getZoom()},this.getZoomRange=function(){return it||(it={min:Math.max(t.minMercatorZoom,o.getInternalMinZoom(),et.min),max:Math.min(t.maxMercatorZoom,o.getInternalMaxZoom(),et.max)}),it},this.restrictZoom=function(n,i){if(n>i)throw"min zoom cannot be greater than max zoom";et.min=n||t.minMercatorZoom,et.max=i||t.maxMercatorZoom,it=null},this.getHeading=function(){return o.getHeading()},this.getBounds=function(){return o&&o.getBounds()},this.getMetersPerPixel=function(){return o.getMetersPerPixel()},this.getTargetCenter=function(){return o.getTargetCenter()},this.getTargetZoom=function(){return o.getTargetZoom()},this.getTargetHeading=function(){return o.getTargetHeading()},this.getTargetBounds=function(){return o.getTargetBounds()},this.getTargetMetersPerPixel=function(){return o.getTargetMetersPerPixel()},this.tryLocationToPixel=function(n,t,i){var r,f,u,e,s;if(!o.tryLocationToViewport)return null;r=o.tryLocationToViewport(n,i);if(r&&t){f=0,u=0;switch(t){case ei.page:k(),f=tt,u=nt;break;case ei.control:k(),f=tt-st,u=nt-vt}if(f||u)if(gi(r)){s=r.length;while(s--)e=r[s],e&&(e.x+=f,e.y+=u)}else r.x+=f,r.y+=u}return r},this.tryPixelToLocation=function(n,t,r){var s,f,u,e;if(!o.tryViewportToLocation)return null;s=n;if(t){f=0,u=0;switch(t){case ei.page:k(),f=tt,u=nt;break;case ei.control:k(),f=tt-st,u=nt-vt}if(f||u)if(gi(n)){e=n.length,s=new Array(e);while(e--)s[e]=new i(n[e].x-f,n[e].y-u)}else s=new i(n.x-f,n.y-u)}return o.tryViewportToLocation(s,r)},this.isDownloadingTiles=function(){return o&&o.isDownloadingTiles?o.isDownloadingTiles():!1},this.getTileDownloadMetrics=function(){return o&&o.getTileDownloadMetrics?o.getTileDownloadMetrics():0},this.getImageryId=function(){return o&&o.getImageryId?o.getImageryId():""},this.isMercator=function(){return o.isMercator?o.isMercator():!1},this.isRotationEnabled=function(){return o.isRotationEnabled()},this.getCopyrights=function(n){return o&&o.getCopyrights&&o.getCopyrights(n),[]},this.getMode=function(){return o.getPublicApi?o.getPublicApi():{}},this.setMapType=function(n){this.setView({mapTypeId:n})},this.getMapTypeId=function(){return at?at.getMapTypeId():""},this.registerMapType=function(n){var t=n.getMapTypeId();if(a[t])throw"InvalidOperation: already registered";a.push(n),a[t]=n},this.entities=wi,p=[["viewchangestart",null],["viewchange",null],["viewchangeend",null],["targetviewchanged",null],["imagerychanged",null],["copyrightchanged",null],["tiledownloadcomplete",null],["click",null],["dblclick",null],["rightclick",null],["mousedown",null],["mouseup",null],["mousemove",null],["mousewheel",null]],fr(),bi.push(e),PRF.end("MapObject instantiated","mapobj")}function vi(n,t){var r=n,i=t;this.getMapTypeId=function(){return r},this.getMode=function(){return i},this.activating=function(){},this.activated=function(){}}function li(n,t,i,r,u,f,e,o,s){var h=n;this.pageX=u,this.pageY=f,this.eventName=r,this.targetType=t,this.target=i,this.wheelDelta=e,this.isTouchEvent=o,this.originalEvent=s,this.isPrimary=s.which===1,this.isSecondary=s.which===3,this.getX=function(){return this.pageX-h.getViewportX()},this.getY=function(){return this.pageY-h.getViewportY()}}function hu(n,t,i,r,u){this.eventName=n,this.keyCode=t,this.altKey=i,this.ctrlKey=r,this.shiftKey=u,this.originalEvent={}}function lt(n,t,i,r){this.a=n,this.r=t,this.g=i,this.b=r}function ki(t){function s(t){t.collection||(t.collection=r),n.invoke(r,"entitychanged",t)}function h(t){n.invoke(r,"entityadded",t)}function c(t){n.invoke(r,"entityremoved",t)}function e(t,i){var e=u.length;if(!t[f]){t[f]=[];while(e--)t[f].push(n.addHandler(t,u[e][0],u[e][1]))}n.invoke(r,"entityadded",{collection:r,entity:t,index:i})}function o(t){if(t){var i=u.length;while(i--)n.removeHandler(t[f][i]);delete t[f],n.invoke(r,"entityremoved",{collection:r,entity:t})}}var r=this,f="_ech"+yi.getNext(),u=[["entityadded",h],["entityremoved",c],["entitychanged",s]],i;this._eventsHandlers=u,i=[],this.get=function(n){return i[n]},this.getLength=function(){return i.length},this.push=function(n){i.push(n),e(n,i.length)},this.insert=function(n,t){i.splice(t,0,n),e(n,t)},this.pop=function(){var n=i.pop();return o(n),n},this.removeAt=function(n){var t=i[n];return i.splice(n,1),o(t),t},this.remove=function(n){var r=null,t=i.length;while(t--)if(i[t]===n){r=this.removeAt(t);break}return r},this.clear=function(){while(i.length>0)this.pop()},this.indexOf=function(n){var t=i.length;while(t--)if(i[t]===n)break;return t},this.setOptions(t)}function su(n,t){this._location=n,this.setOptions(t,!1)}function d(n,t){d.baseConstructor.call(this,n,t),this.setOptions(t)}function ir(n,i){this._location=n,i&&typeof i.useTransform3d=="boolean"&&(this._useTransform3d=i.useTransform3d),this._icon=t.pushpinImageUrl,this.setOptions(i)}function nr(n,t){this._locations=n,this.setOptions(t)}function tr(n,t){this._locations=n,this.setOptions(t)}function hr(t){var c=this,s=!0,o=0,f=1,h={},u=lr.auto,r=!0,e,i;this.setOptions=function(t){if(t){var i=!1;typeof t.visible=="boolean"&&(s=t.visible,i=!0),typeof t.reproject=="boolean"&&(r=t.reproject,i=!0),ai(t.zIndex)&&(o=t.zIndex,i=!0),ai(t.opacity)&&(f=t.opacity,i=!0),t.animationDisplay&&(u=t.animationDisplay,i=!0),i&&n.invoke(c,"entitychanged",{entity:c})}},e=typeof ft!="undefined"?ft:{mercator:{}};for(i in e)t[i]instanceof yr&&(h[i]=t[i]);this.getVisible=function(){return s},this.getZIndex=function(){return o},this.getOpacity=function(){return f},this.getAnimation=function(){return u},this.getReproject=function(){return r},this.getTileSource=function(n){return h[n]},this.setOptions(t)}function yr(n){var f=t.defaultTileSize,u=t.defaultTileSize,i,r;isFinite(n.width)&&(f=n.width),isFinite(n.height)&&(u=n.height),typeof n.uriConstructor=="string"?(i=n.uriConstructor,r=n.uriConstructor):(typeof n.uriConstructor=="function"&&(i=n.uriConstructor),typeof n.uriFormat=="string"&&(r=n.uriFormat)),this.getWidth=function(){return f},this.getHeight=function(){return u},this.getUriConstructor=function(){return i},this.getUriFormat=function(){return r}}function fu(n){this._map=n,this.dispose=function(){this._map=null}}function yu(t){function c(){f=n.addHandler(r,"ondispose",e),tt.load(h,{callback:function(){s.Analytics&&s.Analytics.AnalyticsManager&&r&&(o=!0,u=new s.Analytics.AnalyticsManager(r))}})}function i(n,t){u?u[n].apply(u,t):!o&&r&&tt.add(h,l,n,t)}function e(){i("dispose",arguments),u=r=null,n.removeHandler(f),f=null}var l=this,h="Microsoft.Maps.Analytics",r=t,f=null,u=null,o=!1;this.logClientAction=function(){i("logClientAction",arguments)},this.addPreProcessor=function(){i("addPreProcessor",arguments)},this.removePreProcessor=function(){i("removePreProcessor",arguments)},this.registerAction=function(){i("registerAction",arguments)},this.registerChildActions=function(){i("registerChildActions",arguments)},this.enable=function(){i("enable",arguments)},this.dispose=e,c()}function r(n,t,i){this.x=n,this.y=t,this.z=i}function ct(n,t){this.width=n,this.height=t}function at(n,t,i,r){this.x=n,this.y=t,this.width=i,this.height=r}function vt(n,t,i,r,u,f){this.m11=n,this.m12=t,this.m21=i,this.m22=r,this.offsetX=u,this.offsetY=f}function e(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){this.m11=n,this.m12=t,this.m13=i,this.m14=r,this.m21=u,this.m22=f,this.m23=e,this.m24=o,this.m31=s,this.m32=h,this.m33=c,this.m34=l,this.offsetX=a,this.offsetY=v,this.offsetZ=y,this.m44=p}function fi(n,t,i,r){this.a=n,this.b=t,this.c=i,this.d=r}function gt(n,t){this.x=n,this.y=t}function it(n,t,i){this.levelOfDetail=n,this.x=t,this.y=i}function f(n,u,o,s,c,a,v,y,p,w){function k(){var c,o,w,v;if(!gt){ut=s===0&&et===-90&&a===0,ft=ut||st<=bt,lt=ft&&ut?f.simpleGround:fi.fromNormal(nt,rt.getUpVector(nt));var n=f.simpleWorldToFrustumNoZ,u=1/g,i=g*1e3;tt=rt.getNadirMatrix(nt),ut||(tt=e.multiply(tt,e.rotationZ(-vt),e.rotationX(-(et+90)),e.rotationZ(-ct)));if(ft)ut?(n.m22=n.m11=u,n.m33=u*-.001,n.offsetX=tt.offsetX*u,n.offsetY=tt.offsetY*u):n=e.multiply(tt,e.scaling(u,u,1/i));else{var y=Math.pow(2,kt)*g,h=1/st,p=h/y;i=Math.min(h*.99,i),c=h-i,o=h+i,n=e.multiply(tt,e.translation(wt),e.translation(0,0,h),new e(p,0,0,0,0,p,0,0,0,0,o/(o-c),1,0,0,c*o/(c-o),0),e.scaling(y/g,y/g,1)),w=n.transform(nt),n.multiplyBy(e.translation(r.multiply(w,-1)))}ut?ot=n.clone():(ht=n.invert().projectOnPlane(lt),ot=ht.invert()),ut?(d=ot.clone(),d.m11*=b,d.m22*=b,d.m33*=b,d.offsetX*=b,d.offsetY*=b,v=g/b,it=tt.clone(),it.m11*=v,it.m22*=v,it.m33*=i/b,it.offsetX*=-1,it.offsetY*=-1):(d=e.multiply(ot,e.scaling(b)),it=d.invert()),dt=rt.toLocation(nt),pt=f.widthToMercatorZoom(g,rt,nt),at=rt.unitsToMeters(nt,g)/t.zoomOriginWidth,yt=!ft||Math.abs(et+90)>bt||rt!==l,gt=!0}}var ni=this;var rt=n,nt=u,g=o,vt=s||0,et=c===h?-90:c,ct=a||0,st=v||0,kt=y||0,wt=p||new r(0,0,0),ut,ft,lt,tt,ot,ht,d,it,dt,pt,at,yt,b=w||t.zoomOriginWidth,gt=!1;this.getCrs=function(){return rt},this.getLookAt=function(){return nt},this.getWidth=function(){return g},this.getHeading=function(){return vt},this.getPitch=function(){return et},this.getRoll=function(){return ct},this.getDistanceInverse=function(){return st},this.getZoomDelta=function(){return kt},this.getPerspectiveOrigin=function(){return wt},this.getZoomOriginWidth=function(){return b},this.getGroundPlane=function(){return k(),this.getGroundPlane=function(){return lt},lt},this.getWorldToViewport=function(){return k(),this.getWorldToViewport=function(){return d},d},this.getViewportToWorld=function(){return k(),this.getViewportToWorld=function(){return it},it},this.getWorldToFrustum=function(){return k(),this.getWorldToFrustum=function(){return ot},ot},this.getFrustumToWorld=function(){return k(),this.getFrustumToWorld=function(){return ht},ht},this.getCenter=function(){return k(),this.getCenter=function(){return dt},dt},this.getMercatorZoom=function(){return k(),this.getMercatorZoom=function(){return pt},pt},this.getMetersPerPixel=function(){return k(),this.getMetersPerPixel=function(){return at},at},this.getNeedsElevation=function(){return k(),this.getNeedsElevation=function(){return yt},yt},this.getAlignedCamera=function(n,t,r,u){var s,h;k();var v=g/Math.pow(2,n),o,l=null,c=0,a=null;return t?(o=t,ft||(a=e.multiply(tt,e.translation(wt)),l=a.transform(o),c=n+kt)):o=nt,s=vt,u&&(s=s+u),c=0,h=new f(rt,o,v,s,et,ct,st,c,l,b),r&&(o=h.getViewportToWorld().transform(new i(-r.x,-r.y)),ft||(l=a.transform(o)),h=new f(rt,o,v,s,et,ct,st,c,l,b)),h}}function ci(n){var u=this,e=n,f=2,i=v+"count",t=[{}],r;t[0][i]=0,this.get=function(n,i){var r,e=t.length,f=!0;while(e--){r=t[e][n];if(r!==h)return i&&!f&&u.insert(n,r),r;f=!1}},this.insert=function(n,o){var v,s,l,c,a;v=!1,s=t[t.length-1];if(s[n]===h)if(s[i]<e)s[i]++;else{s={},s[i]=0,t.push(s);if(t.length>f){l=t.shift();if(r)for(c in l)c!==i&&l.hasOwnProperty(c)&&(a=l[c],a!==u.get(c)&&r(a))}}else v=!0;return s[n]=o,v},this.useDisposer=function(n){r=n}}function wt(n,t,i,r,u){this.nativeCamera=n,this.maxLocalZoom=i,this.minLocalZoom=0,this.tilePyramid=t,this.imageryId=r,this.copyrightProvider=u,this.needsElevation=n.getNeedsElevation()||t&&t.projectingCamera&&t.projectingCamera.getNeedsElevation()}function yt(){function ou(){var n=k.getOptions();return!(n.disablePanning||n.disableMouseInput||n.disableUserInput)}function su(){n.invoke(s,"copyrightchanged")}function vi(n,i){var c;if(i&&f.areEqual(e,n))return;ui&&(n=ut.adjustCameraElevation(n)),e=n,ft=n,c=!1,bi<1/t.maxFPS&&(i=!1);if(i){ft=f.snapSmallDifferences(ut.adjustCameraElevation(a),e),f.areEqual(ft,e)&&(i=!1);if(i){var r=new ct(o.width*1.2,o.height*1.2),h=at.union(nt.getMercatorFootprint(ft,r)),u=at.union(nt.getMercatorFootprint(e,r));at.intersect(h,u)||(i=!1)}}i?(et=new Date(new Date-(s.usingCssAnimation()?0:au)),it(),i!=!0&&(gt=i)):(et=new Date(0),d=null,ci())}function fi(t,i,u,o,h,c,l){var v,d,b,et=k.getZoomRange(),tt=i,w=f.widthToMercatorZoom(o,t,i),ot,a,nt,st,g,y,ft,rt;w=Math.max(w,et.min),w=Math.min(w,et.max),ot=2,ui=!1;while(ot--){d=t.toLocation(tt),a=null,nt=ht.length;while(nt--){a=ht[nt].getScene(p,d.latitude,d.longitude,w,h,ir),a&&a.needsElevation&&(st=ut.isElevationAvailableAtLatLon(d.latitude,d.longitude,w),ui=!0,st||(a=null));if(a)break}a=a||nu,a=oi?p:a;if(b&&v===a)break;v=a,g=v.nativeCamera,y=w-f.widthToMercatorZoom(g.getWidth(),g.getCrs(),g.getLookAt()),gr&&(y=l?Math.floor(y):Math.round(y)),y=Math.min(y,v.maxLocalZoom),y=Math.max(y,v.minLocalZoom),b=v.nativeCamera.getAlignedCamera(y,i,u);if(r.areAlmostEqual(tt,b.getLookAt()))break;tt=b.getLookAt()}di(ui);if(c&&f.areEqual(e,b)&&v===p)return;ft=v.imageryId!==p.imageryId,rt=v!==p,p=v,vi(b,c),it(),rt&&(n.invoke(s,"scenechanged"),su()),ft&&n.invoke(s,"imagerychanged")}function lt(){var n=ut.adjustCameraElevation(e);fi(n.getCrs(),n.getLookAt(),null,n.getWidth(),ni!=null?ni:n.getHeading(),!0)}function ci(){var nt,h,t,k;w.cancelDispatch(ci);if(!or||hi)return;hi=!0;var c=!1,b=!0,y=!0,i,l;ot.processPendingUserInput(),ct.areEqual(iu,o)||(i=!0,l=!0),iu=o,fr&&(i=!0,l=!0,y=!1,fr=!1),et&&(nt=a,h=lr(),e.getMercatorZoom()>ft.getMercatorZoom()?h<yu&&(b=!1):h<lu&&(b=!1),h>1?(t=e.getLookAt(),vt&&(t=e.getCrs().wrap(t)),t.y<0?t.y=0:t.y>1&&(t.y=1),r.areAlmostEqual(e.getLookAt(),t)||(y=!1,e=e.getAlignedCamera(0,t)),a=e,ft=e,et=null):(a=pr(h),c=!0),f.areAligned(nt,e)||(y=!1),i=!0),v.allowTileGridSwitch=b;var tt=!ur&&i,u=ur&&!i,g=new Date;u&&g-eu<=fu&&(u=!1,c=!0),ur=i||c,i&&(eu=g,c=!0),f.areEqual(dr,e)||(l=!0),(l||u)&&((u||!v.canCssAnimate())&&(d=null),!s.usingCssAnimation()&&si&&(li(),si=!1),v.enableOrDisableCssAnimation(d,u),yt.enableOrDisableCssAnimation(d)),dr=e,v.render(o,a,p.tilePyramid,e),k=tt?0:u?2:1,yt.update(o,a,e,y,k),l&&n.invoke(s,"targetviewchanged"),tt&&n.invoke(s,"viewchangestart"),i&&n.invoke(s,"viewchange",{linear:y}),u&&(n.invoke(s,"viewchangeend"),su()),hi=!1,c&&it()}function lr(){var n=0,t;return s.usingCssAnimation()?n=d.getStartTime()<et?0:d.getElapsedTimeAsPercentage():(t=new Date,n=gt>0?Math.min(1,(t-et)/gt):(t-et)/1e3/bi),n}function pr(n){var i=a,t=0;return s.usingCssAnimation()?t=d.getProgress(n):gt>0?(n<1||(gt=0),t=1-Math.pow(1-n,4)):t=n<=.5?Math.pow(n*2,2)*.5:Math.pow((1-n)*2,2)*-.5+1,t<0||t>1||(i=f.lerp(ft,e,t)),i}function br(){if(k){var t=k.getWidth(),n=k.getHeight();(o.width!==t||o.height!==n)&&(o=new ct(k.getWidth(),k.getHeight()),it())}}function it(){w.dispatch(ci)}function ar(n){n&&v.suspendGettingNewTiles(),oi=!0}function li(){v.allowGettingNewTiles(),oi&&(oi=!1,lt(),it())}function sr(n){var u=n.getViewportToWorld(),r=n.getCrs(),t=hr(r.toLocation(u.transform(new i(-o.width/2,-o.height/2))),r.toLocation(u.transform(new i(o.width/2,-o.height/2))),r.toLocation(u.transform(new i(o.width/2,o.height/2))),r.toLocation(u.transform(new i(-o.width/2,o.height/2))));return t.center=new y(t.center.latitude,t.center.longitude),t}function hr(){var o=arguments,r,u,t,i,s,e,n,f=o.length;while(f--)n=o[f],isFinite(n.latitude)&&isFinite(n.longitude)&&(r=r===h?n.latitude:Math.max(r,n.latitude),u=u===h?n.latitude:Math.min(u,n.latitude),i=i===h?n.longitude:Math.max(i,n.longitude),t=t===h?n.longitude:Math.min(t,n.longitude),isFinite(n.altitude)&&kt.isValid(n.altitudeReference)&&(e=n.altitude,s=n.altitudeReference));return st.fromEdges(r,t,u,i,e,s)}function vu(n){return f.areEqual(n.nativeCamera,wt.nativeMercatorCamera)}function vr(){var t,n;tt=k.getOptions(),ot.enableOrDisableUserInput(!0,tt),t=.9,tt.inertiaIntensity!==h&&tt.inertiaIntensity!==-1&&(t=tt.inertiaIntensity),ot.enableOrDisableInertialScrolling(tt.useInertia,t),n=tt.labelOverlay,n!==ir&&rt.isValid(n)&&(ir=n,lt()),tt.showBackground!==h&&v.showBackground(tt.showBackground),v.setBufferSize(tt.tileBuffer)}function di(t){t?pt||(pt=n.addThrottledHandler(s,"targetviewchanged",yr,500),w.dispatch(yr)):(cr(),n.removeHandler(pt),pt=null)}function yr(){pt&&(cr(),ei=ut.downloadElevationData(e,o),ei&&(wi=n.addHandler(ei,"downloaded",hu)))}function cr(){n.removeHandler(wi),wi=null,ut.cancelDownload(ei)}function hu(n){fr=!n.cacheHit,lt(),it()}var s=this,or=!1,cu="cm"+yi.getNext(),k=null,dt=null,ki=null,tr=null,ot=null,nu=wt.createMercatorScene(null,"Mercator",null),p=nu,a=p.nativeCamera,e=a,ft,ni,oi,si,pu=g(null,u.safariRenderHack),ht=[],ri=[],ir=rt.visible,et,gt=0,nr=!1,d=null,o=new ct(800,600),iu,v=new kr,hi;n.addHandler(v,"tiledownloadcomplete",function(){n.invoke(s,"tiledownloadcomplete")});var ru,yt=new rr,uu=!1,ur=!1,dr,fr=!1,er,tt,vt=!0,gr=!0,pt,ei,wi,ui,ii,pi={Grab:"url("+t.cursorPath+"grab.cur)"+u.cursorHotspot+", move",Grabbing:"url("+t.cursorPath+"grabbing.cur)"+u.cursorHotspot+", move",SEResize:"se-resize"},au=1e3/30,bi=.3,lu=.1,yu=.4,eu=new Date(0),fu=200;this.activating=function(t){k=t,er=n.addHandler(t,"resize",br),br()},this.activated=function(){dt=k.getModeLayer(),ki=k.getRootElement(),tr=b(ki),dt.appendChild(v.getRootElement()),ru=g("div","position:absolute;z-index:0;left:0;top:0;"+u.safariRenderHack,dt),yt.activate(k,s,v,ru,cu+"_er"),ot=new wr(s,k,new tu(s,k),tr,yt,!0),vr(),n.removeHandler(ii),ii=n.addHandler(k,"optionschanged",vr),di(p.needsElevation),or=!0,it()},this.deactivating=function(){n.removeHandler(ii),ii=null,di(!1),n.removeHandler(er),er=null,ot.enableOrDisableUserInput(!1,tt),vi(e,!1),yt.deactivate(),dt.removeChild(v.getRootElement()),v.disposeTiles(),ot=null,tr=null,ki=null,dt=null,k=null,or=!1},this.getInternalMaxZoom=function(){return t.maxMercatorZoom},this.getInternalMinZoom=function(){return t.minMercatorZoom},this.setView=function(n){var p=e.getCrs(),w,t,tt=null,i=n.bounds,rt=!1,it;if(i instanceof st){if(n.center){t=n.center;var r=i.getNorthwest(),ft=new y(t.latitude*2-r.latitude,t.longitude*2-r.longitude,r.altitude,r.altitudeReference),v=i.getSoutheast(),et=new y(t.latitude*2-v.latitude,t.longitude*2-v.longitude,v.altitude,v.altitudeReference);i=hr(r,v,ft,et)}else t=p===l?nt.getMercatorCenter(i):i.center.clone();it=ai(n.padding)?new ct(Math.max(1,o.width-n.padding),Math.max(1,o.height-n.padding)):o,w=nt.locationRectToMercatorZoom(it,i),rt=!0}else n.center&&(t=n.center,tt=n.centerOffset),ai(n.zoom)&&(w=n.zoom);var a=!1,k=e.getLookAt(),g=e.getWidth(),b=e.getHeading(),d=!0;t&&(k=p.fromLocation(ut.toEllipsoid(t)),a=!0),ai(w)&&(g=f.mercatorZoomToWidth(w,p,k),a=!0),ai(n.heading)?(b=c.normalizeDegrees(n.heading),ni=b,a=!0):ni=null,n.animate===!1&&(d=n.animate,a=!0),n.suspend!==h&&(n.suspend?ar(!0):li()),n.useCssAnimations!==h&&(nr=u.allowCssAnimations&&n.useCssAnimations),a&&(d&&s.requestCssAnimation(),fi(p,k,tt,g,b,d,rt))},this.setWrapping=function(n){vt=n},this.getCenter=function(){var n=a.getCenter();return new y(n.latitude,n.longitude)},this.getZoom=function(){return a.getMercatorZoom()},this.getHeading=function(){return a.getHeading()},this.getBounds=function(){return sr(a)},this.getMetersPerPixel=function(){return a.getMetersPerPixel()},this.getTargetCenter=function(){var n=e.getCenter();return new y(n.latitude,n.longitude)},this.getTargetZoom=function(){return e.getMercatorZoom()},this.getTargetHeading=function(){return e.getHeading()},this.getTargetBounds=function(){return sr(e)},this.getTargetMetersPerPixel=function(){return e.getMetersPerPixel()},this.tryLocationToViewport=function(n,t){return this.internalTryLocationToViewport(a,n,t&&t.referenceLocation)},this.tryViewportToLocation=function(n,t){return this.internalTryViewportToLocation(a,n,!0,!t||t.normalizeLongitude!==!1)},this.internalTryLocationToViewport=function(n,t,i){var u,f,o=n.getCrs(),e=n.getWorldToViewport(),v=n.getDistanceInverse()<bt,a=!n.getNeedsElevation(),s=n.getLookAt();if(t.latitude!==h)return u=o.fromLocation(ut.toEllipsoid(t,a)),vt&&(u=o.wrap(u,s)),f=e.transform(u),v||f.z>=-1&&f.z<=1?f:null;var c=t.length,p=new Array(c),y=null;if(!n.getPerspectiveOrigin().isZero()){var b=n.getViewportToWorld(),k=new r(0,n.getZoomOriginWidth()*6,0),l=b.transform(k),w=l.x*e.m14+l.y*e.m24+l.z*e.m34+e.m44;y=w}i&&(u=o.fromLocation(ut.toEllipsoid(i,a)),vt&&(s=i=o.wrap(u,s)));while(c--)u=o.fromLocation(ut.toEllipsoid(t[c],a)),vt&&(u=o.wrap(u,s)),s=i||u,f=e.transform(u,y),p[c]=v||f.z>=-1&&f.z<=1?f.toPoint():null;return p},this.internalTryViewportToLocation=function(n,t,i,u){var s=n.getCrs(),h=n.getViewportToWorld(),e,f,o,c;if(gi(t)){o=t.length,c=new Array(o);while(o--)e=h.transform(t[o]),i&&(e=ut.rayToGround(s,e,h.transform(new r(t[o].x,t[o].y,1)))),f=s.toLocation(e),f=new y(f.latitude,u!==!1?y.normalizeLongitude(f.longitude):f.longitude),c[o]=s.toLocation(e);return c}return e=h.transform(t),i&&(e=ut.rayToGround(s,e,h.transform(new r(t.x,t.y,1)))),f=s.toLocation(e),f=new y(f.latitude,u!==!1?y.normalizeLongitude(f.longitude):f.longitude)},this.isDownloadingTiles=function(){return v.isDownloadingTiles()},this.getTileDownloadMetrics=function(){return v.getTileDownloadMetrics()},this.getImageryId=function(){return p.imageryId?p.imageryId:""},this.isRotationEnabled=function(){return p.imageryId==="EnhancedBirdseye"||p.imageryId==="NativeBirdseye"},this.isMercator=function(){return vu(p)},this.getCopyrights=function(n){return n&&p.copyrightProvider?p.copyrightProvider.getCopyrights(s.getBounds(),a.getMercatorZoom(),a.getHeading(),n):n&&n([]),[]},this.setSceneContributors=function(t){var i=ri.length;while(i--)n.removeHandler(ri[i]);ri.length=0,i=t.length,ht.length=i;while(i--)ht[i]=t[i],ri.push(n.addHandler(ht[i],"newsceneavailable",lt));ht.sort(function(n,t){return n.priority-t.priority}),it(),lt()},hi=!1,this.ensureUpdateDispatched=function(n){n?ci():it()},this.getTargetCamera=function(){return e},this.getCurrentCamera=function(){return a},this.getCameraAnimationDuration=function(){return bi},this.setAlignedCamera=function(n,t,i,r,u,f,e){ni=null,fi(n,t,i,r,u,f,e)},this.setCamera=function(n,t){vi(n,t)},this.allowSceneChanges=function(){li()},this.suspendSceneChanges=function(n){ar(n)},this.requestCssAnimation=function(n){return nr&&(si=n,d=n?ti.Flicker:ti.Transformer,d=d.duplicate(),d.isFlick=n),d},this.canUseCssAnimations=function(){return nr},this.usingCssAnimation=function(){return d!=null},this.haltCssAnimation=function(){if(s.usingCssAnimation()){var t=lr(),n=pr(t);si=!1,fi(n.getCrs(),n.getLookAt(),null,n.getWidth(),n.getHeading(),!1)}},this.getCursors=function(){var n="default";return{Grab:ou()?pi.Grab:n,Grabbing:ou()?pi.Grabbing:n,SEResize:pi.SEResize}},this.getPublicApi=function(){return{tryPixelToMercatorPoint:function(n){return s.getTargetCamera().getViewportToWorld().transform(n)},setViewChangeEndDelay:function(n){var n=parseInt(n);n<0||(fu=n)},canReprojectTileLayers:function(){return u.animateOverlayLayers},enableOrDisableZoomLevelSnap:function(n){gr=n===!0,ot.setTouchZoomThreshold(n===!0?.1:0)},setPartialZoomBias:function(n){v&&v.setPartialZoomBias(Math.min(.5,Math.max(-.5,n)))},setDrawShapesInSingleLayer:function(n){typeof n=="boolean"&&(uu=n)},getDrawShapesInSingleLayer:function(){return uu}}}}function ot(n,t,i,r){function l(n){return((o*n+f)*n+u)*n}function h(n){return((a*n+s)*n+e)*n}function c(n){return(3*o*n+2*f)*n+u}function v(n,t){for(var f,u,i=n,r=0;r<9;r++){f=l(i)-n,u=c(i);if(Math.abs(f)<t||Math.abs(u)<1e-6)break;i=i-f/u}return i}var y=this;this.cssText="cubic-bezier("+n+","+t+","+i+","+r+")";var u=3*n,e=3*t,f=3*(i-n)-u,s=3*(r-t)-e,o=1-u-f,a=1-e-s;this.getProgress=function(n,t){return h(v(n,t))}}function pu(n,t,i,r){this.animationSequence=n,this.node=t,this.isComplete=i,this.nodeHasPendingAnimations=r}function nu(n){this.url=n}function dt(n,t,i,r,u,f,e,o,s,h){var l=c.ceilLog2(Math.max(n,t));this.getWidth=function(){return n},this.getHeight=function(){return t},this.getTileWidth=function(){return i},this.getTileHeight=function(){return r},this.getTileOverlap=function(){return u},this.getTileBorder=function(){return f},this.getOffsetX=function(){return e},this.getOffsetY=function(){return o},this.getMaxLevelOfDetail=function(){return l},this.getUrl=s,this.getReplacementTileId=h}function di(r,o,s){function pi(){if(k&&k.length){var t=k.length;while(t--)n.removeHandler(k[t]),wi.removeDownloadBasket(k[t]);k=null}}function ki(){var ki,gr,wr=Math.round((h.x+y.x)/2),vr=Math.round((h.y+y.y)/2),ct=[],pt=g(),ir,i,at,e,w,rr,ii,oi,er,f,r,s,yi,o,gi,ai,vi,lr,or;for(bt=0,gt=0,nt=[],kt=[],wt={},pi(),k=[],ii=0,oi=0,f=h.y;f<=y.y;f++){ii=0,er=!1;var yr=ot&&ot.y<=f&&st&&st.y>=f,dr=f>=yt.y&&f<=vt.y,ar=f>=ft.y&&f<=et.y;for(r=h.x;r<=y.x;r++){ir=new it(h.levelOfDetail,r,f),i=null;var br=ot&&ot.x<=r&&st&&st.x>=r,kr=r>=yt.x&&r<=vt.x,pr=r>=ft.x&&r<=et.x,li=!1,cr=!1;!hi||br&&yr||pr&&ar||(cr=!0),e=c.getUrl(ir,dt),e&&!cr&&(w=wi.getState(e),w!=ht.failed||fi?(s=nr,yi=0,r===0&&(s-=tt,s+=rt,yi=-rt),r===ur&&(s-=tt,s+=rt),o=sr,gi=0,f===0&&(o-=tt,o+=rt,gi=-rt),f===fr&&(o-=tt,o+=rt),i=g("img"),at="width:"+s+"px;height:"+o+"px;border:0px;",ni.requireFlowLayout?(ii&&(at+="margin-left:"+ii*b+"px;"),oi&&(at+="margin-top:"+oi*d+"px;")):(ai=(r-h.x)*b+yi,vi=(f-h.y)*d+gi,i[v+"leftOffset"]=ai,i[v+"topOffset"]=vi,at+="position:absolute;",at+=u.useTransform3d?p.Attributes.transform+":translate3d("+ai+"px,"+vi+"px,0px);":"left:"+ai+"px;top:"+vi+"px"),i.style.cssText=at,i[v+"tileId"]=ir,i[v+"tileUrl"]=e,i[v+"tileHeight"]=o,i[v+"tileWidth"]=s,i.width=s,i.height=o,i.border=0,fi&&w==ht.failed&&(i=di(i),li=i!=!1,i&&(e=i[v+"tileUrl"],w=wi.getState(e))),i&&(w===ht.ready||w===ht.cacheExpired&&(br&&yr||li)?(lr=pr&&!kr&&ar&&!dr,!lr||hi||li?i.src=e:(i.style.visibility="hidden",kt.push(i))):(i.style.visibility="hidden",nt.push(i)),w!=ht.ready&&(rr=new nu(e),rr.priority=(wr-r)*(wr-r)+(vr-f)*(vr-f),ct.push(rr)),ci.push(i))):a.isOverlay||gt++,bt++),i||li?(ii=0,er=!0,i&&(li?tr(i,pt):pt.appendChild(i))):ii++}er?(oi=0,ni.requireFlowLayout&&g("br",null,pt)):oi++}if(u.useImageDisposer){ki=lt.length;while(ki--)lt[ki].src=t.spacerImageUrl}lt.length=0,or=lt,lt=ci,ci=or,(u.useTransform3d||u.useTransform2d)&&(ri=this.hideWhileAnimating?ni.setExactTransformOrHide(ut,ti,a.opacity):ni.setTransformAndOpacity(ut,ti,a.opacity,{explicitOpacity:!0})),pt.style.cssText=ri,l.parentNode&&l.parentNode.replaceChild(pt,l),l=pt,ui(),si&&ct.length&&(ct.basketId=a,ct.sort(bu),hr+=ct.length,k.push(n.addHandler(ct,"hasnewtiles",bi)),wi.setDownloadBasket(ct,dt)),ei()}function ei(){kt.length&&w.dispatch(gi),n.invoke(a,"tilesrendered")}function gi(){var t,n;w.cancelDispatch(gi);if(a.allowTileRender){t=Math.min(kt.length,cr);while(t--)n=kt.shift(),n.style.visibility="visible",n.src=n[v+"tileUrl"]}ei()}function bi(){var r;if(si){var u=nt.length,f=!0,t=[];while(u--&&f){var e=!0,i=nt[u],o=i[v+"tileUrl"],s=wi.getState(o);switch(s){case ht.ready:kt.push(i);break;case ht.failed:ni.requireFlowLayout?f=!1:(l.removeChild(i),ar(i,t));break;default:e=!1}e&&nt.splice(u,1)}f?(ei(),t.length&&(r=n.addHandler(t,"hasnewtiles",bi),k.push(r),t.basketId=r,wi.setDownloadBasket(t,dt))):ki()}}function ar(n,t){if(!fi){gt++;return}var i=di(n);i&&(i.style.visibility="hidden",nt.push(i),lt.push(i),t.push(new nu(i[v+"tileUrl"])),tr(i,l))}function di(n){var e=n[v+"tileId"],b=e.toString(),y=wt[b]?wt[b]:1,i=c.getReplacementTileId(n[v+"tileId"]),p=c.getUrl(i,dt),t=!1,r;if(p){r=i.toString();if(wt[r])t=null;else{var f=Math.pow(2,e.levelOfDetail-i.levelOfDetail),w=n[v+"tileWidth"],a=n[v+"tileHeight"],o=w*f,s=a*f,l=(i.x*f-e.x)*w+n[v+"leftOffset"],h=(i.y*f-e.y)*a+n[v+"topOffset"];t=g("img"),t[v+"leftOffset"]=l,t[v+"topOffset"]=h,t[v+"tileHeight"]=s,t[v+"tileWidth"]=o,t[v+"tileId"]=i,t[v+"tileUrl"]=p,t[v+"lod"]=i.levelOfDetail,t.style.cssText="position:absolute;left:"+l+"px;top:"+h+"px;width:"+o+"px;height:"+s+"px;border:0px;"+u.safariRenderHack,t.width=o,t.height=s,t.border=0,wt[r]=0}wt[r]+=y}else gt+=y;return t}function tr(n,t){var i=t.firstChild,u=n[v+"tileId"],r;while(i){r=i[v+"lod"];if(!r||r>=u.levelOfDetail){t.insertBefore(n,i);break}i=i.nextSibling}i||t.appendChild(n)}var a=this,ii,ui;var l=g(),h,y,ft,et,yt,vt,ot,st,hi=!1,oi=0,er,ti,ri="",hr=0,bt=0,gt=0,fi=!1,si=!0,lr=!1,c=r,b,d,tt,rt,nr,sr,pt,ai,vi,ir,ur,fr,yi,li,ut=e.identity,or,rr,lt=[],ci=[],nt=[],kt=[],wt={},k,cr=3,dt;this.levelOfDetail=o,this.opacity=1,this.isOverlay=!1,this.hideWhileAnimating=!1,this.allowTileRender=!0,b=c.getTileWidth(),d=c.getTileHeight(),tt=c.getTileOverlap(),rt=c.getTileBorder(),nr=b+2*tt,sr=d+2*tt,ii=Math.pow(2,c.getMaxLevelOfDetail()-o),pt=Math.ceil(c.getWidth()/ii),ai=Math.ceil(c.getHeight()/ii),pt=Math.ceil(pt),ur=Math.ceil(pt/b)-1,fr=Math.ceil(ai/d)-1,vi=e.multiply(c.projectingCamera.getWorldToFrustum(),e.scaling(pt),e.translation(pt/2+c.getOffsetX()/ii,ai/2+c.getOffsetY()/ii,0)),ir=vi.invert(),s&&(dt=!0),this.populate=function(n,t,r,u){var s,c,k,w;if(f.areEqual(n,or)&&ct.areEqual(t,rr)&&oi==r)return;or=n,rr=t;var a=e.multiply(n.getViewportToWorld(),vi),v=Math.ceil(t.width/2),p=Math.ceil(t.height/2),l=at.union(a.transform(new i(-v,-p)),a.transform(new i(v,-p)),a.transform(new i(v,p)),a.transform(new i(-v,p)));s=new it(o,Math.floor(l.x/b),Math.floor(l.y/d)),c=new it(o,Math.floor(l.getRight()/b),Math.floor(l.getBottom()/d)),(!yt||!vt||r>oi||yt.x>s.x||yt.y>s.y||vt.x<c.x||vt.y<c.y)&&(yi=null,hi=u,oi=r,yt=s,vt=c,ot=ft,st=et,ft=s.clone(),ft.x-=r,ft.y-=r,et=c.clone(),et.x+=r,et.y+=r,h=ft.clone(),y=et.clone(),u&&(h.x=Math.min(ot.x,h.x),h.y=Math.min(ot.y,h.y),y.x=Math.max(st.x,y.x),y.y=Math.max(st.y,y.y)),er=e.multiply(e.translation(h.x*b,h.y*d,0),ir),k=y.x-h.x+1,w=y.y-h.y+1,ti=new ct(k*b,w*d),ki())},this.render=function(n,t){var i,r,o;f.areEqual(n,yi)&&li===a.opacity||(ut=e.multiply(er.projectOnPlane(n.getGroundPlane()),n.getWorldToViewport()),t&&(ut.offsetX+=t,ut.offsetY+=t),i={explicitOpacity:!this.hideWhiteAnimating},r=this.hideWhileAnimating?ni.setExactTransformOrHide:ni.setTransformAndOpacity,u.useTransform3d||u.useTransform2d?(i.includeCommonCss=!1,i.returnStyleObject=!0,o=r(ut,ti,a.opacity,i),l.style[p.Properties.transform]=o[p.Properties.transform],a.opacity!=li&&(l.style.opacity=a.opacity)):(ri=r(ut,ti,a.opacity,i),l.style.cssText=ri),ui()),li=a.opacity,yi=n},this.getRootElement=function(){return l},this.getTilePyramid=function(){return c},this.getDownloadProgress=function(){return bt>0&&nt?1-nt.length/bt:1},this.getTileDownloadMetrics=function(){return hr},this.getNoImageTileRatio=function(){return bt>0?gt/bt:0},this.enableOrDisableScaledTiles=function(n){fi=n&&!ni.requireFlowLayout&&!rt&&!tt&&typeof c.getReplacementTileId=="function"},this.stopDownloading=function(){si=!1,wi.removeDownloadBasket(a)},this.dispose=function(){lr=!0,a.stopDownloading(),pi(),l&&l.parentNode&&l.parentNode.removeChild(l)},ui=function(){},u.useFilterReflowWorkaround&&ni.usingIEFilters&&(ui=function(){l.offsetWidth})}function kr(){function st(n,t,i){return n&&n.getTilePyramid()===t&&n.levelOfDetail===i}function s(t){if(t){if(k!=null){var i=t.getRootElement();k.removeAnimations(i)}n.removeHandler(t.rendererHandler),t.dispose()}}function fi(){s(r),r=null,s(h),h=null,e=o.none}function tt(){var st,t,f,lt,dt,g;w.cancelDispatch(tt);var c,gt=!1,ni=!1,ct=!1,ui=e>o.none,ti=!1,p=e===o.readyForTarget?a:it;d?ft&&(ot||(st=hi(),gt=st.keepGoing,ct=st.gridsAdded,ti=st.shouldSwapTileGrids),ei&&si()):(s(i),i=null,s(h),h=null,s(nt),nt=null,s(y),y=null,s(v),v=null),e<o.started&&(i&&(i.getDownloadProgress()<1&&(ni=!0),i.render(p)),h&&h.render(p),nt&&nt.render(p),r&&ui&&(r.render(p),bt(r)),y&&y.render(p,1),v&&v.render(p,1)),e===o.readyForTarget&&(r&&k.addToGroup(r.getRootElement()),i&&k.addToGroup(i.getRootElement()),y&&k.addToGroup(y.getRootElement()),v&&k.addToGroup(y.getRootElement()),i&&r&&rt.addToGroup(r.mercatorZoom>i.mercatorZoom?r.getRootElement():i.getRootElement())),ti&&(ii(r),kt(),i.mercatorZoom>h.mercatorZoom?(b(i.getRootElement()).set_style({opacity:1}),i.opacity=1):(b(h.getRootElement()).set_style({opacity:0}),h.opacity=0),rt.applyAllAnimations()),c=l.length;while(c--)t=l[c],t.havePendingDownloads=!1,f=t.tileGrid,lt=di.getBestLevelOfDetail(a,t.tilePyramid,ht),g=t.tilePyramid.projectingCamera,dt=a.getHeading()!==g.getHeading()||a.getPitch()!==g.getPitch()||a.getRoll()!==g.getRoll()||a.getDistanceInverse()!==g.getDistanceInverse(),f&&(f.levelOfDetail!==lt||dt&&!u.animateOverlayLayers)&&(!t.tempDisplayGrid&&u.animateOverlayLayers?(t.tempDisplayGrid=f,t.swapping=null):f.dispose(),f=null),ft&&(!dt||u.animateOverlayLayers)&&e<o.readyForTarget&&(f||(f=yt(t.tilePyramid,lt),f.isOverlay=!0,f.hideWhileAnimating=t.animation==="s"?!1:t.animation==="h"?!0:u.animateOverlayLayers?!1:!0,f.opacity=t.opacity,ct=!0),f.populate(a,ut,et)),(f||t.tempDisplayGrid)&&(t.tempDisplayGrid?t.swapping&&f?((t.swapping!=f||ct||at)&&vt(f,c),t.tempDisplayGrid.dispose(),t.tempDisplayGrid=null,t.swapping=null):(f&&e===o.allowed&&vt(f,c),ri(f,t.tempDisplayGrid,.85)&&(e===o.none&&vt(f,c),t.swapping=f,gt=!0)):(ct||at)&&vt(f,c)),f&&(e<o.started&&f.render(p),e===o.readyForTarget&&k.addToGroup(f.getRootElement()),e>o.allowed&&(t.tempDisplayGrid?bt(f):ii(f)),f.getDownloadProgress()<1&&(t.havePendingDownloads=!0)),t.tempDisplayGrid&&(e<o.started&&t.tempDisplayGrid.render(p),e===o.readyForTarget&&k.addToGroup(t.tempDisplayGrid.getRootElement())),t.tileGrid=f;at=!1,!ni&&pt&&n.invoke(wt,"tiledownloadcomplete"),pt=ni,c=l.length;while(c--)t=l[c],!t.havePendingDownloads&&t.hadPendingDownloadsLastUpdate&&t.tileLayer&&n.invoke(t.tileLayer,"tiledownloadcomplete"),t.hadPendingDownloadsLastUpdate=t.havePendingDownloads;gt&&w.dispatch(tt,10),nt&&a.getWidth()/it.getWidth()>.95&&(s(nt),nt=null)}function hi(){var u=!1,y=!1,w=!1,b=f.areAligned(a,it)&&a.getWidth()===it.getWidth(),l=di.getBestLevelOfDetail(a,d,ht),n=e>o.none,v;return st(i,d,l)?e<o.readyForTarget&&(s(r),r=null,v=b&&!n,i.populate(v?it:a,ut,et,n),h&&!n&&(y=oi())):(e<o.readyForTarget&&(st(r,d,l)||(s(r),r=yt(d,l),r.enableOrDisableScaledTiles(!0),r.mercatorZoom=d.projectingCamera.getMercatorZoom()+c.log2(d.projectingCamera.getWidth()/a.getWidth())),r.populate(a,ut,et)),i==null?(i=r,r=null,p.appendChild(i.getRootElement()),u=!0):r!=null&&(s(h),h=null,i.opacity=1,s(nt),nt=null,e===o.allowed&&(dt(),u=!0),wt.allowTileGridSwitch&&(!lt||r.getDownloadProgress()>.7)&&(!n||e>o.allowed)&&(r.getNoImageTileRatio()>.5?(s(r),r=null,ot=!0):n?w=!0:lt&&ni>1/t.maxFPS?(dt(),kt(),u=!0):(p.insertBefore(r.getRootElement(),i.getRootElement()),s(i),i=r,r=null,u=!0),h&&h.stopDownloading(),_lastTileGridBlendOn=new Date))),{keepGoing:y,gridsAdded:u,shouldSwapTileGrids:w}}function si(){var i=e>o.none,n=ci[di.getBestLevelOfDetail(a,d,ht)],t=new ct(ut.width*ui,ut.height*ui);st(y,d,n)?e<o.readyForTarget&&y.populate(a,t,0):(v||(v=yt(d,n,!0),v.populate(a,t,0),p.childNodes[0]?p.insertBefore(v.getRootElement(),p.childNodes[0]):p.appendChild(v.getRootElement())),y?ri(v,y,.9)&&(s(y),y=v,v=null,st(y,d,n)||w.dispatch(tt)):(y=v,v=null))}function oi(){var t=!1,r=(_lastTileGridBlendOn?new Date-_lastTileGridBlendOn:0)/1e3,n=r/ni;return i.mercatorZoom>h.mercatorZoom?(i.opacity+=n,h.opacity=1,i.opacity<1&&n<.5?t=!0:(i.opacity=1,s(h),h=null)):(h.opacity-=n,i.opacity=1,h.opacity>0&&n<.5?t=!0:(s(h),h=null)),_lastTileGridBlendOn=new Date,t}function dt(){if(!r||!i)return;r.mercatorZoom>i.mercatorZoom?(i.getRootElement().nextSibling==null?p.appendChild(r.getRootElement()):p.insertBefore(r.getRootElement(),i.getRootElement().nextSibling),r.opacity=0):(p.insertBefore(r.getRootElement(),i.getRootElement()),r.opacity=1)}function kt(){h=i,i=r,r=null}function yt(t,i,r){var u=new di(t,i,r);return u.rendererHandler=n.addHandler(u,"tilesrendered",li),u}function li(){w.dispatch(tt,10)}function bt(n){if(n){var t=n.getRootElement();t.style.left="-10000px",t.style.top="-10000px"}}function ii(n){if(n){var t=n.getRootElement();t.style.left="0px",t.style.top="0px"}}function vt(n,t){if(l[t].tempDisplayGrid){p.insertBefore(n.getRootElement(),l[t].tempDisplayGrid.getRootElement());return}var i=t+1;while(i<l.length){if(l[i].tempDisplayGrid){p.insertBefore(n.getRootElement(),l[i].tempDisplayGrid.getRootElement());break}else if(l[i].tileGrid){p.insertBefore(n.getRootElement(),l[i].tileGrid.getRootElement());break}i++}i<l.length||p.appendChild(n.getRootElement())}function gt(){at=!0,l.sort(function(n,t){return n.zIndex-t.zIndex})}function ri(n,t,i){return n&&n.getDownloadProgress()>i&&(n.mercatorZoom<=t.mercatorZoom||a.getWidth()/it.getWidth()>.9)}var wt=this,ni=.5,lt=!0,i=null,h=null,r=null,y=null,v=null,ci=[9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,11,11,11,14,14,14,17,17,17,20,20,20,23,23,23,23],ei=u.animateOverlayLayers,ui=u.isIOSBrowser?2:4,ai,p=g();p.style.cssText="position:absolute;z-index:0;left:0;top:0;"+u.safariRenderHack;var d,a,it,ut,l=[],at=!0,pt=!1,ft=!0,et=0,ot=!1,nt,ht=0,e=o.none,k=null,rt=null;this.allowTileGridSwitch=!0,this.render=function(n,t,i,r,u){r!=a&&(ot=!1),i!==d&&(pt=!0,ot=!1),lt=u!=null?u:lt,ut=n,d=i,it=t,a=r,tt(),e>o.none&&e<o.started&&(e==o.readyForTarget&&k.applyAllAnimations(),e++)},this.getBaseTilePyramid=function(){return d},this.enableOrDisableCssAnimation=function(t,i){var u=t!=null,r;if(!u&&e===o.none)return;k||(k=new ar,rt=new ar,rt.manageAnimations([ti.TileFader.duplicate()]),r=function(n){n.hasPendingAnimations()?e=o.pendingCompletion:fi()},n.addHandler(k,"animationscomplete",function(){r(rt)}),n.addHandler(rt,"animationscomplete",function(){r(k)})),e>o.none&&(k.removeAllAnimations(),(!i||u)&&(rt.removeAllAnimations(),fi())),u&&wt.canCssAnimate()&&(k.manageAnimations([t]),e=t.isFlick?o.readyForTarget:o.allowed)},this.canCssAnimate=function(){return i&&d?!0:!1},this.addOverlay=function(n,t){var i=yi.getNext();return l.push({id:i,tilePyramid:n,zIndex:t.getZIndex(),opacity:t.getOpacity(),animation:t.getAnimation(),tileLayer:t,havePendingDownloads:!1,hadPendingDownloadsLastUpdate:!0}),gt(),w.dispatch(tt,10),i},this.removeOverlay=function(n){var i,t=l.length;while(t--)if(l[t].id===n){i=l[t].tileGrid,i&&i.dispose(),l[t].tempDisplayGrid&&(l[t].tempDisplayGrid.dispose(),l[t].tempDisplayGrid=null),l.splice(t,1),w.dispatch(tt,10);break}},this.updateOverlay=function(n,t,i){var r,u;_overlaysUpdated=!0,r=l.length;while(r--)if(l[r].id===n){u=l[r],u.opacity=i,u.zIndex!==t&&(u.zIndex=t,gt()),l[r].tempDisplayGrid&&(l[r].tempDisplayGrid.dispose(),l[r].tempDisplayGrid=null),w.dispatch(tt,10);break}},this.suspendGettingNewTiles=function(){ft=!1,s(r),r=null,s(h),h=null,s(nt),nt=null,i&&(i.opacity=1,i.allowTileRender=!1)},this.allowGettingNewTiles=function(){i&&(i.allowTileRender=!0),ft||(ft=!0,w.dispatch(tt,10))},this.disposeTiles=function(){w.cancelDispatch(tt),s(r),r=null,s(h),h=null,s(nt),nt=null,s(i),i=null,s(y),y=null,s(v),v=null;var t,n,u=l.length;while(u--)t=l[u],n=t.tileGrid,n&&(n.dispose(),t.tileGrid=null)},this.showBackground=function(n){n!==null&&(ei=n,n||(s(y),y=null,s(v),v=null))},this.setBufferSize=function(n){n=Math.max(0,Math.min(4,n)),n!=et&&(et=n,w.dispatch(tt))},this.getRootElement=function(){return p},this.setPartialZoomBias=function(n){ht=n},this.isDownloadingTiles=function(){return r&&r.getDownloadProgress()<1||i&&i.getDownloadProgress()<1},this.getTileDownloadMetrics=function(){var n=0;return n+=i?i.getTileDownloadMetrics():0,n+=r?r.getTileDownloadMetrics():0}}function rr(){function ci(n){ut(n.collection,n.entity,!0,!1,a.last)}function si(n){tt(n.entity,!0,!1),vt(n.entity)}function ei(n){ut(n.collection,n.entity,!0,!1,a.last)}function oi(){ut(null,l,!1,!0,a.last)}function f(t,u,e,o){var s,h,c;t||(t=ui.getEntityForTarget(e.target)),t&&(s=t.entity,s.trueEntity&&f({entity:s.trueEntity,type:s.trueEntity.type},u,e,o),n.hasHandler(s,u)&&(o&&e.touches&&e.touches[0]&&(h=new i(e.touches[0].pageX,e.touches[0].pageY)),h||(h=b.Screen.get_mouse_pos(e)),c=new li(r,t.type,s,u,h.x,h.y,0,o,e),n.invoke(s,u,c)))}function ut(n,i,f,y,w){var hi,li,gi,gt,oi,pi,si,bt,d,fi,yi,at,ci,di,vt,ri,wi,nr,b,bi,ht,ot,et,wt;if(c){hi=!1,li=r.getTheme(),li&&(gi=i[it]=i[it]||{},gt=li._preRenderEntity(i,gi,{updateEntity:f,themeReferenceKey:it}),gt&&gt!==i&&(gt.trueEntity=i,i=gt)),oi=yt.getEntityRenderer(r,i);if(oi)pi={entityCollection:n,rootDom:l[t].shape,parentDom:n[t].shape,parentOffsetLeft:n[t].offsetLeft,parentOffsetTop:n[t].offsetTop,parentRemoved:!1,update:f,linear:y,animationStart:w===a.first,animationEnd:w===a.last,currentBounds:k,actualBounds:ti,viewportSize:c,customRenderer:h},oi.shouldDraw(i,pi)?(si=oi.update(i,pi),si&&ii(si,{entity:i,type:si.type})):tt(i,!0,f);else if(i instanceof ki){b=i[t],b?(bt=b.root,d=b.shape):(bt=g(null,u.safariRenderHack),d=g(null,u.safariRenderHack+";position:absolute;"),bt.appendChild(d),b={root:bt,shape:d,offsetTop:0,offsetLeft:0},i[t]=b,hi=!0,f=!0),f&&(fi="position:absolute;pointer-events:none;",i.getVisible()||(fi+="display:none;"),yi=i.getZIndex(),typeof yi=="number"&&(fi+="z-index:"+yi+";"),bt.style.cssText=fi+u.safariRenderHack);var vt,ei=b.lookAt,vi=!1,ui=!1;for(y&&ei?(at=s==o.readyForTarget?kt.getWorldToViewport().transform(ei):lt.getWorldToViewport().transform(ei),(!pt||!b.harmony)&&(Math.abs(at.x)>1e4||Math.abs(at.y)>1e4)?(vi=!0,ui=!0,y=!1):s<o.started&&(ci=e.translation(at.x,at.y,0),u.useTransform3d&&!u.isIOS3?(di=ni.setTransformAndOpacity(ci,null,1,{excludeCommonCss:!0,returnStyleObject:!0}),d.style[p.Properties.transform]=di[p.Properties.transform]):(vt=ni.setTransformAndOpacity(ci,null,1,{excludeCommonCss:!u.isIOS3}),u.isIOS3||(vt="position:absolute;"+vt),d.style.cssText=vt),b.offsetLeft=at.x,b.offsetTop=at.y)):vi=!0,vi&&s<o.started&&(vt="position:absolute;",b.lookAt=lt.getLookAt(),b.offsetLeft=0,b.offsetTop=0,d.style.cssText=vt),y&&ei&&s==o.readyForTarget&&rt.addToGroup(d),d.harmony&&!ct.areEqual(b.previousSize,c)&&(ri=d.harmony,ri.style.width=c.width+"px",ri.style.height=c.height+"px",ri.style.left=-(c.width/2)+"px",ri.style.top=-(c.height/2)+"px",b.previousSize=c),hi&&n[t].root.appendChild(bt),ui&&d.harmony&&d.harmony.style&&(d.harmony.style.display="none"),wi=i.getLength(),ht=0;ht<wi;ht++)ut(i,i.get(ht),f,y&&!ui,w);ui&&setTimeout(function(){d&&d.harmony&&d.harmony.style&&(d.harmony.style.display="block")},1)}else if(i instanceof ir)nr=i.getVisible()&&(h||k.contains(i.getLocation())||i[t]&&i[t].dragging),nr?ai(n,i,f,y):tt(i,!0,f);else if(i instanceof hr)if(n.getVisible()){b=i[t],b||(b={},i[t]=b);if(f||!b.added||v.getBaseTilePyramid()!==st){b.added=!1,st=v.getBaseTilePyramid(),bi=st?st.projectingCamera:ft.mercator,ht=nt.length;while(ht--)ot=nt[ht][0],b[ot]&&(v.removeOverlay(b[ot]),b[ot]=null),i.getVisible()&&ft[ot]===bi&&(et=i.getTileSource(ot),et&&(wt=dt.createQuadKeyTilePyramid(et.getWidth(),et.getHeight(),et.getUriConstructor(),nt[ht][1]),wt.projectingCamera=ft[ot],b[ot]=v.addOverlay(wt,i),b.added=!0));!b.added&&i.getVisible()&&i.getReproject()&&(et=i.getTileSource("mercator"),et&&(wt=dt.createQuadKeyTilePyramid(et.getWidth(),et.getHeight(),et.getUriConstructor(),nt[0][1]),wt.projectingCamera=ft.mercator,b[ot]=v.addOverlay(wt,i)),b.added=!0)}}else tt(i,!0,f)}}function ai(n,i,r,f){var l,c,y,p,a,nt,v,d,ht,k,st,tt,ft,ut,it,et;if(!n[t])return;c=i[t],c?(r=c.updateEntity||r,c.updateEntity=!1):(l=g(null,u.safariRenderHack),l[w]={entity:i,type:ri.pushpin},c={dom:l,dragAttached:!1,offsetTop:0,offsetLeft:0},i[t]=c,r=!0),l=c.dom,r&&(y=c.icon,p=i.getIcon(),!y&&p&&(y=g("img",u.safariRenderHack,l),c.icon=y,y[w]={entity:i,type:ri.pushpin},y.src=p),y&&y.src!==p&&(y.src=p||""),a=c.text,nt=i.getText(),!a&&nt&&(a=g(null,u.safariRenderHack,l),a.appendChild(document.createTextNode("")),c.text=a,a[w]={entity:i,type:ri.pushpin}),a&&(nt?(a.style.cssText="position:absolute;text-align:center;width:100%;font:bold 10pt Arial,Helvetica,Sans-Serif;color:#fff;left:"+i.getTextOffset().x+"px;top:"+i.getTextOffset().y+"px;",a.replaceChild(document.createTextNode(nt),a.firstChild)):(l.removeChild(a),c.text=null))),v="";if(!h&&s<o.started){v="position:absolute;overflow:hidden;pointer-events:all;"+u.safariRenderHack;if(!f||!c.isDrawn){d=s===o.readyForTarget?bt.internalTryLocationToViewport(kt,i.getLocation()):bt.internalTryLocationToViewport(lt,i.getLocation());if(d){var vt=i.getAnchor(),ot=d.x-vt.x-n[t].offsetLeft,ct=d.y-vt.y-n[t].offsetTop;u.useTransform3d&&i.getUseTransform3d()?(ht=e.translation(ot,ct,0),k={excludeCommonCss:!0},r?v+=ni.setTransformAndOpacity(ht,null,1,k):(k.returnStyleObject=!0,st=ni.setTransformAndOpacity(ht,null,1,k),c.displayHidden&&(st.display=""),b(l).set_style(st))):r?(v+="left:"+ot+"px;",v+="top:"+ct+"px;"):(l.style.left=ot+"px",l.style.top=ct+"px",c.displayHidden&&(l.style.display="")),c.displayHidden=!1}else r?v+="display:none;":l.style.display="none",c.displayHidden=!0;c.displayHidden=!0}}r&&(l.id=i.getId(),tt=i.getTypeName()||"",l.className!=tt&&(l.className=tt),ft=i.getZIndex(),typeof ft=="number"&&(v+="z-index:"+ft+";"),ut=i.getWidth(),v+="width:"+(ut?ut+"px;":"auto;"),it=i.getHeight(),v+="height:"+(it?it+"px;":"auto;"),v+="line-height:0px;",l.style.cssText=v),f||s!==o.readyForTarget||rt.addToGroup(l),(r||!c.isDrawn)&&(et=i.getDraggable(),et!=c.dragAttached&&at(i,et)),h?c.isDrawn?r&&h.updateEntity(i):(h.addEntity(i,l),c.isDrawn=!0):c.isDrawn||(n[t].shape.appendChild(l),c.isDrawn=!0)}function tt(n,i,u){var p,s,e,a,f,o,c,l,k,b;if(n){p=r.getTheme(),p&&(s=n[it]=n[it]||{},s.proxyEntity&&(n=s.proxyEntity),p._unhookFromEntity(n,s));if(n[t]){e=n[t];if(n instanceof ki){f=e.root,a=!1,i&&f&&f.parentNode&&(y?(y.push(y),a=!0):f.parentNode.removeChild(f)),o=n.getLength();while(o--)tt(n.get(o),a,u)}else if(n instanceof ir)at(n,!1),wt(n),f=e.dom,f&&(f[w]=null,i&&f.parentNode&&f.parentNode.removeChild(f)),e.updateEntity=e.updateEntity||u,e.isDrawn=!1,h&&h.removeEntity(n);else if(n instanceof hr){e.added=!1,o=nt.length;while(o--)c=nt[o][0],e[c]&&v.removeOverlay(e[c])}}else l=yt.getEntityRenderer(r,n),l&&(k={parentRemoved:!i,update:u,customRenderer:h},b=l.remove(n,k),ii(b,null))}}function ii(n,t){if(n&&n.doms){var r=n.doms,i=r.length;while(i--)r[i][w]=t}}function vt(n){var u,i;if(n instanceof ki){u=n.getLength();while(u--)vt(n.get(u))}else n instanceof ir?(at(n,!1),wt(n)):(i=yt.getEntityRenderer(r,n),i&&i.dispose(n));delete n[t]}function at(i,r){var u=i[t];u&&(u.dragAttached=r,r?u.dragStartHandler=n.addHandler(i,"mousedown",fi):u.dragStartHandler&&(n.removeHandler(u.dragStartHandler),delete u.dragStartHandler))}function fi(u){var f=u.target,e=f[t],o,h,s;if(e&&(u.isTouchEvent||u.originalEvent.which===1)){e.dragging=!0,o=r.tryLocationToPixel(f.getLocation());if(o){h=o.x-u.getX(),s=o.y-u.getY(),n.invoke(f,"dragstart",{entity:f});function l(t){t.handled=!0,t.originalEvent.preventDefault();var u=r.tryPixelToLocation(new i(t.getX()+h,t.getY()+s));u&&f.setLocation(u),n.invoke(f,"drag",{entity:f})}function c(){wt(f),n.invoke(f,"dragend",{entity:f})}e.dragAttached&&!e.dragEndHandler&&(e.dragMoveHandler=n.addHandler(r,"mousemove",l),e.dragEndHandler=n.addHandler(r,"mouseup",c))}}}function wt(i){var r=i[t];r&&(r.dragging=!1,r.dragMoveHandler&&(n.removeHandler(r.dragMoveHandler),delete r.dragMoveHandler),r.dragEndHandler&&(n.removeHandler(r.dragEndHandler),delete r.dragEndHandler))}rr.ensureVmlNamespace();var ui=this,r,bt,h,l,v,ht,w,t,it,c,lt,k,ti,kt,pt,ot,y,st,s=o.none,rt=new ar,a={first:0,middle:1,last:2},d=[["entityadded",ci],["entityremoved",si],["entitychanged",ei]],gt,nt=[["mercator",et.horizontal],["enhancedBirdseyeNorthUp",et.horizontal],["enhancedBirdseyeEastUp",et.vertical],["enhancedBirdseyeSouthUp",et.horizontal],["enhancedBirdseyeWestUp",et.vertical]];this.activate=function(i,f,e,o,s,c){r=i,bt=f,l=r.entities,v=e,h=c,pt=hi.isClipped(),ht=s,w=ht+"_der",t=ht+"_etr",it=ht+"_thr",l[t]={root:o,shape:g(null,u.safariRenderHack+";position:absolute;",o),offsetTop:0,offsetLeft:0};var a=d.length;while(a--)d[a][2]=n.addHandler(l,d[a][0],d[a][1]);gt=n.addHandler(yt,"newEntityRenderer",oi)},this.deactivate=function(){c=null;var t=d.length;while(t--)n.removeHandler(d[t][2]),d[t][2]=null;n.removeHandler(gt),gt=null,tt(l,!0,!1),vt(l),r=null,l=null,v=null},this.enableOrDisableCssAnimation=function(n){if(!u.allowCssAnimations)return;var i=n!=null;rt.removeAllAnimations(),s=o.none,i&&(rt.manageAnimations([n]),s=n.isFlick?o.readyForTarget:o.allowed)},this.onMouseDown=function(n){f(null,"mousedown",n)},this.onTouchStart=function(n){y||(y=[]),f(null,"mousedown",n,!0)},this.onMouseUp=function(n){f(this.getEntityForTarget(n.captureTarget),"mouseup",n)},this.onTouchEnd=function(n){var i,r,t;f(this.getEntityForTarget(n.captureTarget),"mouseup",n,!0);if(y){i=y,y=null,r=i.length;while(r--)t=i[r],t&&t.parentNode&&t.parentNode.removeChild(t)}},this.onMouseOver=function(n){f(null,"mouseover",n)},this.onMouseOut=function(n){f(null,"mouseout",n)},this.onMouseClick=function(n){f(null,"click",n)},this.onMouseRightClick=function(n){f(null,"rightclick",n)},this.onMouseDoubleClick=function(n){f(null,"dblclick",n)},this.onTap=function(n){f(null,"click",n,!0)},this.onDoubleTap=function(n){f(null,"dblclick",n,!0)},this.onTapAndHold=function(n){f(null,"rightclick",n,!0)},this.getEntityForTarget=function(n){return n&&n.nodeType===3&&(n=n.parentNode),n&&n[w]?n[w]:null},this.update=function(n,t,i,u,f){c=n,lt=t,kt=i,f!=a.last&&k||(k=r.getBounds(),ti=k.clone(),k.width*=3,k.height*=3),ot=f==a.last&&pt?!1:ot&&u,ut(null,l,!1,ot,f),f==a.last&&(ot=!0),s>o.none&&s<o.started&&(s==o.readyForTarget&&rt.applyAllAnimations(),s++)}}function wu(n){function s(t){return n.getMode().getDrawShapesInSingleLayer()?t.rootDom:t.parentDom}function h(n,i){var f=null,r=n[t],e,u;return r&&(e=r.harmony,e&&(u=r.path,u&&(f=u.nativeShape,e.removePath(u),r.path=null)),r.updateEntity=r.updateEntity||i.update,r.isDrawn=!1),hi.isEventsSupported()&&f?{doms:[f]}:null}function i(n){var i=n[t];return i||(i={},n[t]=i),i}function e(n,t){for(var h=n.x,s=n.x+n.width,a=n.y,l=n.y+n.height,o=[],i=[],v=t.length,e,r,c,u=0;u<v;u++)r=t[u],r?(c=r.x>=h&&r.y>=a&&r.x<=s&&r.y<=l,c?(!i.length&&u&&t[u-1]&&i.push(t[u-1]),i.push(r),e=null):(i.length&&(i.push(r),o.push(i),i=[]),e&&f(h,s,a,l,e,r)&&(i.push(e),i.push(r),o.push(i),i=[]),e=r)):(o.push(i),i=[]);return i.length&&o.push(i),o}function f(n,t,i,r,u,f){if(f.x-u.x==0)return u.x>=n&&u.x<=t;if(f.y-u.y==0)return u.y>=i&&u.y<=r;var o=(f.y-u.y)/(f.x-u.x),s=u.y-o*u.x,e=o*n+s;if(e>=i&&e<=r)return!0;e=o*t+s;if(e>=i&&e<=r)return!0;return o=(f.x-u.x)/(f.y-u.y),s=u.x-o*u.y,e=o*i+s,e>=n&&e<=t?!0:!1}var o=n,r="cm"+yi.getNext(),t=r+"_etr";this.shouldDraw=function(n,t){var e=n.getVisible()&&(t.linear||t.animationEnd||u.animateShapes),o,r,f;return e&&(o=i(n),r=o.boundingRect,(t.update||!r)&&(f=n.getLocations(),o.boundingRect=r=f?st.fromLocations(f):null),e=r&&t.currentBounds.intersects(r)),e},this.update=function(n,t){var c=t.viewportSize,vt=t.currentBounds,f=i(n),p,l,a,h,tt,ft,lt,y,ot,nt,st,ut,v,d,ht,et,rt,it,b,w,k;t.update=f.updateEntity||t.update,f.updateEntity=!1,p=f.harmony,l=s(t),!p&&l&&(a=l.harmony,a||(a=g("div","position:absolute;width:"+c.width+"px;height:"+c.height+"px;left:"+-(c.width/2)+"px;top:"+-(c.height/2)+"px;"+u.safariRenderHack),l.harmony=a,l.firstChild?l.insertBefore(a,l.firstChild):l.appendChild(a)),p=hi.getContext(a),a.className="MicrosoftMapDrawing",f.harmony=p),h=f.path,tt=!1,h&&ct.areEqual(f.previousSize,c)||(p.setSize(c.width,c.height),f.previousSize=c,tt=!0),h||(h=p.createPath(),h.id=r+"path"+yi.getNext(),f.path=h,t.update=!0),t.update&&(ft=n.getStrokeColor(),h.strokeStyle=ft.toHex(),h.strokeOpacity=ft.getOpacity(),h.lineWidth=n.getStrokeThickness(),h.dashArray=n.getStrokeDashArray(),n instanceof tr?(lt=n.getFillColor(),h.fillStyle=lt.toHex(),h.fillOpacity=lt.getOpacity()):h.fillStyle="none");if(!t.linear||!f.points||tt){ot=null,nt=f.boundingRect,nt&&nt.width>180&&(ot={referenceLocation:nt.center}),f.points=o.tryLocationToPixel(n.getLocations(),null,ot),f.offsetLeft=t.parentOffsetLeft,f.offsetTop=t.parentOffsetTop,st=n instanceof nr&&(f.boundingRect.width>vt.width||f.boundingRect.height>vt.height),f.doClipping=st;if(!st){v=f.points,ut=v.length,y=v.length;while(y--)v[y]||(ut=!1,y=0);ut||(f.points=[])}}if(!t.linear||t.animationEnd||t.update||tt){v=f.points,f.doClipping?(ht=c.width*3,et=c.height*3,d=e(new at(-t.parentOffsetLeft-ht/2,-t.parentOffsetTop-et/2,ht,et),v)):d=[v],h.beginPath(),rt=f.offsetLeft-c.width/2,it=f.offsetTop-c.height/2,y=d.length;while(y--){b=d[y];if(b&&b.length)for(w=b[0],h.moveTo(w.x-rt,w.y-it),k=1;k<b.length;k++)w=b[k],h.lineTo(w.x-rt,w.y-it)}h.data||h.moveTo(0,0),h.stroke(),f.isDrawn||(p.renderPath(h),f.isDrawn=!0)}return hi.isEventsSupported()&&n.getShouldFireEvents()?{doms:[h.nativeShape],type:n instanceof nr?ri.polyline:ri.polygon}:null},this.remove=h,this.dispose=function(n){delete n[t]}}function br(n,t,i,r,u){function e(n){var u=[],i=n?n.split(";"):[],r=i.length,t;while(r--)t=st.fromString(i[r]),t&&u.push(t);return u}this.priority=u;var f=e(r);this.getScene=function(r,u,e,o){if(o>=t&&o<i){if(!f||!f.length)return n;var c=new y(u,e),h=f.length;while(h--)if(f[h].contains(c))return n}return null}}function oi(n,t){var i=n;this.getCopyrights=function(n,r,u,f){t(function(t){t?gr.getCopyrights(i,n,r,u,t,f):f([ii.defaultCopyright.text])})}}function wr(r,e,o,s,h,c,l){function ot(n){n.stopPropagation(),n.preventDefault()}function fi(n,t){var r,i;r=n.length;if(t&&!n.isWired){while(r--)i=n[r],s.add_event(i[0],i[1],!1);n.isWired=!0}else if(!t&&n.isWired){while(r--)i=n[r],s.remove_event(i[0],i[1],!1);n.isWired=!1}}function ht(){return y!=null&&(y.x!=0||y.y!=0)}function vi(){dt&&ht()&&(y.x*=dt,y.y*=dt,Math.abs(y.x)<5&&Math.abs(y.y)<5&&(y.x=0,y.y=0))}function yi(n,t,i){if(n&&t&&i){var u=i.x-t.x,r=i.y-t.y;u!=0||r!=0?(ct+=n,y?(y.x=.3*y.x+.7*u*1e3/ct,y.y=.3*y.y+.7*r*1e3/ct):y=new gt(u*1e3/ct,r*1e3/ct),ct=0):ct+=n}}function di(n){var t=b.Screen.get_mouse_pos(n);return new i(t.x-e.getViewportX(),t.y-e.getViewportY())}function st(){return new i(0,0)}function k(t,u,f,o){var y=!1,c,p,s,l,v;return n.hasHandler(r,u)&&(o||(f.touches&&f.touches[0]?c=new i(f.touches[0].pageX,f.touches[0].pageY):a&&a[0]&&(c=a[0])),c||(c=b.Screen.get_mouse_pos(f)),p=f.wheelDelta?f.wheelDelta:0,h&&(t&&(s=h.getEntityForTarget(t)),s||(s=h.getEntityForTarget(f.target)),s&&(l=s.type,s=s.entity)),l||(s=e,l=ri.map),v=new li(e,l,s,u,c.x,c.y,p,!o,f),u==="click"&&(v.mouseMoved=ei&&d&&i.distance(ei,d)>5),n.invoke(r,u,v),y=v.handled),y}function br(n){if(!n.handled){var t=!1;if(n.ctrlKey)switch(n.keyCode){case 37:o.rotate(90);break;case 39:o.rotate(-90)}else switch(n.keyCode){case 37:v.x>-1&&(v.x=-1),t=!0;break;case 39:v.x<1&&(v.x=1),t=!0;break;case 38:v.y>-1&&(v.y=-1),t=!0;break;case 40:v.y<1&&(v.y=1),t=!0;break;case 109:case 189:vt=-1;break;case 107:case 187:case 61:vt=1}r.ensureUpdateDispatched(),t&&(n.handled=!0,ot(n.originalEvent))}}function kr(n){if(!n.handled){switch(n.keyCode){case 37:case 39:v.x=0;break;case 38:case 40:v.y=0;break;case 109:case 189:case 107:case 187:case 61:vt=0}r.ensureUpdateDispatched()}}function si(){v.x=0,v.y=0,vt=0}function ki(n){if(!k(null,"dblclick",n,!0)&&!et){if(h)h.onMouseDoubleClick(n);var t=ft?st():di(n);o.zoomCenter(.5,t)}ot(n)}function wr(n){if(!k(null,"click",n,!0)&&h){h.onMouseClick(n);if(u.emulateDblClick){var t=b.Screen.get_mouse_pos(n);new Date-hi<bi&&t.x===kt.x&&t.y===kt.y?(kt={x:0,y:0},hi=new Date(0),ki(n)):(kt=t,hi=new Date)}}}function tu(n){if(!k(null,"rightclick",n,!0)&&h)h.onMouseRightClick(n)}function nu(n){if(!k(null,"mousewheel",n,!0)&&!et){nt.clearInertialScrolling();if(n.wheelDelta){var t=ft?st():di(n);o.zoomPoint(n.wheelDelta,t)}ot(n)}}function dr(n){if(!k(null,"mousedown",n,!0)){si(),r.suspendSceneChanges(!1),r.haltCssAnimation(),o.startUserInput();if(h)h.onMouseDown(n);wt=!et&&c&&(n.shiftKey===!0||n.which===2),d=b.Screen.get_mouse_pos(n),nt.clearInertialScrolling(),ei=tt=d,b.Events.capture_mouse(this,!1),ui=!0,wt?s.set_style({cursor:r.getCursors().SEResize}):s.set_style({cursor:r.getCursors().Grabbing})}ot(n)}function gr(n){k(null,"mousemove",n,!0)||tt&&(d=b.Screen.get_mouse_pos(n),r.ensureUpdateDispatched(),ir=new Date,ot(n))}function yr(n){ui&&gi(n)}function gi(n){var l,a;if(!k(n.captureTarget,"mouseup",n,!0)){r.canUseCssAnimations()&&ht()||r.allowSceneChanges(),yt===!0&&(l=new Date,a=l-ir,a<ur?it=d:nt.clearInertialScrolling()),r.ensureUpdateDispatched();if(h)h.onMouseUp(n);if(wt&&tt)if(i.distance(tt,d)>10){var f=e.getViewportX(),u=e.getViewportY(),t=at.union(new i(tt.x-f,tt.y-u),new i(d.x-f,d.y-u)),y=Math.max(t.width/e.getWidth(),t.height/e.getHeight()),v=ft?st():t.getCenter();o.zoomCenter(y,v)}}c&&(ut.style.display="none",ut.parentNode&&ut.parentNode.removeChild(ut)),s.set_style({cursor:r.getCursors().Grab}),tt=null,ui=!1,b.Events.release_mouse()}function sr(n){if(!k(null,"mouseover",n,!0)&&h)h.onMouseOver(n)}function or(n){if(!k(null,"mouseout",n,!0)&&h)h.onMouseOut(n)}function ci(n){var r=e.getViewportX(),t=e.getViewportY();return n.length>1?new i((n[0].x+n[1].x)/2-r,(n[0].y+n[1].y)/2-t):n.length?new i(n[0].x-r,n[0].y-t):new i(0,0)}function ar(n){n.preventManipulation&&n.preventManipulation(),n.currentTarget&&n.currentTarget.msSetPointerCapture&&n.currentTarget.msSetPointerCapture(n.pointerId),n.preventMouseEvent&&n.preventMouseEvent(),si(),ai();if(!k(null,"mousedown",n,!1)){r.suspendSceneChanges(!0),r.haltCssAnimation(),o.startUserInput();if(h)h.onTouchStart(n);nt.clearInertialScrolling();var t=Math.min(2,n.touches.length);lt===0&&t===2&&(lt=r.getCurrentCamera().getMercatorZoom()),w.length===0&&t===1&&(p=new i(n.touches[0].pageX,n.touches[0].pageY),p.target=n.target,p.start=new Date,ti=setTimeout(hr,pr));while(t--)a[t]=new i(n.touches[t].pageX,n.touches[t].pageY),w[t]=a[t],rt[t]=a[t];fr=r.getCurrentCamera().getHeading()}ot(n)}function vr(n){(n.touches.length>1||p&&(Math.abs(n.touches[0].pageX-p.x)>20||Math.abs(n.touches[0].pageY-p.y)>20))&&(oi(),ai());if(n.touches.length>1||!k(null,"mousemove",n,!1)){var t=w.length;if(t){t=n.touches.length;while(t--)a[t]=new i(n.touches[t].pageX,n.touches[t].pageY)}}r.ensureUpdateDispatched(),nr=new Date,ot(n)}function pi(n){var l,g,d,b,u,s,c,t,v,y;n.currentTarget.msReleasePointerCapture&&n.currentTarget.msReleasePointerCapture(n.pointerId),ai();if(!k(null,"mouseup",n,!1)){if(h)h.onTouchEnd(n);p&&(lr(),ni&&new Date-ni.start<bi?(l=new i(p.x-e.getViewportX(),p.y-e.getViewportY()),cr(),oi()):(ni=p,p=null)),w.length===1&&yt===!0&&(g=new Date,d=g-nr,d<ur?it=a[0]:nt.clearInertialScrolling()),w.length=0,n.touches.length&&(nt.clearInertialScrolling(),a[0]=w[0]=new i(n.touches[0].pageX,n.touches[0].pageY)),r.canUseCssAnimations()&&ht()?r.ensureUpdateDispatched():r.allowSceneChanges();if(l&&!et)u=ft?st():l,o.zoomCenter(.5,u,null,!0);else{if(rt.length>1&&r.isRotationEnabled()){var tt=new gt(rt[1].x-rt[0].x,rt[1].y-rt[0].y),ut=new gt(a[1].x-a[0].x,a[1].y-a[0].y),ot=Math.atan2(ut.y,ut.x)-Math.atan2(tt.y,tt.x);Math.abs(ot)>.7&&(lt=0),rt.length=0}lt!==0&&ii>0&&(u=ft?st():ci(a),s=r.getCurrentCamera().getMercatorZoom(),c=s-lt,lt=0,t=Math.abs(c),t-=Math.floor(t),t>=ii&&t<.5&&(v=c>0?Math.ceil(s):Math.floor(s),y=f.mercatorZoomToWidth(v,r.getCurrentCamera().getCrs(),b)/f.mercatorZoomToWidth(s,r.getCurrentCamera().getCrs(),b),o.zoomCenter(y,u,u)))}ht()||o.endUserInput()}}function ai(){ti&&(clearInterval(ti),ti=null)}function oi(){ni=null,p=null}function lr(){if(!k(null,"click",p,!1)&&h)h.onTap(p)}function cr(){if(!k(null,"dblclick",p,!1)&&h)h.onDoubleTap(p)}function hr(){if(p){if(!k(null,"rightclick",p,!1)&&h)h.onTapAndHold(p);oi()}}var nt=this,ut;l=l||{},c&&(ut=g("div","display:none;z-index:0;position:absolute;border:1px dashed #000;background:#ccc"),b(ut).set_style({opacity:".5"}));var wi=.15,bi=500,pr=1e3,ni,p,ti,ii=l.touchZoomThreshold!=null?l.touchZoomThreshold:.1,iu=[],ui=!1,yt=!0,dt=.9,y=null,pt=null,it=null,kt={x:0,y:0},hi=new Date(0),ir=new Date(0),nr=new Date(0),ur=100,ct=0,ft=!1,et=!1,er=[["dblclick",ki],["click",wr],["mousewheel",nu],["mousedown",dr],["mousemove",gr],["mouseup",gi],["losecapture",yr],["contextmenu",tu],["mouseover",sr],["mouseout",or]],tr=[["touchstart",ar],["touchmove",vr],["touchend",pi],["touchcancel",pi]],bt=[["keydown",br,null],["keyup",kr,null],["blur",si,null]],ru=null,uu=.003*u.scrollAdjustment,fu=0,v=new i(0,0),vt=0,rr=new Date(0),d,tt,ei,wt,a=[],rt=[],fr,w=[],lt=0;nt.enableOrDisableInertialScrolling=function(n,t){n?(yt=!0,typeof t=="number"&&(dt=Math.min(Math.max(t,.01),.99))):yt=!1},nt.enableOrDisableUserInput=function(t,i){if(i){t=t&&!i.disableUserInput,fi(er,t&&!i.disableMouseInput),t&&!i.disableTouchInput?(s.set_style({"-ms-touch-action":"none"}),fi(tr,!0)):(s.set_style({"-ms-touch-action":""}),fi(tr,!1)),t=t&&!i.disableKeyboardInput;var u,f;u=bt.length;if(t)while(u--)f=bt[u],f[2]||(f[2]=n.addHandler(e,f[0],f[1]));else while(u--)n.removeHandler(bt[u][2]),bt[u][2]=null;ft=i.disablePanning?!0:!1,et=i.disableZooming?!0:!1,s.set_style({cursor:r.getCursors().Grab})}},nt.setTouchZoomThreshold=function(n){ii=Math.min(n,.49)},nt.clearInertialScrolling=function(){it=null,y=null},nt.processPendingUserInput=function(){var h=new Date,l=pt?h-pt:null,p,ri,ui,b,c,u,g,ot,bt,k,lt;pt=h,ri=r.getCurrentCamera().getWidth(),ui=r.getCurrentCamera().getLookAt(),vt&&!et&&(nt.clearInertialScrolling(),p=vt<0?2:.5),(v.x||v.y)&&!ft&&(nt.clearInertialScrolling(),b=v.x*wi*e.getWidth(),c=v.y*wi*e.getHeight(),Math.abs(v.x)>.9&&Math.abs(v.x)<3&&(v.x=v.x*1.01),Math.abs(v.y)>.9&&Math.abs(v.y)<3&&(v.y=v.y*1.01)),(p||b||c)&&(h=new Date,(pt-rr)/1e3>r.getCameraAnimationDuration()/3&&(p&&o.zoom(p),(b||c)&&o.doDragXY(b,c),rr=h));if(tt)if(wt&&!et){var ti=e.getPageX(),ni=e.getPageY(),f=at.union(new i(tt.x-ti,tt.y-ni),new i(d.x-ti,d.y-ni));ut.style.left=f.x+"px",ut.style.top=f.y+"px",ut.style.width=f.width+"px",ut.style.height=f.height+"px",ut.style.display="block",s.element().appendChild(ut)}else ft||(o.doDrag(tt,d),yt===!0&&yi(l,tt,d),tt=d);else if(w.length>0){u=w.length;if(a.length>=u){switch(u){case 1:ft||(o.doDrag(w[0],a[0]),yt===!0&&yi(l,w[0],a[0]));break;case 2:g=ft?st():ci(w),ot=ft?st():ci(a);if(!a[0]||!a[1]||!w[0]||!w[1])return;bt=1,et||(bt=i.distance(w[0],w[1])/i.distance(a[0],a[1])),k=0;if(rt.length>1&&r.isRotationEnabled()){var dt=new gt(rt[1].x-rt[0].x,rt[1].y-rt[0].y),kt=new gt(a[1].x-a[0].x,a[1].y-a[0].y),fi=Math.atan2(kt.y,kt.x)-Math.atan2(dt.y,dt.x);k=fr-r.getCurrentCamera().getHeading()-fi*180/Math.PI}o.setCamera(bt,g,ot,k)}while(u--)w[u]=a[u]}}else if(ht()){lt=r.requestCssAnimation(!0);if(lt){var n=new i(it.x,it.y),ct=1/t.maxFPS,ii=0;while(ht())n.x+=y.x*ct,n.y+=y.y*ct,ii+=ct,vi();lt.setDuration(ii),r.suspendSceneChanges(!0),o.doDrag(it,n,!0),it=n}else{if(it){var n=new i(it.x+y.x*l/1e3,it.y+y.y*l/1e3),g=new i(Math.round(it.x),Math.round(it.y)),ot=new i(Math.round(n.x),Math.round(n.y));o.doDrag(g,ot),it=n}vi(),ht()?r.ensureUpdateDispatched():o.endUserInput()}}else o.endUserInput()}}function tu(n,t){var e=null,o=.003*u.scrollAdjustment,r=0;this.doDrag=function(r,u,f){if(r&&u&&!i.areEqual(r,u)){var o=t.getViewportX(),e=t.getViewportY(),c=new i(r.x-o,r.y-e),h=new i(u.x-o,u.y-e),s=n.getCurrentCamera().getViewportToWorld().transform(c);n.setAlignedCamera(n.getCurrentCamera().getCrs(),s,h,n.getCurrentCamera().getWidth(),n.getCurrentCamera().getHeading(),f)}},this.doDragXY=function(t,r){var f=n.getCurrentCamera().getWidth(),u=n.getCurrentCamera().getViewportToWorld().transform(new i(t,r));n.setAlignedCamera(n.getCurrentCamera().getCrs(),u,null,f,n.getCurrentCamera().getHeading(),!0)},this.zoom=function(t){var i=n.getCurrentCamera().getWidth()*t,r=n.getCurrentCamera().getLookAt();i!==n.getTargetCamera().getWidth()&&n.setAlignedCamera(n.getCurrentCamera().getCrs(),r,null,i,n.getCurrentCamera().getHeading(),!0)},this.zoomCenter=function(t,i,r,u){var o=n.getTargetCamera(),h=o.getWidth()*t,c=o.getViewportToWorld().transform(i),e,s;u&&(e=f.widthToMercatorZoom(h,o.getCrs(),o.getLookAt()),e!=Math.floor(e)&&(s=e-o.getMercatorZoom()>0?Math.floor(e):Math.ceil(e),e=s+Math.round(e-s),h=f.mercatorZoomToWidth(e,o.getCrs(),o.getLookAt()))),n.requestCssAnimation(),n.setAlignedCamera(o.getCrs(),c,r,h,o.getHeading(),!0)},this.zoomPoint=function(t,i){var y=new Date,h=y-e,l,s,c,u,v,a;e=y,l=n.getCurrentCamera().getViewportToWorld().transform(i),s=o*t*(t>0?1:.75),h>200?(h=200,r=s/h):r=(r+s/h)/2,r=Math.min(.009,r),r=Math.max(-.006,r),c=n.getCurrentCamera().getMercatorZoom(),u=c+r*(r>0?400:250),u=s>0?Math.min(n.getInternalMaxZoom(),Math.ceil(u)):Math.max(n.getInternalMinZoom(),Math.floor(u)),v=f.mercatorZoomToWidth(u,n.getCurrentCamera().getCrs(),l),a=(u-c)/r*1.5,n.setAlignedCamera(n.getCurrentCamera().getCrs(),l,i,v,n.getCurrentCamera().getHeading(),a)},this.rotate=function(t){n.setAlignedCamera(n.getTargetCamera().getCrs(),n.getTargetCamera().getLookAt(),null,n.getTargetCamera().getWidth(),n.getTargetCamera().getHeading()+t,!0)},this.setCamera=function(t,i,r,u){var e=n.getCurrentCamera().getViewportToWorld().transform(i),f=c.log2(1/t);n.setCamera(n.getCurrentCamera().getAlignedCamera(f,e,r,u),!1)},this.startUserInput=function(){},this.endUserInput=function(){}}function lu(i){function tt(n,t,i,r,u,f){var ft,v,d,b,rt;if(r>=g){ft=ut.toEllipsoid(new y(t,i)),v=l.wrap(l.fromLocation(ft));if(a(n,v,r,u,f))return n;var st=1<<w,ot=k.mercatorXYToTileId(v,w),p=k.tileIdToCacheKey(ot),et=Math.round(c.normalizeDegrees(u)/s)*s%360,h=e.get(p)||[],tt=h.length,nt;while(tt--){nt=h[tt];if(a(nt,v,r,u,f))return nt}d="h"+et.toFixed(),h[d]||(h[d]=!0,e.insert(p,h),b=k.tileIdToLocation(ot),rt=o.replace("{centerpoint}",b.latitude.toFixed(6)+","+b.longitude.toFixed(6)).replace("{heading}",et.toFixed(0)),ui.getObjectAsync(rt,it,p))}return null}function it(t,i){var f=i.userData,r,u;i.success&&t&&t.statusCode===200&&t.resourceSets&&t.resourceSets.length&&(r=t.resourceSets[0],r.resources&&r.resources.length&&(u=e.get(f)||[],nt(r.resources[0],u),e.insert(f,u),n.invoke(h,"newsceneavailable")))}function nt(n,e){var tt;if(n.bes&&n.bes.bec&&n.bes.bei){var h=n.bes,pt=h.s.toString(),s=h.bei,o=h.bec,w=b.get(pt);if(!w){w=[];var ft=2*Math.ceil(s.piw/(2*u)),ot=2*Math.ceil(s.pih/(2*u)),et=ft*u,k=new r(o.qcx,o.qcy,o.qcz),vt=new r(o.qdx,o.qdy,o.qdz),gt=new r(o.qex,o.qey,o.qez),g=ur.toLocation(k),ni=ut.getAltitudeAtLatLon(g.latitude,g.longitude),yt=ur.fromLocation(new y(g.latitude,g.longitude,ni,kt.ellipsoid)),ti=fi.fromNormal(yt,ur.getUpVector(yt)),dt=ti.intersectWithLine(k,r.add(k,vt)),bt=r.subtract(dt,k).getLength(),lt=et/s.piw*(o.ox/(2*o.ol)),ui=2*Math.atan(lt),ri=2*bt*lt,ii=f.fromDirectionVector(ur,dt,ri,vt,gt,1/bt),nt=ii.convertCoordinateReferenceSystem(l),ht=(s.piw-d)/et,st=(s.pih-d)/et,ct=new at(-ht/2-o.opx,-st/2-o.opy,ht,st),a,p,it;p=v(t.nativeBirdseyeUriFormat.replace("{quadkey}",h.q).replace("{runtimeindex}",h.ri),ft,ot,h.l,o.opx*s.piw,o.opy*s.pih),p.projectingCamera=nt,it=nt.getAlignedCamera(c.log2(p.getWidth()/t.zoomOriginWidth)-1),a=new wt(it,p,1,"NativeBirdseye",new oi("Birdseye",i)),a.nativeBirdseyeFrustumRect=ct,a.labelOverlay=rt.hidden,w.push(a),p=v(t.nativeBirdseyeWithLabelsUriFormat.replace("{quadkey}",h.q).replace("{runtimeindex}",h.ri),ft,ot,h.l,o.opx*s.piw,o.opy*s.pih),p.projectingCamera=nt,a=new wt(it,p,1,"NativeBirdseye",new oi("BirdseyeWithLabels",i)),a.nativeBirdseyeFrustumRect=ct,a.labelOverlay=rt.visible,w.push(a)}b.insert(pt,w),tt=w.length;while(tt--)e.push(w[tt])}}function a(n,t,i,r,u){if(n&&n.nativeBirdseyeFrustumRect&&n.labelOverlay===u&&c.distanceDegrees(r,n.nativeCamera.getHeading())<s&&i>=n.nativeCamera.getMercatorZoom()-.5){var f=n.tilePyramid.projectingCamera.getWorldToFrustum().transform(t);if(n.nativeBirdseyeFrustumRect.contains(f))return!0}return!1}function v(n,t,i,r,f,e){var s=Math.ceil(t/2),h=Math.ceil(i/2),o=new dt(t*u,i*u,u,u,0,0,f,e,function(u){var e,f,c;switch(u.levelOfDetail){case o.getMaxLevelOfDetail()-1:f=s,c=h,e=r-1;break;case o.getMaxLevelOfDetail():f=t,c=i,e=r}if(e)if(u.x>=0&&u.x<f&&u.y>=0&&u.y<c)return n.replace("{subdomain}",(u.y&1)*2+(u.x&1)).replace("{level}",e).replace("{index}",f*u.y+u.x);return null});return o}var h=this,g=17.1,e=new ci(100),w=19,b=new ci(100),s=45,d=400,u=256,o=t.nativeBirdseyeMetadataUrl.replace("{zoom}","20"),p;this.priority=40,this.getScene=function(){return p||(p=!0,i(function(t){o=o.replace("{credentials}",t),h.getScene=tt,n.invoke(h,"newsceneavailable")})),null}}var s=window.Microsoft.Maps,b=s.Gimme,t=s.Globals,vr,h,a,v,u,w,si,kt,pt,rt,ei,n,sr,bi,pi,ui,ri,fr,lr,iu,tt,c,nt,l,ur,ft,k,ut,p,o,ti,et,hi,cu,gr,ou;Microsoft.Maps.Resources=new function(n){n=n||{},n.strings={},this.init=function(t){var i;for(i in t)n.strings[i]={value:t[i]}},this.getString=function(){function f(n){i.languages=[t.locale];var r="";try{r=e.getValue(n,i).valueAsString}catch(u){}return r}function u(t){return n.strings[t]&&n.strings[t].value||""}if(window.Windows&&Windows.ApplicationModel){var r=Windows.ApplicationModel.Resources.Core,e=r.ResourceManager.current.mainResourceMap.getSubtree("/Bing.Maps.Javascript/Resources"),i=new r.ResourceContext;return f}return u}()}(this),vr=s.Resources,a={},s.InternalNamespaceForDelay=a,v="mm$",typeof PRF=="undefined"&&(PRF={add:function(){},start:function(){},end:function(){}}),a.PRF=PRF,PRF.start("mapcore");var or=new function(){function f(n,t){var i=!1;return o(n)&&(e(n,t),i=!0),i}function o(n){return localStorage&&localStorage.getItem(n+".keys")&&!localStorage.getItem(n+".invalid")?!0:!1}function i(n,t){var r,i,u;if(!localStorage.getItem(n+".keys")||typeof t!="function")return;for(r=localStorage.getItem(n+".keys").split(";"),i=0,i=r.length;i>0;i--)u=r[i-1],t(u)}function e(n,t){i(n,function(i){t[i]=u(n,i)})}function h(r){localStorage.setItem(r+".invalid","true"),i(r,function(i){localStorage.removeItem(n(r,i)),localStorage.removeItem(t(r,i))}),localStorage.removeItem(r+".keys"),localStorage.removeItem(r+".invalid")}function s(n,t){var u,i;h(),u="";for(i in t)r(n,i,t[i]),u+=i+";";localStorage.setItem(n+".keys",u.substring(0,u.length-1))}function r(i,r,u){var f=typeof u;localStorage.setItem(t(i,r),f),localStorage.setItem(n(i,r),u)}function u(i,r){var f=localStorage.getItem(t(i,r)),u=localStorage.getItem(n(i,r));switch(f){case"number":return Number(u);case"boolean":return u==="true";case"string":case null:return u}}function n(n,t){return n+"."+t}function t(n,t){return n+"."+t+".type"}this.GlobalsId="globals",this.tryLoadConfigIntoObject=function(n,t){return typeof n!="string"||n===""||!t||!localStorage?!1:f(n,t)},this.writeConfig=function(n,t){if(typeof n!="string"||n===""||!t)return;localStorage&&s(n,t)}},pr=new function(){function i(){r||(r=!0,PRF.end("Module initialized",t,{module:"Map Core"}),tt.done(t))}var u=this,n=Microsoft.Maps.Globals,r=!1,t="Microsoft.Maps.Map";this.tryCachedGlobals=function(){var r=!1;return or.tryLoadConfigIntoObject(or.GlobalsId,n)&&(r=!0,ui.getObjectAsync(tt.getRegistration(t).scriptUrl,u.parse),i()),r},this.parse=function(t){var u,r;if(!t||typeof t.ishttpsenabled=="undefined")return;if(t.jsonTimeStamp&&n.jsonTimeStamp&&t.jsonTimeStamp==n.jsonTimeStamp)return;u=!n.version,t.clientVersion="7.0.20120604180051.87",t.cssPath="///Bing.Maps.JavaScript/css/",t.imagePath="///Bing.Maps.JavaScript/images/",t.jsPath="///Bing.Maps.JavaScript/js/",t.pushpinImageUrl="///Bing.Maps.JavaScript/images/poi_search.png",t.cursorPath="///Bing.Maps.JavaScript/cursors/",t.ddCoreStyles="///Bing.Maps.JavaScript/css/mapcontrol.css",t.logServiceUrl&&(t.logServiceUriFormat=t.logServiceUriFormat.replace(t.version,t.clientVersion)),t.bingThemeIconUrlFormat="///Bing.Maps.JavaScript/images/BingTheme/pins/pin_{iconStyle}{imageryStyle}{state}.png",t.protocol=t.ishttpsenabled?"https://":"http://",t.jsonTimeStamp=(new Date).valueOf();for(r in t)typeof t[r]=="string"&&(t[r]=t[r].replace(/{urischeme}/g,t.protocol).replace(/{version}/g,t.version).replace(/{culture}/g,t.locale).replace(/{generation}/g,t.tilegeneration)),u&&(n[r]=t[r]);or.writeConfig(or.GlobalsId,t),u&&(n.protocol=t.protocol,i())}},yi=new function(){var n=1e3;this.getNext=function(){return n++}};a.IdGenerator=yi;var ii=new function(){this.isValidNumber=function(n){return typeof n=="number"&&isFinite(n)},this.cloneObject=function(n){var i={},t;for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},this.createElement=function(n,t,i){var r=document.createElement(n||"div");return t&&(r.style.cssText=t),i&&i.appendChild(r),r},this.ignoreEvent=function(n){n.stopPropagation(),n.preventDefault()},this.stopPropagation=function(n){n.stopPropagation()},this.prioritySort=function(n,t){return n.priority-t.priority},this.isArray=function(n){return typeof Array.isArray=="function"?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"},this.extend=function(n,t){function i(){}i.prototype=t.prototype,n.prototype=new i,n.prototype.constructor=n,n.baseConstructor=t,n.superClass=t.prototype},this.restrictLongitude=function(n,t){while(t-n>180&&t>n)t-=360;while(n-t>180&&t<n)t+=360;return t};var n=function(){function t(n,t,i){return Object.defineProperty(n,t,i)}function n(n,t,i){return n[t]=i.get(),n}try{return Object.defineProperty({},"test",{}),t}catch(i){return n}}();this.defineGetter=n,this.defaultCopyright=n({},"text",{get:function(){return vr.getString("L_microsoftcopyright_text").replace(/{year}/,(new Date).getFullYear())}})},bt=1e-11,ai=ii.isValidNumber,dr=ii.cloneObject,g=ii.createElement,du=ii.ignoreEvent,ku=ii.stopPropagation,bu=ii.prioritySort,gi=ii.isArray,vu=ii.extend,au=ii.restrictLongitude;a.Common=ii,u=new function(){var n=navigator.userAgent,u=n.indexOf("MSIE"),o=n.indexOf("Firefox"),v=n.indexOf("Chrome"),tt=o!==-1,y=v!==-1,t=u!==-1,e=parseInt(n.substring(u+5)),nt=t&&e===6,g=t&&e===9,w=t&&e===10,ut=y&&parseInt(n.substring(v+7))>=11,b=tt&&parseInt(n.substring(o+8))>=4,rt=document.documentMode,it=n.indexOf("Gecko"),s=it!==-1,c=n.indexOf("Trident/"),h=parseInt(n.substring(c+8)),l=c>0,p=n.indexOf("BlackBerry")!==-1,f=n.indexOf("AppleWebKit")!==-1,i=navigator.vendor==="Apple Computer, Inc."&&!p,a=i&&n.indexOf("iPhone OS 3_")!==-1,k=f&&n.indexOf("Android")!==-1,d=typeof WinJS!="undefined"&&w,r;this.isWebkit=f,this.cursorHotspot=f?" 10 9":"",this.allowCssAnimations=i,this.useTransform2d=l&&h>=6&&typeof document.createElement("div").style.msTransform!="undefined",this.useTransform3d=i,this.useTransform3dForTranslate=i,this.useImageDisposer=i,this.isIOSBrowser=n.indexOf("iPhone")!==-1,this.safariRenderHack=i?"-webkit-transform:translate3d(0px,0px,0px);":"",this.isIE6=nt,this.isIE9=g,this.isIE10=w,this.useXHR=d,this.isIOS3=a,r=l&&h>=5,this.isZoomFasterThanMatrixFilter=r,this.useFilterReflowWorkaround=r,this.cssZoomAffectsTopLeft=t&&rt===8,this.animateOverlayLayers=r||ut||b||i,this.animateShapes=this.animateOverlayLayers&&!a,this.canRenderOpacityAndRotationOnSemiTransparentPngs=!(t&&!r),this.scrollAdjustment=y?1.5:1,this.useOnResize=r,this.autoSizesElementsTooSmall=s||f,this.opacityGlitchAtBrowserEdges=s,this.isIE8OrEarlier=t&&parseInt(n.substring(u+5))<9,this.isIE7OrEarlier=t&&parseInt(n.substring(u+5))<8,this.emulateDblClick=p,this.isShapeEventsSupported=function(){return typeof hi!="undefined"&&hi.isEventsSupported?hi.isEventsSupported():!0},this.allowFocus=!k},a.Quirks=u,w=new function(){function o(){r=null,n.length&&u();var i=n;n=t,t=i,t.sort(e);while(t.length)t.shift()()}function e(n,t){return n[i]-t[i]}function u(){r||(r=f(o))}var f=b.Effects.Animation.requestAnimationFrame,r,n=[],t=[],i=v+"dispatchOrder";this.dispatch=function(t,r){t[i]=r||0;var f=n.length;while(f--)if(n[f]===t)return;n.push(t),u()},this.cancelDispatch=function(i){var r;r=n.length;while(r--)n[r]===i&&n.splice(r,1);r=t.length;while(r--)t[r]===i&&t.splice(r,1)}},a.Dispatcher=w,i.prototype={clone:function(){return new i(this.x,this.y)},toString:function(){return"[Point "+this.x+","+this.y+"]"}},i.clone=function(n){return new i(n.x,n.y)},i.add=function(n,t){return new i(n.x+t.x,n.y+t.y)},i.distance=function(n,t){var r=n.x-t.x,i=n.y-t.y;return Math.sqrt(r*r+i*i)},i.subtract=function(n,t){return new i(n.x-t.x,n.y-t.y)},i.multiply=function(n,t){return new i(n.x*t,n.y*t)},i.areEqual=function(n,t){return n&&t&&n.x===t.x&&n.y===t.y},s.Point=i,si={fromTileId:function(n,t){var e=1,i;t&&(e=0);var r="",f=n.x,u=n.y;for(i=0;i<n.levelOfDetail;i++)r=((f&1)+2*(u&1)).toString()+r,f>>=1,u>>=1;return r},toTileId:function(n){var i=0,t=0,u=0,r;if(n!=null&&n.length>0)for(u=n.length,r=0;r<n.length;r++)switch(n.charAt(r)){case"0":i=i*2+0,t=t*2+0;break;case"1":i=i*2+1,t=t*2+0;break;case"2":i=i*2+0,t=t*2+1;break;case"3":i=i*2+1,t=t*2+1}return new it(u,i,t)},wrapX:function(n){var t=1<<n.levelOfDetail;return new it(n.levelOfDetail,(n.x%t+t)%t,n.y)},wrapY:function(n){var t=1<<n.levelOfDetail;return new it(n.levelOfDetail,n.x,(n.y%t+t)%t)},isInBounds:function(n){if(n.x<0||n.y<0)return!1;var t=1<<n.levelOfDetail;return n.x>=t||n.y>=t?!1:!0}},s.QuadKey=si,kt={ground:0,ellipsoid:1,isValid:function(n){return n===kt.ground||n===kt.ellipsoid}},s.AltitudeReference=kt,y.prototype={clone:function(){return new y(this.latitude,this.longitude,this.altitude,this.altitudeReference)},toString:function(){return"[Location "+this.latitude+","+this.longitude+(this.altitude!==h&&this.altitudeReference!==h?","+this.altitude+","+this.altitudeReference:"")+"]"}},y.normalizeLongitude=function(n){return n<-180||n>180?n-Math.floor((n+180)/360)*360:n},y.areEqual=function(n,t){return n&&t&&n.latitude===t.latitude&&n.longitude===t.longitude&&n.altitude===t.altitude&&n.altitudeReference===t.altitudeReference},s.Location=y,st.prototype={getNorthwest:function(){return new y(this.getNorth(),this.getWest(),this.center.altitude,this.center.altitudeReference)},getSoutheast:function(){return new y(this.getSouth(),this.getEast(),this.center.altitude,this.center.altitudeReference)},getNorth:function(){return this.center.latitude+this.height/2},getSouth:function(){return this.center.latitude-this.height/2},getWest:function(){return this.width>=360?-180:y.normalizeLongitude(this.center.longitude-this.width/2)},getEast:function(){return this.width>=360?180:y.normalizeLongitude(this.center.longitude+this.width/2)},toString:function(){return"[LocationRect "+this.center.toString()+" "+this.width+","+this.height+"]"},clone:function(){return new st(this.center.clone(),this.width,this.height)},contains:function(n){var i=Math.abs(this.center.latitude-n.latitude),t=Math.abs(this.center.longitude-n.longitude);return t>180&&(t=360-t),i<=this.height/2&&t<=this.width/2},intersects:function(n){var i=Math.abs(this.center.latitude-n.center.latitude),t=Math.abs(this.center.longitude-n.center.longitude);return t>180&&(t=360-t),i<=this.height/2+n.height/2&&t<=this.width/2+n.width/2}},st.fromEdges=function(n,t,i,r,u,f){return Math.abs(r-t)>360&&(t=-180,r=180),t=y.normalizeLongitude(t),r=y.normalizeLongitude(r),t>r&&(r+=360),new st(new y((i+n)/2,(t+r)/2,u,f),r-t,n-i)},st.fromCorners=function(n,t){return st.fromEdges(n.latitude,n.longitude,t.latitude,t.longitude,n.altitude,n.altitudeReference)},st.fromLocations=function(){var i=gi(arguments[0])?arguments[0]:arguments,e,f,r,u,s,c,t,l=i&&i.length?i[0].longitude:0,n,o=i.length;while(o--)n=i[o],isFinite(n.latitude)&&isFinite(n.longitude)&&(e=e===h?n.latitude:Math.max(e,n.latitude),f=f===h?n.latitude:Math.min(f,n.latitude),t=au(l,n.longitude),u=u===h?t:Math.max(u,t),r=r===h?t:Math.min(r,t),isFinite(n.altitude)&&kt.isValid(n.altitudeReference)&&(c=n.altitude,s=n.altitudeReference));return st.fromEdges(e,r,f,u,c,s)},st.fromString=function(n){var f=null,t=n.split(","),e,u,i,r;return t&&t.length==4&&(e=parseFloat(t[0]),u=parseFloat(t[1]),i=parseFloat(t[2]),r=parseFloat(t[3]),f=st.fromEdges(e,u,i,r)),f},s.LocationRect=st,pt={road:"r",aerial:"a",birdseye:"be"},s.MapTypeId=pt,rt={visible:0,hidden:1,isValid:function(n){return n===rt.hidden||n===rt.visible}},s.LabelOverlay=rt,ei={viewport:0,page:1,control:2,isValid:function(n){return n===ei.viewport||n===ei.page||n===ei.control}},s.PixelReference=ei,n=new function(){var t=this,n=v+"events";this.addHandler=function(t,i,r){var f=null,u;return t&&typeof i=="string"&&typeof r=="function"&&(t[n]=t[n]||{},u=t[n][i]||[],t[n][i]=u,f={target:t,eventName:i,handler:r},u.push(f)),f},this.addThrottledHandler=function(n,i,r,u){var f=t.addHandler(n,i,r);return f.throttleInterval=u,f},this.removeHandler=function(i){var e,f,r,u;if(i){e=i.target,f=i.eventName;if(t.hasHandler(e,f)){r=e[n][f],u=r.length;while(u--)i===r[u]&&(i.willBeInvokedBy&&window.clearInterval(i.willBeInvokedBy),r.splice(u,1))}}},this.hasHandler=function(t,i){return t&&t[n]&&t[n][i]&&t[n][i].length},this.invoke=function(i,r,u){var e;if(t.hasHandler(i,r)){var o=new Date,s=i[n][r],c=s.length,f;u=u||{},u.eventName===h&&(u.eventName=r);while(c--)f=s[c],f.handler&&(f.throttleInterval?f.willBeInvokedBy?f.willBeInvokedWithArgs=u:(e=f.throttleInterval-(o-(f.lastInvokedAt||new Date(0))),e>0?(f.willBeInvokedWithArgs=u,f.willBeInvokedBy=window.setTimeout(function(){var n=f;return function(){var t=n.willBeInvokedWithArgs;delete n.willBeInvokedBy,delete n.willBeInvokedWithArgs,n.lastInvokedAt=new Date,n.handler&&n.handler(t)}}(),e)):(f.lastInvokedAt=o,f.handler(u))):f.handler(u))}}},s.Events=n,a.ElementSizeHelper=eu,sr={singleByteHex:function(n){var t,i;if(!n)return"";for(t=n.toString(16),i=t.length;i<2;i++)t="0"+t;return t},twoByteHex:function(n){var t,i;if(!n)return"";for(t=n.toString(16),i=t.length;i<4;i++)t="0"+t;return t},encodeUrl:function(n){var t,u,i,r;if(!n)return"";for(u=n.length,i=new Array(u),r=0;r<u;++r)t=n.charCodeAt(r),t>96&&t<123||t>64&&t<91||t>47&&t<58||t==46||t==45||t==95?i.push(String.fromCharCode(t)):t>127?(i.push("%u"),i.push(sr.twoByteHex(t))):(i.push("%"),i.push(sr.singleByteHex(t)));return i.join("")}},a.IOSec=sr,bi=[],er.getAllInstances=function(){return bi},er.getVersion=function(){return t.version},s.Map=er,a.MapType=vi,ui=new function(){function o(i,r,u){w.dispatch(function(){i&&!r&&(r=t);if(r){var e=n[r];e&&(delete n[r],e.timeoutId&&window.clearTimeout(e.timeoutId),e.callback(i,{requestId:r,success:u===200?!0:!1,userData:e.userData,httpStatus:u}),f(e.elScript))}})}function u(t){if(t){var i=n[t];i&&(delete n[t],i.callback(null,{requestId:t,success:!1,userData:i.userData}),f(i.elScript))}}function l(n,t){function i(n,i){o(n,t,i)}Microsoft.Maps.Gimme.Ajax.request_json(n,i)}function i(n,t){l(n,t)}function c(n,t,i){var u,r;return u=s(),u?(r=document.createElement("link"),r.rel=t?"alternate stylesheet":"stylesheet",i&&(r.media=i),r.type="text/css",r.rev="stylesheet",r.href=n,u.appendChild(r),r):void 0}function s(){if(!r){var n=document.getElementsByTagName("head");n.length>0&&(r=n[0])}return r}function h(n,t,i){function r(n){t(n,i)}Microsoft.Maps.Gimme.Ajax.request_json(n,r)}function f(n){n&&(n.src&&(n.src=""),n.parentNode&&n.parentNode.removeChild(n))}var v=this,e=5e3,r,a=1,t,n={};window.microsoftMapsNetworkCallback=o,this.downloadScript=function(n){return i(n)},this.downloadStyles=function(n,t,i){c(n,t,i)},this.getObjectAsync=function(t,r,f,o,s){var h=s;return h||(h="r"+ ++a,t=t.replace("{jsono}",h)),typeof o=="number"&&o>0||(o=e),n[h]={callback:r,userData:f,elScript:i(t,h),timeoutId:window.setTimeout(function(){u(h)},o)},h},this.getObjectAsyncWithNoJsonso=function(r,f,o,s){t="_logCallbackRequest",typeof s=="number"&&s>0||(s=e),n[t]={callback:f,userData:o,elScript:i(r,t),timeoutId:window.setTimeout(function(){u(t)},s)}},this.isRequestCompleted=function(t){return n[t]?!1:!0},this.abortRequest=function(t){n[t]&&delete n[t]},this.getObjectAsyncCacheFriendly=function(n,t,i){h(n,t,i)}},a.Network=ui,ri={map:"map",pushpin:"pushpin",polyline:"polyline",polygon:"polygon",infobox:"infobox"},li.prototype={handled:!1,toString:function(){return"[MouseEventArgs]"}},a.MouseEventArgs=li,a.EventTargetType=ri,hu.prototype={handled:!1,toString:function(){return"[KeyEventArgs]"}},lt.prototype={clone:function(){return new lt(this.a,this.r,this.g,this.b)},getOpacity:function(){return isFinite(this.a)?this.a/255:1},toHex:function(){var i=this.r,t=this.g,n=this.b;return"#"+(i<16?"0":"")+Number(i).toString(16)+(t<16?"0":"")+Number(t).toString(16)+(n<16?"0":"")+Number(n).toString(16)},toString:function(){return"[Color "+this.toHex()+"]"}},lt.clone=function(n){return new lt(n.a,n.r,n.g,n.b)},lt.fromHex=function(n){var i=null,t=/^#(\w{2})(\w{2})(\w{2})$/.exec(n);return t&&t.length==4&&(i=new lt(255,parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16))),i},s.Color=lt,ki.prototype={_visible:!0,_zIndex:null,setOptions:function(t,i){var r=!1;return t&&(typeof t.visible=="boolean"&&(this._visible=t.visible,r=!0),typeof t.zIndex!="undefined"&&(this._zIndex=t.zIndex,r=!0),r&&!i&&n.invoke(this,"entitychanged",{entity:this})),r},getVisible:function(){return this._visible},getZIndex:function(){return this._zIndex},toString:function(){return"[EntityCollection]"}},s.EntityCollection=ki,fr={standard:"Infobox",mini:"MiniInfobox2",expanded:"Infobox2"},s.InfoboxType=fr,su.prototype={_width:256,_height:126,_showCloseButton:!0,_offset:new i(0,0),_htmlContent:null,_id:null,_typeName:fr.standard,_visible:!0,_zIndex:null,_options:null,_calculatedSize:null,_clip:!0,_shouldFireEvents:!0,setLocation:function(t){this._location=t,n.invoke(this,"entitychanged",{entity:this})},getLocation:function(){return this._location},setCalculatedSize:function(n){this._calculatedSize=n},measure:function(){return this._calculatedSize||{width:0,height:0}},setOptions:function(t,r){if(t){var u=!1;this._options=t,(t.width>0||t.width===null)&&(this._width=t.width,u=!0),(t.height>0||t.height===null)&&(this._height=t.height,u=!0),typeof t.showCloseButton=="boolean"&&(this._showCloseButton=t.showCloseButton,u=!0),t.offset&&(this._offset=i.clone(t.offset),u=!0),typeof t.htmlContent=="string"&&(this._htmlContent=t.htmlContent,u=!0),typeof t.id=="string"&&(this._id=t.id,u=!0),typeof t.typeName=="string"&&(this._typeName=t.typeName,u=!0),typeof t.visible=="boolean"&&(this._visible=t.visible,u=!0),isFinite(t.zIndex)&&(this._zIndex=t.zIndex,u=!0),typeof t.clip=="boolean"&&(this._clip=t.clip,u=!0),typeof t.shouldFireEvents=="boolean"&&(this._shouldFireEvents=t.shouldFireEvents,u=!0)}return u&&(r===null||!r)&&n.invoke(this,"entitychanged",{entity:this}),u},getWidth:function(){return this._width},getHeight:function(){return this._height},getShowCloseButton:function(){return this._showCloseButton},getOffset:function(){return this._offset},getOptions:function(){return this._options},getShouldFireEvents:function(){return this._shouldFireEvents},setHtmlContent:function(t){var i=this._htmlContent!=t;this._htmlContent=t,this._showPointer=!1,i&&n.invoke(this,"entitychanged",{entity:this})},getHtmlContent:function(){return this._htmlContent},getId:function(){return this._id},getTypeName:function(){return this._typeName},getVisible:function(){return this._visible},getZIndex:function(){return this._zIndex},getClip:function(){return this._clip},toString:function(){return"[InfoboxBase]"}},vu(d,su),s.Infobox=d,d.prototype._title=null,d.prototype._titleAction=null,d.prototype._description=null,d.prototype._titleClickHandler=null,d.prototype._showPointer=!0,d.prototype._actions=[],d.prototype._pushpin=null,d.prototype._polygon=null,d.prototype.setOptions=function(t,i){if(t){var r=d.superClass.setOptions.call(this,t,!1);typeof t.title=="string"&&(this._title=t.title,r=!0),typeof t.description=="string"&&(this._description=t.description,r=!0),typeof t.showPointer=="boolean"&&(this._showPointer=t.showPointer,r=!0),typeof t.actions=="object"&&(this._actions=t.actions,r=!0),typeof t.titleAction=="object"&&(this._titleAction=t.titleAction,r=!0),typeof t.titleClickHandler=="function"&&(this._titleClickHandler=t.titleClickHandler,r=!0),t.pushpin&&t.pushpin instanceof s.Pushpin&&(this._pushpin=t.pushpin,this._pushpin.getInfobox()!=this&&this._pushpin.setOptions({infobox:this}),r=!0),t.polygon&&t.polygon instanceof s.Polygon&&(this._polygon=t.polygon,this._polygon.getInfobox()!=this&&this._polygon.setOptions({infobox:this}),r=!0),(this._typeName===fr.mini||typeof this._htmlContent=="string")&&(this._showPointer=!1),r&&(i===null||!i)&&n.invoke(this,"entitychanged",{entity:this})}},d.prototype.getActions=function(){return this._actions},d.prototype.getTitle=function(){return this._title},d.prototype.getTitleAction=function(){return this._titleAction},d.prototype.getTitleClickHandler=function(){return this._titleClickHandler},d.prototype.getDescription=function(){return this._description},d.prototype.getShowPointer=function(){return this._showPointer},d.prototype.getPushpin=function(){return this._pushpin},d.prototype.getPolygon=function(){return this._polygon},d.prototype.getAnchor=function(){var n,t=this._calculatedSize&&this._calculatedSize.height||0,r;return this._showPointer?this._typeName!==fr.standard?(n=10,new i(20+n/2,t)):(n=28,r=38,new i(20+n/2,this.getHeight()+r)):t!==0?new i(0,t):new i(0,this.getHeight()||0)},d.prototype.getOptions=function(){return d.superClass.getOptions.call(this)},d.prototype.toString=function(){return"[Infobox]"},ir.prototype={_width:25,_height:39,_draggable:!1,_anchor:null,_calculatedAnchor:new i(13,39),_text:null,_textOffset:new i(0,5),_id:null,_typeName:null,_visible:!0,_zIndex:null,_useTransform3d:!0,_infobox:null,setLocation:function(t){this._location=t,n.invoke(this,"entitychanged",{entity:this})},getLocation:function(){return this._location},setOptions:function(t,r){var u=!1;return t&&(typeof t.icon=="string"&&(this._icon=t.icon,u=!0),t.width!==h&&(this._width=t.width>0?t.width:0,u=!0),t.height!==h&&(this._height=t.height>0?t.height:0,u=!0),typeof t.draggable=="boolean"&&(this._draggable=t.draggable,u=!0),t.anchor&&(this._anchor=i.clone(t.anchor),u=!0),typeof t.text=="string"&&(this._text=t.text,u=!0),t.textOffset&&(this._textOffset=i.clone(t.textOffset),u=!0),typeof t.id=="string"&&(this._id=t.id,u=!0),typeof t.typeName=="string"&&(this._typeName=t.typeName,u=!0),typeof t.visible=="boolean"&&(this._visible=t.visible,u=!0),isFinite(t.zIndex)&&(this._zIndex=t.zIndex,u=!0),t.infobox&&t.infobox instanceof d&&(this._infobox=t.infobox,this._infobox.getPushpin()!=this&&this._infobox.setOptions({pushpin:this}),u=!0),u&&!r&&(this._calculatedAnchor=this._anchor?this._anchor:new i(Math.ceil(this._width/2),this._height),n.invoke(this,"entitychanged",{entity:this}))),u},getIcon:function(){return this._icon},getWidth:function(){return this._width},getHeight:function(){return this._height},getDraggable:function(){return this._draggable},getAnchor:function(){return this._calculatedAnchor},getText:function(){return this._text},getTextOffset:function(){return this._textOffset},getId:function(){return this._id},getTypeName:function(){return this._typeName},getVisible:function(){return this._visible},getZIndex:function(){return this._zIndex},getUseTransform3d:function(){return this._useTransform3d},getInfobox:function(){return this._infobox},toString:function(){return"[Pushpin]"}},s.Pushpin=ir,nr.prototype={_strokeColor:new lt(255,255,0,0),_strokeThickness:3,_strokeDashArray:"none",_visible:!0,_id:null,_shouldFireEvents:!0,setLocations:function(t){this._locations=t,n.invoke(this,"entitychanged",{entity:this})},getLocations:function(){return this._locations},setOptions:function(t,i){var r=!1;return t&&(t.strokeColor&&(this._strokeColor=lt.clone(t.strokeColor),r=!0),isFinite(t.strokeThickness)&&(this._strokeThickness=t.strokeThickness,r=!0),typeof t.strokeDashArray=="string"&&(this._strokeDashArray=t.strokeDashArray,r=!0),typeof t.visible=="boolean"&&(this._visible=t.visible,r=!0),typeof t.id=="string"&&(this._id=t.id,r=!0),typeof t.shouldFireEvents=="boolean"&&(this._shouldFireEvents=t.shouldFireEvents,r=!0),r&&!i&&n.invoke(this,"entitychanged",{entity:this})),r},getStrokeColor:function(){return this._strokeColor},getStrokeThickness:function(){return this._strokeThickness},getStrokeDashArray:function(){return this._strokeDashArray},getVisible:function(){return this._visible},getId:function(){return this._id},getShouldFireEvents:function(){return this._shouldFireEvents},toString:function(){return"[Polyline]"}},s.Polyline=nr,tr.prototype={_strokeColor:new lt(255,255,0,0),_strokeThickness:3,_strokeDashArray:"none",_fillColor:new lt(255,0,0,255),_visible:!0,_infobox:null,_shouldFireEvents:!0,setLocations:function(t){this._locations=t,n.invoke(this,"entitychanged",{entity:this})},getLocations:function(){return this._locations},setOptions:function(t,i){var r=!1;return t&&(t.strokeColor&&(this._strokeColor=lt.clone(t.strokeColor),r=!0),isFinite(t.strokeThickness)&&(this._strokeThickness=t.strokeThickness,r=!0),typeof t.strokeDashArray=="string"&&(this._strokeDashArray=t.strokeDashArray,r=!0),t.fillColor&&(this._fillColor=lt.clone(t.fillColor),r=!0),typeof t.visible=="boolean"&&(this._visible=t.visible,r=!0),t.infobox&&t.infobox instanceof s.Infobox&&(this._infobox=t.infobox,this._infobox.getPolygon()!=this&&this._infobox.setOptions({polygon:this}),r=!0),typeof t.shouldFireEvents=="boolean"&&(this._shouldFireEvents=t.shouldFireEvents,r=!0),r&&!i&&n.invoke(this,"entitychanged",{entity:this})),r},getStrokeColor:function(){return this._strokeColor},getStrokeThickness:function(){return this._strokeThickness},getStrokeDashArray:function(){return this._strokeDashArray},getFillColor:function(){return this._fillColor},getVisible:function(){return this._visible},getInfobox:function(){return this._infobox},getShouldFireEvents:function(){return this._shouldFireEvents},toString:function(){return"[Polygon]"}},s.Polygon=tr,lr={show:"s",hide:"h",auto:"a"},hr.prototype={toString:function(){return"[TileLayer]"}},s.AnimationVisibility=lr,s.TileLayer=hr,yr.prototype={toString:function(){return"[TileSource]"}},s.TileSource=yr,s.Globals.disableGeoLocation||(iu=function(n){function w(n,i,r){if(t&&r===t&&n&&n.coords){var u=new y(n.coords.latitude,n.coords.longitude,n.coords.altitude);(!i||i&&i.showAccuracyCircle!=!1)&&f.addAccuracyCircle(u,n.coords.accuracy,a,{displayOnMap:!0}),(!i||i&&i.updateMapView!=!1)&&l(n),i&&i.successCallback&&i.successCallback({center:u,position:n})}t=0}function h(n,i,r){t&&r===t&&i.errorCallback&&i.errorCallback({internalError:n,errorCode:n.code}),t=0}function l(t){if(t)if(t.coords.accuracy<300)n.setView({center:new y(t.coords.latitude,t.coords.longitude,t.coords.altitude),zoom:16});else{var o=e(t.coords.latitude,t.coords.longitude,0,t.coords.accuracy),u=(o.latitude-t.coords.latitude)*2,i=n.getHeight(),r=n.getWidth(),f=i>r?i:r;n.setView({bounds:new st(new y(t.coords.latitude,t.coords.longitude,t.coords.altitude),u,u),padding:f/3})}}function e(n,t,u,f){var a=c,k=a.degreesToRadians(u),p=(1-r)*Math.tan(a.degreesToRadians(n)),it=Math.cos(k),et=Math.sin(k),v=1/Math.sqrt(1+p*p),rt=v*et,ht=rt*rt,tt=1-ht,ut=Math.atan2(p,Math.cos(k)),l=tt*((o*o-i*i)/(i*i)),st=1+l/16384*(4096+l*(-768+l*(320-175*l))),ft=l/1024*(256+l*(-128+l*(74-47*l))),e=f/(i*st),ct=2*Math.PI,s=Math.sin(e),nt=2*ut+e,h=Math.cos(nt),d;while(Math.abs(e-ct)>1e-12){nt=2*ut+e,h=Math.cos(nt),d=h*h,s=Math.sin(e);var wt=Math.cos(e)*(-1+2*d),pt=ft/6*h*(-3+4*s*s)*(-3+4*d),kt=ft*s*(h+ft/4*(wt-pt));ct=e,e=f/(i*st)+kt}h=Math.cos(2*ut+e),s=Math.sin(e);var w=Math.cos(e),b=p*v,ot=b*s-v*w*it,bt=Math.atan2(b*w+v*s*it,(1-r)*Math.sqrt(ht+ot*ot)),yt=Math.atan2(s*et,v*w-b*s*it),g=r/16*tt*(4+r*(4-3*tt)),vt=e+g*s*(h+g*w*(-1+2*h*h)),at=yt-(1-g)*r*rt*vt,lt=(a.degreesToRadians(t)+at+3*Math.PI)%(2*Math.PI)-Math.PI;return new y(a.radiansToDegrees(bt),a.radiansToDegrees(lt))}var u=null,a=128,p=new lt(150,0,163,239),v=new lt(25,0,163,239),t=0,s=navigator&&navigator.geolocation,f=this,o=nt.earthRadiusInMeters,i=nt.earthMinorAxisRadiusInMeters,r=nt.flatteningOfEllipsoidWGS84;this.getCurrentPosition=function(n){f.removeAccuracyCircle();if(s&&t===0)t=Math.random(),navigator.geolocation.getCurrentPosition(function(i){w(i,n,t)},function(i){h(i,n,t)},n);else if(n&&n.errorCallback){var i=s?4:5;n.errorCallback({internalError:null,errorCode:i})}},this.cancelCurrentRequest=function(){t=0},this.addAccuracyCircle=function(t,i,r,o){var c=null,s,d,l,w,a;if(t&&r&&i&&t instanceof y&&ai(r)&&ai(i)){var h=[],b=t.latitude,k=t.longitude;for(s=0;s<r;s++)d=s/r*360,l=e(b,k,d,i),h.push(l);w=e(b,k,0,i),h.push(w),a=o.polygonOptions||{fillColor:v,strokeColor:p},c=new tr(h,a),o&&o.displayOnMap!=!1&&(f.removeAccuracyCircle(),u=c,n.entities.push(u))}return c},this.removeAccuracyCircle=function(){u&&(n.entities.remove(u),u=null)}},s.GeoLocationProvider=iu),a.DelayMap=fu,tt=new function(){function i(i,r){var u=n[i],o,i,h,e,f;if(u){o=u.downloadScript,u.downloadScript=!1;if(u.loaded)t(i,r);else{r&&u.queue.push(r);if(o&&u.loadOverrideCallback(i)!==!0){s.InternalNamespaceForDelay=a;for(i in r)typeof r[i]=="string"&&(h=new RegExp(i+"=[^&]+"),u.scriptUrl=u.scriptUrl.replace(h,i+"="+r[i]));for(u.jsonDownloadCallback?ui.getObjectAsync(u.scriptUrl,u.jsonDownloadCallback):ui.downloadScript(u.scriptUrl),e=u.styleUrls,f=0;f<e.length;f++)e[f]&&ui.downloadStyles(e[f])}}}}function t(n,t){typeof t.callback=="function"?t.callback(n):t.obj&&t.obj[t.name].apply(t.obj,t.args)}var n={};this.register=function(t,i,r){var u=r?r:{};n[t]={key:t,downloadScript:!0,loaded:!1,queue:[],scriptUrl:i,styleUrls:u.styleUrls?u.styleUrls:[],jsonDownloadCallback:typeof u.jsonDownloadCallback=="function"?u.jsonDownloadCallback:null,loadOverrideCallback:typeof u.loadOverrideCallback=="function"?u.loadOverrideCallback:function(){return!1}}},this.add=function(n,t,r,u){i(n,t?{obj:t,name:r,args:u}:null)},this.load=function(n,t){PRF.start(n),i(n,t||{})},this.getRegistration=function(t){return n[t]},this.done=function(i){var f=n[i],e,r,h,u,o;if(f){for(f.loaded=!0,e=f.queue,r=0;r<e.length;r++)h=e[r],t(i,h);u=0;for(o in n)n.hasOwnProperty(o)&&++u;u===0&&delete s.InternalNamespaceForDelay}}},s.loadModule=tt.load,s.registerModule=tt.register,s.moduleLoaded=tt.done,a.Dynamic=tt,s.Globals.disableDirections===!1&&tt.register("Microsoft.Maps.Directions",t.ddDirectionsJs,{styleUrls:[t.ddDirectionsCss]}),s.Globals.disableStreetside===!1&&tt.register("Microsoft.Maps.Streetside",t.ddStreetsideControl,{styleUrls:[t.ddStreetsideStyles]}),s.Globals.disableVenueMaps===!1&&tt.register("Microsoft.Maps.VenueMaps",t.ddVenueMaps,{styleUrls:[t.venueMapsCss]}),s.Globals.disableMicroPOI===!1&&tt.register("Microsoft.Maps.MicroPOI",t.ddMicroPOI,{styleUrls:[t.ddMicroPOICss]}),s.Globals.disableAnalytics===!1&&tt.register("Microsoft.Maps.Analytics",t.ddAnalyticsJs),s.Globals.disableSearch===!1&&tt.register("Microsoft.Maps.Search",t.ddSearchJs,{styleUrls:[t.ddSearchCss]});if(s.Globals.jsonTimeStamp){var uu="en-us",ru="US",cr="http://ecn.dev.virtualearth.net/mapcontrol/mapconfiguration.ashx?name=wwa&v=7.0wwa&mkt={mkt}&region={rgn}";u.useXHR&&(uu=Windows.ApplicationModel.Resources.Core.ResourceManager.current.defaultContext.languages[0],ru=Windows.System.UserProfile.GlobalizationPreferences.homeGeographicRegion),cr=cr.replace("{mkt}",uu).replace("{rgn}",ru),tt.register("Microsoft.Maps.Map",cr,{jsonDownloadCallback:pr.parse,loadOverrideCallback:pr.tryCachedGlobals})}tt.register("Microsoft.Maps.Traffic",t.ddTraffic),tt.register("Microsoft.Maps.Overlays.Style",t.ddOverlaysStyleV2Js,{styleUrls:[t.ddOverlaysStyleV2Css],version:"v2"}),tt.register("Microsoft.Maps.Themes.BingTheme",t.ddBingThemeJs,{styleUrls:[t.ddBingThemeCss]}),tt.register("Microsoft.Maps.AdvancedShapes",t.ddAdvancedShapes),c={LOGE2:Math.log(2),ILOGE2:1/Math.log(2),degreesPerRadian:180/Math.PI,radiansPerDegree:Math.PI/180,log2:function(n){return Math.log(n)/c.LOGE2},ceilLog2:function(n){return Math.ceil(Math.log(n)*c.ILOGE2)},lerpDouble:function(n,t,i){return n+i*(t-n)},normalizeDegrees:function(n){return(n%360+360)%360},distanceDegrees:function(n,t){var i=c.normalizeDegrees(n-t);return Math.min(i,360-i)},lerpAngle:function(n,t,i){var r=c.normalizeDegrees(n-t);return r>180&&(r=r-360),t+(1-i)*r},degreesToRadians:function(n){return n*c.radiansPerDegree},radiansToDegrees:function(n){return n*c.degreesPerRadian}},a.VectorMath=c,r.prototype={normalize:function(){var t=this.getLength(),n;return t===0?point:(n=1/t,new r(this.x*n,this.y*n,this.z*n))},isZero:function(){return this.x===0&&this.y===0&&this.z===0},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},toPoint:function(){return new i(this.x,this.y)},clone:function(){return new r(this.x,this.y,this.z)},toString:function(){return"[Point3D "+this.x+","+this.y+","+this.z+"]"}},r.add=function(n,t){return new r(n.x+t.x,n.y+t.y,n.z+t.z)},r.subtract=function(n,t){return new r(n.x-t.x,n.y-t.y,n.z-t.z)},r.multiply=function(n,t){return new r(t*n.x,t*n.y,t*n.z)},r.dot=function(n,t){return n.x*t.x+n.y*t.y+n.z*t.z},r.cross=function(n,t){return new r(n.y*t.z-n.z*t.y,n.z*t.x-n.x*t.z,n.x*t.y-n.y*t.x)},r.distanceSquared=function(n,t){var u=n.x-t.x,r=n.y-t.y,i=n.z-t.z;return u*u+r*r+i*i},r.lerp=function(n,t,i){return new r(n.x+(t.x-n.x)*i,n.y+(t.y-n.y)*i,n.z+(t.z-n.z)*i)},r.areEqual=function(n,t){return n&&t&&n.x===t.x&&n.y===t.y&&n.z===t.z},r.areAlmostEqual=function(n,t){return n&&t&&Math.abs(n.x-t.x)<bt&&Math.abs(n.y-t.y)<bt&&Math.abs(n.z-t.z)<bt},a.Point3D=r,ct.prototype={clone:function(){return new ct(this.width,this.height)},toString:function(){return"[Size "+this.width+","+this.height+"]"}},ct.clone=function(n){return new ct(n.width,n.height)},ct.areEqual=function(n,t){return n&&t&&n.width===t.width&&n.height===t.height},a.Size=ct,at.prototype={getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenter:function(){return new i(this.x+this.width/2,this.y+this.height/2)},contains:function(n){return n.x>=this.x&&n.y>=this.y&&n.x<=this.getRight()&&n.y<=this.getBottom()},clone:function(){return new at(this.x,this.y,this.width,this.height)},toString:function(){return"[Rect "+this.x+","+this.y+" "+this.width+","+this.height+"]"}},at.union=function(){var u=gi(arguments[0])?arguments[0]:arguments,t=u[0],r=t.x,i=t.y,e=t.x+(t.width?t.width:0),f=t.y+(t.height?t.height:0),o=u.length,n;while(o--)n=u[o],r=Math.min(r,n.x),i=Math.min(i,n.y),e=Math.max(e,n.x+(n.width?n.width:0)),f=Math.max(f,n.y+(n.height?n.height:0));return new at(r,i,e-r,f-i)},at.intersect=function(n,t){return!(n.getRight()<t.x||t.getRight()<n.x||n.getBottom()<t.y||t.getBottom()<n.y)},at.areEqual=function(n,t){return},a.Rect=at,vt.prototype={transform:function(n){return new i(n.x*this.m11+n.y*this.m21+this.offsetX,n.x*this.m12+n.y*this.m22+this.offsetY)},invert:function(){var n=this.m11*this.m22-this.m12*this.m21;if(n===0)throw"matrix cannot be inverted";return new vt(this.m22/n,-1*this.m12/n,-1*this.m21/n,this.m11/n,(this.offsetY*this.m21-this.offsetX*this.m22)/n,(this.offsetX*this.m12-this.offsetY*this.m11)/n)},clone:function(){return new vt(this.m11,this.m12,this.m21,this.m22,this.offsetX,this.offsetY)},toString:function(){return"[Matrix "+this.m11+", "+this.m12+", "+this.m21+", "+this.m22+", "+this.offsetX+", "+this.offsetY+"]"}},vt.multiply=function(n,t){return new vt(n.m11*t.m11+n.m12*t.m21,n.m11*t.m12+n.m12*t.m22,n.m21*t.m11+n.m22*t.m21,n.m21*t.m12+n.m22*t.m22,n.offsetX*t.m11+n.offsetY*t.m21+t.offsetX,n.offsetX*t.m12+n.offsetY*t.m22+t.offsetY)},vt.unitToPoints=function(n,t,i){return new vt(t.x-n.x,t.y-n.y,i.x-n.x,i.y-n.y,n.x,n.y)},vt.conversion=function(n,t,i,r,u,f){var o=vt.unitToPoints(n,t,i).invert(),e=vt.unitToPoints(r,u,f);return vt.multiply(o,e)},a.Matrix=vt,e.prototype={multiplyBy:function(n){var l=this.m11,a=this.m12,h=this.m13,c=this.m14,p=this.m21,w=this.m22,v=this.m23,y=this.m24,r=this.m31,u=this.m32,t=this.m33,i=this.m34,o=this.offsetX,s=this.offsetY,f=this.offsetZ,e=this.m44;this.m11=l*n.m11+a*n.m21+h*n.m31+c*n.offsetX,this.m12=l*n.m12+a*n.m22+h*n.m32+c*n.offsetY,this.m13=l*n.m13+a*n.m23+h*n.m33+c*n.offsetZ,this.m14=l*n.m14+a*n.m24+h*n.m34+c*n.m44,this.m21=p*n.m11+w*n.m21+v*n.m31+y*n.offsetX,this.m22=p*n.m12+w*n.m22+v*n.m32+y*n.offsetY,this.m23=p*n.m13+w*n.m23+v*n.m33+y*n.offsetZ,this.m24=p*n.m14+w*n.m24+v*n.m34+y*n.m44,this.m31=r*n.m11+u*n.m21+t*n.m31+i*n.offsetX,this.m32=r*n.m12+u*n.m22+t*n.m32+i*n.offsetY,this.m33=r*n.m13+u*n.m23+t*n.m33+i*n.offsetZ,this.m34=r*n.m14+u*n.m24+t*n.m34+i*n.m44,this.offsetX=o*n.m11+s*n.m21+f*n.m31+e*n.offsetX,this.offsetY=o*n.m12+s*n.m22+f*n.m32+e*n.offsetY,this.offsetZ=o*n.m13+s*n.m23+f*n.m33+e*n.offsetZ,this.m44=o*n.m14+s*n.m24+f*n.m34+e*n.m44},transform:function(n,t){var u=n.x*this.m11+n.y*this.m21+this.offsetX,e=n.x*this.m12+n.y*this.m22+this.offsetY,f=n.x*this.m13+n.y*this.m23+this.offsetZ,i;return n.z&&(u+=n.z*this.m31,e+=n.z*this.m32,f+=n.z*this.m33),(this.m14!==0||this.m24!==0||this.m34!==0||this.m44!==1)&&(i=n.x*this.m14+n.y*this.m24+(n.z?n.z:0)*this.m34+this.m44,t&&(i=Math.max(t,i)),u/=i,e/=i,f/=i),new r(u,e,f)},invert:function(){var c=this.m11,p=this.m12,w=this.m13,v=this.m14,h=this.m21,a=this.m22,b=this.m23,y=this.m24,l=this.m31,g=this.m32,d=this.m33,k=this.m34,s=this.offsetX,it=this.offsetY,tt=this.offsetZ,nt=this.m44,r=w*y-b*v,i=w*k-d*v,t=w*nt-tt*v,o=b*k-d*y,f=b*nt-tt*y,u=d*nt-tt*k,et=a*i-g*r-p*o,ut=p*f-a*t+it*r,ot=g*t-it*i-p*u,ft=a*u-g*f+it*o,rt=s*et+l*ut+h*ot+c*ft;if(rt===0||!isFinite(rt))throw"InvalidOperation: Matrix3D.invert";var wt=c*o-h*i+l*r,lt=h*t-s*r-c*f,pt=c*u-l*t+s*i,yt=l*f-s*o-h*u;r=c*a-h*p,i=c*g-l*p,t=c*it-s*p,o=h*g-l*a,f=h*it-s*a,u=l*it-s*g;var dt=w*o-b*i+d*r,kt=b*t-tt*r-w*f,bt=w*u-d*t+tt*i,ct=d*f-tt*o-b*u,ht=y*i-k*r-v*o,st=v*f-y*t+nt*r,vt=k*t-nt*i-v*u,at=y*u-k*f+nt*o,n=1/rt;return new e(ft*n,ot*n,ut*n,et*n,yt*n,pt*n,lt*n,wt*n,at*n,vt*n,st*n,ht*n,ct*n,bt*n,kt*n,dt*n)},projectOnPlane:function(n){var t=this,o=n.a*t.m11+n.b*t.m12+n.c*t.m13-n.d*t.m14,f=n.a*t.m21+n.b*t.m22+n.c*t.m23-n.d*t.m24,r=n.a*t.m31+n.b*t.m32+n.c*t.m33-n.d*t.m34,s=n.a*t.offsetX+n.b*t.offsetY+n.c*t.offsetZ-n.d*t.m44,i,u;if(r===0)throw"InvalidOperation: Matrix3D.projectOnPlane";return i=-1/r,u=new e(1,0,o*i,0,0,1,f*i,0,0,0,1,0,0,0,s*i,1),e.multiply(u,this)},clone:function(){return new e(this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.offsetX,this.offsetY,this.offsetZ,this.m44)},toString:function(){return"[Matrix3D "+this.m11+","+this.m12+","+this.m13+","+this.m14+", "+this.m21+","+this.m22+","+this.m23+","+this.m24+", "+this.m31+","+this.m32+","+this.m33+","+this.m34+", "+this.offsetX+","+this.offsetY+","+this.offsetZ+","+this.m44+"]"}},e.multiply=function(){for(var u=arguments.length,r=arguments[0].clone(),i=1;i<u;i++)r.multiplyBy(arguments[i]);return r},e.identity=function(){return new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.translation=function(n){var t=arguments.length==3;return new e(1,0,0,0,0,1,0,0,0,0,1,0,t?arguments[0]:n.x,t?arguments[1]:n.y,t?arguments[2]:n.z,1)},e.scaling=function(n,t,i){var r=new e(n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1);return arguments.length==3&&(r.m22=t,r.m33=i),r},e.rotationX=function(n){var r=n*c.radiansPerDegree,i=Math.sin(r),t=Math.cos(r);return new e(1,0,0,0,0,t,i,0,0,-i,t,0,0,0,0,1)},e.rotationY=function(n){var r=n*c.radiansPerDegree,i=Math.sin(r),t=Math.cos(r);return new e(t,0,-i,0,0,1,0,0,i,0,t,0,0,0,0,1)},e.rotationZ=function(n){var r=n*c.radiansPerDegree,i=Math.sin(r),t=Math.cos(r);return new e(t,i,0,0,-i,t,0,0,0,0,1,0,0,0,0,1)},a.Matrix3D=e,fi.prototype={intersectWithLine:function(n,t){var i=r.subtract(t,n),f=this.d-this.a*n.x-this.b*n.y-this.c*n.z,u=this.a*i.x+this.b*i.y+this.c*i.z;if(u===0)throw"InvalidOperation: Plane3D.intersectWithLine";return r.add(n,r.multiply(i,f/u))},clone:function(){return new fi(this.a,this.b,this.c,this.d)},toString:function(){return"[Plane3D]"}},fi.fromPoints=function(n,t,i){var f=r.subtract(i,t),e=r.subtract(t,n),u=r.cross(f,e);return u=u.normalize(),fi.fromNormal(n,u)},fi.fromNormal=function(n,t){return new fi(t.x,t.y,t.z,r.dot(t,n))},fi.areEqual=function(n,t){return n.a===t.a&&n.b===t.b&&n.c===t.c&&n.d===t.d},a.Plane3D=fi,gt.prototype={dot:function(n){return this.x*n.x+this.y*n.y},perp:function(){return new gt(this.y,-this.x)},normalize:function(){var t,n;return t=this.length(),t<MathHelper.zeroTolerance?new gt(0,0):(n=1/t,new gt(this.x*n,this.y*n))},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},add:function(n){return new gt(this.x+n.x,this.y+n.y)},subtract:function(n){return new gt(this.x-n.x,this.y-n.y)},multiplyScalar:function(n){return new gt(this.x*n,this.y*n)},equals:function(n){return this.x===n.x&&this.y===n.y},toString:function(){return"["+this.x+", "+this.y+"]"}},a.Vector2=gt,nt={earthRadiusInMeters:6378137,earthCircumferenceInMeters:12756274*Math.PI,northUpHeading:0,eastUpHeading:90,southUpHeading:180,westUpHeading:270,enhancedBirdseyePitch:-c.degreesPerRadian*Math.asin(180/256),earthMinorAxisRadiusInMeters:6356752.3142,flatteningOfEllipsoidWGS84:1/298.2572235631,snapToCardinalHeading:function(n){var t=Math.round(n/90);return t=(t%4+4)%4,t*90},locationRectToMercatorZoom:function(n,i){var f=i.width/360,u=Math.abs(l.latitudeToY(i.getNorth())-l.latitudeToY(i.getSouth())),r=Math.min(n.width/(t.zoomOriginWidth*f),n.height/(t.zoomOriginWidth*u));return c.log2(r)},getMercatorCenter:function(n){var t=n.center;return new y(l.yToLatitude((l.latitudeToY(n.getNorth())+l.latitudeToY(n.getSouth()))/2),t.longitude,t.altitude,t.altitudeReference)},getMercatorFootprint:function(n,t){var f=t.width/2,u=t.height/2,r=[new i(-f,-u),new i(f,-u),new i(f,u),new i(-f,u)],h=n.getViewportToWorld(),s=n.getCrs(),e,o=r.length;while(o--)e=h.transform(r[o]),r[o]=s===l?e:l.fromLocation(s.toLocation(e));return r}},a.MapMath=nt,l={latitudeLimit:85.051128,invFourPi:1/(4*Math.PI),unitsPerMeterAtEquator:1/nt.earthCircumferenceInMeters,toLocation:function(n){var t=l.yToLatitude(n.y);return new y(t,(n.x-.5)*360,n.z?l.unitsToMetersAtLatitude(t,n.z):0,kt.ellipsoid)},fromLocation:function(n){return new r(n.longitude/360+.5,l.latitudeToY(n.latitude),l.metersToUnitsAtLatitude(n.latitude,n.altitude))},wrap:function(n,t){var i=n.x,u=t?t.x:.5;return new r(i<u-.5||i>u+.5?i-Math.floor(i-u+.5):i,n.y,n.z)},getUpVector:function(){return new r(0,0,1)},getNadirMatrix:function(n){return new e(1,0,0,0,0,1,0,0,0,0,-1,0,-n.x,-n.y,n.z,1)},unitsToMeters:function(n,t){var i=l.yToLatitude(n.y);return l.unitsToMetersAtLatitude(i,t)},metersToUnits:function(n,t){var i=l.yToLatitude(n.y);return l.metersToUnitsAtLatitude(i,t)},changeAltitude:function(n,t){var u=l.yToLatitude(n.y),i=l.metersToUnitsAtLatitude(u,t);return new r(n.x,n.y,i)},unitsToMetersAtLatitude:function(n,t){return t===0?0:t*Math.cos(n*c.radiansPerDegree)/l.unitsPerMeterAtEquator},metersToUnitsAtLatitude:function(n,t){return t===0?0:t*l.unitsPerMeterAtEquator/Math.cos(n*c.radiansPerDegree)},yToLatitude:function(n){return 90-2*Math.atan(Math.exp((n*2-1)*Math.PI))*c.degreesPerRadian},latitudeToY:function(n){if(n>=l.latitudeLimit)return 0;if(n<=-l.latitudeLimit)return 1;var t=Math.sin(n*c.radiansPerDegree);return.5-Math.log((1+t)/(1-t))*this.invFourPi}},a.MercatorCube=l,ur=new function(){var t=1/298.257222101,i=t*(2-t),f=1/(1-i),n=nt.earthRadiusInMeters,u=new r(0,0,-n);this.toLocation=function(r){var w=r.x,p=r.y,o=r.z,b,d,e,v,a,s,l=Math.sqrt(w*w+p*p),f=o,u,h,k;d=Math.atan2(p,w),u=l*(1-t),h=1/Math.sqrt(f*f+u*u),b=Math.atan2(f,u),v=f*h,a=u*h,s=n,e=l>1?l/a-s:o>0?o-n*(1-t):-o-n*(1-t),k=3;while(k--)u=l*(1-i*s/(s+e)),h=1/Math.sqrt(f*f+u*u),b=Math.atan2(f,u),v=f*h,a=u*h,s=n/Math.sqrt(1-i*v*v),e=l>1?l/a-s:o>0?o-n*(1-t):-o-n*(1-t);return new y(b*c.degreesPerRadian,d*c.degreesPerRadian,e,kt.ellipsoid)},this.fromLocation=function(t){var o=t.latitude*c.radiansPerDegree,h=t.longitude*c.radiansPerDegree,e=t.altitude,u=Math.sin(o),s=Math.cos(o),l=Math.sin(h),a=Math.cos(h),f=n/Math.sqrt(1-i*u*u);return new r((f+e)*s*a,(f+e)*s*l,(f*(1-i)+e)*u)},this.wrap=function(){return wrap.clone()},this.getUpVector=function(n){return new r(n.x,n.y,n.z*f).normalize()},this.getNadirMatrix=function(n){var t,f=this.getUpVector(n),o=r.multiply(f,-1),s=r.cross(f,r.subtract(u,n)),i;return t=s.isZero()?new r(1,0,0):r.cross(s,f).normalize(),i=r.cross(f,t),e.multiply(e.translation(-n.x,-n.y,-n.z),new e(i.x,t.x,o.x,0,i.y,t.y,o.y,0,i.z,t.z,o.z,0,0,0,0,1))},this.unitsToMeters=function(n,t){return t},this.metersToUnits=function(n,t){return t},this.changeAltitude=function(n,t){var i=self.toLocation(n);return i.altitude=t,self.fromLocation(i)}},it.prototype={getParent:function(){return new it(this.levelOfDetail-1,Math.floor(this.x/2),Math.floor(this.y/2))},clone:function(){return new it(this.levelOfDetail,this.x,this.y)},getSibling:function(n,t){var r=1<<this.levelOfDetail,u=this.x+n,i;return u<0?u+=r:u<r||(u-=r),i=this.y+t,i<0?i=0:i<r||(i=r-1),new it(this.levelOfDetail,u,i)},toString:function(){return"[TileId "+this.levelOfDetail+" "+this.x+","+this.y+"]"}},it.areEqual=function(n,t){return n&&t&&n.levelOfDetail===t.levelOfDetail&&n.x===t.x&&n.y===t.y},a.TileId=it,f.prototype={convertCoordinateReferenceSystem:function(n){if(n!==this.getCrs()){var t=n.fromLocation(this.getCrs().toLocation(this.getLookAt()));return new f(n,t,n.metersToUnits(t,this.getCrs().unitsToMeters(this.getLookAt(),this.getWidth())),this.getHeading(),this.getPitch(),this.getRoll(),this.getDistanceInverse()<bt?0:1/n.metersToUnits(t,this.getCrs().unitsToMeters(this.getLookAt(),1/this.getDistanceInverse())),h,h,this.getZoomOriginWidth())}return this.clone()},clone:function(){return new f(this.getCrs(),this.getLookAt().clone(),this.getWidth(),this.getHeading(),this.getPitch(),this.getRoll(),this.getDistanceInverse(),this.getZoomDelta(),this.getPerspectiveOrigin().clone(),this.getZoomOriginWidth())},toString:function(){return"[MapCamera]"}},f.smallWidthRatioDiff=.1,f.smallAngle=1,f.smallPixelDistance=2,f.simpleGround=new fi(0,0,1,0),f.simpleWorldToFrustumNoZ=e.identity(),f.fromDirectionVector=function(n,t,i,u,o,s){var y,a;var p=n.getNadirMatrix(t),l=p.transform(r.add(t,u)).normalize(),h=0;(l.x!==0||l.y!==0)&&(directionXY=new r(l.x,l.y,0).normalize(),h=Math.acos(r.dot(directionXY,new r(0,-1,0)))*c.degreesPerRadian,directionXY.x<0&&(h=360-h));var w=(Math.PI/2-Math.acos(r.dot(l,new r(0,0,-1))))*c.degreesPerRadian,a=0,b=e.multiply(p,e.rotationZ(-h),e.rotationX(-(w+90))),v=b.transform(r.add(t,o));return(v.x!=0||v.y!=0)&&(y=new r(v.x,v.y,0).normalize(),a=Math.acos(r.dot(y,new r(0,-1,0)))*c.degreesPerRadian,y.x<0&&(a=360-a)),new f(n,t,i,h,w,a,s)},f.mercatorZoomToWidth=function(n,t,i){var r=1/Math.pow(2,n);return t===l?r:t.metersToUnits(i,l.unitsToMeters(l.fromLocation(t.toLocation(i)),r))},f.widthToMercatorZoom=function(n,t,i){var r=t===l?n:l.metersToUnits(l.fromLocation(t.ToLocation(i)),t.unitsToMeters(i,n));return c.log2(1/r)},f.snapSmallDifferences=function(n,i){n.getCrs()!==i.getCrs()&&(n=i.convertCoordinateReferenceSystem(i.getCrs()));var s=Math.max(n.getWidth(),i.getWidth())/t.zoomOriginWidth,e=s*f.smallPixelDistance,u=e*e,o=new f(n.getCrs(),r.distanceSquared(i.getLookAt(),n.getLookAt())>u?n.getLookAt():i.getLookAt(),Math.abs(i.getWidth()/n.getWidth()-1)>f.smallWidthRatioDiff?n.getWidth():i.getWidth(),Math.abs(n.getHeading()-i.getHeading())>f.smallAngle?n.getHeading():i.getHeading(),Math.abs(n.getPitch()-i.getPitch())>f.smallAngle?n.getPitch():i.getPitch(),Math.abs(n.getRoll()-i.getRoll())>f.smallAngle?n.getRoll():i.getRoll(),Math.abs(n.getDistanceInverse()-i.getDistanceInverse())>bt?n.getDistanceInverse():i.getDistanceInverse(),Math.abs(n.getZoomDelta()-i.getZoomDelta())>f.smallWidthRatioDiff?n.getZoomDelta():i.getZoomDelta(),r.distanceSquared(i.getPerspectiveOrigin(),n.getPerspectiveOrigin())>u?n.getPerspectiveOrigin():i.getPerspectiveOrigin(),n.getZoomOriginWidth());return f.areEqual(o,n)?n:o},f.lerp=function(n,t,i){var u=i,e=t.getWidth()/n.getWidth();return Math.abs(e-1)>f.smallWidthRatioDiff&&(u=(Math.pow(e,i)-1)/(e-1)),new f(t.getCrs(),r.lerp(n.getLookAt(),t.getLookAt(),u),c.lerpDouble(n.getWidth(),t.getWidth(),u),c.lerpAngle(n.getHeading(),t.getHeading(),i),c.lerpAngle(n.getPitch(),t.getPitch(),i),c.lerpAngle(n.getRoll(),t.getRoll(),i),c.lerpDouble(n.getDistanceInverse(),t.getDistanceInverse(),i),c.lerpDouble(n.getZoomDelta(),t.getZoomDelta(),i),r.lerp(n.getPerspectiveOrigin(),t.getPerspectiveOrigin(),u),n.getZoomOriginWidth())},f.areAligned=function(n,t){return n&&t&&n.getWidth()===t.getWidth()&&n.getHeading()===t.getHeading()&&n.getPitch()===t.getPitch()&&n.getRoll()===t.getRoll()&&n.getDistanceInverse()===t.getDistanceInverse()},f.areEqual=function(n,t){return n&&t&&(n===t||r.areEqual(n.getLookAt(),t.getLookAt())&&n.getWidth()===t.getWidth()&&n.getHeading()===t.getHeading()&&n.getPitch()===t.getPitch()&&n.getRoll()===t.getRoll()&&n.getDistanceInverse()===t.getDistanceInverse()&&n.getZoomDelta()===t.getZoomDelta()&&r.areEqual(n.getPerspectiveOrigin(),t.getPerspectiveOrigin()))},a.MapCamera=f,ft={mercator:new f(l,new r(.5,.5,0),1),enhancedBirdseyeNorthUp:new f(l,new r(.5,.5,0),1,nt.northUpHeading,nt.enhancedBirdseyePitch),enhancedBirdseyeEastUp:new f(l,new r(.5,.5,0),1,nt.eastUpHeading,nt.enhancedBirdseyePitch),enhancedBirdseyeSouthUp:new f(l,new r(.5,.5,0),1,nt.southUpHeading,nt.enhancedBirdseyePitch),enhancedBirdseyeWestUp:new f(l,new r(.5,.5,0),1,nt.westUpHeading,nt.enhancedBirdseyePitch)},a.StandardMapCameras=ft,a.MemoryCache=ci,k={tileIdToCacheKey:function(n){return n.levelOfDetail+"~"+n.x+"~"+n.y},latLonToMercatorXY:function(n,t){var r=t/360+.5;return r-=Math.floor(r),new i(r,l.latitudeToY(n))},mercatorXYToTileId:function(n,t){var i=1<<t;return new it(t,Math.floor(n.x*i),Math.floor(n.y*i))},mercatorXYToCacheKey:function(n,t){return k.tileIdToCacheKey(k.mercatorXYToTileId(n,t))},latLonToTileId:function(n,t,i){var r=k.latLonToMercatorXY(n,t);return k.mercatorXYToTileId(r,i)},latLonToCacheKey:function(n,t,i){return k.tileIdToCacheKey(k.latLonToTileId(n,t,i))},tileIdToMercatorXY:function(n){var t=1<<n.levelOfDetail;return new i((n.x+.5)/t,(n.y+.5)/t)},tileIdToLocation:function(n){var t=k.tileIdToMercatorXY(n);return l.toLocation(t)},normalizeMercatorBounds:function(n){n.width<1?n.x-=Math.floor(n.x):(n.x=0,n.width=1);var t=Math.min(n.getBottom(),1);n.y=Math.max(n.y,0),n.height=t-n.y}},a.SpatialCache=k,ut=new function(){function o(){var o,u,y;if(f.length&&a<1&&d){var c=f.shift(),t=c.topLeft,i=c.bottomRight,l=!0,g=t.x,b=i.x,tt=t.y,nt=i.y,r=new it(t.levelOfDetail,0,0);for(o=tt;o<=nt;o++){for(u=g;u<=b;u++){r.x=u,r.y=o,r=si.wrapX(r);if(e.get(k.tileIdToCacheKey(r))===h){l=!1;break}}if(!l)break}if(l)n.invoke(c.requestHandle,"downloaded",{cacheHit:!0});else{y=1<<t.levelOfDetail,t.x-=s,t.y=Math.max(0,t.y-s),i.x+=s,i.y=Math.min(y-1,i.y+s);var p=k.tileIdToLocation(t),v=k.tileIdToLocation(i),w=d.replace("{north}",p.latitude.toFixed(6)).replace("{west}",p.longitude.toFixed(6)).replace("{south}",v.latitude.toFixed(6)).replace("{east}",v.longitude.toFixed(6)).replace("{cols}",i.x-t.x+1).replace("{rows}",i.y-t.y+1);a++,ui.getObjectAsync(w,ot,{topLeft:t,bottomRight:i,requestHandle:c.requestHandle})}}}function ot(t,i){var s,f;if(i.success){var h=i.userData.topLeft,p=i.userData.bottomRight,d=h.x,b=p.x,w=h.y,y=p.y,c=t.alt;if(c&&c.length===(y-w+1)*(b-d+1)){var u=new it(h.levelOfDetail,0,0),r,nt,g=0,v=0;for(s=w;s<=y;s++)for(f=d;f<=b;f++){v+=c[g++],u.x=f,u.y=s,u=si.wrapX(u),r=u;while(r.levelOfDetail>=h.levelOfDetail-ut){if(e.insert(k.tileIdToCacheKey(r),v))break;r=r.getParent()}}l++,n.invoke(i.userData.requestHandle,"downloaded",{cacheHit:!1})}}a--,o()}function rt(n){return Math.floor(Math.min(n+b,ft))}var u=this,d,st=64,b=c.log2(t.zoomOriginWidth/st),p=10+b,ft=20+b,ut=6,e=new ci(5e3),f=[],a=0,l=0,s=4,et=3,ht=new r(0,0,1),g=v+"ellipsoid",tt;this.authenticate=function(n){tt||(tt=!0,n(function(n){n&&(d=t.elevationServiceUrl.replace("{credentials}",n),o())}))},this.getAltitudeAtLatLon=function(n,t){return u.getAltitudeAtMercatorXY(k.latLonToMercatorXY(n,t))},this.getAltitudeForTile=function(n){return e.get(k.tileIdToCacheKey(n))},this.getApproximateAltitudeForTile=function(n){var t=e.get(k.tileIdToCacheKey(n)),r,i;if(t!==h)return t;for(r=-1;r<2;r++)for(i=-1;i<2;i++){t=e.get(k.tileIdToCacheKey(n.getSibling(r,i)),!1);if(t!==h)return t}},this.getAltitudeAtMercatorXY=function(n){var e=k.mercatorXYToTileId(n,ft),f,t;while(e.levelOfDetail>=1){f=u.getApproximateAltitudeForTile(e);if(f!==h){var o=e.levelOfDetail,d=1<<o,r=n.x*d-.5,v=n.y*d-.5,a=Math.floor(r),l=Math.ceil(r),y=Math.floor(v),w=Math.ceil(v),b=u.getAltitudeForTile(new it(o,a,y)),c=u.getAltitudeForTile(new it(o,l,y)),p=u.getAltitudeForTile(new it(o,a,w)),s=u.getAltitudeForTile(new it(o,l,w)),i;return b!==h?i=c!==h?b*(l-r)+c*(r-a):b:c!==h&&(i=c),p!==h?t=s!==h?p*(l-r)+s*(r-a):p:s!==h&&(t=s),i!==h?f=t!==h?i*(w-v)+t*(v-y):i:t!==h&&(f=t),f}e=e.getParent()}return 0},this.rayToGround=function(n,t,i){if(Math.abs(t.x-i.x)<=bt&&Math.abs(t.y-i.y)<=bt)return n.changeAltitude(t,u.getAltitudeAtMercatorXY(t));var o,r,e,f=t,s=et;while(s--){r=u.getAltitudeAtMercatorXY(f);if(Math.abs(o-r)<1)break;o=r,e=fi.fromNormal(n.changeAltitude(f,r),ht),f=e.intersectWithLine(t,i)}return f},this.toEllipsoid=function(n,t){var i,f,r;if(n.altitudeReference===kt.ellipsoid)return n;if(t)return new y(n.latitude,n.longitude,0,kt.ellipsoid);return i=n[g],i&&i.latitude===n.latitude&&i.longitude===n.longitude&&i.forAltitude===n.altitude&&i.forAltitudeReference===n.altitudeReference&&i.forGeneration===l?i:(f=u.getAltitudeAtLatLon(n.latitude,n.longitude),r=n.altitudeReference===kt.ground?n.altitude+f:f,i=new y(n.latitude,n.longitude,r,kt.ellipsoid),i.forAltitude=n.altitude,i.forAltitudeReference=n.altitudeReference,i.forGeneration=l,n[g]=i,i)},this.isElevationAvailableAtLatLon=function(n,t,i){var e=rt(i),r,f;if(e<p)return!0;r=k.latLonToTileId(n,t,e),f=ut;while(f--){if(u.getApproximateAltitudeForTile(r)!==h)return!0;r=r.getParent()}return!1},this.adjustCameraElevation=function(n){var i=n.getLookAt(),t=u.rayToGround(n.getCrs(),i,n.getViewportToWorld().transform(new r(0,0,1)));return r.areAlmostEqual(i,t)?n:n.getAlignedCamera(0,t)},this.downloadElevationData=function(n,t){var u,r;u=rt(n.getMercatorZoom());if(u>=p){r=at.union(nt.getMercatorFootprint(n,t)),k.normalizeMercatorBounds(r);var s=k.mercatorXYToTileId(r,u),h=k.mercatorXYToTileId(new i(r.getRight(),r.getBottom()),u),e={};return f.push({topLeft:s,bottomRight:h,requestHandle:e}),w.dispatch(o),e}},this.downloadElevationDataForLocationRect=function(n,t){t=t||19;if(t>=p){var h=n.getNorth(),s=n.getWest(),e=n.getSouth(),c=n.getEast(),r=k.latLonToTileId(h,s,t),u=k.latLonToTileId(e,c,t),i={};return f.push({topLeft:r,bottomRight:u,requestHandle:i}),w.dispatch(o),i}},this.cancelDownload=function(n){if(n){var t=f.length;while(t--)f[t].requestHandle===n&&f.splice(t,1)}}},a.ElevationService=ut,wt.nativeMercatorCamera=ft.mercator.getAlignedCamera(t.minMercatorZoom),wt.createMercatorScene=function(n,i,r,u){var f=null;return n&&(f=dt.createQuadKeyTilePyramid(t.defaultTileSize,t.defaultTileSize,n,et.horizontal,u),f.projectingCamera=ft.mercator),new wt(wt.nativeMercatorCamera,f,t.maxMercatorZoom-t.minMercatorZoom,i,r)},a.CompositeModeScene=wt,yt.entityRenderers=[],yt.registerEntityRenderer=function(t,i){var r={getRenderer:t,priority:i?i.priority:null};yt.entityRenderers.push(r),yt.entityRenderers._key="k"+yi.getNext(),i&&i.priority!==null&&yt.entityRenderers.sort(function(n,t){var r=0,i=n.priority,u=t.priority;return(i!==null||u!==null)&&(r=i!==null&&u!==null?i-u:i!==null?-1:1),r}),n.invoke(yt,"newEntityRenderer")},yt.getEntityRenderer=function(n,t){var f=yt.entityRenderers._key,i=t._cmRd,u,r;if(t._cmRdk!==f){for(i=null,u=yt.entityRenderers,r=0;r<u.length&&!i;r++)i=u[r].getRenderer(n,t);t._cmRd=i,t._cmRdk=f}return i},a.CompositeMode=yt,p=new function(){function r(){for(var c=g(),l=!1,e,u,s,a,f,o,h,r=0;r<t.length&&!l;r++){e=t[r];for(u in e)s=e[u][0],a=e[u][1],s in c.style&&(i.Properties[u]=s,i.Attributes[u]=a,l=!0)}for(r=0;r<n.length;r++){f=n[r];for(o in f)if(o in c.style)for(h in f[o])i.Events[h]=f[o][h]}}var i=this,t,n;this.Properties={},this.Attributes={},this.Events={},t=[{transform:["msTransform","-ms-transform"],transformOrigin:["msTransformOrigin","-ms-transform-origin"],transition:["msTransition","-ms-transition"],transitionDelay:["msTransitionDelay","-ms-transition-delay"],transitionProperty:["msTransitionProperty","-ms-transition-property"],transitionDuration:["msTransitionDuration","-ms-transition-duration"]},{transform:["webkitTransform","-webkit-transform"],transformOrigin:["webkitTransformOrigin","-webkit-transform-origin"],transition:["webkitTransition","-webkit-transition"],transitionDelay:["webkitTransitionDelay","-webkit-transition-delay"],transitionProperty:["webkitTransitionProperty","-webkit-transition-property"],transitionDuration:["webkitTransitionDuration","-webkit-transition-duration"]},{transform:["MozTransform","-moz-transform"],transformOrigin:["MozTransformOrigin","-moz-transform-origin"]},{transform:["OTransform","-o-transform"],transformOrigin:["OTransformOrigin","-o-transform-origin"]}],n=[{webkitTransition:{transitionEnd:"webkitTransitionEnd"}},{MozTransition:{transitionEnd:"MozTransitionEnd"}}],r()},o={none:0,allowed:1,readyForTarget:2,started:3,pendingCompletion:4},ot.Default=new ot(.25,.1,.25,1),ot.Linear=new ot(0,0,1,1),ot.EaseIn=new ot(.42,0,1,1),ot.EaseOut=new ot(0,0,.58,1),ot.EaseInOut=new ot(.42,0,.58,1),ot.EaseOutIn=new ot(0,.42,1,.58),ot.Flick=new ot(.2,.5,.35,1),ti=function(){function i(n){var i;if(!n[t]){newKey=+new Date;while(newKey in r)newKey++;n[t]=newKey}return i=r[n[t]]||[],r[n[t]]=i,i}function f(n,t,r){var o=i(n),f=!1,e=o.length;while(e--&&!f)f=o[e]===t,f&&r&&(o.splice(e,1),u(n));return f}function u(n){var e=i(n),s=e.length,h=new Date,r="",u="",o=!0,t,f;while(s--)t=e[s],f=h-t.getStartTime(),o||(r+=", ",u+=" "),r+=t.getProperty()+" "+t.getDuration()+"s "+t.getTimingFunction().cssText,u+="-"+f+"ms",o=!1;n.style[p.Properties.transition]=r,n.style[p.Properties.transitionDelay]=u}function e(t,r,e){function v(){var n=t&&r&&e;!n}var s=this,c=t,y=e,a=r,l=new Date(0),o=0,h=null;this.getStartTime=function(){return l},this.getProperty=function(){return c},this.getTimingFunction=function(){return y},this.getDuration=function(){return a},this.setDuration=function(n){o==0&&(a=n)},this.applyAnimation=function(n){if(!n||f(n,s))return;i(n).push(s),o==0&&(l=new Date),o++,b(n).add_event(p.Events.transitionEnd,function(n){n.propertyName==c&&(b(this).remove_event(p.Events.transitionEnd,arguments.callee,!1),s.removeAnimation(this))},!1),u(n)},this.removeAnimation=function(t){t&&t!=h&&f(t,s,!0)&&(o--,h=t,n.invoke(t,"animationsequenceprogress",new pu(s,t,o>0,i(t).length>0)),h=null)},v()}var r={},t=v+"CssAnimationSequenceId";return e}(),ti.prototype={getElapsedTimeAsPercentage:function(){return(new Date-this.getStartTime())/(this.getDuration()*1e3)},getProgress:function(n){n==null&&(n=this.getElapsedTimeAsPercentage());var t=1/(400*this.getDuration());return this.getTimingFunction().getProgress(n,t)},duplicate:function(n,t,i){return new ti(n?n:this.getProperty(),t?t:this.getDuration(),i?i:this.getTimingFunction())}},ti.Transformer=u.allowCssAnimations&&new ti(p.Attributes.transform,.3,ot.EaseInOut),ti.Flicker=u.allowCssAnimations&&ti.Transformer.duplicate(null,null,ot.Flick),ti.TileFader=u.allowCssAnimations&&new ti("opacity",.3,ot.Linear);var ar=function(){function t(){function u(n){if(!r||!r.length)return;var i=r.length,t=!1;while(!t&&i--)t=n(r[i])}function c(n){return n?n[f]:null}function l(n){n&&n.animationSequence&&!e&&u(function(t){if(t===n.animationSequence)return o(c(n.node),t),!0})}function o(i,r){i&&r&&t[i]&&t[i].remaining&&(e=!0,r.removeAnimation(t[i].node),e=!1,t[i].remaining--,t[i].remaining||(n.removeHandler(t[i].handler),t[i].node=null,t[i].handler=null,delete t[i],--s==0&&n.invoke(h,"animationscomplete",!1)))}var h=this,f=v+"CssAnimationGroupId"+ ++i,a=0,r=null,t={},s=0,e=!1;this.manageAnimations=function(n){var t,i;r&&h.removeAllAnimations(),r=n,t=r instanceof Array&&r.length>0;if(t){i=r.length;while(i--&&t)t=r[i]instanceof ti}if(!t)throw"Must pass in a non-empty array of CssAnimationSequence objects";},this.addToGroup=function(i){var u,e;if(!i)return;if(!i[f]){u=+new Date;while(u in t)u++;i[f]=u}e=i[f],t[e]||(s++,t[e]={node:i,handler:n.addHandler(i,"animationsequenceprogress",l),remaining:r.length})},this.applyAllAnimations=function(){u(function(n){for(var i in t)n.applyAnimation(t[i].node)})},this.removeAllAnimations=function(){u(function(n){for(var i in t)o(i,n)})},this.removeAnimations=function(n){u(function(t){o(c(n),t)})},this.hasPendingAnimations=function(){return s>0}}var i=0;return t}(),ni=new function(){function d(){var n=null,i=g(),t=p.Properties.transform,r;if(t&&t in v){r=v[t];try{i.style[t]="matrix(1,0,0,1,0,0)",l=r.p,n=r.f}catch(f){}}"opacity"in i.style&&(y=!0),n==null&&"filter"in i.style&&(n=nt,c.requireFlowLayout=!0,a=!0,c.usingIEFilters=!0,"zoom"in i.style&&u.isZoomFasterThanMatrixFilter&&(w=!0)),n==null&&(n=b),c.setTransformAndOpacity=n}function h(n){if(n.offsetZ){var i=n.invert(),t=3;while(t--)e[t]=i.transform(o[t]);return vt.conversion(e[0],e[1],e[2],o[0],o[1],o[2])}return n.m44==1?n:new vt(n.m11/n.m44,n.m12/n.m44,n.m21/n.m44,n.m22/n.m44,n.offsetX/n.m44,n.offsetY/n.m44)}function f(n){var t={};return t.position="absolute",t["white-space"]="nowrap",t["line-height"]="0",n&&(t.width=n.width.toFixed(0)+"px",t.height=n.height.toFixed(0)+"px"),t}function r(n){var t=[];for(styleKey in n)t.push(styleKey,":",n[styleKey],";");return t.join("")}function nt(i,e,o,s){var d,g,a;s=s||{};var l=h(i),k=Math.round(l.m11*n)/n,it=Math.round(l.m22*n)/n,rt=Math.round(l.m12*n)/n,tt=Math.round(l.m21*n)/n,c=s.excludeCommonCss?{}:f(e),v=null,y,p;if(k==1&&rt==0&&tt==0&&it==1)y=l.offsetX.toFixed(0),p=l.offsetY.toFixed(0);else if(w&&k==it&&rt==0&&tt==0){var b=Math.abs(k-1)>.02?Math.round(k*1e4)/1e4:1,ft=l.invert(),ut=ft.offsetX,nt=ft.offsetY,y,p;u.cssZoomAffectsTopLeft?(y=-ut,p=-nt):(y=-ut*b,p=-nt*b),b!=1&&(c.zoom=b)}else d=Math.round(e.width/2),g=Math.round(e.height/2),y=-d,p=-g,a=vt.multiply(l,new vt(1,0,0,1,d,g)),v="progid:DXImageTransform.Microsoft.Matrix(FilterType=nearest,  M11="+a.m11.toFixed(t)+", M21="+a.m12.toFixed(t)+", M12="+a.m21.toFixed(t)+", M22="+a.m22.toFixed(t)+", dX="+a.offsetX.toFixed(0)+", dY="+a.offsetY.toFixed(0)+")";return c.left=y+"px",c.top=p+"px",o<.01?c.display="none":(c.display="block",o<.99&&(v=(v==null?"":v+", ")+"alpha(opacity = "+(o*100).toFixed(0)+")")),v&&(c.filter=v),s.returnStyleObject?c:r(c)}function s(t,i,e,o){var s,v;o=o||{};var k=h(t),a=Math.round(k.m11*n)/n,y=Math.round(k.m22*n)/n,g=Math.round(k.m12*n)/n,d=Math.round(k.m21*n)/n,b=Math.round(k.offsetX*n)/n,w=Math.round(k.offsetY*n)/n,c=o.excludeCommonCss?{}:f(i);return a===1&&g===0&&d===0&&y===1?u.useTransform2d?(c[o.returnStyleObject?p.Properties.transformOrigin:p.Attributes.transformOrigin]="0 0",c[o.returnStyleObject?p.Properties.transform:p.Attributes.transform]="translate("+b+"px,"+w+"px)"):(c.left=b+"px",c.top=w+"px"):(i&&(u.isIE9||u.isIE10)&&a&&y&&d===0&&Math.abs(a-y)<.01&&(s=a-1,v=y-1,s>.0102||s<-.009998||(s>.0079||s<-.0075?s>.009175||s<-.009086?(b+=i.width*s*-.05,w+=i.height*v*-.05,a+=s*.1,y+=v*.1):(a+=s*.17,y+=v*.17,s>0&&a<1.0100995||s<0&&a>.99?(b+=i.width*s*.5,w+=i.height*v*.5):(b+=i.width*s*-.09,w+=i.height*v*-.09)):(b+=i.width*s*.5,w+=i.height*v*.5,a+=s*.2,y+=v*.2))),c[o.returnStyleObject?p.Properties.transformOrigin:p.Attributes.transformOrigin]="0 0",c[o.returnStyleObject?p.Properties.transform:p.Attributes.transform]="matrix("+a+","+g+","+d+","+y+","+b+l+","+w+l+")"),e<.01?c.display="none":(e>.99||(c.opacity=e.toFixed(2)),c.display="block"),o.returnStyleObject?c:r(c)}function k(t,i,u,e){e=e||{};var s=e.excludeCommonCss?{}:f(i),o=t.m44,b=Math.round(t.m11*n/o)/n,w=Math.round(t.m12*n/o)/n,k=Math.round(t.m14*n/o)/n,g=Math.round(t.m21*n/o)/n,d=Math.round(t.m22*n/o)/n,y=Math.round(t.m24*n/o)/n,c=Math.round(t.m31*n/o)/n,h=Math.round(t.m32*n/o)/n,l=Math.round(t.m34*n/o)/n,v=Math.round(t.offsetX/o),a=Math.round(t.offsetY/o);return b===1&&w===0&&k===0&&g===0&&d===1&&y===0&&c===0&&h===0&&l===0?(s[e.returnStyleObject?p.Properties.transformOrigin:p.Attributes.transformOrigin]="0 0",s[e.returnStyleObject?p.Properties.transform:p.Attributes.transform]="translate3d("+v+"px,"+a+"px,0px)"):(s[e.returnStyleObject?p.Properties.transformOrigin:p.Attributes.transformOrigin]="0 0",s[e.returnStyleObject?p.Properties.transform:p.Attributes.transform]="matrix3d("+b+","+w+",0,"+k+","+g+","+d+",0,"+y+","+c+","+h+",1,"+l+","+v+","+a+",0,1)"),u>=.01||e.explicitOpacity?((u<=.99||e.explicitOpacity)&&(s.opacity=u.toFixed(2)),s.display="block"):s.display="none",e.returnStyleObject?s:r(s)}function b(n,t,i,u){u=u||{};var o=h(n).invert(),e=u.excludeCommonCss?{}:f(t);return e.left=(-o.offsetX).toFixed(0)+"px",e.top=(-o.offsetY).toFixed(0)+"px",e.display=i>.1?"block":"none",u.returnStyleObject?e:r(e)}var c=this,v={msTransform:{p:"",f:s},webkitTransform:{p:"",f:u.useTransform3d?k:s},MozTransform:{p:"px",f:s},OTransform:{p:"",f:s}},l,t=6,n=Math.pow(10,t),o=[new i(0,0),new i(128,128),new i(-128,128)],e=[],y=!1,a=!1,w=!1;this.setExactTransformOrHide=function(n,t,i,e){var o,s,l,c;return e=e||{},o=e.excludeCommonCss?{}:f(t),s=h(n).invert(),Math.abs(s.m11-1)<bt&&Math.abs(s.m12-0)<bt&&Math.abs(s.m21-0)<bt&&Math.abs(s.m22-1)<bt&&i>=.01?(l=-Math.round(s.offsetX)+"px",c=-Math.round(s.offsetY)+"px",o.display="block",u.useTransform3dForTranslate?o[e.returnStyleObject?p.Properties.transform:p.Attributes.transform]="translate3d("+l+","+c+",0px)":u.useTransform2d?o[e.returnStyleObject?p.Properties.transform:p.Attributes.transform]="translate("+l+","+c+")":(o.left=l,o.top=c),i>.99||(y?o.opacity=i.toFixed(2):a&&(o.filter="alpha(opacity = "+(i*100).toFixed(0)+")"))):o.display="none",e.returnStyleObject?o:r(o)},d()},wi=new function(){function y(){for(var e,h,u,s=0;s<i.length;s++){for(e=i[s],h=0;h<e.length;h++){var l=e[h],o=l.url,v=a.getState(o);switch(v){case ht.none:case ht.timedout:case ht.cacheExpired:c<t.maxConcurrentTileDownloads&&(l.basket=e,f[o]||(c++,u=g("img"),f[o]=u,u[r]=l,u.onload=tt,u.onerror=p,u.onabort=p,u[k]=window.setTimeout(function(){var n=u;return function(){nt.call(n)}}(),d),u.src=o));break;case ht.downloading:break;default:e.hasNewTiles=!0}}e.hasNewTiles&&(n.invoke(e,"hasnewtiles"),e.hasNewTiles=!1)}}function tt(){if(!this[e]){var n=this[r].url;s(this,n),b.insert(n,!0),l.insert(n,this)}}function p(){if(!this[e]){var n=this[r].url;s(this,n),u.useImageDisposer&&(this.src=t.spacerImageUrl),o.insert(n,ht.failed)}}function nt(){if(!this[e]){var n=this[r].url;s(this,n),u.useImageDisposer&&(this.src=t.spacerImageUrl),o.insert(n,ht.timedout)}}function s(n,t){var o,i,u;n[e]=!0,n.onload=null,n.onerror=null,n.onabort=null,window.clearTimeout(n[k]),o=n[r],i=o.basket,i.hasNewTiles=!0,u=i.length;while(u--)i[u]===o&&i.splice(u,1);c--,delete f[t],w.dispatch(y,-10)}var a=this,d=5e3,i=[],c=0,f={},l=new ci(50),o=new ci(30),b=new ci(200);u.useImageDisposer&&l.useDisposer(function(n){n&&n.src&&(n.src=t.spacerImageUrl)});var r=v+"downloadRequest",k=v+"timeoutid",e=v+"processed";this.getState=function(n){if(l.get(n))return ht.ready;if(b.get(n))return ht.cacheExpired;var t=o.get(n);return t!==h?t:f[n]?ht.downloading:ht.none},this.setDownloadBasket=function(n,t){a.removeDownloadBasket(n.basketId),n.length>0&&(t?i.push(n):i.unshift(n),w.dispatch(y,-10))},this.removeDownloadBasket=function(n){for(var t=0;t<i.length;)i[t].basketId===n?i.splice(t,1):t++}},ht={none:0,downloading:1,ready:2,failed:3,timedout:4,cacheExpired:5};dt.createQuadKeyTilePyramid=function(n,i,r,u,f){var e=Math.pow(2,t.maxMercatorZoom);return new dt(n*e,i*e,n,i,0,0,0,0,dt.createMercatorQuadKeyUrlRetriever(r,n,u,f),dt.createQuadkeyTileReplacementHandler())},dt.createMercatorQuadKeyUrlRetriever=function(n,i,r,u){return dt.createQuadKeyUrlRetriever(n,u,i,r,t.minMercatorZoom,t.maxMercatorZoom)},dt.createQuadKeyUrlRetriever=function(n,t,i,r,u,f,e){var l=c.ceilLog2(i),h,o,s;return typeof n=="string"?(h=n,o=t?t:h):s=n,function(n,t){var v=n.levelOfDetail-l,i,c,a;if(v>=u&&v<=f){i=new it(v,n.x,n.y),r&et.horizontal&&(i=si.wrapX(i)),r&et.vertical&&(i=si.wrapY(i));if(si.isInBounds(i)){if(s)return s(i);if(i.levelOfDetail===0)if(e)c=si.fromTileId(i,!0),a=e;else return null;else c=si.fromTileId(i,!1),a=c.charAt(c.length-1);return t?o.replace("{quadkey}",c).replace("{subdomain}",a):h.replace("{quadkey}",c).replace("{subdomain}",a)}}return null}},dt.createQuadkeyTileReplacementHandler=function(){var n=new ci(200);return function(t){var e=t.toString(),i=n[e],f,u,r;if(i){f=i.toString();while(n[f])i=n[f],f=i.toString();u=n[e],r=u.toString();while(n[r])u=n[r],n[r]=i,r=u.toString()}else i=t.getParent(),n[e]=i;return i}},et={none:0,horizontal:1,vertical:2},a.TilePyramid=dt,a.TilePyramidWrapMethod=et,di.getBestLevelOfDetail=function(n,t,i){var r,f,u;return r=t.getMaxLevelOfDetail()-c.log2(t.getWidth()/t.projectingCamera.getWidth()/(n.getZoomOriginWidth()/n.getWidth())),f=Math.ceil(r),u=Math.floor(r),f!=u&&(i&&(r=r+i),r=Math.round(r),r=Math.min(f,Math.max(u,r))),r=Math.min(r,t.getMaxLevelOfDetail())},a.TileRenderer=kr,hi=new function(){function n(){s()?(i=1,r=!0,f=!0):h()?(i=2,r=!1,f=!0):o()&&(i=3,r=!0,f=!1),n=function(){}}function s(){var n=!1,t;return document.implementation&&document.implementation.hasFeature?n=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"):document.createElementNS&&(t=document.createElementNS(ns,"svg"),n=typeof t.createSVGRect!="undefined"),s=function(){return n},n}function h(){var t=document.createElement("v:shape"),n;return t.style.behavior="url(#default#VML)",n=typeof t.strokecolor!="undefined",h=function(){return n},n}function o(){var t=document.createElement("canvas"),n=t.getContext&&t.getContext("2d")!==null;return o=function(){return n},n}function e(n){function t(n){this._surface=n,this._paths=[]}return t.prototype={setSize:function(n,t){this._width=n,this._height=t},createPath:function(){},renderPath:function(){},removePath:function(n){var t=this._paths.length;while(t--)if(this._paths[t]===n){this._surface.removeChild(n.nativeShape),this._paths.splice(t,1);break}},clear:function(){var n=this._paths.length;while(n--)this._surface.removeChild(this._paths[n].nativeShape);this._paths=[]}},new t(n)}function a(n){function i(){}function r(){function n(){var r=this,n=document.createElement("v:shape"),t,i;n.style.position="absolute",t=document.createElement("v:stroke"),n.appendChild(t),i=document.createElement("v:fill"),n.appendChild(i),this._stroke=t,this._fill=i,this._initialize(n)}return n.prototype=t,n.prototype.stroke=function(){this.data==null||this.data.length&&this.data.charAt(this.data.length-1)==="E"||(this.data+="E");var n=this.nativeShape;n.strokecolor=this.strokeStyle,n.strokeweight=this.lineWidth+"pt",this.lineCap&&(this._stroke.endcap=this.lineCap.toLowerCase()==="butt"?"flat":path.lineCap,this._stroke.dashstyle=this.dashArray,this._stroke.opacity=this.strokeOpacity),this.fillStyle&&this.fillStyle!=="none"?(this._fill.color=this.fillStyle,this._fill.opacity=this.fillOpacity*100+"%"):n.filled=!1,n.path=this.data},new n}return i.prototype=new e(n),i.prototype.createPath=function(){return new r},i.prototype.renderPath=function(n){var i="url(#default#VML)",r=this._height!=null?this._height:this._surface.offsetHeight,u=this._width!=null?this._width:this._surface.offsetWidth,t=n.nativeShape;this._surface.appendChild(t),t.style.height=r+"px",t.style.width=u+"px",t.style.behavior=i,t.coordsize=u+","+r,n._stroke.style.behavior=i,n._fill.style.behavior=i,this._paths.push(n)},new i}function l(n){function r(){}function o(){function n(){var t=this,n=document.createElementNS(f,"path");n.style.pointerEvents="visiblePainted",this._initialize(n)}return n.prototype=t,n.prototype.stroke=function(){var n=this.nativeShape;n.setAttribute("stroke",this.strokeStyle),n.setAttribute("stroke-width",this.lineWidth),n.setAttribute("stroke-linecap",this.lineCap),n.setAttribute("stroke-dasharray",this.dashArray),n.setAttribute("fill",this.fillStyle),n.setAttribute("fill-opacity",this.fillOpacity),n.setAttribute("fill-rule","evenodd"),n.setAttribute("stroke-opacity",this.strokeOpacity),n.setAttribute("d",this.data)},new n}var f="http://www.w3.org/2000/svg",i=document.createElementNS(f,"svg");return u.safariRenderHack&&(i.style.cssText=u.safariRenderHack),i.setAttribute("width","100%"),i.setAttribute("height","100%"),n.appendChild(i),r.prototype=new e(i),r.prototype.createPath=function(){return new o},r.prototype.renderPath=function(n){var t=n.nativeShape;this._surface.appendChild(t),this._paths.push(n)},new r(n)}function c(n){function i(){}function r(i,r){function u(){var f=this,t=document.createElement("canvas"),u;t.style.cssText="position:absolute;",n.appendChild(t),u=t.getContext("2d"),u.beginPath(),this.context=u,this._initialize(t),this.setSize(i,r)}function o(n,t){if(n.length==7){var i=/^#(\w{2})(\w{2})(\w{2})$/.exec(n);return"rgba("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+","+t+")"}return""}var e,f;return u.prototype=t,u.prototype.setSize=function(n,t){e=n,f=t,this.nativeShape.setAttribute("width",e),this.nativeShape.setAttribute("height",f)},u.prototype.beginPath=function(){this.context.beginPath()},u.prototype.moveTo=function(n,t){this.context.moveTo(n,t)},u.prototype.lineTo=function(n,t){this.context.lineTo(n,t)},u.prototype.curveTo=function(n,t,i,r,u,f){this.context.bezierCurveTo(n,t,i,r,u,f)},u.prototype.stroke=function(){var n=this.context;n.clearRect(0,0,e,f),this.fillStyle&&this.fillStyle!=="none"&&(n.fillStyle=o(this.fillStyle,this.fillOpacity),n.fill()),n.strokeStyle=o(this.strokeStyle,this.strokeOpacity),n.lineWidth=this.lineWidth,n.stroke(),this.drawn=!0},new u}return i.prototype=new e(n),i.prototype.setSize=function(n,t){if(this._width!==n||this._height!==t){this._width=n,this._height=t;var i=this._paths.length;while(i--)this._paths[i].setSize(n,t)}},i.prototype.createPath=function(){var t=this._height?this._height:this._surface.offsetHeight,n=this._width?this._width:this._surface.offsetWidth;return new r(n,t)},i.prototype.renderPath=function(n){var t=n.nativeShape;this._surface.appendChild(t),this._paths.push(n)},new i(n)}var r,f,i,t;this.isClipped=function(){return n(),r},this.isEventsSupported=function(){return n(),f},this.getContext=function(t){if(!t.harmonyContext){n();var r;switch(i){case 1:r=new l(t);break;case 2:r=new a(t);break;case 3:r=new c(t)}t.harmonyContext=r}return t.harmonyContext},this.destroyContext=function(n){n.harmonyContext&&(n.harmonyContext.clear(),n.harmonyContext=null)},t={nativeShape:null,_events:null,id:null,data:"",strokeStyle:"#000",strokeOpacity:"1",dashArray:"solid",fillStyle:"#000",fillOpacity:"1",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"#000000ff",beginPath:function(){this.data=""},moveTo:function(n,t){this.data+="M"+Math.round(n)+","+Math.round(t)+" "},lineTo:function(n,t){this.data+="L"+Math.round(n)+","+Math.round(t)+" "},curveTo:function(n,t,i,r,u,f){this.data+="C"+Math.round(n)+","+Math.round(t)+" "+Math.round(i)+","+Math.round(r)+" "+Math.round(u)+","+Math.round(f)+" "},stroke:function(){},onMouseDown:function(n){this._events.mousedown.push(n)},onMouseUp:function(n){this._events.mouseup.push(n)},onClick:function(n){this._events.click.push(n)},onMouseMove:function(n){this._events.mousemove.push(n)},onMouseOver:function(n){this._events.mouseover.push(n)},onMouseOut:function(n){this._events.mouseout.push(n)},_dispatchEvent:function(n,t){var i=this._events[n].length;while(i--)this._events[n][i].call(this,t)},_initialize:function(n){function i(n){n=n||window.event,t._dispatchEvent(n.type,n)}var t=this;t._events={mousedown:[],mouseup:[],mousemove:[],mouseover:[],mouseout:[],click:[]},n.onmousedown=n.onmouseup=n.onclick=n.onmousemove=n.onmouseover=n.onmouseout=i,this.nativeShape=n}}},a.Harmony=hi,rr.ensureVmlNamespace=function(){rr.ensureVmlNamespace=function(){};try{document.namespaces&&document.namespaces.add&&document.namespaces.add("v","urn:schemas-microsoft-com:vml")}catch(n){}},a.CompositeModeEntityRenderer=rr,new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof nr||r instanceof tr){f=n.length;while(f--)n[f]===i&&(u=t[f]);u||(u=new wu(i),n.push(i),t.push(u))}return u};yt.registerEntityRenderer(i)},cu=new function(){function r(t,r){var c=r.userData,o=null,l,e,f,s,u,a;if(r&&r.success&&t&&t.resourceSets&&t.resourceSets[0]&&t.resourceSets[0].resources&&t.resourceSets[0].resources[0]&&t.resourceSets[0].resources[0].imageryProviders){o=[],l=t.resourceSets[0].resources[0].imageryProviders,u=l.length;while(u--){var v=l[u],h=v.coverageAreas,p={attribution:v.attribution,coverageAreas:[]},y=h?h.length:0;while(y--)e=h[y],f=e.bbox,p.coverageAreas.push({zoomMax:e.zoomMax,zoomMin:e.zoomMin,boundingBox:st.fromEdges(f[2],f[1],f[0],f[3])});o.push(p)}i[c]=o}s=n[c],delete n[c],u=s.length;while(u--)a=s[u],a.callback(o,a.userData)}var i={},n={};this.getCachedImageryProviders=function(n){return i[n]},this.getImageryProviders=function(u,f,e,o){if(i[u])e(i[u],o);else if(n[u])n[u].push({callback:e,userData:o});else if(t.imageryMetadataUrl){n[u]=[],n[u].push({callback:e,userData:o});var s=t.imageryMetadataUrl.replace(/{imagerySet}/,u).replace(/{credentials}/,f);ui.getObjectAsync(s,r,u)}else e(null,o)}},gr=new function(){function r(t,i){var r,f,u;i&&i.success&&t&&t.resourceSets&&t.resourceSets[0]&&t.resourceSets[0].resources&&t.resourceSets[0].resources[0]&&t.resourceSets[0].resources[0].imageryProviders&&(r=i.userData,f=[ii.defaultCopyright.text].concat(t.resourceSets[0].resources[0].imageryProviders),n[r]&&(u=n[r].callback,delete n[r],n[r]=null,u&&u(f)))}var i=0,n=[];this.getCopyrights=function(u,f,e,o,s,h){if(u&&f&&e&&s&&h){var c=t.imageryCopyrightUrl.replace(/{imagerySet}/,u).replace(/{zoom}/,parseInt(e)).replace(/{minLat}/,f.getSouth()).replace(/{minLon}/,f.getWest()).replace(/{maxLat}/,f.getNorth()).replace(/{maxLon}/,f.getEast()).replace(/{heading}/,parseInt(o)).replace(/{credentials}/,s);n[i]={callback:h},ui.getObjectAsync(c,r,i),i=++i%10}else h([ii.defaultCopyright.text])}},a.ModeEventHandler=wr,a.ModeEventHandlerComposite=tu,ou=new function(){function n(n,u,f,e,o,s){var h=dt.createQuadKeyTilePyramid(r,i,u,f,s);return h.projectingCamera=n,new wt(n.getAlignedCamera(t.minMercatorZoom),h,t.maxMercatorZoom-t.minMercatorZoom,"EnhancedBirdseye",e)}var u=this,r=256,i=180;this.createContributor=function(i){var u=t.enhancedBirdseyeUriFormat,o=t.enhancedBirdseyeWithLabelsUriFormat,e=new oi("Synth",i),s=new oi("SynthWithLabels",i),f={},r;return r={},f[nt.northUpHeading]=r,r[rt.hidden]=n(ft.enhancedBirdseyeNorthUp,u.replace("{dir}","dir_n"),et.horizontal,e),r[rt.visible]=n(ft.enhancedBirdseyeNorthUp,o.replace("{dir}","dir_n"),et.horizontal,s,u.replace("{dir}","dir_n")),r={},f[nt.westUpHeading]=r,r[rt.hidden]=n(ft.enhancedBirdseyeWestUp,u.replace("{dir}","dir_w"),et.vertical,e),r[rt.visible]=n(ft.enhancedBirdseyeWestUp,o.replace("{dir}","dir_w"),et.vertical,s,u.replace("{dir}","dir_w")),r={},f[nt.southUpHeading]=r,r[rt.hidden]=n(ft.enhancedBirdseyeSouthUp,u.replace("{dir}","dir_s"),et.horizontal,e),r[rt.visible]=n(ft.enhancedBirdseyeSouthUp,o.replace("{dir}","dir_s"),et.horizontal,s,u.replace("{dir}","dir_s")),r={},f[nt.eastUpHeading]=r,r[rt.hidden]=n(ft.enhancedBirdseyeEastUp,u.replace("{dir}","dir_e"),et.vertical,e),r[rt.visible]=n(ft.enhancedBirdseyeEastUp,o.replace("{dir}","dir_e"),et.vertical,s,u.replace("{dir}","dir_e")),{priority:30,minZoomLevel:0,getScene:function(n,t,i,r,u,e){return r>this.minZoomLevel?f[nt.snapToCardinalHeading(u)][e]:null}}}},pt.mercator="m",pt.auto="auto",t.allowOrdnanceSurvey&&(pt.ordnanceSurvey="os"),t.allowCollinsBart&&(pt.collinsBart="cb"),n.addHandler(er,"mapcreationstart",function(n){var u=n.map,w=n.options,f=u.getCredentials,i=new yt,g=wt.createMercatorScene(t.roadUriFormat,"Road",new oi("Road",f),t.roadUnlabeledUriFormat),e={priority:10,getScene:function(){return g}},h={},y,l,k,c,b,v,o,a;h[rt.hidden]=wt.createMercatorScene(t.aerialUriFormat,"Aerial",new oi("Aerial",f)),h[rt.visible]=wt.createMercatorScene(t.aerialWithLabelsUriFormat,"Aerial",new oi("AerialWithLabels",f),t.aerialUriFormat);var r={priority:20,maxZoomLevel:4.5,getScene:function(n,t,i,r,u,f){return r<this.maxZoomLevel?h[f]:null}},s=ou.createContributor(f),p=new lu(f),d=new vi(pt.mercator,i);d.activated=function(){i.setSceneContributors([])},y=new vi(pt.road,i),y.activated=function(){i.setSceneContributors([e])},l=new vi(pt.aerial,i),l.activated=function(){r.maxZoomLevel=1e3,i.setSceneContributors([r])},t.allowCollinsBart&&(k=new br(wt.createMercatorScene(t.collinsBartUriFormat,"CollinsBart",new oi("CollinsBart",f)),t.collinsBartMinZoom-.5,t.collinsBartMaxZoom+.5,t.collinsBartBounds,15),c=new vi(pt.collinsBart,i),c.activated=function(){i.setSceneContributors([e,k])},u.registerMapType(c)),t.allowOrdnanceSurvey&&(b=new br(wt.createMercatorScene(t.ordnanceSurveyUriFormat,"OrdnanceSurvey",new oi("OrdnanceSurvey",f)),t.ordnanceSurveyMinZoom-.5,t.ordnanceSurveyMaxZoom+.5,t.ordnanceSurveyBounds,15),v=new vi(pt.ordnanceSurvey,i),v.activated=function(){i.setSceneContributors([e,b])},u.registerMapType(v)),o=new vi(pt.auto,i),o.activated=w.disableBirdseye!==!0&&t.defaultAerialTiltOn===!0?function(){r.maxZoomLevel=4.5,s.minZoomLevel=16.5,i.setSceneContributors([e,r,s,p])}:function(){var n={priority:20,maxZoomLevelBand1:4.5,minZoomLevelBand2:16.5,getScene:function(n,t,i,r,u,f){return r<this.maxZoomLevelBand1||r>this.minZoomLevelBand2?h[f]:null}};i.setSceneContributors([n,e])},a=new vi(pt.birdseye,i),a.activated=function(){w.disableBirdseye!==!0?(r.maxZoomLevel=1e3,s.minZoomLevel=12.5,i.setSceneContributors([r,s,p])):(r.maxZoomLevel=1e3,i.setSceneContributors([r]))},u.registerMapType(d),u.registerMapType(o),u.registerMapType(y),u.registerMapType(l),u.registerMapType(a)}),delete window.Microsoft.Maps.initMapCode,PRF.end("Map core initialized","mapcore")},Microsoft.Maps.Globals&&Microsoft.Maps.initMapCode&&window.Microsoft.Maps.initMapCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initMapDelayCode=function(){function hr(e,o,s){function kt(){g&&(n.removeHandler(g),n.removeHandler(wt),n.removeHandler(dt),g=null,p.remove_event("mousedown",d).remove_event("dblclick",i).remove_event("touchstart",d),t(y).remove_event("click",st),t(v).remove_event("click",ht),a.parentNode.removeChild(a),a=null,y=null,l=null,v=null)}function bt(n){var n=e.isRotationEnabled();n!==b&&(b=n,at.set_style(b?{visibility:"visible"}:{visibility:"hidden"}),n||(l.className="NavBar_compass NavBar_compassFlat",rt=null),ft())}function ft(){var t,n;if(b){t=e.getTargetHeading();if(t!==rt){n="";switch(ct.snapToCardinalHeading(t)){case ct.northUpHeading:n="NavBar_compassN";break;case ct.eastUpHeading:n="NavBar_compassE";break;case ct.southUpHeading:n="NavBar_compassS";break;case ct.westUpHeading:n="NavBar_compassW"}l.className="NavBar_compass "+n,rt=t}}}function et(n){var i=t.Screen.get_mouse_pos(n),r;isNaN(i.x)&&(i=new f(n.touches[0].pageX,n.touches[0].pageY)),c=new f(i.x-it.x-w.x,i.y-it.y-w.y),r=Math.sqrt(c.x*c.x+c.y*c.y),r<nt&&(c.x=c.x/nt*yt,c.y=c.y/nt*yt)}function lt(){Math.abs(c.x)>1||(c.x=0),Math.abs(c.y)>1||(c.y=0);if(c.x||c.y){var n=e.tryPixelToLocation(c);n&&e.setView({center:n,animate:!1})}}function d(n){n.preventMouseEvent&&n.preventMouseEvent(),n.which===1&&(i(n),h(e,n),t(document).add_event("mousemove",tt,!0).add_event("mouseup",k,!0).add_event("touchmove",tt,!0).add_event("touchend",k,!0).add_event("contextmenu",i,!0),p.add_event("selectstart",i,!0),w=new f(l.offsetWidth/2,l.offsetHeight/2),nt=Math.min(w.x,w.y),it=p.get_absolute_pos(),et(n),lt(),pt=window.setInterval(lt,100))}function tt(n){n.preventMouseEvent&&n.preventMouseEvent(),i(n),et(n)}function k(n){n.preventMouseEvent&&n.preventMouseEvent(),n.which===1&&(i(n),t(document).remove_event("mousemove",tt,!0).remove_event("mouseup",k,!0).remove_event("touchmove",tt,!0).remove_event("touchend",k,!0).remove_event("contextmenu",i,!0),p.remove_event("selectstart",i,!0),window.clearInterval(pt))}function st(n){i(n),h(e,n),ut(90)}function ht(n){i(n),h(e,n),ut(-90)}function ut(n){e.setView({heading:e.getTargetHeading()+n})}var ni=this,a,l,p,it,w,nt,pt,c,yt=15,b,gt,rt,y,v,at,wt,dt,g;a=r("div",s.getClassName()),ot(a),y=vt("NavBar_rotateLeft",u.getString("L_rotateLeftTooltip_Text")),t(y).add_event("click",st).set_attr("uici","NB.CS.RotateLeft"),l=r("a"),l.appendChild(document.createTextNode(u.getString("L_compassNorthLabel_Text"))),p=t(l),l.title=u.getString("L_compassTooltip_Text"),v=vt("NavBar_rotateRight",u.getString("L_rotateRightTooltip_Text")),t(v).add_event("click",ht).set_attr("uici","NB.CS.RotateRight"),at=t([y,v]),p.add_event("mousedown",d).add_event("dblclick",i).add_event("touchstart",d).set_attr("uici","NB.CS.PanControl"),s.getRotateVisible()&&a.appendChild(y),s.getCompassVisible()&&a.appendChild(l),s.getRotateVisible()&&a.appendChild(v),o.appendChild(a),s.getDomElement=function(){return a},wt=n.addHandler(e,"imagerychanged",bt),dt=n.addHandler(e,"targetviewchanged",ft),bt(),g=n.addHandler(e,"ondispose",kt),this.dispose=kt}function yi(i,u,f){function g(){p(),nt=new Date,c||(o(e,"show"),c=!0,rt.appendChild(v));if(h.style.visibility==="hidden"){var f=s.offsetHeight,r=t(s).get_relative_pos().x,l=t(s).get_absolute_pos(),n=i.getRootElement(),u=t(n).get_absolute_pos().x+n.offsetWidth-(l.x+h.offsetWidth);u<0&&(r+=u),h.style.top=f+"px",h.style.left=r+"px",h.style.visibility="visible"}}function w(){p(),c&&(o(e,"hide"),c=!1,v.parentNode.removeChild(v),h.style.visibility="hidden")}function p(){d&&(window.clearTimeout(d),d=null),k&&(window.clearTimeout(k),k=null)}var e=this,rt=u,a,c=!1,it=[],nt=new Date(0),ut=300,d,k,s=r("span","NavBar_button NavBar_typeButton"+(f?" "+f:"")),tt=t(s),y,b,v,h;tt.add_event("mouseenter",function(n){o(e,"mouseenter",n)}).add_event("mouseleave",function(n){o(e,"mouseleave",n)}).add_event("touchstart",function(n){o(e,"touchstart",n)}),y=r("a","NavBar_dropIconContainer",s),y.href="#",t(y).add_event("click",function(n){o(e,"clickicon",n)}).add_event("mouseenter",function(n){o(e,"mouseentericon",n)}).add_event("mouseleave",function(n){o(e,"mouseleaveicon",n)});var ft=r("span","NavBar_dropIcon",y),et=r("span","separator",s),l=r("a","NavBar_typeButtonLabel",s);l.href="#",l.appendChild(document.createTextNode("")),b=t(l),b.add_event("click",function(n){o(e,"clicklabel",n)}).add_event("mouseenter",function(n){o(e,"mouseenterlabel",n)}).add_event("mouseleave",function(n){o(e,"mouseleavelabel",n)}),u.appendChild(s),v=r("div","NavBar_ModeSelectorControl"),h=r("ul","MicrosoftMap_NavBar_typeMenu",v),h.style.cssText="position:absolute;visibility:hidden",t(h).add_event("mouseenter",function(n){o(e,"mouseenter",n)}).add_event("mouseleave",function(n){o(e,"mouseleave",n)}),this.dispose=function(){s&&(w(),s.parentNode.removeChild(s),s=null)},this.isShown=function(){return c},this.addMenuItem=function(t,i){t&&(it.push(t),n.addHandler(t,"click",function(t){n.invoke(e,"clickitem",t)})),h.appendChild(i)},this.getItems=function(){return it},this.setMapType=function(n){a&&b.remove_class("NavBar_MapType_"+a),a=n,n&&b.add_class("NavBar_MapType_"+a)},this.getMapType=function(){return a},this.updateLabel=function(n){l.replaceChild(document.createTextNode(n),l.firstChild)},this.setSelected=function(n){n?tt.add_class("NavBar_buttonSel"):tt.remove_class("NavBar_buttonSel")},this.toggleMenu=function(){c?new Date-nt>ut&&w():(g(),nt=new Date(0))},this.showMenu=function(){g()},this.showMenuDelay=function(n){p(),c||(d=window.setTimeout(g,n))},this.hideMenu=function(){w()},this.hideMenuDelay=function(n){p(),k=window.setTimeout(w,n)}}function bi(i,u,f){var a=this,c=et[i],s=r("li","NavBar_menuitem"+(u?" NavBar_menuItemSel":"")),e=r("div","NavBar_itemContainer NavBar_itemContainer_"+i,s),h;t(e).add_event("click",function(t){t.stopPropagation(),n.invoke(a,"click",t),f(i)});var v=r("div","NavBar_typePreview NavBar_typePreview_"+i,e),o=r("div","NavBar_typeContent",e),l=r("div","NavBar_typeTitle",o);l.appendChild(document.createTextNode(c.title)),h=r("div","NavBar_typeDesc",o),h.appendChild(document.createTextNode(c.description)),this.getTypeId=function(){return i},this.getElement=function(){return s},this.getContent=function(){return o},this.setSelected=function(n){s.className="NavBar_menuitem"+(n?" NavBar_menuItemSel":"")}}function rr(i,f,e,s){function tt(){var e=i.getOptions(),u,r,t,n,f;c=i.getMapTypeId(),c===w?(l=!1,p.disableBirdseye!==!0&&(c=a)):c===a&&(p.disableBirdseye===!0?c=w:l=!0);if(et.hasOwnProperty(c)){u=v.getItems(),r=u.length;while(r--)t=u[r],n=t.getTypeId(),t.setSelected(n==c||g(c)&&g(n));f=et[c],v.updateLabel(f.title),v.setMapType(i.getMapTypeId())}y=e.labelOverlay!==rt.hidden,nt&&(nt.checked=y),d&&(d.checked=l)}function it(n){n===a&&(n=p.disableBirdseye!==!0&&l?a:w),i.setView({mapTypeId:n,labelOverlay:y||n===st?rt.visible:rt.hidden});var t=i.getComponent("analyticsProxy");t&&t.logClientAction({uici:"NB.MT.SetMapType",customData:{mt:n}})}function g(n){return n===w||n===a}function ft(n){y=!y,ut(n,nt,y)}function ot(n){l=!l,ut(n,d,l)}function ut(n,t,r){n.stopPropagation(),h(i,n),n.currentTarget.tagName==="SPAN"&&t&&(t.checked=r),g(c)&&it(a),ht&&v.hideMenuDelay(1e3)}function lt(t){var r=new yi(i,f),v,e,s,l,u;for(r.mapTypes=t,r.updateLabel(et[t[0]].title),r.setMapType(t[0]),v=[],r.events=v,u=0;u<t.length;u++)e=t[u],e&&(s=new bi(e,c===e,it),r.addMenuItem(s,s.getElement()),(e===a||e===w&&p.disableBirdseye===!0)&&at(s.getContent()));l=[["clicklabel",function(n){h(i,n),r.toggleMenu()}],["clickicon",function(n){h(i,n),r.toggleMenu()}],["clickitem",function(n){h(i,n),r.hideMenu()}],["mouseenter",function(){r.showMenu()}],["mouseleave",function(){r.hideMenuDelay(1e3)}],["show",function(){o(ct,"showmaptypemenu",{menuPosition:0})}],["hide",function(){o(ct,"hidemaptypemenu",{menuPosition:0})}]],u=l.length;while(u--)v.push(n.addHandler(r,l[u][0],l[u][1]));return r}function at(n){var o=r("div","NavBar_checkControls"),e=r("div","NavBar_checkControl",o),i=r("input"),f;i.id="LabelCB_"+kt.getNext(),i.setAttribute("type","checkbox"),t(i).add_event("click",ft),nt=i,e.appendChild(i),i.checked=!0,f=r("span","",e),f.appendChild(document.createTextNode(u.getString("L_aerialShowLabels_Text"))),t(f).add_event("click",ft),p.disableBirdseye!==!0&&(e=r("div","NavBar_checkControl",o),i=r("input"),i.id="TiltCB_"+kt.getNext(),i.setAttribute("type","checkbox"),t(i).add_event("click",ot),d=i,e.appendChild(i),i.checked=!0,f=r("span","",e),f.appendChild(document.createTextNode(u.getString("L_aerialEnableTilt_Text"))),t(f).add_event("click",ot)),n.appendChild(o)}var ct=this,st=b.auto,a=b.birdseye,w=b.aerial,c=i.getMapTypeId(),p=s,y=!0,l=k.defaultAerialTiltOn===!0,nt=null,d=null,v=lt([b.road,k.allowCollinsBart?b.collinsBart:null,k.allowOrdnanceSurvey?b.ordnanceSurvey:null,st,p.disableBirdseye!==!0?a:w]),vt=n.addHandler(i,"maptypechanged",tt),yt=n.addHandler(i,"optionschanged",tt),pt=!1;tt(),this.dispose=function(){var i=v.events,t=i.length;while(t--)n.removeHandler(i[t]);v.dispose(),n.removeHandler(vt),n.removeHandler(yt)},this.showMenu=function(){v.showMenu()},this.hideMenu=function(){v.hideMenu()},this.getAerialViewSettings=function(){return{showLabels:y,enableTilt:l}},this.setAerialViewSettings=function(n,t){y=n,l=t,g(c)&&it(a)}}function dr(i,f,e,s){function w(){var h=i.getOptions(),u,r,n,s;l=i.getMapTypeId();if(et.hasOwnProperty(l)){u=c.length;while(u--){var t=c[u],o=!1,e=t.getItems(),f=e.length;while(f--)r=e[f],n=r.getTypeId(),r.setSelected(n==l),n==l&&(o=!0,s=et[n],t.updateLabel(s.title),t.setMapType(n));t.setSelected(o)}}!p&&g(l)&&(a=h.labelOverlay!==rt.hidden,ot.checked=a),p=!1}function v(n){var u=i.getOptions(),r=n==ut||a,t;p=u.labelOverlay!==rt.hidden!==r,i.setView({mapTypeId:n,labelOverlay:r?rt.visible:rt.hidden}),t=i.getComponent("analyticsProxy"),t&&t.logClientAction({uici:"NB.MT.SetMapType",customData:{mt:n}})}function g(n){return n===y||n===d}function nt(){var n=c.length;while(n--)c[n].hideMenu()}function tt(n){n.stopPropagation(),h(i,n),a=!a,ot.checked=a,g(l)&&v(l),ht&&c[1].hideMenuDelay(1e3)}function ft(t,r){var b=c.length,u=new yi(i,f,r),w,e,s,p;for(u.mapTypes=t,u.updateLabel(et[t[0]].title),u.setMapType(t[0]),w=[],u.events=w,e=0;e<t.length;e++)s=t[e],s&&(p=new bi(s,l===s,v),u.addMenuItem(p,p.getElement()));var y=!1,a=[["clicklabel",function(n){h(i,n),nt(),v(u.getMapType())}],["clickicon",function(n){h(i,n),u.toggleMenu()}],["clickitem",function(n){h(i,n),nt()}],["mouseentericon",function(){u.showMenu()}],["mouseleaveicon",function(){u.hideMenuDelay(1)}],["mouseenterlabel",function(){y=!0}],["mouseleavelabel",function(){y=!1}],["mouseenter",function(){u.isShown()&&!y&&u.showMenu()}],["mouseleave",function(){u.hideMenuDelay(1e3)}],["show",function(){var t=c.length;while(t--)u!=c[t]&&c[t].hideMenu();o(it,"showmaptypemenu",{menuPosition:b})}],["hide",function(){o(it,"hidemaptypemenu",{menuPosition:b})}]],e=a.length;while(e--)w.push(n.addHandler(u,a[e][0],a[e][1]));return u}function st(n){var e=r("div","NavBar_checkControl"),i=r("input"),f;return i.setAttribute("type","checkbox"),t(i).add_event("click",tt),e.appendChild(i),i.checked=!0,f=r("span","",e),f.appendChild(document.createTextNode(u.getString("L_aerialShowLabels_Text"))),t(f).add_event("click",tt),n.addMenuItem(null,e),i}var it=this,ut=b.auto,d=b.birdseye,y=b.aerial,l=i.getMapTypeId(),ct=s,c=[];c.push(ft([b.road,k.allowCollinsBart?b.collinsBart:null,k.allowOrdnanceSurvey?b.ordnanceSurvey:null,ut],"NavBar_DropDownMenu_0")),c.push(ft(ct.disableBirdseye!==!0?[d,y]:[y],"NavBar_DropDownMenu_1"));var a=!0,ot=st(c[1]),lt=n.addHandler(i,"maptypechanged",w),at=n.addHandler(i,"optionschanged",w),p=!1;w(),this.dispose=function(){var r=c.length;while(r--){var u=c[r],t=u.events,i=t.length;while(i--)n.removeHandler(t[i]);u.dispose()}n.removeHandler(lt),n.removeHandler(at)},this.showMenu=function(n){c[n].showMenu()},this.hideMenu=function(n){c[n].hideMenu()},this.getAerialViewSettings=function(){return{showLabels:a}},this.setAerialViewSettings=function(n,t){a=n,g(l)&&(t?v(d):v(y))}}function gr(e,o,s){function lt(n){i(n),t.Events.capture_mouse(c),y=!0}function g(n){k();var t=Math.min(1,n.touches.length);at||n.touches.length!==1||(p=new f(n.touches[0].pageX,n.touches[0].pageY),p.target=n.target,p.start=new Date),d=new f(n.touches[0].pageX,n.touches[0].pageY),at=d,y=!0,i(n)}function ct(n){i(n);if(y){var r=b(t.Screen.get_mouse_pos(n).y);c.style.top=r+"px",w(r,!0)}}function tt(n){k(),et(),d=new f(n.touches[0].pageX,n.touches[0].pageY);if(y){var t=b(d.y);c.style.top=t+"px",w(t,!0)}i(n)}function pt(n){i(n),y&&(t.Events.release_mouse(),y=!1,w(b(t.Screen.get_mouse_pos(n).y),!1),ut(),h(e,n))}function nt(n){k(),p?(bt(n),h(e,n)):y&&(y=!1,w(b(d.y),!1),ut(),h(e,n)),et()}function ft(n){i(n),w(b(t.Screen.get_mouse_pos(n).y)),h(e,n)}function bt(n){n.target===l&&w(b(p.y))}function et(){p=null}function rt(){var n=e.getZoomRange();a&&a.min==n.min&&a.max==n.max||(a=n),ut()}function b(n){var i=l.offsetHeight-c.offsetHeight;return n-=t(l).get_absolute_pos().y+c.offsetHeight/2,n=Math.max(n,0),n=Math.min(n,i)}function w(n,t){var i=c.offsetHeight/2,f=l.offsetHeight-i,u=n+i,r=Math.round(a.max+(u-i)*-(a.max-a.min)/(f-i));e.setView({zoom:r,suspend:t})}function dt(n,t){if(a){var i=c.offsetHeight/2,u=l.offsetHeight-i,r=Math.round(i+(u-i)*(t-a.max)/-(a.max-a.min));n.style.top=r-n.offsetHeight/2+"px"}}function ut(){dt(c,e.getTargetZoom())}function st(){it&&(window.clearTimeout(it),it=null)}function k(){st(),ht&&(it=window.setTimeout(wt,5e3))}function wt(){st(),o.style.display="none"}var gt=this,v,l,kt,c,ht=s,yt,vt,y,a,p,d,at,it;v=r("div","NavBar_zoom"),ot(v),l=r("div","NavBar_zoomBar",v),l.style.cssText="position:absolute;overflow:hidden",t(l).add_event("click",ft).add_event("touchstart",g).add_event("touchmove",tt).add_event("touchend",nt),kt=r("div","NavBar_zoomBarBg",l),c=r("div","NavBar_zoomSlider",l),c.title=u.getString("L_zoomSliderTooltip_Text"),t(c).add_event("mousedown",lt).add_event("mouseup",pt).add_event("mousemove",ct).add_event("click",i).add_event("touchstart",g).add_event("touchmove",tt).add_event("touchend",nt),t(v).add_event("mousedown",i).add_event("mouseup",i).add_event("mousemove",i).add_event("click",i).add_event("touchstart",i).add_event("touchmove",i).add_event("touchend",i),o.appendChild(v),yt=n.addHandler(e,"targetviewchanged",rt),vt=n.addHandler(e,"imagerychanged",rt),ht&&k(),this.getDomElement=function(){return v},this.dispose=function(){v&&(t(l).remove_event("click",ft).remove_event("touchstart",g).remove_event("touchmove",tt).remove_event("touchend",nt),t(c).remove_event("mousedown",lt).remove_event("mouseup",pt).remove_event("mousemove",ct).remove_event("click",i).remove_event("touchstart",g).remove_event("touchmove",tt).remove_event("touchend",nt),t(v).remove_event("mousedown",i).remove_event("mouseup",i).remove_event("mousemove",i).remove_event("click",i).remove_event("touchstart",i).remove_event("touchmove",i).remove_event("touchend",i),n.removeHandler(yt),n.removeHandler(vt),v.parentNode.removeChild(v),l=null,c=null,v=null)},this.show=function(){rt()},this.resetZoomBarTimer=k}function br(u,f,e){function v(){s&&(n.removeHandler(s),s=null,a.removeNavigationBar(u))}function l(n){var t,u,i;t=c[n];if(!t){t=r("div","NavBar_clientRegion NavBar_clientRegion_"+w.getName(n)),u=f.getDomElement();switch(n){case w.left:i=c[w.middle],u.insertBefore(t,i?i.nextSibling:e.getDomElement().nextSibling);break;case w.middle:t=e.getDomElement();break;case w.right:u.appendChild(t)}c[n]=t}return t}var c={},o={},s;a.registerNavigationBar(u,this),s=n.addHandler(u,"ondispose",v),this.addClientButton=function(n,r,f,e,s){var a=l(n),c=typeof f=="string"?vt(e,f):f;return a.appendChild(c),o[r]=c,t(c).add_event("click",function(n){typeof f=="string"&&i(n),h(u,n),s&&s(r)}).set_attr("uici","NB.TB."+f),c},this.updateClientButton=function(n,i,r){var u=o[n];u&&(u.className="NavBar_button NavBar_toolButton "+(r||""),u.title=i||"",t(u).set_attr("uici","NB.TB."+i))},this.removeClientButton=function(n,t){var r=l(n),i=o[t];i&&(delete o[t],r.removeChild(i))}}function kr(f,o,s){function ar(){n.removeHandler(lt),lt=null,sr=f.getTargetCenter(),cr=f.getTargetZoom()}function yt(){dt&&(f.entities.remove(dt),dt=null),c.current.style.display!=="none"&&(c.current.style.display="none",c.currentDelim.style.display="none",g=p[d],y())}function hr(){c.current.style.display==="none"&&(l.currentZoom=f.getTargetZoom(),l.currentCenter=f.getTargetCenter(),c.current.style.display="inline-block",c.currentDelim.style.display="inline",y())}function nf(n){ni=n,y()}function fr(){ft=ni!==null?ni:ff()}function ff(){var r=c.breadcrumbContainer,u=c.breadcrumb,n,i;return u&&r?(n=t(u),i=r.offsetWidth-parseInt(n.get_style("paddingLeft"))-parseInt(n.get_style("paddingRight")),i>0?i:0):0}function pu(){y()}function vu(){var t,n,i;fr();if(ft>0)c.breadcrumb&&(c.breadcrumb.style.display="block");else{c.breadcrumb&&(c.breadcrumb.style.display="none");return}t=c.breadcrumbBar.offsetWidth;if(t>=ft)for(n=0,i=p.length-1;n<i;n++){c[p[n]].firstChild.nodeValue="...",c[p[n]].setAttribute("title",l[p[n]]),t=c.breadcrumbBar.offsetWidth;if(t<ft)break}nu()}function nu(){var t,n,i;fr();if(ft>0)c.breadcrumb&&(c.breadcrumb.style.display="block");else{c.breadcrumb&&(c.breadcrumb.style.display="none");return}t=c.breadcrumbBar.offsetWidth;if(t>=ft)for(n=0,i=w.length;n<i;n++){a[w[n].name].firstChild.nodeValue="...",a[w[n].name].setAttribute("title",w[n].value),t=c.breadcrumbBar.offsetWidth;if(t<ft)break}nr(it)}function wr(){c.breadcrumb&&(ci(c.breadcrumbContainer),c.breadcrumbContainer.parentNode.removeChild(c.breadcrumbContainer),c.breadcrumbContainer=null,c.breadcrumb=null)}function wu(t){var f=a[t+"Delim"],u,i,r;f&&(f.parentNode.removeChild(f),a[t+"Delim"]=null),u=ht(t),u.type==="group"?(i=t+"Click",n.removeHandler(k[i]),k[i]=null,i=t+"MouseEnter",n.removeHandler(k[i]),k[i]=null,i=t+"MouseLeave",n.removeHandler(k[i]),k[i]=null,u===it&&rt(!0),r=a[t+"Container"],a[t+"Container"]=null,a[t]=null,a[t+"ListSign"]=null,r.parentNode.removeChild(r)):(i=t+"Click",n.removeHandler(k[i]),k[i]=null,r=a[t],a[t]=null,r.parentNode.removeChild(r))}function bu(t){var i,r,u;g=t,y();switch(t){case"world":case"country":case"state":case"county":case"city":case"neighborhood":hr();break;case"current":yt();break;default:n.invoke(v,"pathnodeclicked",{pathNodeLevel:t,pathNodeValue:ht(t).value});return}i={animate:iu},f.isStreetside&&f.isStreetside()&&(i.mapTypeId=b.road),r=l[t+"Bounds"],r?(u=gt.fromEdges(r[2],r[1],r[0],r[3]),i.bounds=u):t==="current"?(i.center=l.currentCenter,i.zoom=l.currentZoom):(i.center=l.currentCenter,i.zoom=l[t+"Zoom"]),ef(i),n.invoke(v,"pathnodeclicked",{pathNodeLevel:t,pathNodeValue:l[t]})}function kr(){bu(this.attributes.pathNodeLevel.value)}function wi(){var h,u,n,e;c.root||(c.root=f.getRootElement(),h=r("div","pathContainer"),c.breadcrumb=h,h.setAttribute("onselectstart","return false;"),u=r("div",s.getClassName(),o),s.getDomElement=function(){return u},ot(u),c.breadcrumbContainer=u,u.appendChild(c.breadcrumb),n=document.createElement("div"),n.className="unlockButton",e=t(n),e.add_event("click",ai),e.add_event("touchstart",i),e.add_event("touchend",ai),c.root.appendChild(n),c.breadcrumbUnlock=n,yu())}function yu(){var f,i,r,e,o,n;if(c.breadcrumb){f=document.createElement("span"),f.className="path";for(i in ut)r=document.createElement("span"),i!=="world"?(i==="current"&&(e=document.createElement("span"),f.appendChild(e),c.breadcrumbExtension=e),o="•",r.className="pathNodeDelim",r.style.display="none"):(o="",r.className="pathHeight",r.style.display="inline-block"),r.appendChild(document.createTextNode(o)),f.appendChild(r),c[i+"Delim"]=r,i==="current"?(n=document.createElement("a"),n.className="currentIcon",n.href="#",n.title=u.getString("L_currentIconTooltip_Text")):(n=document.createElement("a"),n.href="#",n.className="pathNode",i!=="world"?n.appendChild(document.createTextNode("")):n.appendChild(document.createTextNode(l[i]))),i!=="world"&&(n.style.display="none"),t(n).add_event("click",kr),n.setAttribute("pathNodeLevel",i),n.setAttribute("uici","BC.PN."+i),f.appendChild(n),c[i]=n;c.breadcrumbBar=f,c.breadcrumb.appendChild(f)}}function pi(){h.country=null,h.state=null,h.county=null,h.city=null,h.neighborhood=null,h.street=null,h.current=null,h.countryBounds=null,h.stateBounds=null,h.countyBounds=null,h.cityBounds=null,h.neighborhoodBounds=null,h.streetBounds=null,h.currentBounds=null,h.countryEntityId=null,h.stateEntityId=null,h.countyEntityId=null,h.cityEntityId=null,h.neighborhoodEntityId=null,h.streetEntityId=null,h.currentEntityId=null}function yi(){c.breadcrumbUnlock.style.display="block"}function bi(){c.breadcrumbUnlock.style.display="none"}function ku(n,t,i,r,u){var f={type:n,name:t,value:i,values:r,isVisible:u};w.push(f),gu(f)}function gu(n){var u=document.createElement("span"),e="•",r,f,i;u.className="pathNodeDelim",u.style.display="none",u.appendChild(document.createTextNode(e)),a[n.name+"Delim"]=u,c.breadcrumbExtension.appendChild(u),n.type==="group"?(r=document.createElement("span"),r.className="groupContainer",r.style.display="none",r.setAttribute("pathNodeLevel",n.name),k[n.name+"Click"]=t(r).add_event("click",tf),k[n.name+"MouseEnter"]=t(r).add_event("mouseenter",ir),k[n.name+"MouseLeave"]=t(r).add_event("mouseleave",tr),i=document.createElement("span"),i.className="group",i.appendChild(document.createTextNode("")),f=document.createElement("span"),f.className="groupListSign",a[n.name+"Container"]=r,a[n.name]=i,a[n.name+"ListSign"]=f,r.appendChild(i),r.appendChild(f),c.breadcrumbExtension.appendChild(r)):(i=document.createElement("span"),i.className="pathNode",i.appendChild(document.createTextNode("")),i.style.display="none",k[n.name+"Click"]=t(i).add_event("click",kr),i.setAttribute("pathNodeLevel",n.name),i.setAttribute("uici","BC.PN."+n.name),a[n.name]=i,c.breadcrumbExtension.appendChild(i))}function du(n,t){var i=ht(n);if(i.isVisible===t)return;i.type==="group"&&t===!1&&i===it&&rt(!0),i.isVisible=t,y()}function au(n){wu(n),w.splice(lu(n),1),y()}function ht(n){var t=w.length;while(t--)if(w[t].name===n)return w[t]}function lu(n){var t=w.length;while(t--)if(w[t].name===n)return t}function vi(t,i){var r=ht(t),u=r.value;r.value=i,a[t].firstChild.nodeValue=i,ei(t),y(),n.invoke(v,"groupselecteditemchanged",{groupName:t,newItem:i,oldItem:u})}function li(t){st=!0,ct=t,bt(!0),n.invoke(v,"locked")}function ef(t){lt||(lt=n.addHandler(f,"targetviewchanged",ar)),f.setView(t),window.setTimeout(function(){lt&&ar()},100)}function of(){st=!1}function sf(){st=!1,bi(),rt(!0),yt(),pi(),h.currentZoom=f.getTargetZoom(),di(),g=p[d],y(),ct=f.getTargetCenter(),bt(!0),n.invoke(v,"unlocked")}function ai(t){sf(),n.invoke(v,"closed"),t.stopPropagation()}function tf(){var i=this.attributes.pathNodeLevel.value,r=ht(i);ei(i),y(),a.groupList?rt(!0):gi(r),n.invoke(v,"pathnodeclicked",{pathNodeLevel:i,pathNodeValue:r.value})}function ir(){gi(ht(this.attributes.pathNodeLevel.value))}function tr(){a.groupList&&rt()}function vt(n){vi(it.name,this.firstChild.nodeValue),rt(!0),i(n)}function rr(){var u,f,r;tt=null;if(a.groupList){n.removeHandler(ui),n.removeHandler(fi),u=a.groupList.childNodes,f=u.length;while(f--)r=t(u[f]),r.remove_event("click",vt),r.remove_event("touchstart",i),r.remove_event("touchend",vt);ui=null,fi=null,a.groupList.parentNode.removeChild(a.groupList),a.groupList=null,it=null}}function rt(n){a.groupList&&(n?(tt&&(clearTimeout(tt),tt=null),rr()):tt||(tt=setTimeout(rr,1e3)))}function nr(n){var i=a.groupList;if(i){var u=t(o).get_absolute_pos(),r=c.breadcrumb,e=t(r).get_absolute_pos().y+r.offsetHeight-u.y,f=t(a[n.name+"Container"]).get_absolute_pos().x-u.x;i.style.top=e+"px",i.style.left=f+"px"}}function gi(n){var r,e,u,f;if(it)if(it!==n)rt(!0);else{tt&&(clearTimeout(tt),tt=null);return}r=document.createElement("ul"),a.groupList=r,it=n,r.className="pathList",r.style.position="absolute",r.setAttribute("pathNodeLevel",n.name),c.root.appendChild(r),ui=t(r).add_event("mouseenter",ir),fi=t(r).add_event("mouseleave",tr);for(e in n.values)u=document.createElement("li"),u.appendChild(document.createTextNode(n.values[e])),r.appendChild(u),f=t(u),f.add_event("click",vt),f.add_event("touchstart",i),f.add_event("touchend",vt);nr(n)}function rf(){l.country=null,l.state=null,l.county=null,l.city=null,l.neighborhood=null,l.street=null,l.current=null,l.countryBounds=null,l.stateBounds=null,l.countyBounds=null,l.cityBounds=null,l.neighborhoodBounds=null,l.streetBounds=null,l.currentBounds=null,l.countryEntityId=null,l.stateEntityId=null,l.countyEntityId=null,l.cityEntityId=null,l.neighborhoodEntityId=null,l.streetEntityId=null,l.currentEntityId=null,d=ut.world,g="world"}function oi(){hi=er,et++,f.getCredentials(function(n){if(n){var t=pr+"/"+ct.latitude.toFixed(10)+","+ct.longitude.toFixed(10)+"?include=EntityId&includeEntityTypes=Neighborhood,PopulatedPlace,AdminDivision1,AdminDivision2,CountryRegion&output=json&jsonp=microsoftMapsNetworkCallback&key="+n+"&jsonso={jsono}&culture="+ii;wt.getObjectAsync(t,ou,et)}})}function bt(n,t){n?(clearTimeout(nt),nt=null,oi()):(hi===lr&&nt&&(clearTimeout(nt),nt=null),et++,hi=lr,nt=t?setTimeout(oi,t):setTimeout(oi,uf))}function si(n){var o="",e=ut[n]+1,t;while(e-->1){var r=p[e],u=tu[r],i=h[r];if(u&&i)o+="&"+u+"="+i;else{ti();return}}n!=="street"&&(t=vr.get(h[n+"EntityId"])),t?(h[n+"Bounds"]=t,ti()):f.getCredentials(function(n){if(n){var t=pr+"?key="+n+"&jsonso={jsono}&culture="+ii+"&output=json&jsonp=microsoftMapsNetworkCallback"+o;wt.getObjectAsync(t,dr,et)}})}function y(){var f=ut,u,n,i,r;pt.selectedCrumb=g;for(n in f)i=c[n],n!=="current"&&(n==="street"?i.firstChild.nodeValue="Near "+l[n]:(u=l[n],u||(u=""),i.firstChild.nodeValue=u),i.removeAttribute("title"),r=c[n+"Delim"],(ut[n]<=d||st)&&l[n]?(i&&(i.style.display="inline",n===g?t(i).add_class("pathNodeSelected"):t(i).remove_class("pathNodeSelected")),r&&n!=="world"&&(r.style.display="inline")):(i&&(i.style.display="none"),r&&n!=="world"&&(r.style.display="none")));su(),vu()}function su(){for(var n,i,r,u=0,f=w.length;u<f;u++)n=w[u],i=a[n.name],i.firstChild.nodeValue=n.value,i.removeAttribute("title"),r=a[n.name+"Delim"],n.isVisible?(i&&(n.type==="group"?a[n.name+"Container"].style.display="inline":i.style.display="inline",n.name===g?t(i).add_class("pathNodeSelected"):t(i).remove_class("pathNodeSelected")),r&&(r.style.display="inline")):(i&&(n.type==="group"?(a[n.name+"Container"].style.display="none",rt(!0)):i.style.display="none"),r&&(r.style.display="none"))}function ou(n,t){var c=t.userData,s,e,f,o,u,r,i;if(c===et&&t.success&&n.statusCode===200){s=n.resourceSets[0],e=!1;if(s.estimatedTotal>0){f=s.resources,pi(),u=f.length;while(u--){r=f[u],o=r.entityType;if(ki[o]&&o!=="Neighborhood"){i=r.address,h.country=i.countryRegion,h.state=i.adminDistrict,h.county=i.adminDistrict2,h.city=i.locality,h.street=i.addressLine,h.countryEntityId=i.countryRegionEntityId,h.stateEntityId=i.adminDistrictEntityId,h.countyEntityId=i.adminDistrict2EntityId,h.cityEntityId=i.localityEntityId,h.streetEntityId=i.addressLineEntityId;break}}u=f.length;while(u--){r=f[u];if(r.entityType==="Neighborhood"){i=r.address,h.country=i.countryRegion,h.state=i.adminDistrict,h.county=i.adminDistrict2,h.neighborhood=i.locality,h.countryEntityId=i.countryRegionEntityId,h.stateEntityId=i.adminDistrictEntityId,h.countyEntityId=i.adminDistrict2EntityId,h.neighborhoodEntityId=i.localityEntityId;break}}e=!0}else rf(),y();pt={currentCrumb:p[d],selectedCrumb:g,country:h.country,state:h.state,county:h.county,neighborhood:h.neighborhood,city:h.city,street:h.street,location:n},e&&hu()}}function cu(n,t){var i=ki[n];h[i+"Bounds"]=t,vr.add(h[i+"EntityId"],t)}function hu(){br=3,si("city"),si("state"),si("country")}function dr(n,t){var r=t.userData,i;r===et&&t.success&&n&&n.statusCode===200&&n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0].resources&&n.resourceSets[0].resources.length>0&&(i=n.resourceSets[0].resources[0],cu(i.entityType,i.bbox)),ti()}function ti(){--br||(l=h,di(),pt.currentCrumb=p[d],n.invoke(v,"breadcrumbschanged"),y())}function ru(n){var t=f.getBounds();return!(n.width>t.width||n.height>t.height)}function eu(n){var i=f.getBounds(),t=Math.min(i.width/4,i.height/4);return n.width>=t||n.height>=t}function di(){var n,u,t,r,f,i;if(st){d=ut.neighborhood;return}for(n=0,u=p.length-1;n<u;n++)if(l[p[n]]){t=l[p[n]+"Bounds"];if(t){r=gt.fromEdges(t[2],t[1],t[0],t[3]);if(ru(r)){f=r,eu(r)&&(d=n);break}else d=n}else{i=l[p[n]+"Zoom"];if(i)if(i<l.currentZoom)d=n;else if(i<l.currentZoom+2){d=n;break}}}g=p[d]}function fu(){wi(),ct=f.getTargetCenter(),h.currentZoom=f.getTargetZoom(),bt(!1,5e3),or=n.addHandler(f,"viewchangeend",uu)}function uu(){ri.areEqual(f.getTargetCenter(),sr)&&f.getTargetZoom()===cr||(yt(),st===!1?(ct=f.getCenter(),h.currentZoom=f.getZoom(),bt()):y())}function ei(n){g!==n&&(g=n,y())}function ur(){nt&&(clearTimeout(nt),nt=null),n.removeHandler(or),wr()}function yr(){kt&&(n.removeHandler(kt),kt=null,ur(),f.addComponent("breadcrumb",v))}var pr=e.Globals.bingMapsRESTServicesUrl,ii="en-us",gr=["cs-cz","da-dk","nl-nl","en-ca","en-gb","en-us","fi-fi","fr-ca","fr-fr","de-de","it-it","ja-jp","nb-no","pt-br","pt-pt","es-es","es-us","sv-se"],br=0,ft=0,ni=null,et=0,ct,it,ui=null,fi=null,k={},dt,iu=!0,v=this,st=!1,or,hf,lf="navigationBar",pt={},g="world",cf=0,er="ready",lr="wait",hi=er,sr,cr,lt,nt,uf=1e3,tt,w=[],l={world:u.getString("L_world_Text"),worldBounds:[-75,-175,75,175],countryZoom:4,stateZoom:7,countyZoom:10,cityZoom:13,neighborhoodZoom:15,streetZoom:16,current:""},h=l,ut={world:0,country:1,state:2,county:3,city:4,neighborhood:5,street:6,current:7},p=["world","country","state","county","city","neighborhood","street","current"],d=ut.world,c={},a={},vr={_cacheSize:100,_history:[],_recentlyUsed:[],_cache:{},add:function(n,t){if(!n)return;this._cache[n]=t,this._history.push(n),this._history.length>this._cacheSize&&delete this._cache[this._history.shift()]},get:function(n){return n?this._cache[n]:null}},tu={street:"addressLine",city:"locality",county:"adminDistrict2",state:"adminDistrict",country:"countryRegion"},ki={Dependent:"country",Sovereign:"country",CountryRegion:"country",AdminDivision1:"state",AdminDivision2:"county",PopulatedPlace:"city",Neighborhood:"neighborhood",Address:"street"},at=e.Globals.locale,kt;at&&(at=at.toLowerCase(),t(gr).index_of(at)!==-1&&(ii=at)),n.addHandler(f,"resize",pu),f.addComponent("breadcrumb",v),kt=n.addHandler(f,"ondispose",yr),v.enable=fu,v.disable=ur,v.dispose=yr,v.setWidth=nf,v.lockToLocation=li,v.unlockFromLocation=of,v.showCloseButton=yi,v.hideCloseButton=bi,v.addCrumb=ku,v.removeCrumb=au,v.setVisibility=du,v.selectGroupItem=vi,v.highlightCrumb=ei,v.showBookmark=hr,v.hideBookmark=yt,v.relocateCloseButton=function(n,t){c.breadcrumbUnlock.style.top=n,c.breadcrumbUnlock.style.right=t},v.getBreadcrumbs=function(){return pt},this.enable()}function tu(f,e,o){function it(){y&&(n.removeHandler(y),y=null,a&&a.dispose(),t(b).remove_event("click",nt).remove_event("mouseenter",l).remove_event("mouseleave",v),t(w).remove_event("click",tt).remove_event("mouseenter",l).remove_event("mouseleave",v),s.parentNode.removeChild(s))}function tt(n){i(n),h(f,n),ht()?l():d(),f.setView({zoom:f.getTargetZoom()+1})}function nt(n){i(n),h(f,n),ht()?l():d(),f.setView({zoom:f.getTargetZoom()-1})}function l(){k(),o.getZoomBarVisible()&&(c||(c=r("div","NavBar_zoomDrop"),c.style.cssText="position:absolute;display:none;",a=new gr(f,c,o.getZoomBarToggle()),s.firstChild?s.insertBefore(c,s.firstChild):s.appendChild(c),o.getZoomBarToggle()&&t(c).add_event("mouseenter",l).add_event("mouseleave",v)),c.style.display==="none"&&(c.style.display="",a.show()),ht()&&a.resetZoomBarTimer())}function v(){k(),p=window.setTimeout(d,1e3)}function d(){k(),o.getZoomBarToggle()&&c&&(c.style.display="none")}function k(){p&&(window.clearTimeout(p),p=null),g&&(window.clearTimeout(g),g=null)}var rt=this,s,w,b,c,a,p,g,y;s=r("div",o.getClassName()),ot(s),b=vt("NavBar_zoomOut",u.getString("L_zoomOutTooltip_Text")),t(b).add_event("click",nt).add_event("mouseenter",l).add_event("mouseleave",v).set_attr("uici","NB.ZC.ZoomOut"),w=vt("NavBar_zoomIn",u.getString("L_zoomInTooltip_Text")),t(w).add_event("click",tt).add_event("mouseenter",l).add_event("mouseleave",v).set_attr("uici","NB.ZC.ZoomIn"),o.getZoomOutVisible()&&s.appendChild(b),o.getZoomInVisible()&&s.appendChild(w),e.appendChild(s),o.getZoomBarToggle()||l(),o.getDomElement=function(){return s},y=n.addHandler(f,"ondispose",it),this.dispose=it}function nu(t,i,u){function v(){if(c){n.removeHandler(c),c=null;var t=e.length;while(t--)n.removeHandler(e[t][2]);h.dispose(),f.parentNode.removeChild(f)}}var e=[["showmaptypemenu",function(n){o(a.getNavBar(t),"showmaptypemenu",n)}],["hidemaptypemenu",function(n){o(a.getNavBar(t),"hidemaptypemenu",n)}]],h,f=r("div",u.getClassName()),y,l,s,c;ot(f),y=r("span","NavBar_separator",f),l={disableBirdseye:u.getDisableBirdseye()},h=u.getMapTypes()!==null?new dr(t,f,this,l):new rr(t,f,this,l),i.appendChild(f),u.getDomElement=function(){return f},s=e.length;while(s--)e[s][2]=n.addHandler(h,e[s][0],e[s][1]);c=n.addHandler(t,"ondispose",v),this.dispose=v}function wr(t,i,u){function y(){s&&(n.removeHandler(s),n.removeHandler(b),s=null,f.parentNode.removeChild(f)),v&&n.removeHandler(v),a&&n.removeHandler(a)}for(var l=new p,f=r("div",u.getClassName()),w=u.getLength(),o,h,e=0;e<w;e++)o=u.get(e),h=c.getRenderer(o),typeof h=="function"&&new h(t,f,o);u.getStopPropagation()&&ot(f),i.appendChild(f),u.getDomElement=function(){return f},l.setContext(f);var b=n.addHandler(u,"entitychanged",function(n){n&&n.entity==u&&(n.handled=!0,f.className=u.getClassName(),u.getStopPropagation()?ot(f):ci(f))}),v=n.addHandler(u,"entityadded",function(n){l.add(n.entity)}),a=n.removeHandler(u,"entityremoved",function(n){l.remove(n.entity)}),s=n.addHandler(t,"ondispose",y);this.dispose=y}function p(n){function e(n){var t=document.createElement("div");return t.className="item",t.style.marginRight="1px",t.entity=n,t}function u(n){var h,o,u,e,s;if(!r)return;for(h=n===p.Layout.TopBottom||n===p.Layout.BottomTop?"none":"left",((i===p.Layout.TopBottom||i===p.Layout.LeftRight)&&(n===p.Layout.BottomTop||n===p.Layout.RightLeft)||(i===p.Layout.BottomTop||i===p.Layout.RightLeft)&&(n===p.Layout.TopBottom||n===p.Layout.LeftRight))&&t.reverse(),o=0;o<t.length;o++)u=t[o],e=u.entity,e&&(s=e&&e.getDomElement&&e.getDomElement(),s?u.appendChild(s):u.appendChild(e),u.entity=undefined),u.style.cssFloat!==undefined?u.style.cssFloat=h:u.style.styleFloat!==undefined&&(u.style.styleFloat=h),r.appendChild(u);r.appendChild(f)}var r=n,t=[],i=p.Layout.TopBottom,f=document.createElement("span");f.style.cssText="display:block;height:0;width:0;line-height:0;font-size:0;clear:both;",this.setContext=function(n){r||(r=n,u(i))},this.add=function(n){var r=e(n);t.push(r),u(i)},this.insert=function(n,i){var r=e(n);t.splice(i,0,r)},this.pop=function(){t.pop()},this.removeAt=function(n){t.splice(n,1)},this.remove=function(n){var i=t.length;while(i--)if(children[i]===n){this.removeAt(i);break}},this.clear=function(){t.length=0},this.setLayout=function(n){n!==i&&(u(n),i=n)}}function wi(n){var r=n,i;t(n).add_class("shadowtextDark"),i=document.createElement("span"),r.appendChild(i),this.setColorsForDarkBackground=function(){t(r).swap_class("shadowtextDark","shadowtextLight")},this.setColorsForLightBackground=function(){t(r).swap_class("shadowtextLight","shadowtextDark")},this.setHtmlContent=function(n){i.innerHTML=n},this.setTextContent=function(n){i.innerHTML="",i.appendChild(document.createTextNode(n))}}function ar(t,i,u){function c(){p(),e=window.setTimeout(k,b)}function p(){e!=null&&window.clearTimeout(e)}function k(){e=null,f.getCopyrights(d)}function d(n){for(var i=n.concat(a).sort(function(n,t){return(n||"").length>(t||"").length}),r=i.length,t=0;t<r;t++)i[t]&&(i[t]='<span class = "copyrightAttribution">'+i[t]+"</span>");l.setHtmlContent(i.join(""))}function h(){ut.getImageryBackground(t.getImageryId())===ut.light?l.setColorsForLightBackground():l.setColorsForDarkBackground()}function w(){if(o){n.removeHandler(o),o=null;var t=s.length;while(t--)n.removeHandler(s[t]);s.length=0}}var y=r("div",u.getClassName(),i),s,o,v;u.getDomElement=function(){return y};var l=new wi(y),f=t,a=[],e=null,b=1e3;c(),h(),s=[n.addThrottledHandler(f,"copyrightchanged",c,2e3),n.addHandler(f,"imagerychanged",h),n.addHandler(f,"modechanged",h),n.addHandler(f,"viewchangestart",p)],o=n.addHandler(t,"ondispose",w),v=new function(){this.get_customAttributions=function(){return a},this.set_customAttributions=function(n){a=n,c()}},t.addComponent("copyright",v)}function cr(i,f,e){function ri(){var b,k,f,p;nt=n.addHandler(i,"ondispose",ii),gt=ft.isIE6,a=r("div",e.getClassName(),kt),e.getDomElement=function(){return a},(ht||yt)&&(l=t(a),l.add_event("mouseover",wt).add_event("mouseout",bt).add_event("mousedown",s).add_event("mouseup",s).add_event("dblclick",s).add_event("contextmenu",s).add_event("click",s));if(ht){h=document.createElement("a"),h.href="#",h.target="mc_bingMaps",h.title=u.getString("L_BingLogoTooltip_Text"),w=h,n.addHandler(i,"viewchangeend",ut);try{ut()}catch(d){}}else h=document.createElement("div");h.id="PoweredByLogo",it(h,st),a.appendChild(h),yt&&(b=document.createElement("div"),b.className="LogoSearchContainer",k=document.createElement("div"),k.className="LogoSearchGroup",b.appendChild(k),f=document.createElement("input"),f.id="LogoSearchInput",ft.useXHR||(f.type="text"),f.maxLength=60,f.className="watermark",f.value=u.getString("L_BingSearchWatermark_Text"),y=!0,k.appendChild(f),p=document.createElement("input"),p.id="LogoSearchGo",ft.useXHR||(p.type="button"),p.title=u.getString("L_BingSearchGoTooltip_Text"),k.appendChild(p),o=t(b),o.set_style({display:"none"}),v=!1,o.add_event("mouseover",vt).add_event("mouseout",at).add_event("mousedown",s).add_event("mouseup",s).add_event("dblclick",s).add_event("contextmenu",s),g=t(p),g.add_event("blur",ot).add_event("focus",rt).add_event("click",et),c=t(f),c.add_event("blur",ct).add_event("focus",lt).add_event("keydown",pt),kt.appendChild(b))}function ii(){nt&&(n.removeHandler(nt),nt=null),w&&n.removeHandler(ut),l&&l.remove_event("mouseover",wt).remove_event("mouseout",bt).remove_event("mousedown",s).remove_event("mouseup",s).remove_event("dblclick",s).remove_event("contextmenu",s).remove_event("click",s),a.parentNode.removeChild(a),o&&(o.remove_event("mouseover",vt).remove_event("mouseout",at).remove_event("mousedown",s).remove_event("mouseup",s).remove_event("dblclick",s).remove_event("contextmenu",s),g.remove_event("blur",ot).remove_event("focus",rt).remove_event("click",et),c.remove_event("blur",ct).remove_event("focus",lt).remove_event("keydown",pt),o.element().parentNode.removeChild(o.element())),d(),w=null,h=null,a=null,g=null,c=null,o=null,l=null}function it(n,t){gt&&(n.style.background="",n.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+k.domain+"/i/"+t+'", sizingMethod="scale")')}function d(){o&&p&&(window.clearTimeout(p),p=null)}function tt(){o&&b&&(d(),p=window.setTimeout(fi,2e3))}function dt(){y||c.element().value||(c.element().value=u.getString("L_BingSearchWatermark_Text"),c.add_class("watermark"),y=!0)}function ni(){y&&(c.element().value="",c.remove_class("watermark"),y=!1)}function fi(){p=null,ui(),b=!1}function ui(){o.set_style({display:"none"}),l.remove_class("Active"),it(h,st),o.set_style("width",null)}function ut(){if(w){var t=i.getCenter();t&&(w.href=k.logoBingMapsLink.replace("{0}",t.latitude).replace("{1}",t.longitude).replace("{2}",i.getZoom()))}}function vt(){d()}function at(){v||tt()}function ot(){v=!1,tt()}function rt(){v=!0,d()}function ct(n){ot(n),dt()}function lt(n){rt(n),ni()}function et(){var t=c.element().value,i;!y&&typeof t=="string"&&t.length>0&&(c.element().value="",dt(),t=or.encodeUrl(t),i=k.logoBingSearchUrl.replace("{0}",t),window.open(i,"mc_bingSearch"),tt())}function pt(n){v&&n.keyCode===13&&et()}function wt(){d(),o&&!b&&(o.set_style({display:""}),b=!0,l.add_class("Active"),it(h,ti))}function bt(){o?b&&!v&&tt():(l.remove_class("Active"),it(h,st))}var kt=f,ht=e.getClickable(),yt=e.getEnableSearch(),ei=this,gt=!1,h=null,b=!1,v=!1,y=!1,p=null,l=null,o=null,c=null,g=null,a=null,w=null,nt,st="logo2.png",ti="logo_no_shadow2.png";ri()}function pi(n,i){function w(n){for(var r=Math.floor(n),i,t=0;t<h.length;t++){i=h[t];if(r>i)return i}return 1}function p(n,t){for(var r,i=0;i<c.length;i++){r=c[i];if(n>r)return r*t}return t}function r(n){var u=Math.log(n)/y,r=Math.floor(u),t=Math.pow(10,r),i=n/t;return 1===t?w(i):p(i,t)}var y=2.3025850929940459,e=n,l=i,v=0,a=0,h=[5,2],c=[5,2.5,2],o,f,s;t(e).add_class("ScaleBar"),o=document.createElement("span"),e.appendChild(o),f=new wi(o),s=document.createElement("span"),s.className="scalerect",e.appendChild(s),this.getMaxWidth=function(){return v},this.setMaxWidth=function(n){return v=n,n},this.getActualWidth=function(){return a},this.setActualWidth=function(n){return a=n,n},this.setColorsForBackground=function(n){n===ut.light?f.setColorsForLightBackground():f.setColorsForDarkBackground()},this.setScale=function(n){var f,t,i,s,e,o;l===lt.kilometersMeters?(s=n*this.getMaxWidth(),s>d.metersPerKm?(t=r(s/d.metersPerKm),f=Math.floor(t*d.metersPerKm/n),i=u.getString("L_scaleBarKilometers_Text")):(t=r(s),f=Math.floor(t/n),i=u.getString("L_scaleBarMeters_Text"))):(e=n*d.feetPerMeter,o=e*this.getMaxWidth(),o>d.feetPerMile?(t=r(o/d.feetPerMile),f=Math.floor(t*d.feetPerMile/e),i=u.getString("L_scaleBarMiles_Text")):l===lt.milesFeet?(t=r(o),f=Math.floor(t/e),i=u.getString("L_scaleBarFeet_Text")):(t=r(o/d.feetPerYard),f=Math.floor(t*d.feetPerYard/e),i=u.getString("L_scaleBarYards_Text"))),this.setControlScale(f,i.replace("{num}",t))},this.setControlScale=function(n,t){this.setActualWidth(n+2),e.style.width=this.getActualWidth().toFixed()+"px",f.setTextContent(t)}}function pr(n){var e=200,u=n,i,f,r;t(u).add_class("DoubleScaleBar"),_scaleBarMiElement=document.createElement("span"),i=new pi(_scaleBarMiElement,lt.milesFeet),i.setMaxWidth(e/2),u.appendChild(_scaleBarMiElement),f=document.createElement("span"),r=new pi(f,lt.kilometersMeters),r.setMaxWidth(e/2),u.appendChild(f),this.setColorsForBackground=function(n){r.setColorsForBackground(n),i.setColorsForBackground(n)},this.setScale=function(n){r.setScale(n),i.setScale(n)}}function er(t,i,u){function s(){o.setScale(t.getMetersPerPixel())}function l(){o.setColorsForBackground(ut.getImageryBackground(t.getImageryId()))}function c(){if(e){n.removeHandler(e),e=null;var t=f.length;while(t--)n.removeHandler(f[t]);f.length=0}}var h=r("div",u.getClassName(),i),o,f,e;u.getDomElement=function(){return h},o=new pr(h),o.setScale(t.getMetersPerPixel()),f=[n.addHandler(t,"viewchangeend",s),n.addHandler(t,"imagerychanged",l),n.addHandler(t,"modechanged",s)],e=n.addHandler(t,"ondispose",c)}function vr(i,r){function lt(){var n=i.getOptions();return!(n.disablePanning||n.disableMouseInput||n.disableUserInput)}function ct(){var n=i.getOptions();return!(n.disableZooming||n.disableMouseInput||n.disableUserInput)}function bt(n){var r=Math.round(i.getTargetZoom()),t=1<<r,u=new yt(r,Math.floor(n.x*t),Math.floor(n.y*t));return ti.fromTileId(u,!1)}function kt(){var n=i.getOptions().labelOverlay;ot=n===rt.hidden?!0:r}function ii(){var n=null,t=i.getImageryId();switch(t){case"Road":n=fi;break;case"Aerial":n=hi;break;case"EnhancedBirdseye":case"NativeBirdseye":o.removeLayer(a),a=null;break;default:c.removeLayer(a),a=null,st()}n!==a&&(et(),c.removeLayer(a),c.addLayer(n),a=n,it())}function oi(n){p=n}function ui(){s&&(n.removeHandler(s),s=null,h||(p=null,h=n.addHandler(i,"mousemove",oi)),u&&nt())}function it(){h&&(n.removeHandler(h),h=null),s||(s=n.addHandler(i,"mousemove",ut));var r=Math.round(i.getTargetZoom()),t=l.getMapTargetMercatorBounds(i);c.loadQuadkeysForMercatorBounds(t,r),p&&(ut(p),p=null)}function ei(n){return y&&(window.clearTimeout(y),y=null),n.handled=!1,!1}function si(n){if(n.targetType!=="map"&&n.target.pointerEvents!=="none"||n.mouseMoved)return n.handled=!1,!1;if(y)return n.handled=!0,!0;var i=new f(n.getX(),n.getY()),t=pt(i);return t?(y=window.setTimeout(function(){ci(t.hotRegion,i,t.worldPoint)},250),n.handled=!0,!0):(n.handled=!1,!1)}function ci(t,r,u){var s,h,a,e;y=null,s={hotRegion:t,cancelDefault:!1,clickLocation:i.tryPixelToLocation(r,null,{normalizeLongitude:!1})},n.invoke(o,"click",s),h=t.bmv;if(!s.cancelDefault&&h){var v=h.tl,l=h.br,b=h.z,p=h.c,w=360*Math.floor(u.x),c=180*Math.floor(u.y),f;v&&l?(a=gt.fromEdges(v.y+c,v.x+w,l.y+c,l.x+w),tt(a.center,s.clickLocation),f={bounds:a,animate:!0},lt()||(e=i.getCenter(),tt(e,s.clickLocation),f.center=e),ct()||(f.center=f.center||f.bounds.center,delete f.bounds),i.setView(f)):p&&b&&(e=lt()?new ri(p.y+c,p.x+w):i.getCenter(),tt(e,s.clickLocation),f={center:e,zoom:ct()?b:i.getZoom(),animate:!0},i.setView(f))}}function tt(n,t){while(n.longitude-t.longitude>180&&n.longitude>t.longitude)n.longitude-=360;while(t.longitude-n.longitude>180&&n.longitude<t.longitude)n.longitude+=360}function pt(n){var s=i.getMode().tryPixelToMercatorPoint,t,l,r,e,u,o;if(s){t=s(n),l=new f(t.x,t.y),t.x=(t.x%1+1)%1,t.y=(t.y%1+1)%1;var v=bt(t),h=c.getTileHotRegionsForQuadkey(v),a=h.length;while(a--){r=h[a];if(ot&&r.type==="label")continue;if(r.getMercatorBounds().contains(t)){e=r.boundRegions,u=e.length;while(u--){o=e[u];if(o.getMercatorBounds().contains(t))if(o.isMercatorPointInBoundRegion(t))return{hotRegion:r,worldPoint:l}}}}}return null}function nt(){var t={hotRegion:u,cancelDefault:!1};n.invoke(o,"leave",t),!t.cancelDefault&&v&&(ht.set_style({cursor:v}),v=null),u=null}function ut(i){var s;if(i.targetType!=="map"&&i.target.pointerEvents!=="none")if(u)var c=!0,l=!1,e=null;else return;if(!c)var a=new f(i.getX(),i.getY()),h=pt(a),e=h&&h.hotRegion,c=u&&(!e||e.id!==u.id),l=e&&(!u||u.id!==e.id);c&&nt(),u=e,l&&(s={hotRegion:e,cancelDefault:!1},n.invoke(o,"enter",s),!s.cancelDefault&&e&&e.bmv&&(!r||e.type!=="label")&&(v=ht.get_style("cursor"),ft.isWebkit&&v.toLowerCase().indexOf("/cursors/grab.cur")!==-1?v=wt.Grab:t.Browser.is_ie&&(v+=", "+wt.Grab),(lt()||ct())&&ht.set_style({cursor:"pointer"})))}function et(){s||(s=n.addHandler(i,"mousemove",ut)),w||(w=n.addHandler(i,"click",si)),g||(_mapMouseClickDoubleHandle=n.addHandler(i,"dblclick",ei)),b||(b=n.addHandler(i,"viewchangeend",it)),d||(d=n.addHandler(i,"viewchangestart",ui))}function st(){h&&(n.removeHandler(h),h=null),s&&(n.removeHandler(s),s=null),w&&(n.removeHandler(w),w=null),g&&(n.removeHandler(g),g=null),b&&(n.removeHandler(b),b=null),d&&(n.removeHandler(d),d=null),u&&nt()}function vt(){c.getLayerCount()>0?et():st()}var o=this,s,w,g,ni,dt,b,d,ot=r,c=new yr,wt={Grab:"url("+k.cursorPath+"grab.cur)"+ft.cursorHotspot+", default"},ht=t(i.getRootElement()),v=null,u=null,fi=new at(e.Globals.hotRegionsRoadUrl,null,i,"r"),hi=new at(e.Globals.hotRegionsAerialWithLabelsUrl,null,i,"a"),a=null,p,h,y;o.enable=function(){et(),ni=n.addHandler(i,"maptypechanged",kt),dt=n.addHandler(i,"imagerychanged",ii),kt(),ii()},o.disable=function(){st(),n.removeHandler(dt),n.removeHandler(ni),u=null},o.createLayer=function(n,t,i,r){return new at(n,t,i,r)},o.addLayer=function(n,t){c.addLayer(n,t),vt(),it()},o.removeLayer=function(n){c.removeLayer(n),vt()},i.addComponent("hotRegions",o),o.enable()}function pt(n,t){function a(n){var i=[],r=n.length,t;while(r--)t=n[r],i.push(new f(t.x,t.y));return i}var i,e,u,r,o,c,s;n.boundRegions=[];var v=n.boundRegions,l=n.brs,h=l.length;while(h--)i=l[h],si(i)?(r=a(i),r.push(r[0]),e=new dt(t,r),v.push(e)):i&&i.x&&i.y&&i.r&&(e=new bt(t,new f(i.x,i.y),i.r),v.push(e));if(n.hbrs){n.highlightBoundRegions=[];var p=n.highlightBoundRegions,y=n.hbrs,h=y.length;while(h--){u=y[h];if(u)switch(u.t){case"polygon":r=a(u.v),r.push(r[0]),o=new dt(t,r),p.push(o);break;case"circle":o=new bt(t,new f(u.x,u.y),u.r),p.push(o)}}}return c=/^YN/i,s=n.ypid,s&&c.test(s)&&(n.ypid=s.substring(2)),n.getLocationCenter=pt.prototype.getLocationCenter,n.getMercatorBounds=pt.prototype.getMercatorBounds,n}function ei(n){this.hotRegions=n}function dt(n,t){this._tileId=n,this._quadkeyTilePoints=t}function bt(n,t,i){this._tileId=n,this._quadkeyTilePointCenter=t,this._quadkeyTilePointRadius=i}function lr(i){function b(n){var r=!1,t;return n.hotRegion.type==="vm"&&(e.VenueMaps?(h||(h=new e.VenueMaps.VenueMapFactory(i)),t=h.getActiveVenueMap(),t&&n.hotRegion.vmid===t.id||(r=!0)):r=!0),r}function ct(n){b(n)&&(n.cancelDefault=!0,s!==n.hotRegion.vmid&&rt(n.hotRegion.vmid))}function lt(n){b(n)&&(n.cancelDefault=!0,o=l.get_style("cursor"),ft.isWebkit&&o.toLowerCase().indexOf("/cursors/grab.cur")!==-1?o=d.Grab:t.Browser.is_ie&&(o+=", "+d.Grab),s===n.hotRegion.vmid?l.set_style({cursor:"wait"}):l.set_style({cursor:"pointer"}),f=n.hotRegion,ht())}function vt(n){b(n)&&(o&&(l.set_style({cursor:o}),o=null),w(),f=null)}function w(){nt(),a&&(i.entities.remove(a),a=null)}function ht(){var r,u,n,t;w();if(f){a=new nr({zIndex:-1}),r=f.highlightBoundRegions?f.highlightBoundRegions:f.boundRegions,u=r.length;while(u--)n=r[u],n.type==="polygon"&&(t=new fr(n.getLocations(),{strokeThickness:1,strokeColor:new di(255,0,0,0),fillColor:new di(0,0,0,0)}),t.pointerEvents="none",a.push(t));i.entities.push(a),s!==f.vmid&&yt()}}function yt(){if(!r){g=n.addHandler(i,"mousemove",at),r=document.createElement("span"),r.style.cssText="position:absolute;visibility:hidden;background-color:white;border: 1px solid black;padding:5px;";var t=f.name?u.getString("L_VenueMapExplorerTooltip_Text").replace("{0}",f.name):u.getString("L_VenueMapExplorerTooltip_Text").replace(" {0}","");r.appendChild(document.createTextNode(t)),i.getRootElement().appendChild(r)}}function nt(){r&&(n.removeHandler(g),r.parentNode.removeChild(r),r=null)}function at(n){r.style.visibility="visible",r.style.left=i.getWidth()/2+16+n.getX()+"px",r.style.top=i.getHeight()/2+16+n.getY()+"px"}function st(){v||(v=n.addHandler(i.getComponent("hotRegions"),"click",ct),p=n.addHandler(i.getComponent("hotRegions"),"enter",lt),y=n.addHandler(i.getComponent("hotRegions"),"leave",vt))}function it(){v&&(n.removeHandler(v),v=null),p&&(n.removeHandler(p),p=null),y&&(n.removeHandler(y),y=null)}function rt(n){ot(n),e.loadModule("Microsoft.Maps.VenueMaps",{callback:function(){h||(h=new e.VenueMaps.VenueMapFactory(i));var t=h.getActiveVenueMap();t&&t.dispose(),h.create({venueMapId:n,success:ut,error:et})}})}function ut(n){if(s===n.id){var r=n.bestMapView;r.animate=!0,i.setView(r),n.show(),tt(!0)}}function ot(t){s=t,f&&(l.set_style({cursor:"wait"}),nt()),n.invoke(c,"activationstart",t)}function tt(t){var i=s;s=null,f&&(o&&(l.set_style({cursor:o}),o=null),w()),n.invoke(c,"activationend",{isSuccess:t,venueMapId:i})}function et(n,t){s===t.venueMapId&&tt(!1)}var c=this,v,p,y,h,s,o,d={Grab:"url("+k.cursorPath+"grab.cur)"+ft.cursorHotspot+", default"},l=t(i.getRootElement()),f,a,r,g;c.enable=function(){st()},c.disable=function(){it(),s=null},i.addComponent("venueMapsExplorer",c),c.enable()}function g(){return null}function ur(n,t){function o(r,f){var c,e,o,h;r||f&&f.httpStatus===401?(c=r&&r.authenticationResultCode=="ValidCredentials",i=c&&typeof r.sessionId=="string"&&r.sessionId.length>0?r.sessionId:null,c||(e=document.createElement("div"),e.style.cssText="position:absolute; width:100%; top:50%; text-Align:center",o=document.createElement("div"),o.innerHTML=u.getString("L_invalidcredentials_text"),o.style.cssText="background: #f8f7f5; padding:10px; color: #000;",e.appendChild(o),h=n&&n.getRootElement(),h&&h.appendChild(e))):i=t,s()}var e=this,f=k.logServiceUriFormat,r,h,i;if(f){r=[],f=f.replace(/{credentials}/,t),this.getCredentials=function(n){r.push(n)};function s(){e.getCredentials=function(n){n(i)};var n=r.length;while(n--)e.getCredentials(r[n])}wt.getObjectAsyncWithNoJsonso(f,o,kt.getNext(),1e4)}else i=t,this.getCredentials=function(n){n(i)}}function c(t){function r(n){if(!n||n.handled!==!0){f&&f.dispose();var i=c.getRenderer(t.overlays);typeof i=="function"&&(f=new i(t,t.getRootElement(),t.overlays))}}var f,u=[["entityadded",r],["entityremoved",r],["entitychanged",r]],i=u.length;while(i--)u[i][2]=n.addHandler(t.overlays,u[i][0],u[i][1]);this.update=r}function vi(n){this.setOptions(n)}function ai(n){this.setOptions(n)}function li(n){this.setOptions(n)}function nt(n){nt.baseConstructor.call(this,n),this.setOptions(n)}function fi(n){this.setOptions(n)}function oi(n){this.setOptions(n)}function ui(n){this.setOptions(n)}function ki(n){this.setOptions(n)}var e=window.Microsoft.Maps,y=e.InternalNamespaceForDelay,u=Microsoft.Maps.Resources,v=y.Common,sr=y.DelayMap,kt=y.IdGenerator,wt=y.Network,hi=y.PRF,w,ut,lt,d,st,tt;hi.start("mapdelay");var t=e.Gimme,k=e.Globals,iu=e.Map,f=e.Point,rt=e.LabelOverlay,n=e.Events,gt=e.LocationRect,ri=e.Location,ru=e.Pushpin,b=e.MapTypeId,nr=e.EntityCollection,it=y.MercatorCube,gi=y.SpatialCache,ti=e.QuadKey,yt=y.TileId,uu=e.AltitudeReference,ii=y.Rect,di=e.Color,fr=e.Polygon,ct=y.MapMath,ft=y.Quirks,or=y.IOSec,a=new function(){function s(n,t,i){var r=document.createElement(n||"div");return t&&(r.className=t),i&&i.appendChild(r),r}function e(n){var i,t=u.length;while(t--)u[t][0]===n&&(i=u[t][1]);return i}function o(t,i,r){n.invoke(t,i,r)}function f(n){n.stopPropagation()}function r(n){h=!0,n.stopPropagation()}var u=[],h=!1;this.addIgnoreEvents=function(n){t(n).add_event("mousedown",i).add_event("mouseup",i).add_event("mousewheel",i).add_event("dblclick",i).add_event("contextmenu",i).add_event("keydown",f).add_event("keyup",i).add_event("click",i).add_event("touchstart",r).add_event("touchmove",r).add_event("touchend",r).add_event("touchcancel",r)},this.removeIgnoreEvents=function(n){t(n).remove_event("mousedown",i).remove_event("mouseup",i).remove_event("mousewheel",i).remove_event("dblclick",i).remove_event("contextmenu",i).remove_event("keydown",f).remove_event("keyup",i).remove_event("click",i).remove_event("touchstart",r).remove_event("touchmove",r).remove_event("touchend",r).remove_event("touchcancel",r)},this.createElement=s,this.createToolButton=function(n,t){var i=s("a","NavBar_button NavBar_toolButton "+(n||""));return i.href="#",t&&(i.title=t),i},this.registerNavigationBar=function(n,t){u.push([n,t])},this.removeNavigationBar=function(n){var t=u.length;while(t--)if(u[t][0]===n){u.splice(t,1);break}},this.reportAction=function(n,t){var r=e(n),i;r&&(i=t.currentTarget,i&&o(r,"navbaraction",{id:i.id,typeName:i.className,title:i.title}))},this.getNavBar=e,this.invokeEvent=o,this.ignoreEvent=function(n){n.stopPropagation(),n.preventDefault()},this.stopPropagation=f,this.isTouch=function(){return h},this.addClass=function(n,t){var i=new RegExp("(^| )"+t+"( |$)");return n+(n.search(i)===-1?" "+t:"")},this.removeClass=function(n,t){var i=new RegExp("(^| )"+t+"( |$)");return n.replace(i,"$1").replace(/^\s+|\s+$/g,"")}},et={auto:new function(){v.defineGetter(this,"title",{get:function(){return u.getString("L_mapTypeAutoName_Text")}}),v.defineGetter(this,"description",{get:function(){return u.getString("L_mapTypeAutoDescription_Text")}})},r:new function(){v.defineGetter(this,"title",{get:function(){return u.getString("L_mapTypeRoadName_Text")}}),v.defineGetter(this,"description",{get:function(){return u.getString("L_mapTypeRoadDescription_Text")}})},a:new function(){v.defineGetter(this,"title",{get:function(){return u.getString("L_mapTypeAerialName_Text")}}),v.defineGetter(this,"description",{get:function(){return u.getString("L_mapTypeAerialDescription_Text")}})},be:new function(){v.defineGetter(this,"title",{get:function(){return u.getString("L_mapTypeBirdsEyeName_Text")}}),v.defineGetter(this,"description",{get:function(){return u.getString("L_mapTypeBirdsEyeDescription_Text")}})},cb:new function(){v.defineGetter(this,"title",{get:function(){return u.getString("L_mapTypeCollinsBartName_Text")}}),v.defineGetter(this,"description",{get:function(){return u.getString("L_mapTypeCollinsBartDescription_Text")}})},os:new function(){v.defineGetter(this,"title",{get:function(){return u.getString("L_mapTypeOrdnanceSurveyName_Text")}}),v.defineGetter(this,"description",{get:function(){return u.getString("L_mapTypeOrdnanceSurveyDescription_Text")}})}};w={left:0,middle:1,right:2,getName:function(n){switch(n){case w.left:return"left";case w.middle:return"middle";case w.right:return"right"}return""},isValid:function(n){return n===w.left||n===w.middle||n===w.right}},e.ClientRegion=w,p.Layout={TopBottom:"topBottom",BottomTop:"bottomTop",LeftRight:"leftRight",RightLeft:"rightLeft"},ut={light:0,dark:1},ut.getImageryBackground=function(n){return n==="Aerial"||n==="EnhancedBirdseye"||n==="NativeBirdseye"||n==="streetside"?ut.dark:ut.light},lt={milesFeet:0,milesYards:1,kilometersMeters:2},d={metersPerKm:1e3,yardsPerMeter:1.0936133,yardsPerMile:1760,feetPerYard:3,feetPerMeter:3.2808399,feetPerMile:5280},pt.prototype={getLocationCenter:function(){var i=this.highlightBoundRegions?this.highlightBoundRegions:this.boundRegions,u=0,e=0,n=i.length,r=n,t;while(r--)t=i[r].getMercatorBounds().getCenter(),u+=t.x,e+=t.y;return this._locationCenter=it.toLocation(new f(u/n,e/n)),this.getLocationCenter=function(){return this._locationCenter},this._locationCenter},getMercatorBounds:function(){var i=null,t=null,u=null,f=null,h=this.boundRegions,r=this.boundRegions.length-1,n;if(r>-1){n=h[r].getMercatorBounds(),i=n.y,t=n.x,u=n.getRight(),f=n.getBottom();while(r--){var n=h[r].getMercatorBounds(),c=n.y,s=n.x,e=n.getRight(),o=n.getBottom();c<i&&(i=c),o>f&&(f=o),s<t&&(t=s),e>u&&(u=e)}}return this._mercatorBounds=new ii(t,i,u-t,f-i),this.getMercatorBounds=function(){return this._mercatorBounds},this._mercatorBounds}},ei.prototype={getHotRegionsForTile:function(n){var r={},v,s,t,a,e,u;for(this._tileIndexedHotRegions=r,v=n.length,s=this.hotRegions,t=0,a=s.length;t<a;t++){var o=s[t],i=o.getMercatorBounds(),y=new f(i.x,i.y),p=new f(i.getRight(),i.getBottom()),w=l.getMercatorBoundsDescriptor(y,p,v),h=l.getQuadkeysForBounds(w),c=h.length;while(c--)e=h[c],u=r[e],u?u.push(o):r[e]=[o]}return this.getHotRegionsForTile=function(n){var t=this._tileIndexedHotRegions[n];return t?t:[]},this.getHotRegionsForTile(n)}};var at=function(n,t,i,r){function d(n,t){return n.z-t.z}function c(n){var t;return t=n==="l1"?1:n==="l2"?2:n.length+2}function rt(n,t){var f=c(n),o=e[f],r=h[f],p,y,s,u,w,v;o||(o=e[f]={},r=h[f]=[]);if(o[n])return!1;o[n]=t,r.push(n),p=(Math.ceil(i.getHeight()/1024)+2*a)*(Math.ceil(i.getWidth()/1024)+2*a);while(r.length>p){for(y||(y=tt(l.getMapTargetMercatorBounds(i),Math.max(f-2,0))),s=!1,u=0,w=r.length;u<w;u++)if(it(y,r[u])===-1){v=r.splice(0,u+1),delete o[v.pop()],r=r.concat(v),s=!0;break}if(!s)break}return!0}function it(n,t){var i=n.length;while(i--)if(n[i]===t)return i;return-1}function tt(n,t){var u=new f(n.left,n.top),r=new f(n.right,n.bottom),i=l.getMercatorBoundsDescriptor(u,r,t);return l.getQuadkeysForBounds(i)}function k(n,t){var i,f,e;delete u[t];if(n&&b(n.hrs)){i=null,i=t==="l1"?new yt(-1,0,0):t==="l2"?new yt(0,0,0):ti.toTileId(t);var r=[],o=n.hrs,s=o.length;while(s--)f=new pt(o[s],i),r.push(f);r.sort(d),e=new ei(r),rt(t,e)}}function s(i){var v=c(i),a=e[v],f,s,o,l,h;a&&a[i]||(p(),u[i]||(u[i]={requestTime:+new Date},f="",s="",i==="l1"?s="&lod=1":i!=="l2"&&(f=i),o="0",f!==""&&(o=f.charAt(f.length-1)),l=typeof t=="function"?t(i):n,h=l.replace("{subdomain}",o).replace("{quadkey}",f).replace("{jsonp}",nt).replace("{jsonso}",encodeURIComponent(r+"|"+i))+s,wt.getObjectAsyncCacheFriendly(h)))}function v(){u={}}function p(){var i=+new Date,t,n;for(t in u)n=u[t].requestTime,n&&i-n>g&&delete u[t]}function y(n){var r=l.tileQuadkeyToSheetQuadkey(n),u=n.length,i=e[u],t;if(i){t=i[r];if(t)return t.getHotRegionsForTile(n);s(r)}return[]}function w(n,t){var i;if(t===1)s("l1");else if(t===2)s("l2");else{var c=Math.max(t-2,0),v=new f(n.left,n.top),h=new f(n.right,n.bottom),a=l.getMercatorBoundsDescriptor(v,h,c),o=l.getQuadkeysForBounds(a),u=e[t],r=o.length;while(r--)i=o[r],u&&u[i]||s(i)}}function b(n){return typeof Array.isArray=="function"?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"}var o=this,nt="microsoftMapsHotRegionsCacheCallback",e={},h={},a=1,g=1e4,u={};o.getTileHotRegionsForQuadkey=y,o.loadQuadkeysForMercatorBounds=w,o.getHotRegionsNetworkCallback=k,o.clearRequestedQuadkeys=v,o.getId=function(){return r}},yr=function(){function i(t){var i=n.length;while(i--)if(n[i].layer.getId()===t)return i;return null}function o(t,r){if(r){var f=decodeURIComponent(r).split("|"),e=f[0],o=f[1],u=i(e);u!==null&&n[u].layer.getHotRegionsNetworkCallback(t,o)}}function c(t){var i=[],r=n.length;while(r--)i=i.concat(n[r].layer.getTileHotRegionsForQuadkey(t));return i}function h(t,i){var r=n.length;while(r--)n[r].layer.loadQuadkeysForMercatorBounds(t,i)}function u(n,t){return t.zIndex-n.zIndex}function r(t,r){t instanceof at&&(r||(r=0),i(t.getId())===null&&(n.push({zIndex:r,layer:t}),n.sort(u)))}function e(t){if(t instanceof at){var r=i(t.getId());r!==null&&(n.splice(r,1),t.clearRequestedQuadkeys())}}function f(){return n.length}var t=this,s="microsoftMapsHotRegionsCacheCallback",n=[];t.addLayer=r,t.removeLayer=e,t.getLayerCount=f,t.getTileHotRegionsForQuadkey=c,t.loadQuadkeysForMercatorBounds=h,window[s]=o},l=new function(){this.tilePixelToLocation=function(n,t){var u=this._tilePixelToMapPixel(n,t),r=this._mapPixelToMercatorPoint(n.levelOfDetail,u);return it.toLocation(r)},this.tilePixelToMapPixel=function(n,t){return new f(n.x*1024+t.x,n.y*1024+t.y)},this.mapPixelToMercatorPoint=function(n,t){var i,r;return i=n<0?1/(1<<Math.abs(n)):1<<n,r=new f(t.x/i/1024,t.y/i/1024)},this.getMapTargetMercatorBounds=function(n){var r=n.getMode().tryPixelToMercatorPoint,u,t;if(r){var e=n.getHeight()/2,o=n.getWidth()/2,s=new f(-o,-e),i=r(s);return i.x=(i.x%1+1)%1,i.y=(i.y%1+1)%1,u=new f(o,e),t=r(u),t.x=(t.x%1+1)%1,t.y=(t.y%1+1)%1,{left:i.x,right:t.x,top:i.y,bottom:t.y}}return null},this.getQuadkeysForBounds=function(n){var h=n.levelOfDetails,o=n.tileIdXCount,c=n.tileIdYCount,a=n.tileIdX0,l=n.tileIdY0,s=n.tileIdCount,r=[],i,u,e,t,f;while(o--){i=c,u=(a+o)%s;while(i--)e=(l+i)%s,t=ti.fromTileId(new yt(h,u,e)),t.length===0&&(f=0,f++),r.push(t)}return r},this.getMercatorBoundsDescriptor=function(n,t,i){var u=gi.mercatorXYToTileId(n,i),o=gi.mercatorXYToTileId(t,i),r=1<<i,s=(o.x-u.x+r)%r+1,h=u.x,e,f;return s===1&&t.x<n.x&&(s=r,h=0),f=(o.y-u.y+r)%r+1,e=u.y,f===1&&t.y<n.y&&(f=r,e=0),{mercatorTL:n,mercatorBR:t,levelOfDetails:i,tileIdTL:u,tileIdBR:o,tileIdX0:h,tileIdY0:e,tileIdXCount:s,tileIdYCount:f,tileIdCount:r}},this.tileQuadkeyToSheetQuadkey=function(n){var i=n.length,t="l1";return i>2?t=n.substr(0,i-2):i===2&&(t="l2"),t}};dt.prototype={type:"polygon",getLocations:function(){var n,t;this._locations=[];var r=this._locations,u=this.getMercatorPoints(),i=u.length;while(i--)n=u[i],t=it.toLocation(n),r.push(t);return this.getLocations=function(){return this._locations},r},getMercatorPoints:function(){var n,t;this._mercatorPoints=[];var r=this._mercatorPoints,u=this.getMapPixels(),i=u.length;while(i--)n=u[i],t=l.mapPixelToMercatorPoint(this._tileId.levelOfDetail,n),r.push(t);return this.getMercatorPoints=function(){return this._mercatorPoints},r},getMapPixels:function(){var t;this._mapPixels=[];var i=this._mapPixels,r=this._quadkeyTilePoints,n=r.length;while(n--)t=l.tilePixelToMapPixel(this._tileId,r[n]),i.push(t);return this.getMapPixels=function(){return this._mapPixels},i},getMercatorBounds:function(){var e=null,o=null,f=null,u=null,t=this.getMercatorPoints(),n=t.length-1,i,r;if(n>-1){e=f=t[n].x,o=u=t[n].y;while(n--)i=t[n].x,r=t[n].y,i>e?e=i:i<f&&(f=i),r>o?o=r:r<u&&(u=r)}return this._mercatorBounds=new ii(f,u,e-f,o-u),this.getMercatorBounds=function(){return this._mercatorBounds},this._mercatorBounds},isMercatorPointInBoundRegion:function(n){for(var i=this.getMercatorPoints(),h=i.length-1,l=n.x,e=n.y,f=!1,t=0,r=h-1;t<h;r=t++){var u=i[t].y,o=i[r].y,s=i[t].x,c=i[r].x;u>e!=o>e&&l<(c-s)*(e-u)/(o-u)+s&&(f=!f)}return f}},bt.prototype={getLocations:function(){var n=this.getMercatorBounds(),o=new f(n.x,n.y),e=new f(n.getRight(),n.y),h=new f(n.getRight(),n.getBottom()),s=new f(n.x,n.getBottom()),t=it.toLocation(o),r=it.toLocation(e),i=it.toLocation(h),u=it.toLocation(s);return this._locationBounds=[t,r,i,u,t],this.getLocations=function(){return this._locationBounds},this._locationBounds},type:"circle",getLocationCenter:function(){return this._locationCenter=it.toLocation(this.getMercatorCenter()),this.getLocationCenter=function(){return this._locationCenter},this._locationCenter},getMercatorCenter:function(){return this._mercatorCenter=l.mapPixelToMercatorPoint(this._tileId.levelOfDetail,this.getMapCenter()),this.getMercatorPoints=function(){return this._mercatorCenter},this._mercatorCenter},getMercatorRadius:function(){return this._mercatorRadius=l.mapPixelToMercatorPoint(this._tileId.levelOfDetail,new f(0,this._quadkeyTilePointRadius)).y,this.getMercatorRadius=function(){return this._mercatorRadius},this._mercatorRadius},getPixelRadius:function(){return this._quadkeyTilePointRadius},getMapCenter:function(){return this._mapCenter=l.tilePixelToMapPixel(this._tileId,this._quadkeyTilePointCenter),this.getMapCenter=function(){return this._mapCenter},this._mapCenter},getMercatorBounds:function(){var i=this.getMercatorCenter(),n=this.getMercatorRadius(),t=2*n;return this._mercatorBounds=new ii(i.x-n,i.y-n,t,t),this.getMercatorBounds=function(){return this._mercatorBounds},this._mercatorBounds},isMercatorPointInBoundRegion:function(n){var r=this.getMercatorCenter(),u=this.getMercatorRadius(),t=n.x-r.x,i=n.y-r.y;return t*t+i*i-u*u<=0}};var i=a.ignoreEvent,s=a.stopPropagation,h=a.reportAction,o=a.invokeEvent,r=a.createElement,vt=a.createToolButton,ot=a.addIgnoreEvents,ci=a.removeIgnoreEvents,ht=a.isTouch,ni=a.addClass,tr=a.removeClass,ir=v.extend,si=v.isArray;st=sr.prototype,st.showOverlays=function(t){var r,i,v,f,a,e,o,u,w,k,l,b,s,p,h;if(this._map){r=this._map,i=new nt({className:"MicrosoftNav"}),t.showDashboard!==!1&&(t.showDualMapTypeSelector&&(i.setOptions({className:ni(i.getClassName(),"NavBar_typeButton_count2")}),t.mapTypes=[]),f=new nt({className:"OverlaysTL",stopPropagation:!0}),t.showBreadcrumb===!0&&(i.setOptions({className:ni(i.getClassName(),"NavBar_breadcrumb")}),f.push(new ki(t))),f.push(new li),f.push(new ai),t.showMapTypeSelector!==!1&&(a=new vi(t),f.push(a),v=new br(r,f,a)),i.push(f)),(t.showScalebar!==!1||t.showCopyright!==!1||t.showLogo!==!1)&&(o=new nt({className:"OverlaysBL"}),u=new nt({className:"OverlaysBR"}),t.showLogo!==!1&&(w=new oi(t),e=t.logoPosition==="bottomLeft"?o:u,e.push(w)),t.showScalebar!==!1&&(k=new ui,e=t.scalebarPosition==="bottomLeft"?o:u,e.push(k)),t.showCopyright!==!1&&(l={},t.copyrightStacked===!0&&(l.className="CopyrightContainer stacked"),b=new fi(l),e=t.copyrightPosition==="bottomLeft"?o:u,e.push(b)),t.copyrightPosition==="bottomRight"&&t.showLogo!==!1&&u.setOptions({className:"OverlaysBR-logoAware"}),u.getLength()>0&&i.push(u),o.getLength()>0&&i.push(o));function y(){var n=i.getClassName();s&&(n=tr(n,"MapTypeId_"+s)),s=r.getMapTypeId(),n=ni(n,"MapTypeId_"+s),i.setOptions({className:n})}p=n.addHandler(r,"maptypechanged",y),y();function d(){h&&(n.removeHandler(h),h=null,n.removeHandler(p))}h=n.addHandler(r,"ondispose",d),r.overlays=i,n.invoke(r,"overlayscreationstart",{map:r,overlays:i}),this._overlays||(this._overlays=new c(r),this._overlays.update()),v&&r.addComponent("navigationBar",v)}},st.showHotRegions=function(n){this._map&&new vr(this._map,n)},st.showVenueMapsExplorer=function(){this._map&&new lr(this._map)},st.authenticate=function(n){this._map&&(this._authentication=new ur(this._map,n))},st.getCredentials=function(n){this._map&&this._authentication.getCredentials(n)},c.renderers={},c.registerOverlay=function(n,t){c.renderers[n]=t},c.getRenderer=function(n){return c.renderers[n.toString()]},vi.prototype={_className:"NavBar_modeSelectorControlContainer",_mapTypes:null,_disableBirdseye:!1,getDomElement:g,getClassName:function(){return this._className},getMapTypes:function(){return this._mapTypes},getDisableBirdseye:function(){return this._disableBirdseye},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),si(t.mapTypes)&&(this._mapTypes=t.mapTypes,i=!0),typeof t.disableBirdseye=="boolean"&&(this._disableBirdseye=t.disableBirdseye,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[ModeSelectorControl]"}},c.registerOverlay("[ModeSelectorControl]",nu),ai.prototype={_className:"NavBar_zoomControlContainer",_zoomInVisible:!0,_zoomOutVisible:!0,_zoomBarVisible:!0,_zoomBarToggle:!0,getDomElement:g,getClassName:function(){return this._className},getZoomInVisible:function(){return this._zoomInVisible},getZoomOutVisible:function(){return this._zoomOutVisible},getZoomBarVisible:function(){return this._zoomBarVisible},getZoomBarToggle:function(){return this._zoomBarToggle},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),typeof t.zoomInVisible=="boolean"&&(this._zoomInVisible=t.zoomInVisible,i=!0),typeof t.zoomOutVisible=="boolean"&&(this._zoomOutVisible=t.zoomOutVisible,i=!0),typeof t.zoomBarVisible=="boolean"&&(this._zoomBarVisible=t.zoomBarVisible,i=!0),typeof t.zoomBarToggle=="boolean"&&(this._zoomBarToggle=t.zoomBarToggle,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[ZoomControl]"}},c.registerOverlay("[ZoomControl]",tu),li.prototype={_className:"NavBar_compassControlContainer",_compassVisible:!0,_rotateVisible:!0,getDomElement:g,getClassName:function(){return this._className},getCompassVisible:function(){return this._compassVisible},getRotateVisible:function(){return this._rotateVisible},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),typeof t.compassVisible=="boolean"&&(this._compassVisible=t.compassVisible,i=!0),typeof t.rotateVisible=="boolean"&&(this._rotateVisible=t.rotateVisible,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[CompassControl]"}},c.registerOverlay("[CompassControl]",hr),ir(nt,nr),tt=nt.prototype,tt.getDomElement=g,tt._className="",tt.getClassName=function(){return this._className},tt._stopPropagation=!1,tt.getStopPropagation=function(){return this._stopPropagation},tt.setOptions=function(t,i){var r=nt.superClass.setOptions.call(this,t,!0);return t&&(typeof t.className=="string"&&(this._className=t.className,r=!0),typeof t.stopPropagation=="boolean"&&(this._stopPropagation=t.stopPropagation,r=!0)),r&&!i&&n.invoke(this,"entitychanged",{entity:this}),r},tt.toString=function(){return"[OverlayEntityCollection]"},c.registerOverlay("[OverlayEntityCollection]",wr),fi.prototype={_className:"CopyrightContainer",getDomElement:g,getClassName:function(){return this._className},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[CopyrightControl]"}},c.registerOverlay("[CopyrightControl]",ar),oi.prototype={_className:"LogoContainer",_clickable:!0,_enableSearch:!0,getDomElement:g,getClassName:function(){return this._className},getClickable:function(){return this._clickable},getEnableSearch:function(){return this._enableSearch},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),typeof t.clickable=="boolean"&&(this._clickable=t.clickable,i=!0),typeof t.enableSearch=="boolean"&&(this._enableSearch=t.enableSearch,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[LogoControl]"}},c.registerOverlay("[LogoControl]",cr),ui.prototype={_className:"ScaleBarContainer",getDomElement:g,getClassName:function(){return this._className},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[ScalebarControl]"}},c.registerOverlay("[ScalebarControl]",er),ki.prototype={_className:"BreadcrumbContainer",getDomElement:g,getClassName:function(){return this._className},setOptions:function(t){if(t){var i=!1;typeof t.className=="string"&&(this._className=t.className,i=!0),i&&n.invoke(this,"entitychanged",{entity:this})}},toString:function(){return"[BreadcrumbControl]"}},c.registerOverlay("[BreadcrumbControl]",kr),delete window.Microsoft.Maps.initMapDelayCode,y.Dynamic&&y.Dynamic.done("Microsoft.Maps.Overlays"),hi.end("Map delay initialized","mapdelay")},Microsoft.Maps.Map&&Microsoft.Maps.initMapDelayCode&&window.Microsoft.Maps.initMapDelayCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initInfoboxRenderer=function(){function h(i){function f(t,i,r){if(u.hasHandler(t,i)){var f=n.Screen.get_mouse_pos(r),e=new v(h,"infobox",t,i,f.x,f.y,0,!1,r);u.invoke(t,i,e)}}var h=i,l="cm"+c.getNext(),r=l+"_etr";this.shouldDraw=function(n,t){return n.getVisible()&&(n.getClip()===!1?t.actualBounds.contains(n.getLocation()):t.currentBounds.contains(n.getLocation()))},this.update=function(c,l){var dt=l.customRenderer,rt=l.update,v,a=c[r],ht,nt,p,ft,di,pt,hi,it,st,w,g,b,ut,y,tt,k,lt,yt,ni,gi,d,li,ti,wt,ai,ot,bt,ei,ui,si,ci,vi,oi,wi,kt,vt;a?(rt=a.updateEntity||rt,a.updateEntity=!1):(v=t(null,s.safariRenderHack),a={dom:v},c[r]=a,rt=!0),v=a.dom,ht=c.getTypeName(),nt=c.getHtmlContent()==null||c.getTitle()!==null&&c.getTitle()!==""||c.getDescription()!==null&&c.getDescription()!="";if(rt){a.htmlContent!=null&&nt&&(a.htmlContent.style.display="none",a.infoBoxNode!=null&&(a.infoBoxNode.style.display=""));if(nt){a.infoBoxNode==null?(p=t("div"),v.appendChild(p),p.className=ht,a.infoBoxNode=p):(p=a.infoBoxNode,p.className=ht),c.getShowCloseButton()&&a.closeButtonNode==null&&nt?(ft=t("a"),di=document.createTextNode("x"),p.appendChild(ft),ft.className="infobox-close",ft.href="#",ft.appendChild(di),pt=function(n){n.preventDefault(),c.setOptions({visible:!1})},n(ft).add_event("click",pt).add_event("touchend",pt),a.closeButtonHideEvent=pt,a.closeButtonNode=ft):c.getShowCloseButton()&&nt||!a.closeButtonNode||(n(a.closeButtonNode).remove_event("click",a.closeButtonHideEvent).remove_event("touchend",a.closeButtonHideEvent),a.closeButtonHideEvent=null,p.removeChild(a.closeButtonNode),a.closeButtonNode=null),hi=c.getHeight()-55,c.getActions().length>0&&(hi-=32),it=c.getTitle(),it===""&&(it=null),st=c.getDescription(),st===""&&(st=null),w=a.contentNode,w==null&&nt?(w=t("div"),w.className="infobox-body",p.appendChild(w),a.contentNode=w):w==null||nt||(p.removeChild(w),a.contentNode=null),it!=null&&(a.titleDivNode==null?(g=t("div"),g.className="infobox-title",w.insertBefore(g,w.firstChild),a.titleDivNode=g):g=a.titleDivNode),b=a.titleLinkNode,b!=null&&(a.titleLinkHandler!=null&&(n(b).remove_event("click",a.titleLinkHandler).remove_event("touchend",a.titleLinkHandler),a.titleLinkHandler=null),b.firstChild&&b.removeChild(b.firstChild),g.removeChild(b),a.titleLinkNode=null,b=null),g!=null&&g.firstChild&&g.removeChild(g.firstChild),it==null&&a.titleDivNode!=null&&(w.removeChild(a.titleDivNode),a.titleDivNode=null),it!=null&&(c.getTitleClickHandler()!=null?(b=t("a"),g.appendChild(b),a.titleLinkNode=b,b.innerHTML=it,b.setAttribute("href","#"),n(b).add_event("click",c.getTitleClickHandler()).add_event("touchend",c.getTitleClickHandler()),a.titleLinkHandler=c.getTitleClickHandler()):g.innerHTML=it),it!==null&&c.getTitleAction()!==null&&(ut=c.getTitleAction(),a.titleAction=[],y=t("a"),y.className="infobox-titleActionLink",y.appendChild(document.createTextNode(ut.label)),ti=ut.url?ut.url:"#",y.setAttribute("href",ti),ut.urltarget&&y.setAttribute("target",ut.urltarget),g.appendChild(y),n(y).add_event("click",ut.eventHandler).add_event("touchend",ut.eventHandler)),tt=a.descriptionNode,st!=null&&tt==null&&(tt=t("div"),tt.cssText="height:"+hi+"px",tt.className="infobox-info",a.actionsNode?w.insertBefore(tt,a.actionsNode):w.appendChild(tt),a.descriptionNode=tt),st!=null?tt.innerHTML=st:tt&&(v.removeChild(tt),a.descriptionNode=null),k=c.getActions();if(k.length>0)if(a.actionsNode!=null){while(a.actionsNode.firstChild)a.actionsNode.removeChild(a.actionsNode.firstChild);lt=a.actionsNode}else lt=t("div"),a.actionsNode=lt,lt.className="infobox-actions",w.appendChild(lt);if(a.actionsEventHandlers!=null)try{while((yt=a.actionsEventHandlers.pop())!=null)n(yt.elem).remove_event("click",yt.event).remove_event("touchend",yt.event)}catch(rr){}if(k.length>0){for(ni=t("ul"),ni.className="infobox-actions-list",gi=[],a.actionsEventHandlers=[],d=0;d<k.length;d++){var ki=t("li"),y=t("a"),pi,ir=h.getImageryId();switch(ir){case"Aerial":case"EnhancedBirdseye":case"NativeBirdseye":pi="dark";break;default:pi="light"}li=k[d][pi+"Icon"]||k[d].icon,ti=k[d].url?k[d].url:"#",y.setAttribute("href",ti),k[d].urltarget&&y.setAttribute("target",k[d].urltarget),li?(y.className="icon",y.style.cssText="background: url("+li+") no-repeat 0 0;",y.innerHTML="&nbsp;"):y.innerHTML=k[d].label,ki.appendChild(y),ni.appendChild(ki),n(y).add_event("click",k[d].eventHandler).add_event("touchend",k[d].eventHandler),a.actionsEventHandlers.push({elem:y,event:k[d].eventHandler})}lt.appendChild(ni)}c.getShowPointer()&&a.pointerNode==null&&nt?(wt=t("div"),wt.className="infobox-stalk",p.appendChild(wt),a.pointerNode=wt):c.getShowPointer()&&nt||!a.pointerNode||(p.removeChild(a.pointerNode),a.pointerNode=null)}else ai=c.getHtmlContent(),ot=a.htmlContent,it==null&&st==null&&ai!=null&&(ot==null&&(ot=t("div"),v.appendChild(ot),a.htmlContent=ot),ot.innerHTML=ai,p=ot,a.infoBoxNode!=null&&(a.infoBoxNode.style.display="none"),a.pointerNode!=null&&(a.pointerNode.style.display="none"),v.style.pointerEvents="all")}var at="position:absolute;overflow:visible;white-space:normal;line-height:16px;pointer-events:none;",fi="position:absolute;background-color:white;border:1px solid rgb(136, 136, 136);left:0px;top:0px;pointer-events:auto;",yi="width:33px;height:38px;overflow:hidden;position:absolute;z-index:1;",ct=c.getClip();if(!dt&&(!l.linear||!a.isDrawn||ct===!1)){bt=h.tryLocationToPixel(c.getLocation(),ct===!1?o.control:o.viewport);if(bt){var bi=c.getOffset(),ii=c.getAnchor(),tr=ct===!1?0:l.parentOffsetLeft||0,nr=ct===!1?0:l.parentOffsetTop||0,gt=bt.x-tr,et=bt.y-nr;gt=gt+bi.x-ii.x,et=et-bi.y-ii.y,rt&&nt?(at+="left:"+gt+"px;",at+="top:"+et+"px;"):(v.style.position="absolute",v.style.left=gt+"px",v.style.top=et+"px",v.style.display="")}else rt?at+="display:none;":v.style.display="none"}if(rt&&nt){ei=c.getZIndex(),typeof ei=="number"&&(at+="z-index:"+ei+";"),fi+="width:"+c.getWidth()+"px;",fi+="height:"+c.getHeight()+"px;",ct===!1&&(v.className="MicrosoftMap"),v.style.cssText=at+s.safariRenderHack,yi+="left:20px;",yi+="top:"+c.getHeight()+"px;";if(ht==="Infobox")a.infoBoxNode.style.cssText=fi;else{var kt=c.getWidth(),vt=c.getHeight(),ri="";kt&&(ri+="width:"+kt+"px;"),vt&&(ri+="height:"+vt+"px;"),a.infoBoxNode.style.cssText=ri}c.getShowPointer()&&ht==="Infobox"&&(a.pointerNode.style.cssText=yi)}c.getShouldFireEvents()&&(a.mapImageryChanged||(ui=function(){u.invoke(c,"entitychanged",{entity:c})},u.addHandler(h,"imagerychanged",ui),a.mapImageryChanged=ui),a.mouseDoubleClickInfobox||(si=function(n){f(c,"dblclick",n),n.stopPropagation()},n(v).add_event("dblclick",si,!0),a.mouseDoubleClickInfobox=si),a.mouseEnterInfobox||(ci=function(n){f(c,"mouseenter",n),n.stopPropagation()},n(v).add_event("mouseenter",ci,!0),a.mouseEnterInfobox=ci),a.mouseLeaveInfobox||(vi=function(n){f(c,"mouseleave",n),n.stopPropagation()},n(v).add_event("mouseleave",vi,!0),a.mouseLeaveInfobox=vi),a.mouseClickInfobox||(oi=function(n){f(c,"click",n),n.stopPropagation()},n(v).add_event("click",oi,!1),a.mouseClickInfobox=oi),n(v).add_event("touchstart",e)),dt?a.isDrawn?rt&&dt.updateEntity(c):(dt.addEntity(c,v),a.isDrawn=!0):(a.isDrawn||(ct===!1?(wi=i.getRootElement().parentNode,wi.appendChild(v)):l.parentDom.appendChild(v),a.isDrawn=!0),p&&rt===!0&&(ht!==Microsoft.Maps.InfoboxType.standard||c.getHtmlContent()!==null)&&(kt=p.offsetWidth,vt=p.offsetHeight,c.setCalculatedSize({width:kt,height:vt}),et=et+ii.y-vt,v.style.top=et+"px"))},this.remove=function(t,i){if(t&&t[r]){var f=t[r],o=f.dom;o&&(u.removeHandler(f.mapImageryChanged),n(o).remove_event("mouseenter",f.mouseEnterInfobox,!0).remove_event("mouseleave",f.mouseLeaveInfobox,!0).remove_event("click",f.mouseClickInfobox,!1).remove_event("dblclick",f.mouseDoubleClickInfobox,!0).remove_event("touchstart",e,!1),f.mapImageryChanged=f.mouseEnterInfobox=f.mouseLeaveInfobox=f.mouseClickInfobox=f.mouseDoubleClickInfobox=null,!i.parentRemoved&&o.parentNode&&o.parentNode.removeChild(o)),f.updateEntity=f.updateEntity||i.update,f.isDrawn=!1,i.customRenderer&&i.customRenderer.removeEntity(t)}},this.dispose=function(n){delete n[r]}}var i=window.Microsoft.Maps,n=i.Gimme,y=i.Globals,u=i.Events,l=i.Infobox,o=i.PixelReference,r=i.InternalNamespaceForDelay,a=r.CompositeMode,f=r.Common,v=r.MouseEventArgs,a=r.CompositeMode,c=r.IdGenerator,s=r.Quirks,e=f.stopPropagation,t=f.createElement,e=f.stopPropagation,t=f.createElement;new function(){var n=[],t=[],i=function(i,r){var u=null,f;if(r instanceof l){f=n.length;while(f--)n[f]===i&&(u=t[f]);u||(u=new h(i),n.push(i),t.push(u))}return u};a.registerEntityRenderer(i)},delete window.Microsoft.Maps.initInfoboxRenderer},Microsoft.Maps.Map&&Microsoft.Maps.initInfoboxRenderer&&Microsoft.Maps.initInfoboxRenderer(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.Streetside=window.Microsoft.Maps.Streetside||{},window.Microsoft.Maps.initStreetsideAvailabilityCode=function(){function a(i,r,u){var e=i.bounds,a=i.center,p=i.radius||n.BlockLookupService.defaultRadiusInMeters,y,f,l,w,h;u=u||t.streetside360,u===t.streetside360?(y=n.CubeLookupService,f=[1,e],e instanceof s||(l=c(p),e=new s(a,l,l),f=[1,e])):(y=n.BlockLookupService,f=[a,p],a instanceof o||(w=v(e),f=[e.center,w])),h=nt(u,r),f.push(h.available,h.unavailable,h.error),y.lookup.apply(window,f)}function v(n){var i=n.height*h.earthCircumferenceInMeters/360,t=n.width*Math.cos(n.center.latitude*w.radiansPerDegree)*h.earthCircumferenceInMeters/360;return Math.floor(Math.sqrt(t*t+i*i)/2)}function c(n){return n*720/h.earthCircumferenceInMeters}function nt(n,i){function f(n){i(!0,{mapTypeId:t.streetside360,cubeID:n[1].id,center:new o(n[1].la,n[1].lo,n[1].al,g.ellipsoid),cubePitch:n[1].pi,cubeHeading:n[1].he,cubeRoll:n[1].ro})}function e(n,r){n.streetsideMetadata=r,n.mapTypeId=t.streetsideSlide,n.center=n.projectedLatitude!=null&&n.projectedLongitude!=null?new o(n.projectedLatitude,n.projectedLongitude):location,i(!0,n)}function r(){i(!1,null)}function u(){i(!1,null)}return{available:n===t.streetside360?f:e,unavailable:r,error:u}}var r=window.Microsoft.Maps,d=r.Map,y=r.Gimme,i=r.Globals,o=r.Location,s=r.LocationRect,t=r.MapTypeId,g=r.AltitudeReference,n=r.Streetside,u=r.InternalNamespaceForDelay,k=u.Dispatcher,h,w,p,l,e,b,f;u.Streetside=u.Streetside||{},h=u.MapMath,w=u.VectorMath,t.streetside360="ss360",t.streetsideSlide="ssSlide",p=1e6,l=8.5,n.isAvailabilityRectTooLarge=function(i,r){return r===t.streetsideSlide?n.isAvailabilityRadiusTooLarge(v(i),r):i.getNorth()-i.getSouth()>l||i.getEast()-i.getWest()>l},n.isAvailabilityRadiusTooLarge=function(i,r){if(r===t.streetsideSlide)return i>p;var u=c(i),f=new location(0,0);return n.isAvailabilityRectTooLarge(new s(f,u,u))},n.isValidMapTypeId=function(n){return n===t.streetside360||n===t.streetsideSlide},n.checkAvailabilityRadius=function(n,t,i,r){if(n instanceof o&&t>=0){var u={center:n,radius:t,bounds:{}};a(u,i,r)}else throw"Cannot invoke availability lookup service -- insufficient or invalid location and/or radius data";},n.checkAvailabilityRect=function(n,t,i){if(n instanceof s){var r={center:{},radius:null,bounds:n};a(r,t,i)}else throw"Cannot invoke availability lookup service -- insufficient or invalid locationRect";},u.Streetside.estimateRectHeightAndWidthFromRadius=c,d.prototype.isStreetside=function(){var n=this.getMapTypeId();return n===t.streetside360||t===n.streetsideSlide},e=n.Config,function(){if(e)return;n.Config={Debug:!0},e=n.Config}(),n.Debug=function(){this.assert=function(n,t){if(!n&&e.Debug)throw"assert failed: "+t;},this.log=function(n){var t=window.console||{};e.Debug&&t.log&&t.log(n)}},b=n.Debug=new n.Debug,f=new function(){var u,e=0,d="microsoftMapsStreetsideCacheableNetworkCallback{0}",g="microsoftMapsStreetsideNetworkCallback{0}",o=5e3,w=30,b=.5,nt=function(){return u||(u=y("HEAD").element()),u},t={},rt=function(){var i=0,n;for(n in t)t.hasOwnProperty(n)&&++i;return i},ut=function(n,t){return n.time>t.time?1:n.time<t.time?-1:0},tt=function(){var f=rt(),e=Math.floor(f*b),r,n,i=[],u;if(f>=w){for(r in t)t.hasOwnProperty(r)&&(u=t[r],u.id=r,i.push(u));for(i.sort(ut),n=0;n<f-e;++n)i[n].inflight===!1&&delete t[i[n].id]}},it=function(n,i){tt();if(t[n]){if(t[n].listeners.length>0){for(var r=0;r<t[n].listeners.length;++r)t[n].listeners[r](i);t[n].listeners.length=0}}else t[n]={},t[n].listeners=[];t[n].inflight=!1,t[n].data=i,t[n].time=new Date},c=function(n){delete t[n]},h=function(i,r,u){t[r]===undefined&&(t[r]={},t[r].listeners=[],t[r].inflight=!1),t[r].data!==undefined?(t[r].time=new Date,k.dispatch(n.Utils.createCallback(null,u,t[r].data))):(t[r].listeners.push(u),t[r].inflight||(t[r].inflight=!0,a(i,r)))},f=function(t,i,r){t?it(r,i):(n.Debug.log("timed out or 404ed id = "+r),c(r))},l=function(n){n&&(n.src&&(n.src=""),n.parentNode&&n.parentNode.removeChild(n))},r=function(n,t){var n=n,t=t;return function(){if(window[n]!==undefined)try{delete window[n]}catch(i){window[n]=null}l(y("#"+n).element()),t&&window.clearTimeout(t)}},p=function(n,t,i){var n=n,t=t,i=i,u=r(t,i);return function(t){f(!0,t,n),u()}},v=function(n,t){var n=n,t=t,i=r(t);return function(){f(!1,null,n),i()}},s=function(n,t){var i=document.createElement("script");i.type="text/javascript",i.language="javascript",i.src=n,i.id=t,nt().appendChild(i)},a=function(n,t){var i=d.replace("{0}",t),u=window.setTimeout(v(t,i),o),r;window[i]=p(t,i,u),r=n.replace("{callbackName}",i),s(r,i)};this.getChunkMetadataAsync=function(n,t,r){var u=i.streetsideChunkMetadataUriFormat.replace("{0}",i.locale).replace("{1}",t).replace("{2}",n).replace("{3}",i.streetsideTileGeneration).replace("{4}","{callbackName}");h(u,n,r)},this.getGlobalMetadataAsync=function(n,t,r){var u=i.streetsideGlobalMetadataUriFormat.replace("{0}",i.locale).replace("{1}",t).replace("{2}",n).replace("{3}",i.streetsideTileGeneration).replace("{4}","{callbackName}");h(u,n,r)},this.getJsonAsync=function(n,t){var i=g.replace("{0}",e),h=n.replace("{callbackName}",i),f=function(n,t,i){var u=r(n,t),i=i;return function(n){u(),i(n)}},u=window.setTimeout(r(i),o);window[i]=f(i,u,t),++e,s(h,i)}},n.MetadataService=f,n.BlockLookupService=new function(){this.defaultRadiusInMeters=20;var r=15,u=10,e=1e6,t=function(t,i,r){return function(u){u===null?i():u.statusCode&&u.statusCode!==200?(n.Debug.log("Invalid JSON data"+u.errorDetails),r(u)):u.bl&&u.smd?t(u.bl,u.smd):(n.Debug.log("Unexpected JSON response"),r(u))}};this.lookup=function(o,s,h,c,l){if(o&&o.latitude&&o.longitude&&s&&typeof h=="function"&&typeof c=="function"&&typeof l=="function"){s=Math.min(Math.max(s,u),e);var a=i.streetsideSingleBlockLookupWithDataUriFormat.replace("{0}",i.locale).replace("{1}",i.streetsideTileGeneration).replace("{2}",o.latitude.toFixed(r)).replace("{3}",o.longitude.toFixed(r)).replace("{4}",s).replace("{5}","{callbackName}");f.getJsonAsync(a,t(h,c,l))}else n.Debug.assert(!1,"Expected location, radius, and 3 callback functions as arguments")},this.tokenLookup=function(r,u,e,o){if(r&&typeof u=="function"&&typeof e=="function"&&typeof o=="function"){var s=i.streetsideSingleBlockTokenLookupWithDataUriFormat.replace("{0}",i.locale).replace("{1}",i.streetsideTileGeneration).replace("{2}",r).replace("{3}","{callbackName}");f.getJsonAsync(s,t(u,e,o))}else n.Debug.assert(!1,"Expected token, and 3 callback functions as arguments")}},n.CubeLookupService=new function(){function t(t,i,r){return function(u){u===null?(n.Debug.log("Unexpected JSON response"),r(u)):u.length>1?t(u):i()}}var r=i.streetsideCubeDataLookupUriFormat;this.lookup=function(i,u,e,o,s){i=i||1,o=o||function(){},s=s||function(){},n.Debug.assert(u&&e,"Minimum expected arguments: locationRect, and a callback function");var h=r.replace("{0}",i).replace("{1}",u.getNorth()).replace("{2}",u.getSouth()).replace("{3}",u.getEast()).replace("{4}",u.getWest()).replace("{5}","{callbackName}");f.getJsonAsync(h,t(e,o,s))}},delete window.Microsoft.Maps.initStreetsideAvailabilityCode},Microsoft.Maps.Map&&Microsoft.Maps.initStreetsideAvailabilityCode&&window.Microsoft.Maps.initStreetsideAvailabilityCode(),window.Microsoft=window.Microsoft||{},window.Microsoft.Maps=window.Microsoft.Maps||{},window.Microsoft.Maps.initMapAnalytics=function(){var n="length",o="indexOf",l="apply",r=window.Microsoft.Maps,c=r.Analytics=r.Analytics||{},f=r.Gimme,e=r.Globals,i=r.Events,u=r.InternalNamespaceForDelay,h=u.Common,t;if(!e.disableAnalytics){function s(r){function p(n){if(n&&n.currentTarget){var t=f(n.currentTarget).get_attr("uici");t&&w({uici:t,autoLog:!0})}}function ti(n){if(n){n.lod=u.getZoom().toPrecision(2),n.mo=u.getHeading().toPrecision(3);var t=u.getCenter();n.mc="["+t.latitude.toPrecision(6)+","+t.longitude.toPrecision(6)+"]",n.til=l,b=!1}}function ii(){var n=u.getTileDownloadMetrics();l=n>l?n:l+n,b=!0}function gt(){!b||u.isDownloadingTiles()||t.getDataBacklog()>0||w({})}function ni(n){n.componentName===ct&&(et(),i.removeHandler(nt),nt=null)}function et(){u&&u.overlays&&ot(u.overlays.getDomElement())}function at(){for(var r=y[n],t,i=0;i<r;i++)t=y.shift(),t[3]=c,rt.LogIG.apply(s,t)}function w(n){var e,o,r,i,u;if(n){var t=n.customData||{},f=a?v:n.IG||c,l=n.autoLog;ti(t),t.uici=n.uici;if(l)for(e in h)h[e](t);if(n&&n.onClientAction)n.onClientAction(t);o=n.forceDispatch||!1,r=[bt,0,o,f];for(i in t)u=t[i],i!==null&&i!==undefined&&u!==null&&u!==undefined&&r.push(i,u);f&&it?rt.LogIG.apply(s,r):y.push(r)}}function ot(n){f(n).select(ut).add_event(tt,p)}function yt(n){f(n).add_event(tt,p)}function pt(n,t){typeof n=="string"&&typeof t=="function"&&(h[n]=t)}function vt(n){typeof n=="string"&&delete h[n]}function lt(n){it||(n&&(c=n.pageViewId||null,v=n.sessionKey||null,g=n.cId||null,ft=n.pcId||null),(c||a&&v)&&(it=!0,at(),st=window.setInterval(gt,dt)))}function ht(){var r,n;window.clearInterval(st),t.dispose(),i.removeHandler(d),d=null,i.removeHandler(k),k=null;for(r in h)delete h[r];h=null,u&&u.overlays&&(n=f(u.overlays.getDomElement()),n.select(ut).remove_event(tt,p))}function wt(){u&&(d=i.addHandler(u,"ondispose",ht),u.getComponent(ct)?et():nt=i.addHandler(u,"componentadded",ni),u.addComponent("analyticsManager",s),k=i.addHandler(u,"tiledownloadcomplete",ii))}var s=r.getComponent("analyticsManager");if(s)return s;s=this;var c,g,ft=null,ut="a,input[type=button],input[type=submit],input[type=checkbox],input[type=radio],button,.button,.pathNode",bt="MAPSAction",tt="mousedown",h={},u=r,d=null,nt=null,it=!1,ct="navigationBar",y=[],v=null,a=e.frontdoorLogUrl?!1:!0,kt=e.biciLoggingService||e.frontdoorLogUrl,dt=3e4,st=-1,ri="tdd",l=0,b=!0,ui=null,k=null,rt=new function(){function w(){r("Init","CI","Base",!1),l=window.setInterval(h,y),v=1,f(window).add_event("beforeunload",s)}function r(i,r,u,f,e){var y="",w=e||c,v,l,h,p;if(w){if(f)for(v=0;v<f[n];v+=2)l=f[v],h=f[v+1],(typeof l!="string"||l[o]('"')<0)&&(l='"'+l+'"'),typeof h=="string"&&h[o]("{")<0&&h[o]('"')<0&&(h='"'+h+'"'),y+=l+":"+h+",";p='"TS":'+ +new Date,y+=a?p:'"T":"CI.'+i+'",'+(typeof r=="number"?'"K":'+r:'"FID":"'+r+'"')+","+p,t.add(w,y),u&&s()}}function b(){var n=kt;return n+=a?"?sk=%ig%&pid="+e.biciPID+"&DATA=":"?IG=%ig%"+(g?"&CID="+g:"")+(ft?"&PM=Y":"")+"&TYPE=Event.ClientInst&DATA="}function s(){while(t.getDataBacklog()>0)h()}function h(){if(t.getDataBacklog()>0&&!u.isDownloadingTiles()){var n=t.fetchNextRequest(b(),p);n&&(i.ping.src=n)}}var i=this,p=2048,y=2e3,v=0,l=-1;i.ping=new Image,i.LogIG=function(n,t,i,u){v||w(),r(n,t,i,[].slice.apply(arguments).slice(4),u)}};s.removePreProcessor=vt,s.addPreProcessor=pt,s.registerAction=yt,s.registerChildActions=ot,s.logClientAction=w,s.dispose=ht,s.enable=lt,wt()}c.AnalyticsManager=s}t=new function(){var t={},i=0;this.getDataBacklog=function(){return i},this.add=function(r,u){var f=t[r],u="{"+encodeURIComponent(u)+"}";f||(f=t[r]=[]),f.push(u),i+=u[n]},this.dispose=function(){for(var n in t)t.hasOwnProperty(n)&&(t[n]=null,delete t[n]);t={},i=0},this.fetchNextRequest=function(r,u){var l=null,e,s,v,o,a,f,c;if(typeof r=="string"&&u>0)for(e in t){s=e&&t[e],r=r.replace("%ig%",e),v=r[n]+e[n]+1;if(h.isArray(s)&&s[n]>0){o="[",a=!0;while(s[n]>0){f=s.shift();if(f){c=f[n],i-=c,f=(a?"":",")+f,c=f[n];if(c+o[n]+v>=u){l=r+o+"]";break}o+=f,a=!1}}l=r+o+"]",delete t[e];break}}return l}},delete window.Microsoft.Maps.initMapAnalytics,u&&u.Dynamic&&u.Dynamic.done("Microsoft.Maps.Analytics"),u&&u.PRF.end("Module initialized","Microsoft.Maps.Analytics",{module:"Analytics"})},Microsoft.Maps.Map&&Microsoft.Maps.initMapAnalytics&&window.Microsoft.Maps.initMapAnalytics()